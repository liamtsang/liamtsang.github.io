function jM(t,e){for(var n=0;n<e.length;n++){const i=e[n];if(typeof i!="string"&&!Array.isArray(i)){for(const s in i)if(s!=="default"&&!(s in t)){const c=Object.getOwnPropertyDescriptor(i,s);c&&Object.defineProperty(t,s,c.get?c:{enumerable:!0,get:()=>i[s]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const c of s)if(c.type==="childList")for(const d of c.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&i(d)}).observe(document,{childList:!0,subtree:!0});function n(s){const c={};return s.integrity&&(c.integrity=s.integrity),s.referrerPolicy&&(c.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?c.credentials="include":s.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function i(s){if(s.ep)return;s.ep=!0;const c=n(s);fetch(s.href,c)}})();var GM=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function sg(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var x2={exports:{}},tn={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $d=Symbol.for("react.element"),WM=Symbol.for("react.portal"),HM=Symbol.for("react.fragment"),$M=Symbol.for("react.strict_mode"),qM=Symbol.for("react.profiler"),ZM=Symbol.for("react.provider"),XM=Symbol.for("react.context"),YM=Symbol.for("react.forward_ref"),KM=Symbol.for("react.suspense"),JM=Symbol.for("react.memo"),QM=Symbol.for("react.lazy"),vb=Symbol.iterator;function eL(t){return t===null||typeof t!="object"?null:(t=vb&&t[vb]||t["@@iterator"],typeof t=="function"?t:null)}var b2={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},w2=Object.assign,E2={};function Uu(t,e,n){this.props=t,this.context=e,this.refs=E2,this.updater=n||b2}Uu.prototype.isReactComponent={};Uu.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};Uu.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function T2(){}T2.prototype=Uu.prototype;function vv(t,e,n){this.props=t,this.context=e,this.refs=E2,this.updater=n||b2}var xv=vv.prototype=new T2;xv.constructor=vv;w2(xv,Uu.prototype);xv.isPureReactComponent=!0;var xb=Array.isArray,S2=Object.prototype.hasOwnProperty,bv={current:null},A2={key:!0,ref:!0,__self:!0,__source:!0};function P2(t,e,n){var i,s={},c=null,d=null;if(e!=null)for(i in e.ref!==void 0&&(d=e.ref),e.key!==void 0&&(c=""+e.key),e)S2.call(e,i)&&!A2.hasOwnProperty(i)&&(s[i]=e[i]);var l=arguments.length-2;if(l===1)s.children=n;else if(1<l){for(var y=Array(l),w=0;w<l;w++)y[w]=arguments[w+2];s.children=y}if(t&&t.defaultProps)for(i in l=t.defaultProps,l)s[i]===void 0&&(s[i]=l[i]);return{$$typeof:$d,type:t,key:c,ref:d,props:s,_owner:bv.current}}function tL(t,e){return{$$typeof:$d,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function wv(t){return typeof t=="object"&&t!==null&&t.$$typeof===$d}function nL(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var bb=/\/+/g;function z_(t,e){return typeof t=="object"&&t!==null&&t.key!=null?nL(""+t.key):e.toString(36)}function Kp(t,e,n,i,s){var c=typeof t;(c==="undefined"||c==="boolean")&&(t=null);var d=!1;if(t===null)d=!0;else switch(c){case"string":case"number":d=!0;break;case"object":switch(t.$$typeof){case $d:case WM:d=!0}}if(d)return d=t,s=s(d),t=i===""?"."+z_(d,0):i,xb(s)?(n="",t!=null&&(n=t.replace(bb,"$&/")+"/"),Kp(s,e,n,"",function(w){return w})):s!=null&&(wv(s)&&(s=tL(s,n+(!s.key||d&&d.key===s.key?"":(""+s.key).replace(bb,"$&/")+"/")+t)),e.push(s)),1;if(d=0,i=i===""?".":i+":",xb(t))for(var l=0;l<t.length;l++){c=t[l];var y=i+z_(c,l);d+=Kp(c,e,n,y,s)}else if(y=eL(t),typeof y=="function")for(t=y.call(t),l=0;!(c=t.next()).done;)c=c.value,y=i+z_(c,l++),d+=Kp(c,e,n,y,s);else if(c==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return d}function up(t,e,n){if(t==null)return t;var i=[],s=0;return Kp(t,i,"","",function(c){return e.call(n,c,s++)}),i}function iL(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Er={current:null},Jp={transition:null},rL={ReactCurrentDispatcher:Er,ReactCurrentBatchConfig:Jp,ReactCurrentOwner:bv};tn.Children={map:up,forEach:function(t,e,n){up(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return up(t,function(){e++}),e},toArray:function(t){return up(t,function(e){return e})||[]},only:function(t){if(!wv(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};tn.Component=Uu;tn.Fragment=HM;tn.Profiler=qM;tn.PureComponent=vv;tn.StrictMode=$M;tn.Suspense=KM;tn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=rL;tn.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var i=w2({},t.props),s=t.key,c=t.ref,d=t._owner;if(e!=null){if(e.ref!==void 0&&(c=e.ref,d=bv.current),e.key!==void 0&&(s=""+e.key),t.type&&t.type.defaultProps)var l=t.type.defaultProps;for(y in e)S2.call(e,y)&&!A2.hasOwnProperty(y)&&(i[y]=e[y]===void 0&&l!==void 0?l[y]:e[y])}var y=arguments.length-2;if(y===1)i.children=n;else if(1<y){l=Array(y);for(var w=0;w<y;w++)l[w]=arguments[w+2];i.children=l}return{$$typeof:$d,type:t.type,key:s,ref:c,props:i,_owner:d}};tn.createContext=function(t){return t={$$typeof:XM,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:ZM,_context:t},t.Consumer=t};tn.createElement=P2;tn.createFactory=function(t){var e=P2.bind(null,t);return e.type=t,e};tn.createRef=function(){return{current:null}};tn.forwardRef=function(t){return{$$typeof:YM,render:t}};tn.isValidElement=wv;tn.lazy=function(t){return{$$typeof:QM,_payload:{_status:-1,_result:t},_init:iL}};tn.memo=function(t,e){return{$$typeof:JM,type:t,compare:e===void 0?null:e}};tn.startTransition=function(t){var e=Jp.transition;Jp.transition={};try{t()}finally{Jp.transition=e}};tn.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};tn.useCallback=function(t,e){return Er.current.useCallback(t,e)};tn.useContext=function(t){return Er.current.useContext(t)};tn.useDebugValue=function(){};tn.useDeferredValue=function(t){return Er.current.useDeferredValue(t)};tn.useEffect=function(t,e){return Er.current.useEffect(t,e)};tn.useId=function(){return Er.current.useId()};tn.useImperativeHandle=function(t,e,n){return Er.current.useImperativeHandle(t,e,n)};tn.useInsertionEffect=function(t,e){return Er.current.useInsertionEffect(t,e)};tn.useLayoutEffect=function(t,e){return Er.current.useLayoutEffect(t,e)};tn.useMemo=function(t,e){return Er.current.useMemo(t,e)};tn.useReducer=function(t,e,n){return Er.current.useReducer(t,e,n)};tn.useRef=function(t){return Er.current.useRef(t)};tn.useState=function(t){return Er.current.useState(t)};tn.useSyncExternalStore=function(t,e,n){return Er.current.useSyncExternalStore(t,e,n)};tn.useTransition=function(){return Er.current.useTransition()};tn.version="18.2.0";x2.exports=tn;var at=x2.exports;const Tn=sg(at);var I2={exports:{}},ls={},C2={exports:{}},M2={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(rt,At){var Ct=rt.length;rt.push(At);e:for(;0<Ct;){var an=Ct-1>>>1,ln=rt[an];if(0<s(ln,At))rt[an]=At,rt[Ct]=ln,Ct=an;else break e}}function n(rt){return rt.length===0?null:rt[0]}function i(rt){if(rt.length===0)return null;var At=rt[0],Ct=rt.pop();if(Ct!==At){rt[0]=Ct;e:for(var an=0,ln=rt.length,cr=ln>>>1;an<cr;){var li=2*(an+1)-1,Ai=rt[li],ci=li+1,pn=rt[ci];if(0>s(Ai,Ct))ci<ln&&0>s(pn,Ai)?(rt[an]=pn,rt[ci]=Ct,an=ci):(rt[an]=Ai,rt[li]=Ct,an=li);else if(ci<ln&&0>s(pn,Ct))rt[an]=pn,rt[ci]=Ct,an=ci;else break e}}return At}function s(rt,At){var Ct=rt.sortIndex-At.sortIndex;return Ct!==0?Ct:rt.id-At.id}if(typeof performance=="object"&&typeof performance.now=="function"){var c=performance;t.unstable_now=function(){return c.now()}}else{var d=Date,l=d.now();t.unstable_now=function(){return d.now()-l}}var y=[],w=[],S=1,C=null,P=3,D=!1,U=!1,H=!1,ae=typeof setTimeout=="function"?setTimeout:null,G=typeof clearTimeout=="function"?clearTimeout:null,V=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function W(rt){for(var At=n(w);At!==null;){if(At.callback===null)i(w);else if(At.startTime<=rt)i(w),At.sortIndex=At.expirationTime,e(y,At);else break;At=n(w)}}function ie(rt){if(H=!1,W(rt),!U)if(n(y)!==null)U=!0,Tt(ge);else{var At=n(w);At!==null&&Si(ie,At.startTime-rt)}}function ge(rt,At){U=!1,H&&(H=!1,G(Ne),Ne=-1),D=!0;var Ct=P;try{for(W(At),C=n(y);C!==null&&(!(C.expirationTime>At)||rt&&!vt());){var an=C.callback;if(typeof an=="function"){C.callback=null,P=C.priorityLevel;var ln=an(C.expirationTime<=At);At=t.unstable_now(),typeof ln=="function"?C.callback=ln:C===n(y)&&i(y),W(At)}else i(y);C=n(y)}if(C!==null)var cr=!0;else{var li=n(w);li!==null&&Si(ie,li.startTime-At),cr=!1}return cr}finally{C=null,P=Ct,D=!1}}var be=!1,De=null,Ne=-1,He=5,je=-1;function vt(){return!(t.unstable_now()-je<He)}function Nt(){if(De!==null){var rt=t.unstable_now();je=rt;var At=!0;try{At=De(!0,rt)}finally{At?Qt():(be=!1,De=null)}}else be=!1}var Qt;if(typeof V=="function")Qt=function(){V(Nt)};else if(typeof MessageChannel<"u"){var Bt=new MessageChannel,ai=Bt.port2;Bt.port1.onmessage=Nt,Qt=function(){ai.postMessage(null)}}else Qt=function(){ae(Nt,0)};function Tt(rt){De=rt,be||(be=!0,Qt())}function Si(rt,At){Ne=ae(function(){rt(t.unstable_now())},At)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(rt){rt.callback=null},t.unstable_continueExecution=function(){U||D||(U=!0,Tt(ge))},t.unstable_forceFrameRate=function(rt){0>rt||125<rt?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):He=0<rt?Math.floor(1e3/rt):5},t.unstable_getCurrentPriorityLevel=function(){return P},t.unstable_getFirstCallbackNode=function(){return n(y)},t.unstable_next=function(rt){switch(P){case 1:case 2:case 3:var At=3;break;default:At=P}var Ct=P;P=At;try{return rt()}finally{P=Ct}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(rt,At){switch(rt){case 1:case 2:case 3:case 4:case 5:break;default:rt=3}var Ct=P;P=rt;try{return At()}finally{P=Ct}},t.unstable_scheduleCallback=function(rt,At,Ct){var an=t.unstable_now();switch(typeof Ct=="object"&&Ct!==null?(Ct=Ct.delay,Ct=typeof Ct=="number"&&0<Ct?an+Ct:an):Ct=an,rt){case 1:var ln=-1;break;case 2:ln=250;break;case 5:ln=1073741823;break;case 4:ln=1e4;break;default:ln=5e3}return ln=Ct+ln,rt={id:S++,callback:At,priorityLevel:rt,startTime:Ct,expirationTime:ln,sortIndex:-1},Ct>an?(rt.sortIndex=Ct,e(w,rt),n(y)===null&&rt===n(w)&&(H?(G(Ne),Ne=-1):H=!0,Si(ie,Ct-an))):(rt.sortIndex=ln,e(y,rt),U||D||(U=!0,Tt(ge))),rt},t.unstable_shouldYield=vt,t.unstable_wrapCallback=function(rt){var At=P;return function(){var Ct=P;P=At;try{return rt.apply(this,arguments)}finally{P=Ct}}}})(M2);C2.exports=M2;var sL=C2.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var L2=at,as=sL;function Ge(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var k2=new Set,vd={};function Jl(t,e){bu(t,e),bu(t+"Capture",e)}function bu(t,e){for(vd[t]=e,t=0;t<e.length;t++)k2.add(e[t])}var Zo=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Hy=Object.prototype.hasOwnProperty,oL=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,wb={},Eb={};function aL(t){return Hy.call(Eb,t)?!0:Hy.call(wb,t)?!1:oL.test(t)?Eb[t]=!0:(wb[t]=!0,!1)}function lL(t,e,n,i){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return i?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function cL(t,e,n,i){if(e===null||typeof e>"u"||lL(t,e,n,i))return!0;if(i)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Tr(t,e,n,i,s,c,d){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=i,this.attributeNamespace=s,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=c,this.removeEmptyString=d}var $i={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){$i[t]=new Tr(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];$i[e]=new Tr(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){$i[t]=new Tr(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){$i[t]=new Tr(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){$i[t]=new Tr(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){$i[t]=new Tr(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){$i[t]=new Tr(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){$i[t]=new Tr(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){$i[t]=new Tr(t,5,!1,t.toLowerCase(),null,!1,!1)});var Ev=/[\-:]([a-z])/g;function Tv(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(Ev,Tv);$i[e]=new Tr(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(Ev,Tv);$i[e]=new Tr(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(Ev,Tv);$i[e]=new Tr(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){$i[t]=new Tr(t,1,!1,t.toLowerCase(),null,!1,!1)});$i.xlinkHref=new Tr("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){$i[t]=new Tr(t,1,!1,t.toLowerCase(),null,!0,!0)});function Sv(t,e,n,i){var s=$i.hasOwnProperty(e)?$i[e]:null;(s!==null?s.type!==0:i||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(cL(e,n,s,i)&&(n=null),i||s===null?aL(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):s.mustUseProperty?t[s.propertyName]=n===null?s.type===3?!1:"":n:(e=s.attributeName,i=s.attributeNamespace,n===null?t.removeAttribute(e):(s=s.type,n=s===3||s===4&&n===!0?"":""+n,i?t.setAttributeNS(i,e,n):t.setAttribute(e,n))))}var ta=L2.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,hp=Symbol.for("react.element"),Kc=Symbol.for("react.portal"),Jc=Symbol.for("react.fragment"),Av=Symbol.for("react.strict_mode"),$y=Symbol.for("react.profiler"),R2=Symbol.for("react.provider"),D2=Symbol.for("react.context"),Pv=Symbol.for("react.forward_ref"),qy=Symbol.for("react.suspense"),Zy=Symbol.for("react.suspense_list"),Iv=Symbol.for("react.memo"),Ma=Symbol.for("react.lazy"),z2=Symbol.for("react.offscreen"),Tb=Symbol.iterator;function Fh(t){return t===null||typeof t!="object"?null:(t=Tb&&t[Tb]||t["@@iterator"],typeof t=="function"?t:null)}var qn=Object.assign,O_;function ed(t){if(O_===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);O_=e&&e[1]||""}return`
`+O_+t}var F_=!1;function N_(t,e){if(!t||F_)return"";F_=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(w){var i=w}Reflect.construct(t,[],e)}else{try{e.call()}catch(w){i=w}t.call(e.prototype)}else{try{throw Error()}catch(w){i=w}t()}}catch(w){if(w&&i&&typeof w.stack=="string"){for(var s=w.stack.split(`
`),c=i.stack.split(`
`),d=s.length-1,l=c.length-1;1<=d&&0<=l&&s[d]!==c[l];)l--;for(;1<=d&&0<=l;d--,l--)if(s[d]!==c[l]){if(d!==1||l!==1)do if(d--,l--,0>l||s[d]!==c[l]){var y=`
`+s[d].replace(" at new "," at ");return t.displayName&&y.includes("<anonymous>")&&(y=y.replace("<anonymous>",t.displayName)),y}while(1<=d&&0<=l);break}}}finally{F_=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?ed(t):""}function uL(t){switch(t.tag){case 5:return ed(t.type);case 16:return ed("Lazy");case 13:return ed("Suspense");case 19:return ed("SuspenseList");case 0:case 2:case 15:return t=N_(t.type,!1),t;case 11:return t=N_(t.type.render,!1),t;case 1:return t=N_(t.type,!0),t;default:return""}}function Xy(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Jc:return"Fragment";case Kc:return"Portal";case $y:return"Profiler";case Av:return"StrictMode";case qy:return"Suspense";case Zy:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case D2:return(t.displayName||"Context")+".Consumer";case R2:return(t._context.displayName||"Context")+".Provider";case Pv:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case Iv:return e=t.displayName||null,e!==null?e:Xy(t.type)||"Memo";case Ma:e=t._payload,t=t._init;try{return Xy(t(e))}catch{}}return null}function hL(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Xy(e);case 8:return e===Av?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Xa(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function O2(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function dL(t){var e=O2(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),i=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var s=n.get,c=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return s.call(this)},set:function(d){i=""+d,c.call(this,d)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(d){i=""+d},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function dp(t){t._valueTracker||(t._valueTracker=dL(t))}function F2(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),i="";return t&&(i=O2(t)?t.checked?"true":"false":t.value),t=i,t!==n?(e.setValue(t),!0):!1}function ym(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function Yy(t,e){var n=e.checked;return qn({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function Sb(t,e){var n=e.defaultValue==null?"":e.defaultValue,i=e.checked!=null?e.checked:e.defaultChecked;n=Xa(e.value!=null?e.value:n),t._wrapperState={initialChecked:i,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function N2(t,e){e=e.checked,e!=null&&Sv(t,"checked",e,!1)}function Ky(t,e){N2(t,e);var n=Xa(e.value),i=e.type;if(n!=null)i==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(i==="submit"||i==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?Jy(t,e.type,n):e.hasOwnProperty("defaultValue")&&Jy(t,e.type,Xa(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function Ab(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var i=e.type;if(!(i!=="submit"&&i!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function Jy(t,e,n){(e!=="number"||ym(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var td=Array.isArray;function du(t,e,n,i){if(t=t.options,e){e={};for(var s=0;s<n.length;s++)e["$"+n[s]]=!0;for(n=0;n<t.length;n++)s=e.hasOwnProperty("$"+t[n].value),t[n].selected!==s&&(t[n].selected=s),s&&i&&(t[n].defaultSelected=!0)}else{for(n=""+Xa(n),e=null,s=0;s<t.length;s++){if(t[s].value===n){t[s].selected=!0,i&&(t[s].defaultSelected=!0);return}e!==null||t[s].disabled||(e=t[s])}e!==null&&(e.selected=!0)}}function Qy(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(Ge(91));return qn({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function Pb(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(Ge(92));if(td(n)){if(1<n.length)throw Error(Ge(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:Xa(n)}}function B2(t,e){var n=Xa(e.value),i=Xa(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),i!=null&&(t.defaultValue=""+i)}function Ib(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function U2(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function e0(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?U2(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var fp,V2=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,i,s){MSApp.execUnsafeLocalFunction(function(){return t(e,n,i,s)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(fp=fp||document.createElement("div"),fp.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=fp.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function xd(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var ad={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},fL=["Webkit","ms","Moz","O"];Object.keys(ad).forEach(function(t){fL.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),ad[e]=ad[t]})});function j2(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||ad.hasOwnProperty(t)&&ad[t]?(""+e).trim():e+"px"}function G2(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var i=n.indexOf("--")===0,s=j2(n,e[n],i);n==="float"&&(n="cssFloat"),i?t.setProperty(n,s):t[n]=s}}var pL=qn({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function t0(t,e){if(e){if(pL[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(Ge(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(Ge(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(Ge(61))}if(e.style!=null&&typeof e.style!="object")throw Error(Ge(62))}}function n0(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var i0=null;function Cv(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var r0=null,fu=null,pu=null;function Cb(t){if(t=Xd(t)){if(typeof r0!="function")throw Error(Ge(280));var e=t.stateNode;e&&(e=ug(e),r0(t.stateNode,t.type,e))}}function W2(t){fu?pu?pu.push(t):pu=[t]:fu=t}function H2(){if(fu){var t=fu,e=pu;if(pu=fu=null,Cb(t),e)for(t=0;t<e.length;t++)Cb(e[t])}}function $2(t,e){return t(e)}function q2(){}var B_=!1;function Z2(t,e,n){if(B_)return t(e,n);B_=!0;try{return $2(t,e,n)}finally{B_=!1,(fu!==null||pu!==null)&&(q2(),H2())}}function bd(t,e){var n=t.stateNode;if(n===null)return null;var i=ug(n);if(i===null)return null;n=i[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(t=t.type,i=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!i;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(Ge(231,e,typeof n));return n}var s0=!1;if(Zo)try{var Nh={};Object.defineProperty(Nh,"passive",{get:function(){s0=!0}}),window.addEventListener("test",Nh,Nh),window.removeEventListener("test",Nh,Nh)}catch{s0=!1}function mL(t,e,n,i,s,c,d,l,y){var w=Array.prototype.slice.call(arguments,3);try{e.apply(n,w)}catch(S){this.onError(S)}}var ld=!1,vm=null,xm=!1,o0=null,gL={onError:function(t){ld=!0,vm=t}};function _L(t,e,n,i,s,c,d,l,y){ld=!1,vm=null,mL.apply(gL,arguments)}function yL(t,e,n,i,s,c,d,l,y){if(_L.apply(this,arguments),ld){if(ld){var w=vm;ld=!1,vm=null}else throw Error(Ge(198));xm||(xm=!0,o0=w)}}function Ql(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function X2(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function Mb(t){if(Ql(t)!==t)throw Error(Ge(188))}function vL(t){var e=t.alternate;if(!e){if(e=Ql(t),e===null)throw Error(Ge(188));return e!==t?null:t}for(var n=t,i=e;;){var s=n.return;if(s===null)break;var c=s.alternate;if(c===null){if(i=s.return,i!==null){n=i;continue}break}if(s.child===c.child){for(c=s.child;c;){if(c===n)return Mb(s),t;if(c===i)return Mb(s),e;c=c.sibling}throw Error(Ge(188))}if(n.return!==i.return)n=s,i=c;else{for(var d=!1,l=s.child;l;){if(l===n){d=!0,n=s,i=c;break}if(l===i){d=!0,i=s,n=c;break}l=l.sibling}if(!d){for(l=c.child;l;){if(l===n){d=!0,n=c,i=s;break}if(l===i){d=!0,i=c,n=s;break}l=l.sibling}if(!d)throw Error(Ge(189))}}if(n.alternate!==i)throw Error(Ge(190))}if(n.tag!==3)throw Error(Ge(188));return n.stateNode.current===n?t:e}function Y2(t){return t=vL(t),t!==null?K2(t):null}function K2(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=K2(t);if(e!==null)return e;t=t.sibling}return null}var J2=as.unstable_scheduleCallback,Lb=as.unstable_cancelCallback,xL=as.unstable_shouldYield,bL=as.unstable_requestPaint,oi=as.unstable_now,wL=as.unstable_getCurrentPriorityLevel,Mv=as.unstable_ImmediatePriority,Q2=as.unstable_UserBlockingPriority,bm=as.unstable_NormalPriority,EL=as.unstable_LowPriority,eS=as.unstable_IdlePriority,og=null,xo=null;function TL(t){if(xo&&typeof xo.onCommitFiberRoot=="function")try{xo.onCommitFiberRoot(og,t,void 0,(t.current.flags&128)===128)}catch{}}var $s=Math.clz32?Math.clz32:PL,SL=Math.log,AL=Math.LN2;function PL(t){return t>>>=0,t===0?32:31-(SL(t)/AL|0)|0}var pp=64,mp=4194304;function nd(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function wm(t,e){var n=t.pendingLanes;if(n===0)return 0;var i=0,s=t.suspendedLanes,c=t.pingedLanes,d=n&268435455;if(d!==0){var l=d&~s;l!==0?i=nd(l):(c&=d,c!==0&&(i=nd(c)))}else d=n&~s,d!==0?i=nd(d):c!==0&&(i=nd(c));if(i===0)return 0;if(e!==0&&e!==i&&!(e&s)&&(s=i&-i,c=e&-e,s>=c||s===16&&(c&4194240)!==0))return e;if(i&4&&(i|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=i;0<e;)n=31-$s(e),s=1<<n,i|=t[n],e&=~s;return i}function IL(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function CL(t,e){for(var n=t.suspendedLanes,i=t.pingedLanes,s=t.expirationTimes,c=t.pendingLanes;0<c;){var d=31-$s(c),l=1<<d,y=s[d];y===-1?(!(l&n)||l&i)&&(s[d]=IL(l,e)):y<=e&&(t.expiredLanes|=l),c&=~l}}function a0(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function tS(){var t=pp;return pp<<=1,!(pp&4194240)&&(pp=64),t}function U_(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function qd(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-$s(e),t[e]=n}function ML(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var i=t.eventTimes;for(t=t.expirationTimes;0<n;){var s=31-$s(n),c=1<<s;e[s]=0,i[s]=-1,t[s]=-1,n&=~c}}function Lv(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var i=31-$s(n),s=1<<i;s&e|t[i]&e&&(t[i]|=e),n&=~s}}var bn=0;function nS(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var iS,kv,rS,sS,oS,l0=!1,gp=[],Ba=null,Ua=null,Va=null,wd=new Map,Ed=new Map,ka=[],LL="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function kb(t,e){switch(t){case"focusin":case"focusout":Ba=null;break;case"dragenter":case"dragleave":Ua=null;break;case"mouseover":case"mouseout":Va=null;break;case"pointerover":case"pointerout":wd.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ed.delete(e.pointerId)}}function Bh(t,e,n,i,s,c){return t===null||t.nativeEvent!==c?(t={blockedOn:e,domEventName:n,eventSystemFlags:i,nativeEvent:c,targetContainers:[s]},e!==null&&(e=Xd(e),e!==null&&kv(e)),t):(t.eventSystemFlags|=i,e=t.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),t)}function kL(t,e,n,i,s){switch(e){case"focusin":return Ba=Bh(Ba,t,e,n,i,s),!0;case"dragenter":return Ua=Bh(Ua,t,e,n,i,s),!0;case"mouseover":return Va=Bh(Va,t,e,n,i,s),!0;case"pointerover":var c=s.pointerId;return wd.set(c,Bh(wd.get(c)||null,t,e,n,i,s)),!0;case"gotpointercapture":return c=s.pointerId,Ed.set(c,Bh(Ed.get(c)||null,t,e,n,i,s)),!0}return!1}function aS(t){var e=zl(t.target);if(e!==null){var n=Ql(e);if(n!==null){if(e=n.tag,e===13){if(e=X2(n),e!==null){t.blockedOn=e,oS(t.priority,function(){rS(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Qp(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=c0(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var i=new n.constructor(n.type,n);i0=i,n.target.dispatchEvent(i),i0=null}else return e=Xd(n),e!==null&&kv(e),t.blockedOn=n,!1;e.shift()}return!0}function Rb(t,e,n){Qp(t)&&n.delete(e)}function RL(){l0=!1,Ba!==null&&Qp(Ba)&&(Ba=null),Ua!==null&&Qp(Ua)&&(Ua=null),Va!==null&&Qp(Va)&&(Va=null),wd.forEach(Rb),Ed.forEach(Rb)}function Uh(t,e){t.blockedOn===e&&(t.blockedOn=null,l0||(l0=!0,as.unstable_scheduleCallback(as.unstable_NormalPriority,RL)))}function Td(t){function e(s){return Uh(s,t)}if(0<gp.length){Uh(gp[0],t);for(var n=1;n<gp.length;n++){var i=gp[n];i.blockedOn===t&&(i.blockedOn=null)}}for(Ba!==null&&Uh(Ba,t),Ua!==null&&Uh(Ua,t),Va!==null&&Uh(Va,t),wd.forEach(e),Ed.forEach(e),n=0;n<ka.length;n++)i=ka[n],i.blockedOn===t&&(i.blockedOn=null);for(;0<ka.length&&(n=ka[0],n.blockedOn===null);)aS(n),n.blockedOn===null&&ka.shift()}var mu=ta.ReactCurrentBatchConfig,Em=!0;function DL(t,e,n,i){var s=bn,c=mu.transition;mu.transition=null;try{bn=1,Rv(t,e,n,i)}finally{bn=s,mu.transition=c}}function zL(t,e,n,i){var s=bn,c=mu.transition;mu.transition=null;try{bn=4,Rv(t,e,n,i)}finally{bn=s,mu.transition=c}}function Rv(t,e,n,i){if(Em){var s=c0(t,e,n,i);if(s===null)Y_(t,e,i,Tm,n),kb(t,i);else if(kL(s,t,e,n,i))i.stopPropagation();else if(kb(t,i),e&4&&-1<LL.indexOf(t)){for(;s!==null;){var c=Xd(s);if(c!==null&&iS(c),c=c0(t,e,n,i),c===null&&Y_(t,e,i,Tm,n),c===s)break;s=c}s!==null&&i.stopPropagation()}else Y_(t,e,i,null,n)}}var Tm=null;function c0(t,e,n,i){if(Tm=null,t=Cv(i),t=zl(t),t!==null)if(e=Ql(t),e===null)t=null;else if(n=e.tag,n===13){if(t=X2(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return Tm=t,null}function lS(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(wL()){case Mv:return 1;case Q2:return 4;case bm:case EL:return 16;case eS:return 536870912;default:return 16}default:return 16}}var Da=null,Dv=null,em=null;function cS(){if(em)return em;var t,e=Dv,n=e.length,i,s="value"in Da?Da.value:Da.textContent,c=s.length;for(t=0;t<n&&e[t]===s[t];t++);var d=n-t;for(i=1;i<=d&&e[n-i]===s[c-i];i++);return em=s.slice(t,1<i?1-i:void 0)}function tm(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function _p(){return!0}function Db(){return!1}function cs(t){function e(n,i,s,c,d){this._reactName=n,this._targetInst=s,this.type=i,this.nativeEvent=c,this.target=d,this.currentTarget=null;for(var l in t)t.hasOwnProperty(l)&&(n=t[l],this[l]=n?n(c):c[l]);return this.isDefaultPrevented=(c.defaultPrevented!=null?c.defaultPrevented:c.returnValue===!1)?_p:Db,this.isPropagationStopped=Db,this}return qn(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=_p)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=_p)},persist:function(){},isPersistent:_p}),e}var Vu={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},zv=cs(Vu),Zd=qn({},Vu,{view:0,detail:0}),OL=cs(Zd),V_,j_,Vh,ag=qn({},Zd,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Ov,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Vh&&(Vh&&t.type==="mousemove"?(V_=t.screenX-Vh.screenX,j_=t.screenY-Vh.screenY):j_=V_=0,Vh=t),V_)},movementY:function(t){return"movementY"in t?t.movementY:j_}}),zb=cs(ag),FL=qn({},ag,{dataTransfer:0}),NL=cs(FL),BL=qn({},Zd,{relatedTarget:0}),G_=cs(BL),UL=qn({},Vu,{animationName:0,elapsedTime:0,pseudoElement:0}),VL=cs(UL),jL=qn({},Vu,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),GL=cs(jL),WL=qn({},Vu,{data:0}),Ob=cs(WL),HL={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},$L={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},qL={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function ZL(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=qL[t])?!!e[t]:!1}function Ov(){return ZL}var XL=qn({},Zd,{key:function(t){if(t.key){var e=HL[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=tm(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?$L[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Ov,charCode:function(t){return t.type==="keypress"?tm(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?tm(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),YL=cs(XL),KL=qn({},ag,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Fb=cs(KL),JL=qn({},Zd,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Ov}),QL=cs(JL),ek=qn({},Vu,{propertyName:0,elapsedTime:0,pseudoElement:0}),tk=cs(ek),nk=qn({},ag,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),ik=cs(nk),rk=[9,13,27,32],Fv=Zo&&"CompositionEvent"in window,cd=null;Zo&&"documentMode"in document&&(cd=document.documentMode);var sk=Zo&&"TextEvent"in window&&!cd,uS=Zo&&(!Fv||cd&&8<cd&&11>=cd),Nb=String.fromCharCode(32),Bb=!1;function hS(t,e){switch(t){case"keyup":return rk.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function dS(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Qc=!1;function ok(t,e){switch(t){case"compositionend":return dS(e);case"keypress":return e.which!==32?null:(Bb=!0,Nb);case"textInput":return t=e.data,t===Nb&&Bb?null:t;default:return null}}function ak(t,e){if(Qc)return t==="compositionend"||!Fv&&hS(t,e)?(t=cS(),em=Dv=Da=null,Qc=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return uS&&e.locale!=="ko"?null:e.data;default:return null}}var lk={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Ub(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!lk[t.type]:e==="textarea"}function fS(t,e,n,i){W2(i),e=Sm(e,"onChange"),0<e.length&&(n=new zv("onChange","change",null,n,i),t.push({event:n,listeners:e}))}var ud=null,Sd=null;function ck(t){TS(t,0)}function lg(t){var e=nu(t);if(F2(e))return t}function uk(t,e){if(t==="change")return e}var pS=!1;if(Zo){var W_;if(Zo){var H_="oninput"in document;if(!H_){var Vb=document.createElement("div");Vb.setAttribute("oninput","return;"),H_=typeof Vb.oninput=="function"}W_=H_}else W_=!1;pS=W_&&(!document.documentMode||9<document.documentMode)}function jb(){ud&&(ud.detachEvent("onpropertychange",mS),Sd=ud=null)}function mS(t){if(t.propertyName==="value"&&lg(Sd)){var e=[];fS(e,Sd,t,Cv(t)),Z2(ck,e)}}function hk(t,e,n){t==="focusin"?(jb(),ud=e,Sd=n,ud.attachEvent("onpropertychange",mS)):t==="focusout"&&jb()}function dk(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return lg(Sd)}function fk(t,e){if(t==="click")return lg(e)}function pk(t,e){if(t==="input"||t==="change")return lg(e)}function mk(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Zs=typeof Object.is=="function"?Object.is:mk;function Ad(t,e){if(Zs(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var s=n[i];if(!Hy.call(e,s)||!Zs(t[s],e[s]))return!1}return!0}function Gb(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function Wb(t,e){var n=Gb(t);t=0;for(var i;n;){if(n.nodeType===3){if(i=t+n.textContent.length,t<=e&&i>=e)return{node:n,offset:e-t};t=i}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=Gb(n)}}function gS(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?gS(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function _S(){for(var t=window,e=ym();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=ym(t.document)}return e}function Nv(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function gk(t){var e=_S(),n=t.focusedElem,i=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&gS(n.ownerDocument.documentElement,n)){if(i!==null&&Nv(n)){if(e=i.start,t=i.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var s=n.textContent.length,c=Math.min(i.start,s);i=i.end===void 0?c:Math.min(i.end,s),!t.extend&&c>i&&(s=i,i=c,c=s),s=Wb(n,c);var d=Wb(n,i);s&&d&&(t.rangeCount!==1||t.anchorNode!==s.node||t.anchorOffset!==s.offset||t.focusNode!==d.node||t.focusOffset!==d.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),t.removeAllRanges(),c>i?(t.addRange(e),t.extend(d.node,d.offset)):(e.setEnd(d.node,d.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var _k=Zo&&"documentMode"in document&&11>=document.documentMode,eu=null,u0=null,hd=null,h0=!1;function Hb(t,e,n){var i=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;h0||eu==null||eu!==ym(i)||(i=eu,"selectionStart"in i&&Nv(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),hd&&Ad(hd,i)||(hd=i,i=Sm(u0,"onSelect"),0<i.length&&(e=new zv("onSelect","select",null,e,n),t.push({event:e,listeners:i}),e.target=eu)))}function yp(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var tu={animationend:yp("Animation","AnimationEnd"),animationiteration:yp("Animation","AnimationIteration"),animationstart:yp("Animation","AnimationStart"),transitionend:yp("Transition","TransitionEnd")},$_={},yS={};Zo&&(yS=document.createElement("div").style,"AnimationEvent"in window||(delete tu.animationend.animation,delete tu.animationiteration.animation,delete tu.animationstart.animation),"TransitionEvent"in window||delete tu.transitionend.transition);function cg(t){if($_[t])return $_[t];if(!tu[t])return t;var e=tu[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in yS)return $_[t]=e[n];return t}var vS=cg("animationend"),xS=cg("animationiteration"),bS=cg("animationstart"),wS=cg("transitionend"),ES=new Map,$b="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ja(t,e){ES.set(t,e),Jl(e,[t])}for(var q_=0;q_<$b.length;q_++){var Z_=$b[q_],yk=Z_.toLowerCase(),vk=Z_[0].toUpperCase()+Z_.slice(1);Ja(yk,"on"+vk)}Ja(vS,"onAnimationEnd");Ja(xS,"onAnimationIteration");Ja(bS,"onAnimationStart");Ja("dblclick","onDoubleClick");Ja("focusin","onFocus");Ja("focusout","onBlur");Ja(wS,"onTransitionEnd");bu("onMouseEnter",["mouseout","mouseover"]);bu("onMouseLeave",["mouseout","mouseover"]);bu("onPointerEnter",["pointerout","pointerover"]);bu("onPointerLeave",["pointerout","pointerover"]);Jl("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Jl("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Jl("onBeforeInput",["compositionend","keypress","textInput","paste"]);Jl("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Jl("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Jl("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var id="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),xk=new Set("cancel close invalid load scroll toggle".split(" ").concat(id));function qb(t,e,n){var i=t.type||"unknown-event";t.currentTarget=n,yL(i,e,void 0,t),t.currentTarget=null}function TS(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var i=t[n],s=i.event;i=i.listeners;e:{var c=void 0;if(e)for(var d=i.length-1;0<=d;d--){var l=i[d],y=l.instance,w=l.currentTarget;if(l=l.listener,y!==c&&s.isPropagationStopped())break e;qb(s,l,w),c=y}else for(d=0;d<i.length;d++){if(l=i[d],y=l.instance,w=l.currentTarget,l=l.listener,y!==c&&s.isPropagationStopped())break e;qb(s,l,w),c=y}}}if(xm)throw t=o0,xm=!1,o0=null,t}function Dn(t,e){var n=e[g0];n===void 0&&(n=e[g0]=new Set);var i=t+"__bubble";n.has(i)||(SS(e,t,2,!1),n.add(i))}function X_(t,e,n){var i=0;e&&(i|=4),SS(n,t,i,e)}var vp="_reactListening"+Math.random().toString(36).slice(2);function Pd(t){if(!t[vp]){t[vp]=!0,k2.forEach(function(n){n!=="selectionchange"&&(xk.has(n)||X_(n,!1,t),X_(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[vp]||(e[vp]=!0,X_("selectionchange",!1,e))}}function SS(t,e,n,i){switch(lS(e)){case 1:var s=DL;break;case 4:s=zL;break;default:s=Rv}n=s.bind(null,e,n,t),s=void 0,!s0||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),i?s!==void 0?t.addEventListener(e,n,{capture:!0,passive:s}):t.addEventListener(e,n,!0):s!==void 0?t.addEventListener(e,n,{passive:s}):t.addEventListener(e,n,!1)}function Y_(t,e,n,i,s){var c=i;if(!(e&1)&&!(e&2)&&i!==null)e:for(;;){if(i===null)return;var d=i.tag;if(d===3||d===4){var l=i.stateNode.containerInfo;if(l===s||l.nodeType===8&&l.parentNode===s)break;if(d===4)for(d=i.return;d!==null;){var y=d.tag;if((y===3||y===4)&&(y=d.stateNode.containerInfo,y===s||y.nodeType===8&&y.parentNode===s))return;d=d.return}for(;l!==null;){if(d=zl(l),d===null)return;if(y=d.tag,y===5||y===6){i=c=d;continue e}l=l.parentNode}}i=i.return}Z2(function(){var w=c,S=Cv(n),C=[];e:{var P=ES.get(t);if(P!==void 0){var D=zv,U=t;switch(t){case"keypress":if(tm(n)===0)break e;case"keydown":case"keyup":D=YL;break;case"focusin":U="focus",D=G_;break;case"focusout":U="blur",D=G_;break;case"beforeblur":case"afterblur":D=G_;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":D=zb;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":D=NL;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":D=QL;break;case vS:case xS:case bS:D=VL;break;case wS:D=tk;break;case"scroll":D=OL;break;case"wheel":D=ik;break;case"copy":case"cut":case"paste":D=GL;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":D=Fb}var H=(e&4)!==0,ae=!H&&t==="scroll",G=H?P!==null?P+"Capture":null:P;H=[];for(var V=w,W;V!==null;){W=V;var ie=W.stateNode;if(W.tag===5&&ie!==null&&(W=ie,G!==null&&(ie=bd(V,G),ie!=null&&H.push(Id(V,ie,W)))),ae)break;V=V.return}0<H.length&&(P=new D(P,U,null,n,S),C.push({event:P,listeners:H}))}}if(!(e&7)){e:{if(P=t==="mouseover"||t==="pointerover",D=t==="mouseout"||t==="pointerout",P&&n!==i0&&(U=n.relatedTarget||n.fromElement)&&(zl(U)||U[Xo]))break e;if((D||P)&&(P=S.window===S?S:(P=S.ownerDocument)?P.defaultView||P.parentWindow:window,D?(U=n.relatedTarget||n.toElement,D=w,U=U?zl(U):null,U!==null&&(ae=Ql(U),U!==ae||U.tag!==5&&U.tag!==6)&&(U=null)):(D=null,U=w),D!==U)){if(H=zb,ie="onMouseLeave",G="onMouseEnter",V="mouse",(t==="pointerout"||t==="pointerover")&&(H=Fb,ie="onPointerLeave",G="onPointerEnter",V="pointer"),ae=D==null?P:nu(D),W=U==null?P:nu(U),P=new H(ie,V+"leave",D,n,S),P.target=ae,P.relatedTarget=W,ie=null,zl(S)===w&&(H=new H(G,V+"enter",U,n,S),H.target=W,H.relatedTarget=ae,ie=H),ae=ie,D&&U)t:{for(H=D,G=U,V=0,W=H;W;W=Lc(W))V++;for(W=0,ie=G;ie;ie=Lc(ie))W++;for(;0<V-W;)H=Lc(H),V--;for(;0<W-V;)G=Lc(G),W--;for(;V--;){if(H===G||G!==null&&H===G.alternate)break t;H=Lc(H),G=Lc(G)}H=null}else H=null;D!==null&&Zb(C,P,D,H,!1),U!==null&&ae!==null&&Zb(C,ae,U,H,!0)}}e:{if(P=w?nu(w):window,D=P.nodeName&&P.nodeName.toLowerCase(),D==="select"||D==="input"&&P.type==="file")var ge=uk;else if(Ub(P))if(pS)ge=pk;else{ge=dk;var be=hk}else(D=P.nodeName)&&D.toLowerCase()==="input"&&(P.type==="checkbox"||P.type==="radio")&&(ge=fk);if(ge&&(ge=ge(t,w))){fS(C,ge,n,S);break e}be&&be(t,P,w),t==="focusout"&&(be=P._wrapperState)&&be.controlled&&P.type==="number"&&Jy(P,"number",P.value)}switch(be=w?nu(w):window,t){case"focusin":(Ub(be)||be.contentEditable==="true")&&(eu=be,u0=w,hd=null);break;case"focusout":hd=u0=eu=null;break;case"mousedown":h0=!0;break;case"contextmenu":case"mouseup":case"dragend":h0=!1,Hb(C,n,S);break;case"selectionchange":if(_k)break;case"keydown":case"keyup":Hb(C,n,S)}var De;if(Fv)e:{switch(t){case"compositionstart":var Ne="onCompositionStart";break e;case"compositionend":Ne="onCompositionEnd";break e;case"compositionupdate":Ne="onCompositionUpdate";break e}Ne=void 0}else Qc?hS(t,n)&&(Ne="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(Ne="onCompositionStart");Ne&&(uS&&n.locale!=="ko"&&(Qc||Ne!=="onCompositionStart"?Ne==="onCompositionEnd"&&Qc&&(De=cS()):(Da=S,Dv="value"in Da?Da.value:Da.textContent,Qc=!0)),be=Sm(w,Ne),0<be.length&&(Ne=new Ob(Ne,t,null,n,S),C.push({event:Ne,listeners:be}),De?Ne.data=De:(De=dS(n),De!==null&&(Ne.data=De)))),(De=sk?ok(t,n):ak(t,n))&&(w=Sm(w,"onBeforeInput"),0<w.length&&(S=new Ob("onBeforeInput","beforeinput",null,n,S),C.push({event:S,listeners:w}),S.data=De))}TS(C,e)})}function Id(t,e,n){return{instance:t,listener:e,currentTarget:n}}function Sm(t,e){for(var n=e+"Capture",i=[];t!==null;){var s=t,c=s.stateNode;s.tag===5&&c!==null&&(s=c,c=bd(t,n),c!=null&&i.unshift(Id(t,c,s)),c=bd(t,e),c!=null&&i.push(Id(t,c,s))),t=t.return}return i}function Lc(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function Zb(t,e,n,i,s){for(var c=e._reactName,d=[];n!==null&&n!==i;){var l=n,y=l.alternate,w=l.stateNode;if(y!==null&&y===i)break;l.tag===5&&w!==null&&(l=w,s?(y=bd(n,c),y!=null&&d.unshift(Id(n,y,l))):s||(y=bd(n,c),y!=null&&d.push(Id(n,y,l)))),n=n.return}d.length!==0&&t.push({event:e,listeners:d})}var bk=/\r\n?/g,wk=/\u0000|\uFFFD/g;function Xb(t){return(typeof t=="string"?t:""+t).replace(bk,`
`).replace(wk,"")}function xp(t,e,n){if(e=Xb(e),Xb(t)!==e&&n)throw Error(Ge(425))}function Am(){}var d0=null,f0=null;function p0(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var m0=typeof setTimeout=="function"?setTimeout:void 0,Ek=typeof clearTimeout=="function"?clearTimeout:void 0,Yb=typeof Promise=="function"?Promise:void 0,Tk=typeof queueMicrotask=="function"?queueMicrotask:typeof Yb<"u"?function(t){return Yb.resolve(null).then(t).catch(Sk)}:m0;function Sk(t){setTimeout(function(){throw t})}function K_(t,e){var n=e,i=0;do{var s=n.nextSibling;if(t.removeChild(n),s&&s.nodeType===8)if(n=s.data,n==="/$"){if(i===0){t.removeChild(s),Td(e);return}i--}else n!=="$"&&n!=="$?"&&n!=="$!"||i++;n=s}while(n);Td(e)}function ja(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function Kb(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var ju=Math.random().toString(36).slice(2),go="__reactFiber$"+ju,Cd="__reactProps$"+ju,Xo="__reactContainer$"+ju,g0="__reactEvents$"+ju,Ak="__reactListeners$"+ju,Pk="__reactHandles$"+ju;function zl(t){var e=t[go];if(e)return e;for(var n=t.parentNode;n;){if(e=n[Xo]||n[go]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=Kb(t);t!==null;){if(n=t[go])return n;t=Kb(t)}return e}t=n,n=t.parentNode}return null}function Xd(t){return t=t[go]||t[Xo],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function nu(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(Ge(33))}function ug(t){return t[Cd]||null}var _0=[],iu=-1;function Qa(t){return{current:t}}function zn(t){0>iu||(t.current=_0[iu],_0[iu]=null,iu--)}function kn(t,e){iu++,_0[iu]=t.current,t.current=e}var Ya={},lr=Qa(Ya),zr=Qa(!1),Gl=Ya;function wu(t,e){var n=t.type.contextTypes;if(!n)return Ya;var i=t.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===e)return i.__reactInternalMemoizedMaskedChildContext;var s={},c;for(c in n)s[c]=e[c];return i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=s),s}function Or(t){return t=t.childContextTypes,t!=null}function Pm(){zn(zr),zn(lr)}function Jb(t,e,n){if(lr.current!==Ya)throw Error(Ge(168));kn(lr,e),kn(zr,n)}function AS(t,e,n){var i=t.stateNode;if(e=e.childContextTypes,typeof i.getChildContext!="function")return n;i=i.getChildContext();for(var s in i)if(!(s in e))throw Error(Ge(108,hL(t)||"Unknown",s));return qn({},n,i)}function Im(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Ya,Gl=lr.current,kn(lr,t),kn(zr,zr.current),!0}function Qb(t,e,n){var i=t.stateNode;if(!i)throw Error(Ge(169));n?(t=AS(t,e,Gl),i.__reactInternalMemoizedMergedChildContext=t,zn(zr),zn(lr),kn(lr,t)):zn(zr),kn(zr,n)}var jo=null,hg=!1,J_=!1;function PS(t){jo===null?jo=[t]:jo.push(t)}function Ik(t){hg=!0,PS(t)}function el(){if(!J_&&jo!==null){J_=!0;var t=0,e=bn;try{var n=jo;for(bn=1;t<n.length;t++){var i=n[t];do i=i(!0);while(i!==null)}jo=null,hg=!1}catch(s){throw jo!==null&&(jo=jo.slice(t+1)),J2(Mv,el),s}finally{bn=e,J_=!1}}return null}var ru=[],su=0,Cm=null,Mm=0,Ts=[],Ss=0,Wl=null,Ho=1,$o="";function kl(t,e){ru[su++]=Mm,ru[su++]=Cm,Cm=t,Mm=e}function IS(t,e,n){Ts[Ss++]=Ho,Ts[Ss++]=$o,Ts[Ss++]=Wl,Wl=t;var i=Ho;t=$o;var s=32-$s(i)-1;i&=~(1<<s),n+=1;var c=32-$s(e)+s;if(30<c){var d=s-s%5;c=(i&(1<<d)-1).toString(32),i>>=d,s-=d,Ho=1<<32-$s(e)+s|n<<s|i,$o=c+t}else Ho=1<<c|n<<s|i,$o=t}function Bv(t){t.return!==null&&(kl(t,1),IS(t,1,0))}function Uv(t){for(;t===Cm;)Cm=ru[--su],ru[su]=null,Mm=ru[--su],ru[su]=null;for(;t===Wl;)Wl=Ts[--Ss],Ts[Ss]=null,$o=Ts[--Ss],Ts[Ss]=null,Ho=Ts[--Ss],Ts[Ss]=null}var ss=null,is=null,Bn=!1,Ws=null;function CS(t,e){var n=As(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function ew(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,ss=t,is=ja(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,ss=t,is=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=Wl!==null?{id:Ho,overflow:$o}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=As(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,ss=t,is=null,!0):!1;default:return!1}}function y0(t){return(t.mode&1)!==0&&(t.flags&128)===0}function v0(t){if(Bn){var e=is;if(e){var n=e;if(!ew(t,e)){if(y0(t))throw Error(Ge(418));e=ja(n.nextSibling);var i=ss;e&&ew(t,e)?CS(i,n):(t.flags=t.flags&-4097|2,Bn=!1,ss=t)}}else{if(y0(t))throw Error(Ge(418));t.flags=t.flags&-4097|2,Bn=!1,ss=t}}}function tw(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;ss=t}function bp(t){if(t!==ss)return!1;if(!Bn)return tw(t),Bn=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!p0(t.type,t.memoizedProps)),e&&(e=is)){if(y0(t))throw MS(),Error(Ge(418));for(;e;)CS(t,e),e=ja(e.nextSibling)}if(tw(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(Ge(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){is=ja(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}is=null}}else is=ss?ja(t.stateNode.nextSibling):null;return!0}function MS(){for(var t=is;t;)t=ja(t.nextSibling)}function Eu(){is=ss=null,Bn=!1}function Vv(t){Ws===null?Ws=[t]:Ws.push(t)}var Ck=ta.ReactCurrentBatchConfig;function js(t,e){if(t&&t.defaultProps){e=qn({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}var Lm=Qa(null),km=null,ou=null,jv=null;function Gv(){jv=ou=km=null}function Wv(t){var e=Lm.current;zn(Lm),t._currentValue=e}function x0(t,e,n){for(;t!==null;){var i=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,i!==null&&(i.childLanes|=e)):i!==null&&(i.childLanes&e)!==e&&(i.childLanes|=e),t===n)break;t=t.return}}function gu(t,e){km=t,jv=ou=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(Dr=!0),t.firstContext=null)}function Cs(t){var e=t._currentValue;if(jv!==t)if(t={context:t,memoizedValue:e,next:null},ou===null){if(km===null)throw Error(Ge(308));ou=t,km.dependencies={lanes:0,firstContext:t}}else ou=ou.next=t;return e}var Ol=null;function Hv(t){Ol===null?Ol=[t]:Ol.push(t)}function LS(t,e,n,i){var s=e.interleaved;return s===null?(n.next=n,Hv(e)):(n.next=s.next,s.next=n),e.interleaved=n,Yo(t,i)}function Yo(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var La=!1;function $v(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function kS(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function qo(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Ga(t,e,n){var i=t.updateQueue;if(i===null)return null;if(i=i.shared,hn&2){var s=i.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),i.pending=e,Yo(t,n)}return s=i.interleaved,s===null?(e.next=e,Hv(i)):(e.next=s.next,s.next=e),i.interleaved=e,Yo(t,n)}function nm(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var i=e.lanes;i&=t.pendingLanes,n|=i,e.lanes=n,Lv(t,n)}}function nw(t,e){var n=t.updateQueue,i=t.alternate;if(i!==null&&(i=i.updateQueue,n===i)){var s=null,c=null;if(n=n.firstBaseUpdate,n!==null){do{var d={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};c===null?s=c=d:c=c.next=d,n=n.next}while(n!==null);c===null?s=c=e:c=c.next=e}else s=c=e;n={baseState:i.baseState,firstBaseUpdate:s,lastBaseUpdate:c,shared:i.shared,effects:i.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function Rm(t,e,n,i){var s=t.updateQueue;La=!1;var c=s.firstBaseUpdate,d=s.lastBaseUpdate,l=s.shared.pending;if(l!==null){s.shared.pending=null;var y=l,w=y.next;y.next=null,d===null?c=w:d.next=w,d=y;var S=t.alternate;S!==null&&(S=S.updateQueue,l=S.lastBaseUpdate,l!==d&&(l===null?S.firstBaseUpdate=w:l.next=w,S.lastBaseUpdate=y))}if(c!==null){var C=s.baseState;d=0,S=w=y=null,l=c;do{var P=l.lane,D=l.eventTime;if((i&P)===P){S!==null&&(S=S.next={eventTime:D,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var U=t,H=l;switch(P=e,D=n,H.tag){case 1:if(U=H.payload,typeof U=="function"){C=U.call(D,C,P);break e}C=U;break e;case 3:U.flags=U.flags&-65537|128;case 0:if(U=H.payload,P=typeof U=="function"?U.call(D,C,P):U,P==null)break e;C=qn({},C,P);break e;case 2:La=!0}}l.callback!==null&&l.lane!==0&&(t.flags|=64,P=s.effects,P===null?s.effects=[l]:P.push(l))}else D={eventTime:D,lane:P,tag:l.tag,payload:l.payload,callback:l.callback,next:null},S===null?(w=S=D,y=C):S=S.next=D,d|=P;if(l=l.next,l===null){if(l=s.shared.pending,l===null)break;P=l,l=P.next,P.next=null,s.lastBaseUpdate=P,s.shared.pending=null}}while(1);if(S===null&&(y=C),s.baseState=y,s.firstBaseUpdate=w,s.lastBaseUpdate=S,e=s.shared.interleaved,e!==null){s=e;do d|=s.lane,s=s.next;while(s!==e)}else c===null&&(s.shared.lanes=0);$l|=d,t.lanes=d,t.memoizedState=C}}function iw(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var i=t[e],s=i.callback;if(s!==null){if(i.callback=null,i=n,typeof s!="function")throw Error(Ge(191,s));s.call(i)}}}var RS=new L2.Component().refs;function b0(t,e,n,i){e=t.memoizedState,n=n(i,e),n=n==null?e:qn({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var dg={isMounted:function(t){return(t=t._reactInternals)?Ql(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var i=wr(),s=Ha(t),c=qo(i,s);c.payload=e,n!=null&&(c.callback=n),e=Ga(t,c,s),e!==null&&(qs(e,t,s,i),nm(e,t,s))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var i=wr(),s=Ha(t),c=qo(i,s);c.tag=1,c.payload=e,n!=null&&(c.callback=n),e=Ga(t,c,s),e!==null&&(qs(e,t,s,i),nm(e,t,s))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=wr(),i=Ha(t),s=qo(n,i);s.tag=2,e!=null&&(s.callback=e),e=Ga(t,s,i),e!==null&&(qs(e,t,i,n),nm(e,t,i))}};function rw(t,e,n,i,s,c,d){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(i,c,d):e.prototype&&e.prototype.isPureReactComponent?!Ad(n,i)||!Ad(s,c):!0}function DS(t,e,n){var i=!1,s=Ya,c=e.contextType;return typeof c=="object"&&c!==null?c=Cs(c):(s=Or(e)?Gl:lr.current,i=e.contextTypes,c=(i=i!=null)?wu(t,s):Ya),e=new e(n,c),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=dg,t.stateNode=e,e._reactInternals=t,i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=s,t.__reactInternalMemoizedMaskedChildContext=c),e}function sw(t,e,n,i){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,i),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,i),e.state!==t&&dg.enqueueReplaceState(e,e.state,null)}function w0(t,e,n,i){var s=t.stateNode;s.props=n,s.state=t.memoizedState,s.refs=RS,$v(t);var c=e.contextType;typeof c=="object"&&c!==null?s.context=Cs(c):(c=Or(e)?Gl:lr.current,s.context=wu(t,c)),s.state=t.memoizedState,c=e.getDerivedStateFromProps,typeof c=="function"&&(b0(t,e,c,n),s.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&dg.enqueueReplaceState(s,s.state,null),Rm(t,n,s,i),s.state=t.memoizedState),typeof s.componentDidMount=="function"&&(t.flags|=4194308)}function jh(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(Ge(309));var i=n.stateNode}if(!i)throw Error(Ge(147,t));var s=i,c=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===c?e.ref:(e=function(d){var l=s.refs;l===RS&&(l=s.refs={}),d===null?delete l[c]:l[c]=d},e._stringRef=c,e)}if(typeof t!="string")throw Error(Ge(284));if(!n._owner)throw Error(Ge(290,t))}return t}function wp(t,e){throw t=Object.prototype.toString.call(e),Error(Ge(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function ow(t){var e=t._init;return e(t._payload)}function zS(t){function e(G,V){if(t){var W=G.deletions;W===null?(G.deletions=[V],G.flags|=16):W.push(V)}}function n(G,V){if(!t)return null;for(;V!==null;)e(G,V),V=V.sibling;return null}function i(G,V){for(G=new Map;V!==null;)V.key!==null?G.set(V.key,V):G.set(V.index,V),V=V.sibling;return G}function s(G,V){return G=$a(G,V),G.index=0,G.sibling=null,G}function c(G,V,W){return G.index=W,t?(W=G.alternate,W!==null?(W=W.index,W<V?(G.flags|=2,V):W):(G.flags|=2,V)):(G.flags|=1048576,V)}function d(G){return t&&G.alternate===null&&(G.flags|=2),G}function l(G,V,W,ie){return V===null||V.tag!==6?(V=sy(W,G.mode,ie),V.return=G,V):(V=s(V,W),V.return=G,V)}function y(G,V,W,ie){var ge=W.type;return ge===Jc?S(G,V,W.props.children,ie,W.key):V!==null&&(V.elementType===ge||typeof ge=="object"&&ge!==null&&ge.$$typeof===Ma&&ow(ge)===V.type)?(ie=s(V,W.props),ie.ref=jh(G,V,W),ie.return=G,ie):(ie=lm(W.type,W.key,W.props,null,G.mode,ie),ie.ref=jh(G,V,W),ie.return=G,ie)}function w(G,V,W,ie){return V===null||V.tag!==4||V.stateNode.containerInfo!==W.containerInfo||V.stateNode.implementation!==W.implementation?(V=oy(W,G.mode,ie),V.return=G,V):(V=s(V,W.children||[]),V.return=G,V)}function S(G,V,W,ie,ge){return V===null||V.tag!==7?(V=Vl(W,G.mode,ie,ge),V.return=G,V):(V=s(V,W),V.return=G,V)}function C(G,V,W){if(typeof V=="string"&&V!==""||typeof V=="number")return V=sy(""+V,G.mode,W),V.return=G,V;if(typeof V=="object"&&V!==null){switch(V.$$typeof){case hp:return W=lm(V.type,V.key,V.props,null,G.mode,W),W.ref=jh(G,null,V),W.return=G,W;case Kc:return V=oy(V,G.mode,W),V.return=G,V;case Ma:var ie=V._init;return C(G,ie(V._payload),W)}if(td(V)||Fh(V))return V=Vl(V,G.mode,W,null),V.return=G,V;wp(G,V)}return null}function P(G,V,W,ie){var ge=V!==null?V.key:null;if(typeof W=="string"&&W!==""||typeof W=="number")return ge!==null?null:l(G,V,""+W,ie);if(typeof W=="object"&&W!==null){switch(W.$$typeof){case hp:return W.key===ge?y(G,V,W,ie):null;case Kc:return W.key===ge?w(G,V,W,ie):null;case Ma:return ge=W._init,P(G,V,ge(W._payload),ie)}if(td(W)||Fh(W))return ge!==null?null:S(G,V,W,ie,null);wp(G,W)}return null}function D(G,V,W,ie,ge){if(typeof ie=="string"&&ie!==""||typeof ie=="number")return G=G.get(W)||null,l(V,G,""+ie,ge);if(typeof ie=="object"&&ie!==null){switch(ie.$$typeof){case hp:return G=G.get(ie.key===null?W:ie.key)||null,y(V,G,ie,ge);case Kc:return G=G.get(ie.key===null?W:ie.key)||null,w(V,G,ie,ge);case Ma:var be=ie._init;return D(G,V,W,be(ie._payload),ge)}if(td(ie)||Fh(ie))return G=G.get(W)||null,S(V,G,ie,ge,null);wp(V,ie)}return null}function U(G,V,W,ie){for(var ge=null,be=null,De=V,Ne=V=0,He=null;De!==null&&Ne<W.length;Ne++){De.index>Ne?(He=De,De=null):He=De.sibling;var je=P(G,De,W[Ne],ie);if(je===null){De===null&&(De=He);break}t&&De&&je.alternate===null&&e(G,De),V=c(je,V,Ne),be===null?ge=je:be.sibling=je,be=je,De=He}if(Ne===W.length)return n(G,De),Bn&&kl(G,Ne),ge;if(De===null){for(;Ne<W.length;Ne++)De=C(G,W[Ne],ie),De!==null&&(V=c(De,V,Ne),be===null?ge=De:be.sibling=De,be=De);return Bn&&kl(G,Ne),ge}for(De=i(G,De);Ne<W.length;Ne++)He=D(De,G,Ne,W[Ne],ie),He!==null&&(t&&He.alternate!==null&&De.delete(He.key===null?Ne:He.key),V=c(He,V,Ne),be===null?ge=He:be.sibling=He,be=He);return t&&De.forEach(function(vt){return e(G,vt)}),Bn&&kl(G,Ne),ge}function H(G,V,W,ie){var ge=Fh(W);if(typeof ge!="function")throw Error(Ge(150));if(W=ge.call(W),W==null)throw Error(Ge(151));for(var be=ge=null,De=V,Ne=V=0,He=null,je=W.next();De!==null&&!je.done;Ne++,je=W.next()){De.index>Ne?(He=De,De=null):He=De.sibling;var vt=P(G,De,je.value,ie);if(vt===null){De===null&&(De=He);break}t&&De&&vt.alternate===null&&e(G,De),V=c(vt,V,Ne),be===null?ge=vt:be.sibling=vt,be=vt,De=He}if(je.done)return n(G,De),Bn&&kl(G,Ne),ge;if(De===null){for(;!je.done;Ne++,je=W.next())je=C(G,je.value,ie),je!==null&&(V=c(je,V,Ne),be===null?ge=je:be.sibling=je,be=je);return Bn&&kl(G,Ne),ge}for(De=i(G,De);!je.done;Ne++,je=W.next())je=D(De,G,Ne,je.value,ie),je!==null&&(t&&je.alternate!==null&&De.delete(je.key===null?Ne:je.key),V=c(je,V,Ne),be===null?ge=je:be.sibling=je,be=je);return t&&De.forEach(function(Nt){return e(G,Nt)}),Bn&&kl(G,Ne),ge}function ae(G,V,W,ie){if(typeof W=="object"&&W!==null&&W.type===Jc&&W.key===null&&(W=W.props.children),typeof W=="object"&&W!==null){switch(W.$$typeof){case hp:e:{for(var ge=W.key,be=V;be!==null;){if(be.key===ge){if(ge=W.type,ge===Jc){if(be.tag===7){n(G,be.sibling),V=s(be,W.props.children),V.return=G,G=V;break e}}else if(be.elementType===ge||typeof ge=="object"&&ge!==null&&ge.$$typeof===Ma&&ow(ge)===be.type){n(G,be.sibling),V=s(be,W.props),V.ref=jh(G,be,W),V.return=G,G=V;break e}n(G,be);break}else e(G,be);be=be.sibling}W.type===Jc?(V=Vl(W.props.children,G.mode,ie,W.key),V.return=G,G=V):(ie=lm(W.type,W.key,W.props,null,G.mode,ie),ie.ref=jh(G,V,W),ie.return=G,G=ie)}return d(G);case Kc:e:{for(be=W.key;V!==null;){if(V.key===be)if(V.tag===4&&V.stateNode.containerInfo===W.containerInfo&&V.stateNode.implementation===W.implementation){n(G,V.sibling),V=s(V,W.children||[]),V.return=G,G=V;break e}else{n(G,V);break}else e(G,V);V=V.sibling}V=oy(W,G.mode,ie),V.return=G,G=V}return d(G);case Ma:return be=W._init,ae(G,V,be(W._payload),ie)}if(td(W))return U(G,V,W,ie);if(Fh(W))return H(G,V,W,ie);wp(G,W)}return typeof W=="string"&&W!==""||typeof W=="number"?(W=""+W,V!==null&&V.tag===6?(n(G,V.sibling),V=s(V,W),V.return=G,G=V):(n(G,V),V=sy(W,G.mode,ie),V.return=G,G=V),d(G)):n(G,V)}return ae}var Tu=zS(!0),OS=zS(!1),Yd={},bo=Qa(Yd),Md=Qa(Yd),Ld=Qa(Yd);function Fl(t){if(t===Yd)throw Error(Ge(174));return t}function qv(t,e){switch(kn(Ld,e),kn(Md,t),kn(bo,Yd),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:e0(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=e0(e,t)}zn(bo),kn(bo,e)}function Su(){zn(bo),zn(Md),zn(Ld)}function FS(t){Fl(Ld.current);var e=Fl(bo.current),n=e0(e,t.type);e!==n&&(kn(Md,t),kn(bo,n))}function Zv(t){Md.current===t&&(zn(bo),zn(Md))}var Wn=Qa(0);function Dm(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Q_=[];function Xv(){for(var t=0;t<Q_.length;t++)Q_[t]._workInProgressVersionPrimary=null;Q_.length=0}var im=ta.ReactCurrentDispatcher,ey=ta.ReactCurrentBatchConfig,Hl=0,$n=null,Ei=null,Ri=null,zm=!1,dd=!1,kd=0,Mk=0;function tr(){throw Error(Ge(321))}function Yv(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!Zs(t[n],e[n]))return!1;return!0}function Kv(t,e,n,i,s,c){if(Hl=c,$n=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,im.current=t===null||t.memoizedState===null?Dk:zk,t=n(i,s),dd){c=0;do{if(dd=!1,kd=0,25<=c)throw Error(Ge(301));c+=1,Ri=Ei=null,e.updateQueue=null,im.current=Ok,t=n(i,s)}while(dd)}if(im.current=Om,e=Ei!==null&&Ei.next!==null,Hl=0,Ri=Ei=$n=null,zm=!1,e)throw Error(Ge(300));return t}function Jv(){var t=kd!==0;return kd=0,t}function mo(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ri===null?$n.memoizedState=Ri=t:Ri=Ri.next=t,Ri}function Ms(){if(Ei===null){var t=$n.alternate;t=t!==null?t.memoizedState:null}else t=Ei.next;var e=Ri===null?$n.memoizedState:Ri.next;if(e!==null)Ri=e,Ei=t;else{if(t===null)throw Error(Ge(310));Ei=t,t={memoizedState:Ei.memoizedState,baseState:Ei.baseState,baseQueue:Ei.baseQueue,queue:Ei.queue,next:null},Ri===null?$n.memoizedState=Ri=t:Ri=Ri.next=t}return Ri}function Rd(t,e){return typeof e=="function"?e(t):e}function ty(t){var e=Ms(),n=e.queue;if(n===null)throw Error(Ge(311));n.lastRenderedReducer=t;var i=Ei,s=i.baseQueue,c=n.pending;if(c!==null){if(s!==null){var d=s.next;s.next=c.next,c.next=d}i.baseQueue=s=c,n.pending=null}if(s!==null){c=s.next,i=i.baseState;var l=d=null,y=null,w=c;do{var S=w.lane;if((Hl&S)===S)y!==null&&(y=y.next={lane:0,action:w.action,hasEagerState:w.hasEagerState,eagerState:w.eagerState,next:null}),i=w.hasEagerState?w.eagerState:t(i,w.action);else{var C={lane:S,action:w.action,hasEagerState:w.hasEagerState,eagerState:w.eagerState,next:null};y===null?(l=y=C,d=i):y=y.next=C,$n.lanes|=S,$l|=S}w=w.next}while(w!==null&&w!==c);y===null?d=i:y.next=l,Zs(i,e.memoizedState)||(Dr=!0),e.memoizedState=i,e.baseState=d,e.baseQueue=y,n.lastRenderedState=i}if(t=n.interleaved,t!==null){s=t;do c=s.lane,$n.lanes|=c,$l|=c,s=s.next;while(s!==t)}else s===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function ny(t){var e=Ms(),n=e.queue;if(n===null)throw Error(Ge(311));n.lastRenderedReducer=t;var i=n.dispatch,s=n.pending,c=e.memoizedState;if(s!==null){n.pending=null;var d=s=s.next;do c=t(c,d.action),d=d.next;while(d!==s);Zs(c,e.memoizedState)||(Dr=!0),e.memoizedState=c,e.baseQueue===null&&(e.baseState=c),n.lastRenderedState=c}return[c,i]}function NS(){}function BS(t,e){var n=$n,i=Ms(),s=e(),c=!Zs(i.memoizedState,s);if(c&&(i.memoizedState=s,Dr=!0),i=i.queue,Qv(jS.bind(null,n,i,t),[t]),i.getSnapshot!==e||c||Ri!==null&&Ri.memoizedState.tag&1){if(n.flags|=2048,Dd(9,VS.bind(null,n,i,s,e),void 0,null),zi===null)throw Error(Ge(349));Hl&30||US(n,e,s)}return s}function US(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=$n.updateQueue,e===null?(e={lastEffect:null,stores:null},$n.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function VS(t,e,n,i){e.value=n,e.getSnapshot=i,GS(e)&&WS(t)}function jS(t,e,n){return n(function(){GS(e)&&WS(t)})}function GS(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!Zs(t,n)}catch{return!0}}function WS(t){var e=Yo(t,1);e!==null&&qs(e,t,1,-1)}function aw(t){var e=mo();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Rd,lastRenderedState:t},e.queue=t,t=t.dispatch=Rk.bind(null,$n,t),[e.memoizedState,t]}function Dd(t,e,n,i){return t={tag:t,create:e,destroy:n,deps:i,next:null},e=$n.updateQueue,e===null?(e={lastEffect:null,stores:null},$n.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(i=n.next,n.next=t,t.next=i,e.lastEffect=t)),t}function HS(){return Ms().memoizedState}function rm(t,e,n,i){var s=mo();$n.flags|=t,s.memoizedState=Dd(1|e,n,void 0,i===void 0?null:i)}function fg(t,e,n,i){var s=Ms();i=i===void 0?null:i;var c=void 0;if(Ei!==null){var d=Ei.memoizedState;if(c=d.destroy,i!==null&&Yv(i,d.deps)){s.memoizedState=Dd(e,n,c,i);return}}$n.flags|=t,s.memoizedState=Dd(1|e,n,c,i)}function lw(t,e){return rm(8390656,8,t,e)}function Qv(t,e){return fg(2048,8,t,e)}function $S(t,e){return fg(4,2,t,e)}function qS(t,e){return fg(4,4,t,e)}function ZS(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function XS(t,e,n){return n=n!=null?n.concat([t]):null,fg(4,4,ZS.bind(null,e,t),n)}function ex(){}function YS(t,e){var n=Ms();e=e===void 0?null:e;var i=n.memoizedState;return i!==null&&e!==null&&Yv(e,i[1])?i[0]:(n.memoizedState=[t,e],t)}function KS(t,e){var n=Ms();e=e===void 0?null:e;var i=n.memoizedState;return i!==null&&e!==null&&Yv(e,i[1])?i[0]:(t=t(),n.memoizedState=[t,e],t)}function JS(t,e,n){return Hl&21?(Zs(n,e)||(n=tS(),$n.lanes|=n,$l|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,Dr=!0),t.memoizedState=n)}function Lk(t,e){var n=bn;bn=n!==0&&4>n?n:4,t(!0);var i=ey.transition;ey.transition={};try{t(!1),e()}finally{bn=n,ey.transition=i}}function QS(){return Ms().memoizedState}function kk(t,e,n){var i=Ha(t);if(n={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null},eA(t))tA(e,n);else if(n=LS(t,e,n,i),n!==null){var s=wr();qs(n,t,i,s),nA(n,e,i)}}function Rk(t,e,n){var i=Ha(t),s={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null};if(eA(t))tA(e,s);else{var c=t.alternate;if(t.lanes===0&&(c===null||c.lanes===0)&&(c=e.lastRenderedReducer,c!==null))try{var d=e.lastRenderedState,l=c(d,n);if(s.hasEagerState=!0,s.eagerState=l,Zs(l,d)){var y=e.interleaved;y===null?(s.next=s,Hv(e)):(s.next=y.next,y.next=s),e.interleaved=s;return}}catch{}finally{}n=LS(t,e,s,i),n!==null&&(s=wr(),qs(n,t,i,s),nA(n,e,i))}}function eA(t){var e=t.alternate;return t===$n||e!==null&&e===$n}function tA(t,e){dd=zm=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function nA(t,e,n){if(n&4194240){var i=e.lanes;i&=t.pendingLanes,n|=i,e.lanes=n,Lv(t,n)}}var Om={readContext:Cs,useCallback:tr,useContext:tr,useEffect:tr,useImperativeHandle:tr,useInsertionEffect:tr,useLayoutEffect:tr,useMemo:tr,useReducer:tr,useRef:tr,useState:tr,useDebugValue:tr,useDeferredValue:tr,useTransition:tr,useMutableSource:tr,useSyncExternalStore:tr,useId:tr,unstable_isNewReconciler:!1},Dk={readContext:Cs,useCallback:function(t,e){return mo().memoizedState=[t,e===void 0?null:e],t},useContext:Cs,useEffect:lw,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,rm(4194308,4,ZS.bind(null,e,t),n)},useLayoutEffect:function(t,e){return rm(4194308,4,t,e)},useInsertionEffect:function(t,e){return rm(4,2,t,e)},useMemo:function(t,e){var n=mo();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var i=mo();return e=n!==void 0?n(e):e,i.memoizedState=i.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},i.queue=t,t=t.dispatch=kk.bind(null,$n,t),[i.memoizedState,t]},useRef:function(t){var e=mo();return t={current:t},e.memoizedState=t},useState:aw,useDebugValue:ex,useDeferredValue:function(t){return mo().memoizedState=t},useTransition:function(){var t=aw(!1),e=t[0];return t=Lk.bind(null,t[1]),mo().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var i=$n,s=mo();if(Bn){if(n===void 0)throw Error(Ge(407));n=n()}else{if(n=e(),zi===null)throw Error(Ge(349));Hl&30||US(i,e,n)}s.memoizedState=n;var c={value:n,getSnapshot:e};return s.queue=c,lw(jS.bind(null,i,c,t),[t]),i.flags|=2048,Dd(9,VS.bind(null,i,c,n,e),void 0,null),n},useId:function(){var t=mo(),e=zi.identifierPrefix;if(Bn){var n=$o,i=Ho;n=(i&~(1<<32-$s(i)-1)).toString(32)+n,e=":"+e+"R"+n,n=kd++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=Mk++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},zk={readContext:Cs,useCallback:YS,useContext:Cs,useEffect:Qv,useImperativeHandle:XS,useInsertionEffect:$S,useLayoutEffect:qS,useMemo:KS,useReducer:ty,useRef:HS,useState:function(){return ty(Rd)},useDebugValue:ex,useDeferredValue:function(t){var e=Ms();return JS(e,Ei.memoizedState,t)},useTransition:function(){var t=ty(Rd)[0],e=Ms().memoizedState;return[t,e]},useMutableSource:NS,useSyncExternalStore:BS,useId:QS,unstable_isNewReconciler:!1},Ok={readContext:Cs,useCallback:YS,useContext:Cs,useEffect:Qv,useImperativeHandle:XS,useInsertionEffect:$S,useLayoutEffect:qS,useMemo:KS,useReducer:ny,useRef:HS,useState:function(){return ny(Rd)},useDebugValue:ex,useDeferredValue:function(t){var e=Ms();return Ei===null?e.memoizedState=t:JS(e,Ei.memoizedState,t)},useTransition:function(){var t=ny(Rd)[0],e=Ms().memoizedState;return[t,e]},useMutableSource:NS,useSyncExternalStore:BS,useId:QS,unstable_isNewReconciler:!1};function Au(t,e){try{var n="",i=e;do n+=uL(i),i=i.return;while(i);var s=n}catch(c){s=`
Error generating stack: `+c.message+`
`+c.stack}return{value:t,source:e,stack:s,digest:null}}function iy(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function E0(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var Fk=typeof WeakMap=="function"?WeakMap:Map;function iA(t,e,n){n=qo(-1,n),n.tag=3,n.payload={element:null};var i=e.value;return n.callback=function(){Nm||(Nm=!0,R0=i),E0(t,e)},n}function rA(t,e,n){n=qo(-1,n),n.tag=3;var i=t.type.getDerivedStateFromError;if(typeof i=="function"){var s=e.value;n.payload=function(){return i(s)},n.callback=function(){E0(t,e)}}var c=t.stateNode;return c!==null&&typeof c.componentDidCatch=="function"&&(n.callback=function(){E0(t,e),typeof i!="function"&&(Wa===null?Wa=new Set([this]):Wa.add(this));var d=e.stack;this.componentDidCatch(e.value,{componentStack:d!==null?d:""})}),n}function cw(t,e,n){var i=t.pingCache;if(i===null){i=t.pingCache=new Fk;var s=new Set;i.set(e,s)}else s=i.get(e),s===void 0&&(s=new Set,i.set(e,s));s.has(n)||(s.add(n),t=Kk.bind(null,t,e,n),e.then(t,t))}function uw(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function hw(t,e,n,i,s){return t.mode&1?(t.flags|=65536,t.lanes=s,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=qo(-1,1),e.tag=2,Ga(n,e,1))),n.lanes|=1),t)}var Nk=ta.ReactCurrentOwner,Dr=!1;function xr(t,e,n,i){e.child=t===null?OS(e,null,n,i):Tu(e,t.child,n,i)}function dw(t,e,n,i,s){n=n.render;var c=e.ref;return gu(e,s),i=Kv(t,e,n,i,c,s),n=Jv(),t!==null&&!Dr?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,Ko(t,e,s)):(Bn&&n&&Bv(e),e.flags|=1,xr(t,e,i,s),e.child)}function fw(t,e,n,i,s){if(t===null){var c=n.type;return typeof c=="function"&&!lx(c)&&c.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=c,sA(t,e,c,i,s)):(t=lm(n.type,null,i,e,e.mode,s),t.ref=e.ref,t.return=e,e.child=t)}if(c=t.child,!(t.lanes&s)){var d=c.memoizedProps;if(n=n.compare,n=n!==null?n:Ad,n(d,i)&&t.ref===e.ref)return Ko(t,e,s)}return e.flags|=1,t=$a(c,i),t.ref=e.ref,t.return=e,e.child=t}function sA(t,e,n,i,s){if(t!==null){var c=t.memoizedProps;if(Ad(c,i)&&t.ref===e.ref)if(Dr=!1,e.pendingProps=i=c,(t.lanes&s)!==0)t.flags&131072&&(Dr=!0);else return e.lanes=t.lanes,Ko(t,e,s)}return T0(t,e,n,i,s)}function oA(t,e,n){var i=e.pendingProps,s=i.children,c=t!==null?t.memoizedState:null;if(i.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},kn(lu,es),es|=n;else{if(!(n&1073741824))return t=c!==null?c.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,kn(lu,es),es|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=c!==null?c.baseLanes:n,kn(lu,es),es|=i}else c!==null?(i=c.baseLanes|n,e.memoizedState=null):i=n,kn(lu,es),es|=i;return xr(t,e,s,n),e.child}function aA(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function T0(t,e,n,i,s){var c=Or(n)?Gl:lr.current;return c=wu(e,c),gu(e,s),n=Kv(t,e,n,i,c,s),i=Jv(),t!==null&&!Dr?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,Ko(t,e,s)):(Bn&&i&&Bv(e),e.flags|=1,xr(t,e,n,s),e.child)}function pw(t,e,n,i,s){if(Or(n)){var c=!0;Im(e)}else c=!1;if(gu(e,s),e.stateNode===null)sm(t,e),DS(e,n,i),w0(e,n,i,s),i=!0;else if(t===null){var d=e.stateNode,l=e.memoizedProps;d.props=l;var y=d.context,w=n.contextType;typeof w=="object"&&w!==null?w=Cs(w):(w=Or(n)?Gl:lr.current,w=wu(e,w));var S=n.getDerivedStateFromProps,C=typeof S=="function"||typeof d.getSnapshotBeforeUpdate=="function";C||typeof d.UNSAFE_componentWillReceiveProps!="function"&&typeof d.componentWillReceiveProps!="function"||(l!==i||y!==w)&&sw(e,d,i,w),La=!1;var P=e.memoizedState;d.state=P,Rm(e,i,d,s),y=e.memoizedState,l!==i||P!==y||zr.current||La?(typeof S=="function"&&(b0(e,n,S,i),y=e.memoizedState),(l=La||rw(e,n,l,i,P,y,w))?(C||typeof d.UNSAFE_componentWillMount!="function"&&typeof d.componentWillMount!="function"||(typeof d.componentWillMount=="function"&&d.componentWillMount(),typeof d.UNSAFE_componentWillMount=="function"&&d.UNSAFE_componentWillMount()),typeof d.componentDidMount=="function"&&(e.flags|=4194308)):(typeof d.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=i,e.memoizedState=y),d.props=i,d.state=y,d.context=w,i=l):(typeof d.componentDidMount=="function"&&(e.flags|=4194308),i=!1)}else{d=e.stateNode,kS(t,e),l=e.memoizedProps,w=e.type===e.elementType?l:js(e.type,l),d.props=w,C=e.pendingProps,P=d.context,y=n.contextType,typeof y=="object"&&y!==null?y=Cs(y):(y=Or(n)?Gl:lr.current,y=wu(e,y));var D=n.getDerivedStateFromProps;(S=typeof D=="function"||typeof d.getSnapshotBeforeUpdate=="function")||typeof d.UNSAFE_componentWillReceiveProps!="function"&&typeof d.componentWillReceiveProps!="function"||(l!==C||P!==y)&&sw(e,d,i,y),La=!1,P=e.memoizedState,d.state=P,Rm(e,i,d,s);var U=e.memoizedState;l!==C||P!==U||zr.current||La?(typeof D=="function"&&(b0(e,n,D,i),U=e.memoizedState),(w=La||rw(e,n,w,i,P,U,y)||!1)?(S||typeof d.UNSAFE_componentWillUpdate!="function"&&typeof d.componentWillUpdate!="function"||(typeof d.componentWillUpdate=="function"&&d.componentWillUpdate(i,U,y),typeof d.UNSAFE_componentWillUpdate=="function"&&d.UNSAFE_componentWillUpdate(i,U,y)),typeof d.componentDidUpdate=="function"&&(e.flags|=4),typeof d.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof d.componentDidUpdate!="function"||l===t.memoizedProps&&P===t.memoizedState||(e.flags|=4),typeof d.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&P===t.memoizedState||(e.flags|=1024),e.memoizedProps=i,e.memoizedState=U),d.props=i,d.state=U,d.context=y,i=w):(typeof d.componentDidUpdate!="function"||l===t.memoizedProps&&P===t.memoizedState||(e.flags|=4),typeof d.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&P===t.memoizedState||(e.flags|=1024),i=!1)}return S0(t,e,n,i,c,s)}function S0(t,e,n,i,s,c){aA(t,e);var d=(e.flags&128)!==0;if(!i&&!d)return s&&Qb(e,n,!1),Ko(t,e,c);i=e.stateNode,Nk.current=e;var l=d&&typeof n.getDerivedStateFromError!="function"?null:i.render();return e.flags|=1,t!==null&&d?(e.child=Tu(e,t.child,null,c),e.child=Tu(e,null,l,c)):xr(t,e,l,c),e.memoizedState=i.state,s&&Qb(e,n,!0),e.child}function lA(t){var e=t.stateNode;e.pendingContext?Jb(t,e.pendingContext,e.pendingContext!==e.context):e.context&&Jb(t,e.context,!1),qv(t,e.containerInfo)}function mw(t,e,n,i,s){return Eu(),Vv(s),e.flags|=256,xr(t,e,n,i),e.child}var A0={dehydrated:null,treeContext:null,retryLane:0};function P0(t){return{baseLanes:t,cachePool:null,transitions:null}}function cA(t,e,n){var i=e.pendingProps,s=Wn.current,c=!1,d=(e.flags&128)!==0,l;if((l=d)||(l=t!==null&&t.memoizedState===null?!1:(s&2)!==0),l?(c=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(s|=1),kn(Wn,s&1),t===null)return v0(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(d=i.children,t=i.fallback,c?(i=e.mode,c=e.child,d={mode:"hidden",children:d},!(i&1)&&c!==null?(c.childLanes=0,c.pendingProps=d):c=gg(d,i,0,null),t=Vl(t,i,n,null),c.return=e,t.return=e,c.sibling=t,e.child=c,e.child.memoizedState=P0(n),e.memoizedState=A0,t):tx(e,d));if(s=t.memoizedState,s!==null&&(l=s.dehydrated,l!==null))return Bk(t,e,d,i,l,s,n);if(c){c=i.fallback,d=e.mode,s=t.child,l=s.sibling;var y={mode:"hidden",children:i.children};return!(d&1)&&e.child!==s?(i=e.child,i.childLanes=0,i.pendingProps=y,e.deletions=null):(i=$a(s,y),i.subtreeFlags=s.subtreeFlags&14680064),l!==null?c=$a(l,c):(c=Vl(c,d,n,null),c.flags|=2),c.return=e,i.return=e,i.sibling=c,e.child=i,i=c,c=e.child,d=t.child.memoizedState,d=d===null?P0(n):{baseLanes:d.baseLanes|n,cachePool:null,transitions:d.transitions},c.memoizedState=d,c.childLanes=t.childLanes&~n,e.memoizedState=A0,i}return c=t.child,t=c.sibling,i=$a(c,{mode:"visible",children:i.children}),!(e.mode&1)&&(i.lanes=n),i.return=e,i.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=i,e.memoizedState=null,i}function tx(t,e){return e=gg({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function Ep(t,e,n,i){return i!==null&&Vv(i),Tu(e,t.child,null,n),t=tx(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function Bk(t,e,n,i,s,c,d){if(n)return e.flags&256?(e.flags&=-257,i=iy(Error(Ge(422))),Ep(t,e,d,i)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(c=i.fallback,s=e.mode,i=gg({mode:"visible",children:i.children},s,0,null),c=Vl(c,s,d,null),c.flags|=2,i.return=e,c.return=e,i.sibling=c,e.child=i,e.mode&1&&Tu(e,t.child,null,d),e.child.memoizedState=P0(d),e.memoizedState=A0,c);if(!(e.mode&1))return Ep(t,e,d,null);if(s.data==="$!"){if(i=s.nextSibling&&s.nextSibling.dataset,i)var l=i.dgst;return i=l,c=Error(Ge(419)),i=iy(c,i,void 0),Ep(t,e,d,i)}if(l=(d&t.childLanes)!==0,Dr||l){if(i=zi,i!==null){switch(d&-d){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(i.suspendedLanes|d)?0:s,s!==0&&s!==c.retryLane&&(c.retryLane=s,Yo(t,s),qs(i,t,s,-1))}return ax(),i=iy(Error(Ge(421))),Ep(t,e,d,i)}return s.data==="$?"?(e.flags|=128,e.child=t.child,e=Jk.bind(null,t),s._reactRetry=e,null):(t=c.treeContext,is=ja(s.nextSibling),ss=e,Bn=!0,Ws=null,t!==null&&(Ts[Ss++]=Ho,Ts[Ss++]=$o,Ts[Ss++]=Wl,Ho=t.id,$o=t.overflow,Wl=e),e=tx(e,i.children),e.flags|=4096,e)}function gw(t,e,n){t.lanes|=e;var i=t.alternate;i!==null&&(i.lanes|=e),x0(t.return,e,n)}function ry(t,e,n,i,s){var c=t.memoizedState;c===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:s}:(c.isBackwards=e,c.rendering=null,c.renderingStartTime=0,c.last=i,c.tail=n,c.tailMode=s)}function uA(t,e,n){var i=e.pendingProps,s=i.revealOrder,c=i.tail;if(xr(t,e,i.children,n),i=Wn.current,i&2)i=i&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&gw(t,n,e);else if(t.tag===19)gw(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}i&=1}if(kn(Wn,i),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(n=e.child,s=null;n!==null;)t=n.alternate,t!==null&&Dm(t)===null&&(s=n),n=n.sibling;n=s,n===null?(s=e.child,e.child=null):(s=n.sibling,n.sibling=null),ry(e,!1,s,n,c);break;case"backwards":for(n=null,s=e.child,e.child=null;s!==null;){if(t=s.alternate,t!==null&&Dm(t)===null){e.child=s;break}t=s.sibling,s.sibling=n,n=s,s=t}ry(e,!0,n,null,c);break;case"together":ry(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function sm(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Ko(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),$l|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(Ge(153));if(e.child!==null){for(t=e.child,n=$a(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=$a(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function Uk(t,e,n){switch(e.tag){case 3:lA(e),Eu();break;case 5:FS(e);break;case 1:Or(e.type)&&Im(e);break;case 4:qv(e,e.stateNode.containerInfo);break;case 10:var i=e.type._context,s=e.memoizedProps.value;kn(Lm,i._currentValue),i._currentValue=s;break;case 13:if(i=e.memoizedState,i!==null)return i.dehydrated!==null?(kn(Wn,Wn.current&1),e.flags|=128,null):n&e.child.childLanes?cA(t,e,n):(kn(Wn,Wn.current&1),t=Ko(t,e,n),t!==null?t.sibling:null);kn(Wn,Wn.current&1);break;case 19:if(i=(n&e.childLanes)!==0,t.flags&128){if(i)return uA(t,e,n);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),kn(Wn,Wn.current),i)break;return null;case 22:case 23:return e.lanes=0,oA(t,e,n)}return Ko(t,e,n)}var hA,I0,dA,fA;hA=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};I0=function(){};dA=function(t,e,n,i){var s=t.memoizedProps;if(s!==i){t=e.stateNode,Fl(bo.current);var c=null;switch(n){case"input":s=Yy(t,s),i=Yy(t,i),c=[];break;case"select":s=qn({},s,{value:void 0}),i=qn({},i,{value:void 0}),c=[];break;case"textarea":s=Qy(t,s),i=Qy(t,i),c=[];break;default:typeof s.onClick!="function"&&typeof i.onClick=="function"&&(t.onclick=Am)}t0(n,i);var d;n=null;for(w in s)if(!i.hasOwnProperty(w)&&s.hasOwnProperty(w)&&s[w]!=null)if(w==="style"){var l=s[w];for(d in l)l.hasOwnProperty(d)&&(n||(n={}),n[d]="")}else w!=="dangerouslySetInnerHTML"&&w!=="children"&&w!=="suppressContentEditableWarning"&&w!=="suppressHydrationWarning"&&w!=="autoFocus"&&(vd.hasOwnProperty(w)?c||(c=[]):(c=c||[]).push(w,null));for(w in i){var y=i[w];if(l=s!=null?s[w]:void 0,i.hasOwnProperty(w)&&y!==l&&(y!=null||l!=null))if(w==="style")if(l){for(d in l)!l.hasOwnProperty(d)||y&&y.hasOwnProperty(d)||(n||(n={}),n[d]="");for(d in y)y.hasOwnProperty(d)&&l[d]!==y[d]&&(n||(n={}),n[d]=y[d])}else n||(c||(c=[]),c.push(w,n)),n=y;else w==="dangerouslySetInnerHTML"?(y=y?y.__html:void 0,l=l?l.__html:void 0,y!=null&&l!==y&&(c=c||[]).push(w,y)):w==="children"?typeof y!="string"&&typeof y!="number"||(c=c||[]).push(w,""+y):w!=="suppressContentEditableWarning"&&w!=="suppressHydrationWarning"&&(vd.hasOwnProperty(w)?(y!=null&&w==="onScroll"&&Dn("scroll",t),c||l===y||(c=[])):(c=c||[]).push(w,y))}n&&(c=c||[]).push("style",n);var w=c;(e.updateQueue=w)&&(e.flags|=4)}};fA=function(t,e,n,i){n!==i&&(e.flags|=4)};function Gh(t,e){if(!Bn)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var i=null;n!==null;)n.alternate!==null&&(i=n),n=n.sibling;i===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:i.sibling=null}}function nr(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,i=0;if(e)for(var s=t.child;s!==null;)n|=s.lanes|s.childLanes,i|=s.subtreeFlags&14680064,i|=s.flags&14680064,s.return=t,s=s.sibling;else for(s=t.child;s!==null;)n|=s.lanes|s.childLanes,i|=s.subtreeFlags,i|=s.flags,s.return=t,s=s.sibling;return t.subtreeFlags|=i,t.childLanes=n,e}function Vk(t,e,n){var i=e.pendingProps;switch(Uv(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return nr(e),null;case 1:return Or(e.type)&&Pm(),nr(e),null;case 3:return i=e.stateNode,Su(),zn(zr),zn(lr),Xv(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(t===null||t.child===null)&&(bp(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Ws!==null&&(O0(Ws),Ws=null))),I0(t,e),nr(e),null;case 5:Zv(e);var s=Fl(Ld.current);if(n=e.type,t!==null&&e.stateNode!=null)dA(t,e,n,i,s),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!i){if(e.stateNode===null)throw Error(Ge(166));return nr(e),null}if(t=Fl(bo.current),bp(e)){i=e.stateNode,n=e.type;var c=e.memoizedProps;switch(i[go]=e,i[Cd]=c,t=(e.mode&1)!==0,n){case"dialog":Dn("cancel",i),Dn("close",i);break;case"iframe":case"object":case"embed":Dn("load",i);break;case"video":case"audio":for(s=0;s<id.length;s++)Dn(id[s],i);break;case"source":Dn("error",i);break;case"img":case"image":case"link":Dn("error",i),Dn("load",i);break;case"details":Dn("toggle",i);break;case"input":Sb(i,c),Dn("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!c.multiple},Dn("invalid",i);break;case"textarea":Pb(i,c),Dn("invalid",i)}t0(n,c),s=null;for(var d in c)if(c.hasOwnProperty(d)){var l=c[d];d==="children"?typeof l=="string"?i.textContent!==l&&(c.suppressHydrationWarning!==!0&&xp(i.textContent,l,t),s=["children",l]):typeof l=="number"&&i.textContent!==""+l&&(c.suppressHydrationWarning!==!0&&xp(i.textContent,l,t),s=["children",""+l]):vd.hasOwnProperty(d)&&l!=null&&d==="onScroll"&&Dn("scroll",i)}switch(n){case"input":dp(i),Ab(i,c,!0);break;case"textarea":dp(i),Ib(i);break;case"select":case"option":break;default:typeof c.onClick=="function"&&(i.onclick=Am)}i=s,e.updateQueue=i,i!==null&&(e.flags|=4)}else{d=s.nodeType===9?s:s.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=U2(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=d.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof i.is=="string"?t=d.createElement(n,{is:i.is}):(t=d.createElement(n),n==="select"&&(d=t,i.multiple?d.multiple=!0:i.size&&(d.size=i.size))):t=d.createElementNS(t,n),t[go]=e,t[Cd]=i,hA(t,e,!1,!1),e.stateNode=t;e:{switch(d=n0(n,i),n){case"dialog":Dn("cancel",t),Dn("close",t),s=i;break;case"iframe":case"object":case"embed":Dn("load",t),s=i;break;case"video":case"audio":for(s=0;s<id.length;s++)Dn(id[s],t);s=i;break;case"source":Dn("error",t),s=i;break;case"img":case"image":case"link":Dn("error",t),Dn("load",t),s=i;break;case"details":Dn("toggle",t),s=i;break;case"input":Sb(t,i),s=Yy(t,i),Dn("invalid",t);break;case"option":s=i;break;case"select":t._wrapperState={wasMultiple:!!i.multiple},s=qn({},i,{value:void 0}),Dn("invalid",t);break;case"textarea":Pb(t,i),s=Qy(t,i),Dn("invalid",t);break;default:s=i}t0(n,s),l=s;for(c in l)if(l.hasOwnProperty(c)){var y=l[c];c==="style"?G2(t,y):c==="dangerouslySetInnerHTML"?(y=y?y.__html:void 0,y!=null&&V2(t,y)):c==="children"?typeof y=="string"?(n!=="textarea"||y!=="")&&xd(t,y):typeof y=="number"&&xd(t,""+y):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(vd.hasOwnProperty(c)?y!=null&&c==="onScroll"&&Dn("scroll",t):y!=null&&Sv(t,c,y,d))}switch(n){case"input":dp(t),Ab(t,i,!1);break;case"textarea":dp(t),Ib(t);break;case"option":i.value!=null&&t.setAttribute("value",""+Xa(i.value));break;case"select":t.multiple=!!i.multiple,c=i.value,c!=null?du(t,!!i.multiple,c,!1):i.defaultValue!=null&&du(t,!!i.multiple,i.defaultValue,!0);break;default:typeof s.onClick=="function"&&(t.onclick=Am)}switch(n){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return nr(e),null;case 6:if(t&&e.stateNode!=null)fA(t,e,t.memoizedProps,i);else{if(typeof i!="string"&&e.stateNode===null)throw Error(Ge(166));if(n=Fl(Ld.current),Fl(bo.current),bp(e)){if(i=e.stateNode,n=e.memoizedProps,i[go]=e,(c=i.nodeValue!==n)&&(t=ss,t!==null))switch(t.tag){case 3:xp(i.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&xp(i.nodeValue,n,(t.mode&1)!==0)}c&&(e.flags|=4)}else i=(n.nodeType===9?n:n.ownerDocument).createTextNode(i),i[go]=e,e.stateNode=i}return nr(e),null;case 13:if(zn(Wn),i=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(Bn&&is!==null&&e.mode&1&&!(e.flags&128))MS(),Eu(),e.flags|=98560,c=!1;else if(c=bp(e),i!==null&&i.dehydrated!==null){if(t===null){if(!c)throw Error(Ge(318));if(c=e.memoizedState,c=c!==null?c.dehydrated:null,!c)throw Error(Ge(317));c[go]=e}else Eu(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;nr(e),c=!1}else Ws!==null&&(O0(Ws),Ws=null),c=!0;if(!c)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(i=i!==null,i!==(t!==null&&t.memoizedState!==null)&&i&&(e.child.flags|=8192,e.mode&1&&(t===null||Wn.current&1?Ti===0&&(Ti=3):ax())),e.updateQueue!==null&&(e.flags|=4),nr(e),null);case 4:return Su(),I0(t,e),t===null&&Pd(e.stateNode.containerInfo),nr(e),null;case 10:return Wv(e.type._context),nr(e),null;case 17:return Or(e.type)&&Pm(),nr(e),null;case 19:if(zn(Wn),c=e.memoizedState,c===null)return nr(e),null;if(i=(e.flags&128)!==0,d=c.rendering,d===null)if(i)Gh(c,!1);else{if(Ti!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(d=Dm(t),d!==null){for(e.flags|=128,Gh(c,!1),i=d.updateQueue,i!==null&&(e.updateQueue=i,e.flags|=4),e.subtreeFlags=0,i=n,n=e.child;n!==null;)c=n,t=i,c.flags&=14680066,d=c.alternate,d===null?(c.childLanes=0,c.lanes=t,c.child=null,c.subtreeFlags=0,c.memoizedProps=null,c.memoizedState=null,c.updateQueue=null,c.dependencies=null,c.stateNode=null):(c.childLanes=d.childLanes,c.lanes=d.lanes,c.child=d.child,c.subtreeFlags=0,c.deletions=null,c.memoizedProps=d.memoizedProps,c.memoizedState=d.memoizedState,c.updateQueue=d.updateQueue,c.type=d.type,t=d.dependencies,c.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return kn(Wn,Wn.current&1|2),e.child}t=t.sibling}c.tail!==null&&oi()>Pu&&(e.flags|=128,i=!0,Gh(c,!1),e.lanes=4194304)}else{if(!i)if(t=Dm(d),t!==null){if(e.flags|=128,i=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),Gh(c,!0),c.tail===null&&c.tailMode==="hidden"&&!d.alternate&&!Bn)return nr(e),null}else 2*oi()-c.renderingStartTime>Pu&&n!==1073741824&&(e.flags|=128,i=!0,Gh(c,!1),e.lanes=4194304);c.isBackwards?(d.sibling=e.child,e.child=d):(n=c.last,n!==null?n.sibling=d:e.child=d,c.last=d)}return c.tail!==null?(e=c.tail,c.rendering=e,c.tail=e.sibling,c.renderingStartTime=oi(),e.sibling=null,n=Wn.current,kn(Wn,i?n&1|2:n&1),e):(nr(e),null);case 22:case 23:return ox(),i=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==i&&(e.flags|=8192),i&&e.mode&1?es&1073741824&&(nr(e),e.subtreeFlags&6&&(e.flags|=8192)):nr(e),null;case 24:return null;case 25:return null}throw Error(Ge(156,e.tag))}function jk(t,e){switch(Uv(e),e.tag){case 1:return Or(e.type)&&Pm(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return Su(),zn(zr),zn(lr),Xv(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return Zv(e),null;case 13:if(zn(Wn),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(Ge(340));Eu()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return zn(Wn),null;case 4:return Su(),null;case 10:return Wv(e.type._context),null;case 22:case 23:return ox(),null;case 24:return null;default:return null}}var Tp=!1,sr=!1,Gk=typeof WeakSet=="function"?WeakSet:Set,yt=null;function au(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(i){Qn(t,e,i)}else n.current=null}function C0(t,e,n){try{n()}catch(i){Qn(t,e,i)}}var _w=!1;function Wk(t,e){if(d0=Em,t=_S(),Nv(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var i=n.getSelection&&n.getSelection();if(i&&i.rangeCount!==0){n=i.anchorNode;var s=i.anchorOffset,c=i.focusNode;i=i.focusOffset;try{n.nodeType,c.nodeType}catch{n=null;break e}var d=0,l=-1,y=-1,w=0,S=0,C=t,P=null;t:for(;;){for(var D;C!==n||s!==0&&C.nodeType!==3||(l=d+s),C!==c||i!==0&&C.nodeType!==3||(y=d+i),C.nodeType===3&&(d+=C.nodeValue.length),(D=C.firstChild)!==null;)P=C,C=D;for(;;){if(C===t)break t;if(P===n&&++w===s&&(l=d),P===c&&++S===i&&(y=d),(D=C.nextSibling)!==null)break;C=P,P=C.parentNode}C=D}n=l===-1||y===-1?null:{start:l,end:y}}else n=null}n=n||{start:0,end:0}}else n=null;for(f0={focusedElem:t,selectionRange:n},Em=!1,yt=e;yt!==null;)if(e=yt,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,yt=t;else for(;yt!==null;){e=yt;try{var U=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(U!==null){var H=U.memoizedProps,ae=U.memoizedState,G=e.stateNode,V=G.getSnapshotBeforeUpdate(e.elementType===e.type?H:js(e.type,H),ae);G.__reactInternalSnapshotBeforeUpdate=V}break;case 3:var W=e.stateNode.containerInfo;W.nodeType===1?W.textContent="":W.nodeType===9&&W.documentElement&&W.removeChild(W.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Ge(163))}}catch(ie){Qn(e,e.return,ie)}if(t=e.sibling,t!==null){t.return=e.return,yt=t;break}yt=e.return}return U=_w,_w=!1,U}function fd(t,e,n){var i=e.updateQueue;if(i=i!==null?i.lastEffect:null,i!==null){var s=i=i.next;do{if((s.tag&t)===t){var c=s.destroy;s.destroy=void 0,c!==void 0&&C0(e,n,c)}s=s.next}while(s!==i)}}function pg(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var i=n.create;n.destroy=i()}n=n.next}while(n!==e)}}function M0(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function pA(t){var e=t.alternate;e!==null&&(t.alternate=null,pA(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[go],delete e[Cd],delete e[g0],delete e[Ak],delete e[Pk])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function mA(t){return t.tag===5||t.tag===3||t.tag===4}function yw(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||mA(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function L0(t,e,n){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=Am));else if(i!==4&&(t=t.child,t!==null))for(L0(t,e,n),t=t.sibling;t!==null;)L0(t,e,n),t=t.sibling}function k0(t,e,n){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(i!==4&&(t=t.child,t!==null))for(k0(t,e,n),t=t.sibling;t!==null;)k0(t,e,n),t=t.sibling}var Wi=null,Gs=!1;function Ta(t,e,n){for(n=n.child;n!==null;)gA(t,e,n),n=n.sibling}function gA(t,e,n){if(xo&&typeof xo.onCommitFiberUnmount=="function")try{xo.onCommitFiberUnmount(og,n)}catch{}switch(n.tag){case 5:sr||au(n,e);case 6:var i=Wi,s=Gs;Wi=null,Ta(t,e,n),Wi=i,Gs=s,Wi!==null&&(Gs?(t=Wi,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):Wi.removeChild(n.stateNode));break;case 18:Wi!==null&&(Gs?(t=Wi,n=n.stateNode,t.nodeType===8?K_(t.parentNode,n):t.nodeType===1&&K_(t,n),Td(t)):K_(Wi,n.stateNode));break;case 4:i=Wi,s=Gs,Wi=n.stateNode.containerInfo,Gs=!0,Ta(t,e,n),Wi=i,Gs=s;break;case 0:case 11:case 14:case 15:if(!sr&&(i=n.updateQueue,i!==null&&(i=i.lastEffect,i!==null))){s=i=i.next;do{var c=s,d=c.destroy;c=c.tag,d!==void 0&&(c&2||c&4)&&C0(n,e,d),s=s.next}while(s!==i)}Ta(t,e,n);break;case 1:if(!sr&&(au(n,e),i=n.stateNode,typeof i.componentWillUnmount=="function"))try{i.props=n.memoizedProps,i.state=n.memoizedState,i.componentWillUnmount()}catch(l){Qn(n,e,l)}Ta(t,e,n);break;case 21:Ta(t,e,n);break;case 22:n.mode&1?(sr=(i=sr)||n.memoizedState!==null,Ta(t,e,n),sr=i):Ta(t,e,n);break;default:Ta(t,e,n)}}function vw(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new Gk),e.forEach(function(i){var s=Qk.bind(null,t,i);n.has(i)||(n.add(i),i.then(s,s))})}}function Vs(t,e){var n=e.deletions;if(n!==null)for(var i=0;i<n.length;i++){var s=n[i];try{var c=t,d=e,l=d;e:for(;l!==null;){switch(l.tag){case 5:Wi=l.stateNode,Gs=!1;break e;case 3:Wi=l.stateNode.containerInfo,Gs=!0;break e;case 4:Wi=l.stateNode.containerInfo,Gs=!0;break e}l=l.return}if(Wi===null)throw Error(Ge(160));gA(c,d,s),Wi=null,Gs=!1;var y=s.alternate;y!==null&&(y.return=null),s.return=null}catch(w){Qn(s,e,w)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)_A(e,t),e=e.sibling}function _A(t,e){var n=t.alternate,i=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Vs(e,t),uo(t),i&4){try{fd(3,t,t.return),pg(3,t)}catch(H){Qn(t,t.return,H)}try{fd(5,t,t.return)}catch(H){Qn(t,t.return,H)}}break;case 1:Vs(e,t),uo(t),i&512&&n!==null&&au(n,n.return);break;case 5:if(Vs(e,t),uo(t),i&512&&n!==null&&au(n,n.return),t.flags&32){var s=t.stateNode;try{xd(s,"")}catch(H){Qn(t,t.return,H)}}if(i&4&&(s=t.stateNode,s!=null)){var c=t.memoizedProps,d=n!==null?n.memoizedProps:c,l=t.type,y=t.updateQueue;if(t.updateQueue=null,y!==null)try{l==="input"&&c.type==="radio"&&c.name!=null&&N2(s,c),n0(l,d);var w=n0(l,c);for(d=0;d<y.length;d+=2){var S=y[d],C=y[d+1];S==="style"?G2(s,C):S==="dangerouslySetInnerHTML"?V2(s,C):S==="children"?xd(s,C):Sv(s,S,C,w)}switch(l){case"input":Ky(s,c);break;case"textarea":B2(s,c);break;case"select":var P=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!c.multiple;var D=c.value;D!=null?du(s,!!c.multiple,D,!1):P!==!!c.multiple&&(c.defaultValue!=null?du(s,!!c.multiple,c.defaultValue,!0):du(s,!!c.multiple,c.multiple?[]:"",!1))}s[Cd]=c}catch(H){Qn(t,t.return,H)}}break;case 6:if(Vs(e,t),uo(t),i&4){if(t.stateNode===null)throw Error(Ge(162));s=t.stateNode,c=t.memoizedProps;try{s.nodeValue=c}catch(H){Qn(t,t.return,H)}}break;case 3:if(Vs(e,t),uo(t),i&4&&n!==null&&n.memoizedState.isDehydrated)try{Td(e.containerInfo)}catch(H){Qn(t,t.return,H)}break;case 4:Vs(e,t),uo(t);break;case 13:Vs(e,t),uo(t),s=t.child,s.flags&8192&&(c=s.memoizedState!==null,s.stateNode.isHidden=c,!c||s.alternate!==null&&s.alternate.memoizedState!==null||(rx=oi())),i&4&&vw(t);break;case 22:if(S=n!==null&&n.memoizedState!==null,t.mode&1?(sr=(w=sr)||S,Vs(e,t),sr=w):Vs(e,t),uo(t),i&8192){if(w=t.memoizedState!==null,(t.stateNode.isHidden=w)&&!S&&t.mode&1)for(yt=t,S=t.child;S!==null;){for(C=yt=S;yt!==null;){switch(P=yt,D=P.child,P.tag){case 0:case 11:case 14:case 15:fd(4,P,P.return);break;case 1:au(P,P.return);var U=P.stateNode;if(typeof U.componentWillUnmount=="function"){i=P,n=P.return;try{e=i,U.props=e.memoizedProps,U.state=e.memoizedState,U.componentWillUnmount()}catch(H){Qn(i,n,H)}}break;case 5:au(P,P.return);break;case 22:if(P.memoizedState!==null){bw(C);continue}}D!==null?(D.return=P,yt=D):bw(C)}S=S.sibling}e:for(S=null,C=t;;){if(C.tag===5){if(S===null){S=C;try{s=C.stateNode,w?(c=s.style,typeof c.setProperty=="function"?c.setProperty("display","none","important"):c.display="none"):(l=C.stateNode,y=C.memoizedProps.style,d=y!=null&&y.hasOwnProperty("display")?y.display:null,l.style.display=j2("display",d))}catch(H){Qn(t,t.return,H)}}}else if(C.tag===6){if(S===null)try{C.stateNode.nodeValue=w?"":C.memoizedProps}catch(H){Qn(t,t.return,H)}}else if((C.tag!==22&&C.tag!==23||C.memoizedState===null||C===t)&&C.child!==null){C.child.return=C,C=C.child;continue}if(C===t)break e;for(;C.sibling===null;){if(C.return===null||C.return===t)break e;S===C&&(S=null),C=C.return}S===C&&(S=null),C.sibling.return=C.return,C=C.sibling}}break;case 19:Vs(e,t),uo(t),i&4&&vw(t);break;case 21:break;default:Vs(e,t),uo(t)}}function uo(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(mA(n)){var i=n;break e}n=n.return}throw Error(Ge(160))}switch(i.tag){case 5:var s=i.stateNode;i.flags&32&&(xd(s,""),i.flags&=-33);var c=yw(t);k0(t,c,s);break;case 3:case 4:var d=i.stateNode.containerInfo,l=yw(t);L0(t,l,d);break;default:throw Error(Ge(161))}}catch(y){Qn(t,t.return,y)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function Hk(t,e,n){yt=t,yA(t)}function yA(t,e,n){for(var i=(t.mode&1)!==0;yt!==null;){var s=yt,c=s.child;if(s.tag===22&&i){var d=s.memoizedState!==null||Tp;if(!d){var l=s.alternate,y=l!==null&&l.memoizedState!==null||sr;l=Tp;var w=sr;if(Tp=d,(sr=y)&&!w)for(yt=s;yt!==null;)d=yt,y=d.child,d.tag===22&&d.memoizedState!==null?ww(s):y!==null?(y.return=d,yt=y):ww(s);for(;c!==null;)yt=c,yA(c),c=c.sibling;yt=s,Tp=l,sr=w}xw(t)}else s.subtreeFlags&8772&&c!==null?(c.return=s,yt=c):xw(t)}}function xw(t){for(;yt!==null;){var e=yt;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:sr||pg(5,e);break;case 1:var i=e.stateNode;if(e.flags&4&&!sr)if(n===null)i.componentDidMount();else{var s=e.elementType===e.type?n.memoizedProps:js(e.type,n.memoizedProps);i.componentDidUpdate(s,n.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var c=e.updateQueue;c!==null&&iw(e,c,i);break;case 3:var d=e.updateQueue;if(d!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}iw(e,d,n)}break;case 5:var l=e.stateNode;if(n===null&&e.flags&4){n=l;var y=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":y.autoFocus&&n.focus();break;case"img":y.src&&(n.src=y.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var w=e.alternate;if(w!==null){var S=w.memoizedState;if(S!==null){var C=S.dehydrated;C!==null&&Td(C)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Ge(163))}sr||e.flags&512&&M0(e)}catch(P){Qn(e,e.return,P)}}if(e===t){yt=null;break}if(n=e.sibling,n!==null){n.return=e.return,yt=n;break}yt=e.return}}function bw(t){for(;yt!==null;){var e=yt;if(e===t){yt=null;break}var n=e.sibling;if(n!==null){n.return=e.return,yt=n;break}yt=e.return}}function ww(t){for(;yt!==null;){var e=yt;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{pg(4,e)}catch(y){Qn(e,n,y)}break;case 1:var i=e.stateNode;if(typeof i.componentDidMount=="function"){var s=e.return;try{i.componentDidMount()}catch(y){Qn(e,s,y)}}var c=e.return;try{M0(e)}catch(y){Qn(e,c,y)}break;case 5:var d=e.return;try{M0(e)}catch(y){Qn(e,d,y)}}}catch(y){Qn(e,e.return,y)}if(e===t){yt=null;break}var l=e.sibling;if(l!==null){l.return=e.return,yt=l;break}yt=e.return}}var $k=Math.ceil,Fm=ta.ReactCurrentDispatcher,nx=ta.ReactCurrentOwner,Ps=ta.ReactCurrentBatchConfig,hn=0,zi=null,gi=null,Hi=0,es=0,lu=Qa(0),Ti=0,zd=null,$l=0,mg=0,ix=0,pd=null,Rr=null,rx=0,Pu=1/0,Vo=null,Nm=!1,R0=null,Wa=null,Sp=!1,za=null,Bm=0,md=0,D0=null,om=-1,am=0;function wr(){return hn&6?oi():om!==-1?om:om=oi()}function Ha(t){return t.mode&1?hn&2&&Hi!==0?Hi&-Hi:Ck.transition!==null?(am===0&&(am=tS()),am):(t=bn,t!==0||(t=window.event,t=t===void 0?16:lS(t.type)),t):1}function qs(t,e,n,i){if(50<md)throw md=0,D0=null,Error(Ge(185));qd(t,n,i),(!(hn&2)||t!==zi)&&(t===zi&&(!(hn&2)&&(mg|=n),Ti===4&&Ra(t,Hi)),Fr(t,i),n===1&&hn===0&&!(e.mode&1)&&(Pu=oi()+500,hg&&el()))}function Fr(t,e){var n=t.callbackNode;CL(t,e);var i=wm(t,t===zi?Hi:0);if(i===0)n!==null&&Lb(n),t.callbackNode=null,t.callbackPriority=0;else if(e=i&-i,t.callbackPriority!==e){if(n!=null&&Lb(n),e===1)t.tag===0?Ik(Ew.bind(null,t)):PS(Ew.bind(null,t)),Tk(function(){!(hn&6)&&el()}),n=null;else{switch(nS(i)){case 1:n=Mv;break;case 4:n=Q2;break;case 16:n=bm;break;case 536870912:n=eS;break;default:n=bm}n=AA(n,vA.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function vA(t,e){if(om=-1,am=0,hn&6)throw Error(Ge(327));var n=t.callbackNode;if(_u()&&t.callbackNode!==n)return null;var i=wm(t,t===zi?Hi:0);if(i===0)return null;if(i&30||i&t.expiredLanes||e)e=Um(t,i);else{e=i;var s=hn;hn|=2;var c=bA();(zi!==t||Hi!==e)&&(Vo=null,Pu=oi()+500,Ul(t,e));do try{Xk();break}catch(l){xA(t,l)}while(1);Gv(),Fm.current=c,hn=s,gi!==null?e=0:(zi=null,Hi=0,e=Ti)}if(e!==0){if(e===2&&(s=a0(t),s!==0&&(i=s,e=z0(t,s))),e===1)throw n=zd,Ul(t,0),Ra(t,i),Fr(t,oi()),n;if(e===6)Ra(t,i);else{if(s=t.current.alternate,!(i&30)&&!qk(s)&&(e=Um(t,i),e===2&&(c=a0(t),c!==0&&(i=c,e=z0(t,c))),e===1))throw n=zd,Ul(t,0),Ra(t,i),Fr(t,oi()),n;switch(t.finishedWork=s,t.finishedLanes=i,e){case 0:case 1:throw Error(Ge(345));case 2:Rl(t,Rr,Vo);break;case 3:if(Ra(t,i),(i&130023424)===i&&(e=rx+500-oi(),10<e)){if(wm(t,0)!==0)break;if(s=t.suspendedLanes,(s&i)!==i){wr(),t.pingedLanes|=t.suspendedLanes&s;break}t.timeoutHandle=m0(Rl.bind(null,t,Rr,Vo),e);break}Rl(t,Rr,Vo);break;case 4:if(Ra(t,i),(i&4194240)===i)break;for(e=t.eventTimes,s=-1;0<i;){var d=31-$s(i);c=1<<d,d=e[d],d>s&&(s=d),i&=~c}if(i=s,i=oi()-i,i=(120>i?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*$k(i/1960))-i,10<i){t.timeoutHandle=m0(Rl.bind(null,t,Rr,Vo),i);break}Rl(t,Rr,Vo);break;case 5:Rl(t,Rr,Vo);break;default:throw Error(Ge(329))}}}return Fr(t,oi()),t.callbackNode===n?vA.bind(null,t):null}function z0(t,e){var n=pd;return t.current.memoizedState.isDehydrated&&(Ul(t,e).flags|=256),t=Um(t,e),t!==2&&(e=Rr,Rr=n,e!==null&&O0(e)),t}function O0(t){Rr===null?Rr=t:Rr.push.apply(Rr,t)}function qk(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var i=0;i<n.length;i++){var s=n[i],c=s.getSnapshot;s=s.value;try{if(!Zs(c(),s))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Ra(t,e){for(e&=~ix,e&=~mg,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-$s(e),i=1<<n;t[n]=-1,e&=~i}}function Ew(t){if(hn&6)throw Error(Ge(327));_u();var e=wm(t,0);if(!(e&1))return Fr(t,oi()),null;var n=Um(t,e);if(t.tag!==0&&n===2){var i=a0(t);i!==0&&(e=i,n=z0(t,i))}if(n===1)throw n=zd,Ul(t,0),Ra(t,e),Fr(t,oi()),n;if(n===6)throw Error(Ge(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,Rl(t,Rr,Vo),Fr(t,oi()),null}function sx(t,e){var n=hn;hn|=1;try{return t(e)}finally{hn=n,hn===0&&(Pu=oi()+500,hg&&el())}}function ql(t){za!==null&&za.tag===0&&!(hn&6)&&_u();var e=hn;hn|=1;var n=Ps.transition,i=bn;try{if(Ps.transition=null,bn=1,t)return t()}finally{bn=i,Ps.transition=n,hn=e,!(hn&6)&&el()}}function ox(){es=lu.current,zn(lu)}function Ul(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,Ek(n)),gi!==null)for(n=gi.return;n!==null;){var i=n;switch(Uv(i),i.tag){case 1:i=i.type.childContextTypes,i!=null&&Pm();break;case 3:Su(),zn(zr),zn(lr),Xv();break;case 5:Zv(i);break;case 4:Su();break;case 13:zn(Wn);break;case 19:zn(Wn);break;case 10:Wv(i.type._context);break;case 22:case 23:ox()}n=n.return}if(zi=t,gi=t=$a(t.current,null),Hi=es=e,Ti=0,zd=null,ix=mg=$l=0,Rr=pd=null,Ol!==null){for(e=0;e<Ol.length;e++)if(n=Ol[e],i=n.interleaved,i!==null){n.interleaved=null;var s=i.next,c=n.pending;if(c!==null){var d=c.next;c.next=s,i.next=d}n.pending=i}Ol=null}return t}function xA(t,e){do{var n=gi;try{if(Gv(),im.current=Om,zm){for(var i=$n.memoizedState;i!==null;){var s=i.queue;s!==null&&(s.pending=null),i=i.next}zm=!1}if(Hl=0,Ri=Ei=$n=null,dd=!1,kd=0,nx.current=null,n===null||n.return===null){Ti=1,zd=e,gi=null;break}e:{var c=t,d=n.return,l=n,y=e;if(e=Hi,l.flags|=32768,y!==null&&typeof y=="object"&&typeof y.then=="function"){var w=y,S=l,C=S.tag;if(!(S.mode&1)&&(C===0||C===11||C===15)){var P=S.alternate;P?(S.updateQueue=P.updateQueue,S.memoizedState=P.memoizedState,S.lanes=P.lanes):(S.updateQueue=null,S.memoizedState=null)}var D=uw(d);if(D!==null){D.flags&=-257,hw(D,d,l,c,e),D.mode&1&&cw(c,w,e),e=D,y=w;var U=e.updateQueue;if(U===null){var H=new Set;H.add(y),e.updateQueue=H}else U.add(y);break e}else{if(!(e&1)){cw(c,w,e),ax();break e}y=Error(Ge(426))}}else if(Bn&&l.mode&1){var ae=uw(d);if(ae!==null){!(ae.flags&65536)&&(ae.flags|=256),hw(ae,d,l,c,e),Vv(Au(y,l));break e}}c=y=Au(y,l),Ti!==4&&(Ti=2),pd===null?pd=[c]:pd.push(c),c=d;do{switch(c.tag){case 3:c.flags|=65536,e&=-e,c.lanes|=e;var G=iA(c,y,e);nw(c,G);break e;case 1:l=y;var V=c.type,W=c.stateNode;if(!(c.flags&128)&&(typeof V.getDerivedStateFromError=="function"||W!==null&&typeof W.componentDidCatch=="function"&&(Wa===null||!Wa.has(W)))){c.flags|=65536,e&=-e,c.lanes|=e;var ie=rA(c,l,e);nw(c,ie);break e}}c=c.return}while(c!==null)}EA(n)}catch(ge){e=ge,gi===n&&n!==null&&(gi=n=n.return);continue}break}while(1)}function bA(){var t=Fm.current;return Fm.current=Om,t===null?Om:t}function ax(){(Ti===0||Ti===3||Ti===2)&&(Ti=4),zi===null||!($l&268435455)&&!(mg&268435455)||Ra(zi,Hi)}function Um(t,e){var n=hn;hn|=2;var i=bA();(zi!==t||Hi!==e)&&(Vo=null,Ul(t,e));do try{Zk();break}catch(s){xA(t,s)}while(1);if(Gv(),hn=n,Fm.current=i,gi!==null)throw Error(Ge(261));return zi=null,Hi=0,Ti}function Zk(){for(;gi!==null;)wA(gi)}function Xk(){for(;gi!==null&&!xL();)wA(gi)}function wA(t){var e=SA(t.alternate,t,es);t.memoizedProps=t.pendingProps,e===null?EA(t):gi=e,nx.current=null}function EA(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=jk(n,e),n!==null){n.flags&=32767,gi=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Ti=6,gi=null;return}}else if(n=Vk(n,e,es),n!==null){gi=n;return}if(e=e.sibling,e!==null){gi=e;return}gi=e=t}while(e!==null);Ti===0&&(Ti=5)}function Rl(t,e,n){var i=bn,s=Ps.transition;try{Ps.transition=null,bn=1,Yk(t,e,n,i)}finally{Ps.transition=s,bn=i}return null}function Yk(t,e,n,i){do _u();while(za!==null);if(hn&6)throw Error(Ge(327));n=t.finishedWork;var s=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(Ge(177));t.callbackNode=null,t.callbackPriority=0;var c=n.lanes|n.childLanes;if(ML(t,c),t===zi&&(gi=zi=null,Hi=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||Sp||(Sp=!0,AA(bm,function(){return _u(),null})),c=(n.flags&15990)!==0,n.subtreeFlags&15990||c){c=Ps.transition,Ps.transition=null;var d=bn;bn=1;var l=hn;hn|=4,nx.current=null,Wk(t,n),_A(n,t),gk(f0),Em=!!d0,f0=d0=null,t.current=n,Hk(n),bL(),hn=l,bn=d,Ps.transition=c}else t.current=n;if(Sp&&(Sp=!1,za=t,Bm=s),c=t.pendingLanes,c===0&&(Wa=null),TL(n.stateNode),Fr(t,oi()),e!==null)for(i=t.onRecoverableError,n=0;n<e.length;n++)s=e[n],i(s.value,{componentStack:s.stack,digest:s.digest});if(Nm)throw Nm=!1,t=R0,R0=null,t;return Bm&1&&t.tag!==0&&_u(),c=t.pendingLanes,c&1?t===D0?md++:(md=0,D0=t):md=0,el(),null}function _u(){if(za!==null){var t=nS(Bm),e=Ps.transition,n=bn;try{if(Ps.transition=null,bn=16>t?16:t,za===null)var i=!1;else{if(t=za,za=null,Bm=0,hn&6)throw Error(Ge(331));var s=hn;for(hn|=4,yt=t.current;yt!==null;){var c=yt,d=c.child;if(yt.flags&16){var l=c.deletions;if(l!==null){for(var y=0;y<l.length;y++){var w=l[y];for(yt=w;yt!==null;){var S=yt;switch(S.tag){case 0:case 11:case 15:fd(8,S,c)}var C=S.child;if(C!==null)C.return=S,yt=C;else for(;yt!==null;){S=yt;var P=S.sibling,D=S.return;if(pA(S),S===w){yt=null;break}if(P!==null){P.return=D,yt=P;break}yt=D}}}var U=c.alternate;if(U!==null){var H=U.child;if(H!==null){U.child=null;do{var ae=H.sibling;H.sibling=null,H=ae}while(H!==null)}}yt=c}}if(c.subtreeFlags&2064&&d!==null)d.return=c,yt=d;else e:for(;yt!==null;){if(c=yt,c.flags&2048)switch(c.tag){case 0:case 11:case 15:fd(9,c,c.return)}var G=c.sibling;if(G!==null){G.return=c.return,yt=G;break e}yt=c.return}}var V=t.current;for(yt=V;yt!==null;){d=yt;var W=d.child;if(d.subtreeFlags&2064&&W!==null)W.return=d,yt=W;else e:for(d=V;yt!==null;){if(l=yt,l.flags&2048)try{switch(l.tag){case 0:case 11:case 15:pg(9,l)}}catch(ge){Qn(l,l.return,ge)}if(l===d){yt=null;break e}var ie=l.sibling;if(ie!==null){ie.return=l.return,yt=ie;break e}yt=l.return}}if(hn=s,el(),xo&&typeof xo.onPostCommitFiberRoot=="function")try{xo.onPostCommitFiberRoot(og,t)}catch{}i=!0}return i}finally{bn=n,Ps.transition=e}}return!1}function Tw(t,e,n){e=Au(n,e),e=iA(t,e,1),t=Ga(t,e,1),e=wr(),t!==null&&(qd(t,1,e),Fr(t,e))}function Qn(t,e,n){if(t.tag===3)Tw(t,t,n);else for(;e!==null;){if(e.tag===3){Tw(e,t,n);break}else if(e.tag===1){var i=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(Wa===null||!Wa.has(i))){t=Au(n,t),t=rA(e,t,1),e=Ga(e,t,1),t=wr(),e!==null&&(qd(e,1,t),Fr(e,t));break}}e=e.return}}function Kk(t,e,n){var i=t.pingCache;i!==null&&i.delete(e),e=wr(),t.pingedLanes|=t.suspendedLanes&n,zi===t&&(Hi&n)===n&&(Ti===4||Ti===3&&(Hi&130023424)===Hi&&500>oi()-rx?Ul(t,0):ix|=n),Fr(t,e)}function TA(t,e){e===0&&(t.mode&1?(e=mp,mp<<=1,!(mp&130023424)&&(mp=4194304)):e=1);var n=wr();t=Yo(t,e),t!==null&&(qd(t,e,n),Fr(t,n))}function Jk(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),TA(t,n)}function Qk(t,e){var n=0;switch(t.tag){case 13:var i=t.stateNode,s=t.memoizedState;s!==null&&(n=s.retryLane);break;case 19:i=t.stateNode;break;default:throw Error(Ge(314))}i!==null&&i.delete(e),TA(t,n)}var SA;SA=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||zr.current)Dr=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return Dr=!1,Uk(t,e,n);Dr=!!(t.flags&131072)}else Dr=!1,Bn&&e.flags&1048576&&IS(e,Mm,e.index);switch(e.lanes=0,e.tag){case 2:var i=e.type;sm(t,e),t=e.pendingProps;var s=wu(e,lr.current);gu(e,n),s=Kv(null,e,i,t,s,n);var c=Jv();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Or(i)?(c=!0,Im(e)):c=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,$v(e),s.updater=dg,e.stateNode=s,s._reactInternals=e,w0(e,i,t,n),e=S0(null,e,i,!0,c,n)):(e.tag=0,Bn&&c&&Bv(e),xr(null,e,s,n),e=e.child),e;case 16:i=e.elementType;e:{switch(sm(t,e),t=e.pendingProps,s=i._init,i=s(i._payload),e.type=i,s=e.tag=t3(i),t=js(i,t),s){case 0:e=T0(null,e,i,t,n);break e;case 1:e=pw(null,e,i,t,n);break e;case 11:e=dw(null,e,i,t,n);break e;case 14:e=fw(null,e,i,js(i.type,t),n);break e}throw Error(Ge(306,i,""))}return e;case 0:return i=e.type,s=e.pendingProps,s=e.elementType===i?s:js(i,s),T0(t,e,i,s,n);case 1:return i=e.type,s=e.pendingProps,s=e.elementType===i?s:js(i,s),pw(t,e,i,s,n);case 3:e:{if(lA(e),t===null)throw Error(Ge(387));i=e.pendingProps,c=e.memoizedState,s=c.element,kS(t,e),Rm(e,i,null,n);var d=e.memoizedState;if(i=d.element,c.isDehydrated)if(c={element:i,isDehydrated:!1,cache:d.cache,pendingSuspenseBoundaries:d.pendingSuspenseBoundaries,transitions:d.transitions},e.updateQueue.baseState=c,e.memoizedState=c,e.flags&256){s=Au(Error(Ge(423)),e),e=mw(t,e,i,n,s);break e}else if(i!==s){s=Au(Error(Ge(424)),e),e=mw(t,e,i,n,s);break e}else for(is=ja(e.stateNode.containerInfo.firstChild),ss=e,Bn=!0,Ws=null,n=OS(e,null,i,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Eu(),i===s){e=Ko(t,e,n);break e}xr(t,e,i,n)}e=e.child}return e;case 5:return FS(e),t===null&&v0(e),i=e.type,s=e.pendingProps,c=t!==null?t.memoizedProps:null,d=s.children,p0(i,s)?d=null:c!==null&&p0(i,c)&&(e.flags|=32),aA(t,e),xr(t,e,d,n),e.child;case 6:return t===null&&v0(e),null;case 13:return cA(t,e,n);case 4:return qv(e,e.stateNode.containerInfo),i=e.pendingProps,t===null?e.child=Tu(e,null,i,n):xr(t,e,i,n),e.child;case 11:return i=e.type,s=e.pendingProps,s=e.elementType===i?s:js(i,s),dw(t,e,i,s,n);case 7:return xr(t,e,e.pendingProps,n),e.child;case 8:return xr(t,e,e.pendingProps.children,n),e.child;case 12:return xr(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(i=e.type._context,s=e.pendingProps,c=e.memoizedProps,d=s.value,kn(Lm,i._currentValue),i._currentValue=d,c!==null)if(Zs(c.value,d)){if(c.children===s.children&&!zr.current){e=Ko(t,e,n);break e}}else for(c=e.child,c!==null&&(c.return=e);c!==null;){var l=c.dependencies;if(l!==null){d=c.child;for(var y=l.firstContext;y!==null;){if(y.context===i){if(c.tag===1){y=qo(-1,n&-n),y.tag=2;var w=c.updateQueue;if(w!==null){w=w.shared;var S=w.pending;S===null?y.next=y:(y.next=S.next,S.next=y),w.pending=y}}c.lanes|=n,y=c.alternate,y!==null&&(y.lanes|=n),x0(c.return,n,e),l.lanes|=n;break}y=y.next}}else if(c.tag===10)d=c.type===e.type?null:c.child;else if(c.tag===18){if(d=c.return,d===null)throw Error(Ge(341));d.lanes|=n,l=d.alternate,l!==null&&(l.lanes|=n),x0(d,n,e),d=c.sibling}else d=c.child;if(d!==null)d.return=c;else for(d=c;d!==null;){if(d===e){d=null;break}if(c=d.sibling,c!==null){c.return=d.return,d=c;break}d=d.return}c=d}xr(t,e,s.children,n),e=e.child}return e;case 9:return s=e.type,i=e.pendingProps.children,gu(e,n),s=Cs(s),i=i(s),e.flags|=1,xr(t,e,i,n),e.child;case 14:return i=e.type,s=js(i,e.pendingProps),s=js(i.type,s),fw(t,e,i,s,n);case 15:return sA(t,e,e.type,e.pendingProps,n);case 17:return i=e.type,s=e.pendingProps,s=e.elementType===i?s:js(i,s),sm(t,e),e.tag=1,Or(i)?(t=!0,Im(e)):t=!1,gu(e,n),DS(e,i,s),w0(e,i,s,n),S0(null,e,i,!0,t,n);case 19:return uA(t,e,n);case 22:return oA(t,e,n)}throw Error(Ge(156,e.tag))};function AA(t,e){return J2(t,e)}function e3(t,e,n,i){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function As(t,e,n,i){return new e3(t,e,n,i)}function lx(t){return t=t.prototype,!(!t||!t.isReactComponent)}function t3(t){if(typeof t=="function")return lx(t)?1:0;if(t!=null){if(t=t.$$typeof,t===Pv)return 11;if(t===Iv)return 14}return 2}function $a(t,e){var n=t.alternate;return n===null?(n=As(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function lm(t,e,n,i,s,c){var d=2;if(i=t,typeof t=="function")lx(t)&&(d=1);else if(typeof t=="string")d=5;else e:switch(t){case Jc:return Vl(n.children,s,c,e);case Av:d=8,s|=8;break;case $y:return t=As(12,n,e,s|2),t.elementType=$y,t.lanes=c,t;case qy:return t=As(13,n,e,s),t.elementType=qy,t.lanes=c,t;case Zy:return t=As(19,n,e,s),t.elementType=Zy,t.lanes=c,t;case z2:return gg(n,s,c,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case R2:d=10;break e;case D2:d=9;break e;case Pv:d=11;break e;case Iv:d=14;break e;case Ma:d=16,i=null;break e}throw Error(Ge(130,t==null?t:typeof t,""))}return e=As(d,n,e,s),e.elementType=t,e.type=i,e.lanes=c,e}function Vl(t,e,n,i){return t=As(7,t,i,e),t.lanes=n,t}function gg(t,e,n,i){return t=As(22,t,i,e),t.elementType=z2,t.lanes=n,t.stateNode={isHidden:!1},t}function sy(t,e,n){return t=As(6,t,null,e),t.lanes=n,t}function oy(t,e,n){return e=As(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function n3(t,e,n,i,s){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=U_(0),this.expirationTimes=U_(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=U_(0),this.identifierPrefix=i,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function cx(t,e,n,i,s,c,d,l,y){return t=new n3(t,e,n,l,y),e===1?(e=1,c===!0&&(e|=8)):e=0,c=As(3,null,null,e),t.current=c,c.stateNode=t,c.memoizedState={element:i,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},$v(c),t}function i3(t,e,n){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Kc,key:i==null?null:""+i,children:t,containerInfo:e,implementation:n}}function PA(t){if(!t)return Ya;t=t._reactInternals;e:{if(Ql(t)!==t||t.tag!==1)throw Error(Ge(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Or(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(Ge(171))}if(t.tag===1){var n=t.type;if(Or(n))return AS(t,n,e)}return e}function IA(t,e,n,i,s,c,d,l,y){return t=cx(n,i,!0,t,s,c,d,l,y),t.context=PA(null),n=t.current,i=wr(),s=Ha(n),c=qo(i,s),c.callback=e??null,Ga(n,c,s),t.current.lanes=s,qd(t,s,i),Fr(t,i),t}function _g(t,e,n,i){var s=e.current,c=wr(),d=Ha(s);return n=PA(n),e.context===null?e.context=n:e.pendingContext=n,e=qo(c,d),e.payload={element:t},i=i===void 0?null:i,i!==null&&(e.callback=i),t=Ga(s,e,d),t!==null&&(qs(t,s,d,c),nm(t,s,d)),d}function Vm(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function Sw(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function ux(t,e){Sw(t,e),(t=t.alternate)&&Sw(t,e)}function r3(){return null}var CA=typeof reportError=="function"?reportError:function(t){console.error(t)};function hx(t){this._internalRoot=t}yg.prototype.render=hx.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(Ge(409));_g(t,e,null,null)};yg.prototype.unmount=hx.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;ql(function(){_g(null,t,null,null)}),e[Xo]=null}};function yg(t){this._internalRoot=t}yg.prototype.unstable_scheduleHydration=function(t){if(t){var e=sS();t={blockedOn:null,target:t,priority:e};for(var n=0;n<ka.length&&e!==0&&e<ka[n].priority;n++);ka.splice(n,0,t),n===0&&aS(t)}};function dx(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function vg(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function Aw(){}function s3(t,e,n,i,s){if(s){if(typeof i=="function"){var c=i;i=function(){var w=Vm(d);c.call(w)}}var d=IA(e,i,t,0,null,!1,!1,"",Aw);return t._reactRootContainer=d,t[Xo]=d.current,Pd(t.nodeType===8?t.parentNode:t),ql(),d}for(;s=t.lastChild;)t.removeChild(s);if(typeof i=="function"){var l=i;i=function(){var w=Vm(y);l.call(w)}}var y=cx(t,0,!1,null,null,!1,!1,"",Aw);return t._reactRootContainer=y,t[Xo]=y.current,Pd(t.nodeType===8?t.parentNode:t),ql(function(){_g(e,y,n,i)}),y}function xg(t,e,n,i,s){var c=n._reactRootContainer;if(c){var d=c;if(typeof s=="function"){var l=s;s=function(){var y=Vm(d);l.call(y)}}_g(e,d,t,s)}else d=s3(n,e,t,s,i);return Vm(d)}iS=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=nd(e.pendingLanes);n!==0&&(Lv(e,n|1),Fr(e,oi()),!(hn&6)&&(Pu=oi()+500,el()))}break;case 13:ql(function(){var i=Yo(t,1);if(i!==null){var s=wr();qs(i,t,1,s)}}),ux(t,1)}};kv=function(t){if(t.tag===13){var e=Yo(t,134217728);if(e!==null){var n=wr();qs(e,t,134217728,n)}ux(t,134217728)}};rS=function(t){if(t.tag===13){var e=Ha(t),n=Yo(t,e);if(n!==null){var i=wr();qs(n,t,e,i)}ux(t,e)}};sS=function(){return bn};oS=function(t,e){var n=bn;try{return bn=t,e()}finally{bn=n}};r0=function(t,e,n){switch(e){case"input":if(Ky(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var i=n[e];if(i!==t&&i.form===t.form){var s=ug(i);if(!s)throw Error(Ge(90));F2(i),Ky(i,s)}}}break;case"textarea":B2(t,n);break;case"select":e=n.value,e!=null&&du(t,!!n.multiple,e,!1)}};$2=sx;q2=ql;var o3={usingClientEntryPoint:!1,Events:[Xd,nu,ug,W2,H2,sx]},Wh={findFiberByHostInstance:zl,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},a3={bundleType:Wh.bundleType,version:Wh.version,rendererPackageName:Wh.rendererPackageName,rendererConfig:Wh.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ta.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=Y2(t),t===null?null:t.stateNode},findFiberByHostInstance:Wh.findFiberByHostInstance||r3,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Ap=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Ap.isDisabled&&Ap.supportsFiber)try{og=Ap.inject(a3),xo=Ap}catch{}}ls.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=o3;ls.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!dx(e))throw Error(Ge(200));return i3(t,e,null,n)};ls.createRoot=function(t,e){if(!dx(t))throw Error(Ge(299));var n=!1,i="",s=CA;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(i=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=cx(t,1,!1,null,null,n,!1,i,s),t[Xo]=e.current,Pd(t.nodeType===8?t.parentNode:t),new hx(e)};ls.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(Ge(188)):(t=Object.keys(t).join(","),Error(Ge(268,t)));return t=Y2(e),t=t===null?null:t.stateNode,t};ls.flushSync=function(t){return ql(t)};ls.hydrate=function(t,e,n){if(!vg(e))throw Error(Ge(200));return xg(null,t,e,!0,n)};ls.hydrateRoot=function(t,e,n){if(!dx(t))throw Error(Ge(405));var i=n!=null&&n.hydratedSources||null,s=!1,c="",d=CA;if(n!=null&&(n.unstable_strictMode===!0&&(s=!0),n.identifierPrefix!==void 0&&(c=n.identifierPrefix),n.onRecoverableError!==void 0&&(d=n.onRecoverableError)),e=IA(e,null,t,1,n??null,s,!1,c,d),t[Xo]=e.current,Pd(t),i)for(t=0;t<i.length;t++)n=i[t],s=n._getVersion,s=s(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,s]:e.mutableSourceEagerHydrationData.push(n,s);return new yg(e)};ls.render=function(t,e,n){if(!vg(e))throw Error(Ge(200));return xg(null,t,e,!1,n)};ls.unmountComponentAtNode=function(t){if(!vg(t))throw Error(Ge(40));return t._reactRootContainer?(ql(function(){xg(null,null,t,!1,function(){t._reactRootContainer=null,t[Xo]=null})}),!0):!1};ls.unstable_batchedUpdates=sx;ls.unstable_renderSubtreeIntoContainer=function(t,e,n,i){if(!vg(n))throw Error(Ge(200));if(t==null||t._reactInternals===void 0)throw Error(Ge(38));return xg(t,e,n,!1,i)};ls.version="18.2.0-next-9e3b772b8-20220608";function MA(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(MA)}catch(t){console.error(t)}}MA(),I2.exports=ls;var fx=I2.exports,LA,Pw=fx;LA=Pw.createRoot,Pw.hydrateRoot;const l3="modulepreload",c3=function(t){return"/"+t},Iw={},u3=function(e,n,i){if(!n||n.length===0)return e();const s=document.getElementsByTagName("link");return Promise.all(n.map(c=>{if(c=c3(c),c in Iw)return;Iw[c]=!0;const d=c.endsWith(".css"),l=d?'[rel="stylesheet"]':"";if(!!i)for(let S=s.length-1;S>=0;S--){const C=s[S];if(C.href===c&&(!d||C.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${c}"]${l}`))return;const w=document.createElement("link");if(w.rel=d?"stylesheet":l3,d||(w.as="script",w.crossOrigin=""),w.href=c,document.head.appendChild(w),d)return new Promise((S,C)=>{w.addEventListener("load",S),w.addEventListener("error",()=>C(new Error(`Unable to preload CSS for ${c}`)))})})).then(()=>e()).catch(c=>{const d=new Event("vite:preloadError",{cancelable:!0});if(d.payload=c,window.dispatchEvent(d),!d.defaultPrevented)throw c})},h3=at.createContext(null);function d3(t,e){const n=Array.isArray(t)?t[0]:t?t.x:0,i=Array.isArray(t)?t[1]:t?t.y:0,s=Array.isArray(e)?e[0]:e?e.x:0,c=Array.isArray(e)?e[1]:e?e.y:0;return n===s&&i===c}function Go(t,e){if(t===e)return!0;if(!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!Go(t[n],e[n]))return!1;return!0}else if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(const s of n)if(!e.hasOwnProperty(s)||!Go(t[s],e[s]))return!1;return!0}return!1}function f3(t){const e=t.clone();return e.pixelsToGLUnits=t.pixelsToGLUnits,e}function Cw(t,e){if(!t.getProjection)return;const n=t.getProjection(),i=e.getProjection();Go(n,i)||e.setProjection(n)}function Mw(t){return{longitude:t.center.lng,latitude:t.center.lat,zoom:t.zoom,pitch:t.pitch,bearing:t.bearing,padding:t.padding}}function Lw(t,e){const n=e.viewState||e;let i=!1;if("longitude"in n&&"latitude"in n){const s=t.center;t.center=new s.constructor(n.longitude,n.latitude),i=i||s!==t.center}if("zoom"in n){const s=t.zoom;t.zoom=n.zoom,i=i||s!==t.zoom}if("bearing"in n){const s=t.bearing;t.bearing=n.bearing,i=i||s!==t.bearing}if("pitch"in n){const s=t.pitch;t.pitch=n.pitch,i=i||s!==t.pitch}return n.padding&&!t.isPaddingEqual(n.padding)&&(i=!0,t.padding=n.padding),i}const p3=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function kw(t){if(!t)return null;if(typeof t=="string"||("toJS"in t&&(t=t.toJS()),!t.layers))return t;const e={};for(const i of t.layers)e[i.id]=i;const n=t.layers.map(i=>{let s=null;"interactive"in i&&(s=Object.assign({},i),delete s.interactive);const c=e[i.ref];if(c){s=s||Object.assign({},i),delete s.ref;for(const d of p3)d in c&&(s[d]=c[d])}return s||i});return{...t,layers:n}}const Rw={version:8,sources:{},layers:[]},Dw={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},ay={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},zw={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},m3=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],g3=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class Iu{constructor(e,n,i){this._map=null,this._internalUpdate=!1,this._inRender=!1,this._hoveredFeatures=null,this._deferredEvents={move:!1,zoom:!1,pitch:!1,rotate:!1},this._onEvent=s=>{const c=this.props[zw[s.type]];c?c(s):s.type==="error"&&console.error(s.error)},this._onPointerEvent=s=>{(s.type==="mousemove"||s.type==="mouseout")&&this._updateHover(s);const c=this.props[Dw[s.type]];c&&(this.props.interactiveLayerIds&&s.type!=="mouseover"&&s.type!=="mouseout"&&(s.features=this._hoveredFeatures||this._queryRenderedFeatures(s.point)),c(s),delete s.features)},this._onCameraEvent=s=>{if(!this._internalUpdate){const c=this.props[ay[s.type]];c&&c(s)}s.type in this._deferredEvents&&(this._deferredEvents[s.type]=!1)},this._MapClass=e,this.props=n,this._initialize(i)}get map(){return this._map}get transform(){return this._renderTransform}setProps(e){const n=this.props;this.props=e;const i=this._updateSettings(e,n);i&&this._createShadowTransform(this._map);const s=this._updateSize(e),c=this._updateViewState(e,!0);this._updateStyle(e,n),this._updateStyleComponents(e,n),this._updateHandlers(e,n),(i||s||c&&!this._map.isMoving())&&this.redraw()}static reuse(e,n){const i=Iu.savedMaps.pop();if(!i)return null;const s=i.map,c=s.getContainer();for(n.className=c.className;c.childNodes.length>0;)n.appendChild(c.childNodes[0]);s._container=n;const d=s._resizeObserver;d&&(d.disconnect(),d.observe(n)),i.setProps({...e,styleDiffing:!1}),s.resize();const{initialViewState:l}=e;return l&&(l.bounds?s.fitBounds(l.bounds,{...l.fitBoundsOptions,duration:0}):i._updateViewState(l,!1)),s.isStyleLoaded()?s.fire("load"):s.once("styledata",()=>s.fire("load")),s._update(),i}_initialize(e){const{props:n}=this,{mapStyle:i=Rw}=n,s={...n,...n.initialViewState,accessToken:n.mapboxAccessToken||_3()||null,container:e,style:kw(i)},c=s.initialViewState||s.viewState||s;if(Object.assign(s,{center:[c.longitude||0,c.latitude||0],zoom:c.zoom||0,pitch:c.pitch||0,bearing:c.bearing||0}),n.gl){const S=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=S,n.gl)}const d=new this._MapClass(s);c.padding&&d.setPadding(c.padding),n.cursor&&(d.getCanvas().style.cursor=n.cursor),this._createShadowTransform(d);const l=d._render;d._render=S=>{this._inRender=!0,l.call(d,S),this._inRender=!1};const y=d._renderTaskQueue.run;d._renderTaskQueue.run=S=>{y.call(d._renderTaskQueue,S),this._onBeforeRepaint()},d.on("render",()=>this._onAfterRepaint());const w=d.fire;d.fire=this._fireEvent.bind(this,w),d.on("resize",()=>{this._renderTransform.resize(d.transform.width,d.transform.height)}),d.on("styledata",()=>{this._updateStyleComponents(this.props,{}),Cw(d.transform,this._renderTransform)}),d.on("sourcedata",()=>this._updateStyleComponents(this.props,{}));for(const S in Dw)d.on(S,this._onPointerEvent);for(const S in ay)d.on(S,this._onCameraEvent);for(const S in zw)d.on(S,this._onEvent);this._map=d}recycle(){const n=this.map.getContainer().querySelector("[mapboxgl-children]");n==null||n.remove(),Iu.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const e=this._map;!this._inRender&&e.style&&(e._frame&&(e._frame.cancel(),e._frame=null),e._render())}_createShadowTransform(e){const n=f3(e.transform);e.painter.transform=n,this._renderTransform=n}_updateSize(e){const{viewState:n}=e;if(n){const i=this._map;if(n.width!==i.transform.width||n.height!==i.transform.height)return i.resize(),!0}return!1}_updateViewState(e,n){if(this._internalUpdate)return!1;const i=this._map,s=this._renderTransform,{zoom:c,pitch:d,bearing:l}=s,y=i.isMoving();y&&(s.cameraElevationReference="sea");const w=Lw(s,{...Mw(i.transform),...e});if(y&&(s.cameraElevationReference="ground"),w&&n){const S=this._deferredEvents;S.move=!0,S.zoom||(S.zoom=c!==s.zoom),S.rotate||(S.rotate=l!==s.bearing),S.pitch||(S.pitch=d!==s.pitch)}return y||Lw(i.transform,e),w}_updateSettings(e,n){const i=this._map;let s=!1;for(const c of m3)if(c in e&&!Go(e[c],n[c])){s=!0;const d=i[`set${c[0].toUpperCase()}${c.slice(1)}`];d==null||d.call(i,e[c])}return s}_updateStyle(e,n){if(e.cursor!==n.cursor&&(this._map.getCanvas().style.cursor=e.cursor||""),e.mapStyle!==n.mapStyle){const{mapStyle:i=Rw,styleDiffing:s=!0}=e,c={diff:s};return"localIdeographFontFamily"in e&&(c.localIdeographFontFamily=e.localIdeographFontFamily),this._map.setStyle(kw(i),c),!0}return!1}_updateStyleComponents(e,n){const i=this._map;let s=!1;return i.isStyleLoaded()&&("light"in e&&i.setLight&&!Go(e.light,n.light)&&(s=!0,i.setLight(e.light)),"fog"in e&&i.setFog&&!Go(e.fog,n.fog)&&(s=!0,i.setFog(e.fog)),"terrain"in e&&i.setTerrain&&!Go(e.terrain,n.terrain)&&(!e.terrain||i.getSource(e.terrain.source))&&(s=!0,i.setTerrain(e.terrain))),s}_updateHandlers(e,n){var i,s;const c=this._map;let d=!1;for(const l of g3){const y=(i=e[l])!==null&&i!==void 0?i:!0,w=(s=n[l])!==null&&s!==void 0?s:!0;Go(y,w)||(d=!0,y?c[l].enable(y):c[l].disable())}return d}_queryRenderedFeatures(e){const n=this._map,i=n.transform,{interactiveLayerIds:s=[]}=this.props;try{return n.transform=this._renderTransform,n.queryRenderedFeatures(e,{layers:s.filter(n.getLayer.bind(n))})}catch{return[]}finally{n.transform=i}}_updateHover(e){var n;const{props:i}=this;if(i.interactiveLayerIds&&(i.onMouseMove||i.onMouseEnter||i.onMouseLeave)){const c=e.type,d=((n=this._hoveredFeatures)===null||n===void 0?void 0:n.length)>0,l=this._queryRenderedFeatures(e.point),y=l.length>0;!y&&d&&(e.type="mouseleave",this._onPointerEvent(e)),this._hoveredFeatures=l,y&&!d&&(e.type="mouseenter",this._onPointerEvent(e)),e.type=c}else this._hoveredFeatures=null}_fireEvent(e,n,i){const s=this._map,c=s.transform,d=typeof n=="string"?n:n.type;return d==="move"&&this._updateViewState(this.props,!1),d in ay&&(typeof n=="object"&&(n.viewState=Mw(c)),this._map.isMoving())?(s.transform=this._renderTransform,e.call(s,n,i),s.transform=c,s):(e.call(s,n,i),s)}_onBeforeRepaint(){const e=this._map;this._internalUpdate=!0;for(const i in this._deferredEvents)this._deferredEvents[i]&&e.fire(i);this._internalUpdate=!1;const n=this._map.transform;e.transform=this._renderTransform,this._onAfterRepaint=()=>{Cw(this._renderTransform,n),e.transform=n}}}Iu.savedMaps=[];function _3(){let t=null;if(typeof location<"u"){const e=/access_token=([^&\/]*)/.exec(location.search);t=e&&e[1]}try{t=t||{}.MapboxAccessToken}catch{}try{t=t||{}.REACT_APP_MAPBOX_ACCESS_TOKEN}catch{}return t}const y3=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function v3(t){if(!t)return null;const e=t.map,n={getMap:()=>e,getCenter:()=>t.transform.center,getZoom:()=>t.transform.zoom,getBearing:()=>t.transform.bearing,getPitch:()=>t.transform.pitch,getPadding:()=>t.transform.padding,getBounds:()=>t.transform.getBounds(),project:i=>{const s=e.transform;e.transform=t.transform;const c=e.project(i);return e.transform=s,c},unproject:i=>{const s=e.transform;e.transform=t.transform;const c=e.unproject(i);return e.transform=s,c},queryTerrainElevation:(i,s)=>{const c=e.transform;e.transform=t.transform;const d=e.queryTerrainElevation(i,s);return e.transform=c,d},queryRenderedFeatures:(i,s)=>{const c=e.transform;e.transform=t.transform;const d=e.queryRenderedFeatures(i,s);return e.transform=c,d}};for(const i of x3(e))!(i in n)&&!y3.includes(i)&&(n[i]=e[i].bind(e));return n}function x3(t){const e=new Set;let n=t;for(;n;){for(const i of Object.getOwnPropertyNames(n))i[0]!=="_"&&typeof t[i]=="function"&&i!=="fire"&&i!=="setEventedParent"&&e.add(i);n=Object.getPrototypeOf(n)}return Array.from(e)}const b3=typeof document<"u"?at.useLayoutEffect:at.useEffect,w3=["baseApiUrl","maxParallelImageRequests","workerClass","workerCount","workerUrl"];function E3(t,e){for(const i of w3)i in e&&(t[i]=e[i]);const{RTLTextPlugin:n="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js"}=e;n&&t.getRTLTextPluginStatus&&t.getRTLTextPluginStatus()==="unavailable"&&t.setRTLTextPlugin(n,i=>{i&&console.error(i)},!1)}const bg=at.createContext(null);function T3(t,e,n){const i=at.useContext(h3),[s,c]=at.useState(null),d=at.useRef(),{current:l}=at.useRef({mapLib:null,map:null});at.useEffect(()=>{const S=t.mapLib;let C=!0,P;return Promise.resolve(S||n).then(D=>{if(!C)return;if(!D)throw new Error("Invalid mapLib");const U="Map"in D?D:D.default;if(!U.Map)throw new Error("Invalid mapLib");if(E3(U,t),!U.supported||U.supported(t))t.reuseMaps&&(P=Iu.reuse(t,d.current)),P||(P=new Iu(U.Map,t,d.current)),l.map=v3(P),l.mapLib=U,c(P),i==null||i.onMapMount(l.map,t.id);else throw new Error("Map is not supported by this browser")}).catch(D=>{const{onError:U}=t;U?U({type:"error",target:null,originalEvent:null,error:D}):console.error(D)}),()=>{C=!1,P&&(i==null||i.onMapUnmount(t.id),t.reuseMaps?P.recycle():P.destroy())}},[]),b3(()=>{s&&s.setProps(t)}),at.useImperativeHandle(e,()=>l.map,[s]);const y=at.useMemo(()=>({position:"relative",width:"100%",height:"100%",...t.style}),[t.style]),w={height:"100%"};return at.createElement("div",{id:t.id,ref:d,style:y},s&&at.createElement(bg.Provider,{value:l},at.createElement("div",{"mapboxgl-children":"",style:w},t.children)))}const S3=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function ec(t,e){if(!t||!e)return;const n=t.style;for(const i in e){const s=e[i];Number.isFinite(s)&&!S3.test(i)?n[i]=`${s}px`:n[i]=s}}function A3(t,e){const{map:n,mapLib:i}=at.useContext(bg),s=at.useRef({props:t});s.current.props=t;const c=at.useMemo(()=>{let H=!1;at.Children.forEach(t.children,V=>{V&&(H=!0)});const ae={...t,element:H?document.createElement("div"):null},G=new i.Marker(ae);return G.setLngLat([t.longitude,t.latitude]),G.getElement().addEventListener("click",V=>{var W,ie;(ie=(W=s.current.props).onClick)===null||ie===void 0||ie.call(W,{type:"click",target:G,originalEvent:V})}),G.on("dragstart",V=>{var W,ie;const ge=V;ge.lngLat=c.getLngLat(),(ie=(W=s.current.props).onDragStart)===null||ie===void 0||ie.call(W,ge)}),G.on("drag",V=>{var W,ie;const ge=V;ge.lngLat=c.getLngLat(),(ie=(W=s.current.props).onDrag)===null||ie===void 0||ie.call(W,ge)}),G.on("dragend",V=>{var W,ie;const ge=V;ge.lngLat=c.getLngLat(),(ie=(W=s.current.props).onDragEnd)===null||ie===void 0||ie.call(W,ge)}),G},[]);at.useEffect(()=>(c.addTo(n.getMap()),()=>{c.remove()}),[]);const{longitude:d,latitude:l,offset:y,style:w,draggable:S=!1,popup:C=null,rotation:P=0,rotationAlignment:D="auto",pitchAlignment:U="auto"}=t;return at.useEffect(()=>{ec(c.getElement(),w)},[w]),at.useImperativeHandle(e,()=>c,[]),(c.getLngLat().lng!==d||c.getLngLat().lat!==l)&&c.setLngLat([d,l]),y&&!d3(c.getOffset(),y)&&c.setOffset(y),c.isDraggable()!==S&&c.setDraggable(S),c.getRotation()!==P&&c.setRotation(P),c.getRotationAlignment()!==D&&c.setRotationAlignment(D),c.getPitchAlignment()!==U&&c.setPitchAlignment(U),c.getPopup()!==C&&c.setPopup(C),fx.createPortal(t.children,c.getElement())}at.memo(at.forwardRef(A3));function Ow(t){return new Set(t?t.trim().split(/\s+/):[])}function P3(t,e){const{map:n,mapLib:i}=at.useContext(bg),s=at.useMemo(()=>document.createElement("div"),[]),c=at.useRef({props:t});c.current.props=t;const d=at.useMemo(()=>{const l={...t},y=new i.Popup(l);return y.setLngLat([t.longitude,t.latitude]),y.once("open",w=>{var S,C;(C=(S=c.current.props).onOpen)===null||C===void 0||C.call(S,w)}),y},[]);if(at.useEffect(()=>{const l=y=>{var w,S;(S=(w=c.current.props).onClose)===null||S===void 0||S.call(w,y)};return d.on("close",l),d.setDOMContent(s).addTo(n.getMap()),()=>{d.off("close",l),d.isOpen()&&d.remove()}},[]),at.useEffect(()=>{ec(d.getElement(),t.style)},[t.style]),at.useImperativeHandle(e,()=>d,[]),d.isOpen()&&((d.getLngLat().lng!==t.longitude||d.getLngLat().lat!==t.latitude)&&d.setLngLat([t.longitude,t.latitude]),t.offset&&!Go(d.options.offset,t.offset)&&d.setOffset(t.offset),(d.options.anchor!==t.anchor||d.options.maxWidth!==t.maxWidth)&&(d.options.anchor=t.anchor,d.setMaxWidth(t.maxWidth)),d.options.className!==t.className)){const l=Ow(d.options.className),y=Ow(t.className);for(const w of l)y.has(w)||d.removeClassName(w);for(const w of y)l.has(w)||d.addClassName(w);d.options.className=t.className}return fx.createPortal(t.children,s)}at.memo(at.forwardRef(P3));function Kd(t,e,n,i){const s=at.useContext(bg),c=at.useMemo(()=>t(s),[]);return at.useEffect(()=>{const d=i||n||e,l=typeof e=="function"&&typeof n=="function"?e:null,y=typeof n=="function"?n:typeof e=="function"?e:null,{map:w}=s;return w.hasControl(c)||(w.addControl(c,d==null?void 0:d.position),l&&l(s)),()=>{y&&y(s),w.hasControl(c)&&w.removeControl(c)}},[]),c}function I3(t){const e=Kd(({mapLib:n})=>new n.AttributionControl(t),{position:t.position});return at.useEffect(()=>{ec(e._container,t.style)},[t.style]),null}at.memo(I3);function C3(t){const e=Kd(({mapLib:n})=>new n.FullscreenControl({container:t.containerId&&document.getElementById(t.containerId)}),{position:t.position});return at.useEffect(()=>{ec(e._controlContainer,t.style)},[t.style]),null}at.memo(C3);function M3(t,e){const n=at.useRef({props:t}),i=Kd(({mapLib:s})=>{const c=new s.GeolocateControl(t),d=c._setupUI;return c._setupUI=l=>{c._container.hasChildNodes()||d(l)},c.on("geolocate",l=>{var y,w;(w=(y=n.current.props).onGeolocate)===null||w===void 0||w.call(y,l)}),c.on("error",l=>{var y,w;(w=(y=n.current.props).onError)===null||w===void 0||w.call(y,l)}),c.on("outofmaxbounds",l=>{var y,w;(w=(y=n.current.props).onOutOfMaxBounds)===null||w===void 0||w.call(y,l)}),c.on("trackuserlocationstart",l=>{var y,w;(w=(y=n.current.props).onTrackUserLocationStart)===null||w===void 0||w.call(y,l)}),c.on("trackuserlocationend",l=>{var y,w;(w=(y=n.current.props).onTrackUserLocationEnd)===null||w===void 0||w.call(y,l)}),c},{position:t.position});return n.current.props=t,at.useImperativeHandle(e,()=>i,[]),at.useEffect(()=>{ec(i._container,t.style)},[t.style]),null}at.memo(at.forwardRef(M3));function L3(t){const e=Kd(({mapLib:n})=>new n.NavigationControl(t),{position:t.position});return at.useEffect(()=>{ec(e._container,t.style)},[t.style]),null}at.memo(L3);function k3(t){const e=Kd(({mapLib:c})=>new c.ScaleControl(t),{position:t.position}),n=at.useRef(t),i=n.current;n.current=t;const{style:s}=t;return t.maxWidth!==void 0&&t.maxWidth!==i.maxWidth&&(e.options.maxWidth=t.maxWidth),t.unit!==void 0&&t.unit!==i.unit&&e.setUnit(t.unit),at.useEffect(()=>{ec(e._container,s)},[s]),null}at.memo(k3);const R3=u3(()=>import("./__vite-optional-peer-dep_mapbox-gl_react-map-gl-b25bb000.js"),[]),D3=(()=>at.forwardRef(function(e,n){return T3(e,n,R3)}))();var kA={exports:{}};(function(t,e){(function(n,i){t.exports=i()})(GM,function(){var n,i,s;function c(l,y){if(!n)n=y;else if(!i)i=y;else{var w="var sharedChunk = {}; ("+n+")(sharedChunk); ("+i+")(sharedChunk);",S={};n(S),s=y(S),typeof window<"u"&&(s.workerUrl=window.URL.createObjectURL(new Blob([w],{type:"text/javascript"})))}}c(["exports"],function(l){var y=w;function w(a,r,u,f){this.cx=3*a,this.bx=3*(u-a)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(f-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=a,this.p1y=r,this.p2x=u,this.p2y=f}function S(a,r,u,f){const g=new y(a,r,u,f);return function(v){return g.solve(v)}}w.prototype={sampleCurveX:function(a){return((this.ax*a+this.bx)*a+this.cx)*a},sampleCurveY:function(a){return((this.ay*a+this.by)*a+this.cy)*a},sampleCurveDerivativeX:function(a){return(3*this.ax*a+2*this.bx)*a+this.cx},solveCurveX:function(a,r){if(r===void 0&&(r=1e-6),a<0)return 0;if(a>1)return 1;for(var u=a,f=0;f<8;f++){var g=this.sampleCurveX(u)-a;if(Math.abs(g)<r)return u;var v=this.sampleCurveDerivativeX(u);if(Math.abs(v)<1e-6)break;u-=g/v}var b=0,T=1;for(u=a,f=0;f<20&&(g=this.sampleCurveX(u),!(Math.abs(g-a)<r));f++)a>g?b=u:T=u,u=.5*(T-b)+b;return u},solve:function(a,r){return this.sampleCurveY(this.solveCurveX(a,r))}};const C=S(.25,.1,.25,1);function P(a,r,u){return Math.min(u,Math.max(r,a))}function D(a,r,u){const f=u-r,g=((a-r)%f+f)%f+r;return g===r?u:g}function U(a,...r){for(const u of r)for(const f in u)a[f]=u[f];return a}let H=1;function ae(a,r){a.forEach(u=>{r[u]&&(r[u]=r[u].bind(r))})}function G(a,r,u){const f={};for(const g in a)f[g]=r.call(u||this,a[g],g,a);return f}function V(a,r,u){const f={};for(const g in a)r.call(u||this,a[g],g,a)&&(f[g]=a[g]);return f}function W(a){return Array.isArray(a)?a.map(W):typeof a=="object"&&a?G(a,W):a}const ie={};function ge(a){ie[a]||(typeof console<"u"&&console.warn(a),ie[a]=!0)}function be(a,r,u){return(u.y-a.y)*(r.x-a.x)>(r.y-a.y)*(u.x-a.x)}function De(a){let r=0;for(let u,f,g=0,v=a.length,b=v-1;g<v;b=g++)u=a[g],f=a[b],r+=(f.x-u.x)*(u.y+f.y);return r}function Ne(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function He(a){const r={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(u,f,g,v)=>{const b=g||v;return r[f]=!b||b.toLowerCase(),""}),r["max-age"]){const u=parseInt(r["max-age"],10);isNaN(u)?delete r["max-age"]:r["max-age"]=u}return r}let je,vt,Nt=null;function Qt(a){if(Nt==null){const r=a.navigator?a.navigator.userAgent:null;Nt=!!a.safari||!(!r||!(/\b(iPad|iPhone|iPod)\b/.test(r)||r.match("Safari")&&!r.match("Chrome")))}return Nt}function Bt(a){return typeof ImageBitmap<"u"&&a instanceof ImageBitmap}const ai={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(a){const r=requestAnimationFrame(a);return{cancel:()=>cancelAnimationFrame(r)}},getImageData(a,r=0){const u=window.document.createElement("canvas"),f=u.getContext("2d");if(!f)throw new Error("failed to create canvas 2d context");return u.width=a.width,u.height=a.height,f.drawImage(a,0,0,a.width,a.height),f.getImageData(-r,-r,a.width+2*r,a.height+2*r)},resolveURL:a=>(je||(je=document.createElement("a")),je.href=a,je.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(vt==null&&(vt=matchMedia("(prefers-reduced-motion: reduce)")),vt.matches)}};var Tt=Si;function Si(a,r){this.x=a,this.y=r}Si.prototype={clone:function(){return new Si(this.x,this.y)},add:function(a){return this.clone()._add(a)},sub:function(a){return this.clone()._sub(a)},multByPoint:function(a){return this.clone()._multByPoint(a)},divByPoint:function(a){return this.clone()._divByPoint(a)},mult:function(a){return this.clone()._mult(a)},div:function(a){return this.clone()._div(a)},rotate:function(a){return this.clone()._rotate(a)},rotateAround:function(a,r){return this.clone()._rotateAround(a,r)},matMult:function(a){return this.clone()._matMult(a)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(a){return this.x===a.x&&this.y===a.y},dist:function(a){return Math.sqrt(this.distSqr(a))},distSqr:function(a){var r=a.x-this.x,u=a.y-this.y;return r*r+u*u},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(a){return Math.atan2(this.y-a.y,this.x-a.x)},angleWith:function(a){return this.angleWithSep(a.x,a.y)},angleWithSep:function(a,r){return Math.atan2(this.x*r-this.y*a,this.x*a+this.y*r)},_matMult:function(a){var r=a[2]*this.x+a[3]*this.y;return this.x=a[0]*this.x+a[1]*this.y,this.y=r,this},_add:function(a){return this.x+=a.x,this.y+=a.y,this},_sub:function(a){return this.x-=a.x,this.y-=a.y,this},_mult:function(a){return this.x*=a,this.y*=a,this},_div:function(a){return this.x/=a,this.y/=a,this},_multByPoint:function(a){return this.x*=a.x,this.y*=a.y,this},_divByPoint:function(a){return this.x/=a.x,this.y/=a.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var a=this.y;return this.y=this.x,this.x=-a,this},_rotate:function(a){var r=Math.cos(a),u=Math.sin(a),f=u*this.x+r*this.y;return this.x=r*this.x-u*this.y,this.y=f,this},_rotateAround:function(a,r){var u=Math.cos(a),f=Math.sin(a),g=r.y+f*(this.x-r.x)+u*(this.y-r.y);return this.x=r.x+u*(this.x-r.x)-f*(this.y-r.y),this.y=g,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Si.convert=function(a){return a instanceof Si?a:Array.isArray(a)?new Si(a[0],a[1]):a};const rt={MAX_PARALLEL_IMAGE_REQUESTS:16,REGISTERED_PROTOCOLS:{}},At="mapbox-tiles";let Ct,an,ln=500,cr=50;function li(){typeof caches>"u"||Ct||(Ct=caches.open(At))}let Ai=1/0;const ci={supported:!1,testSupport:function(a){!Kt&&Pi&&(Un?us(a):pn=a)}};let pn,Pi,Kt=!1,Un=!1;function us(a){const r=a.createTexture();a.bindTexture(a.TEXTURE_2D,r);try{if(a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,Pi),a.isContextLost())return;ci.supported=!0}catch{}a.deleteTexture(r),Kt=!0}typeof document<"u"&&(Pi=document.createElement("img"),Pi.onload=function(){pn&&us(pn),pn=null,Un=!0},Pi.onerror=function(){Kt=!0,pn=null},Pi.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Oi={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Oi);class ei extends Error{constructor(r,u,f,g){super(`AJAXError: ${u} (${r}): ${f}`),this.status=r,this.statusText=u,this.url=f,this.body=g}}const Br=Ne()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href;function qi(a,r){const u=new AbortController,f=new Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,referrer:Br(),signal:u.signal});let g=!1,v=!1;return a.type==="json"&&f.headers.set("Accept","application/json"),((b,T,A)=>{if(v)return;const L=Date.now();fetch(f).then(z=>z.ok?((F,j,X)=>{(a.type==="arrayBuffer"?F.arrayBuffer():a.type==="json"?F.json():F.text()).then(Y=>{v||(j&&X&&function(le,oe,ve){if(li(),!Ct)return;const Se={status:oe.status,statusText:oe.statusText,headers:new Headers};oe.headers.forEach((Ee,Oe)=>Se.headers.set(Oe,Ee));const ye=He(oe.headers.get("Cache-Control")||"");ye["no-store"]||(ye["max-age"]&&Se.headers.set("Expires",new Date(ve+1e3*ye["max-age"]).toUTCString()),new Date(Se.headers.get("Expires")).getTime()-ve<42e4||function(Ee,Oe){if(an===void 0)try{new Response(new ReadableStream),an=!0}catch{an=!1}an?Oe(Ee.body):Ee.blob().then(Oe)}(oe,Ee=>{const Oe=new Response(Ee,Se);li(),Ct&&Ct.then(ze=>ze.put(function(ot){const dt=ot.indexOf("?");return dt<0?ot:ot.slice(0,dt)}(le.url),Oe)).catch(ze=>ge(ze.message))}))}(f,j,X),g=!0,r(null,Y,F.headers.get("Cache-Control"),F.headers.get("Expires")))}).catch(Y=>{v||r(new Error(Y.message))})})(z,null,L):z.blob().then(F=>r(new ei(z.status,z.statusText,a.url,F)))).catch(z=>{z.code!==20&&r(new Error(z.message))})})(),{cancel:()=>{v=!0,g||u.abort()}}}const yi=function(a,r){if(/:\/\//.test(a.url)&&!/^https?:|^file:/.test(a.url)){if(Ne()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",a,r);if(!Ne()){const f=a.url.substring(0,a.url.indexOf("://"));return(rt.REGISTERED_PROTOCOLS[f]||qi)(a,r)}}if(!(/^file:/.test(u=a.url)||/^file:/.test(Br())&&!/^\w+:/.test(u))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return qi(a,r);if(Ne()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",a,r,void 0,!0)}var u;return function(f,g){const v=new XMLHttpRequest;v.open(f.method||"GET",f.url,!0),f.type==="arrayBuffer"&&(v.responseType="arraybuffer");for(const b in f.headers)v.setRequestHeader(b,f.headers[b]);return f.type==="json"&&(v.responseType="text",v.setRequestHeader("Accept","application/json")),v.withCredentials=f.credentials==="include",v.onerror=()=>{g(new Error(v.statusText))},v.onload=()=>{if((v.status>=200&&v.status<300||v.status===0)&&v.response!==null){let b=v.response;if(f.type==="json")try{b=JSON.parse(v.response)}catch(T){return g(T)}g(null,b,v.getResponseHeader("Cache-Control"),v.getResponseHeader("Expires"))}else{const b=new Blob([v.response],{type:v.getResponseHeader("Content-Type")});g(new ei(v.status,v.statusText,f.url,b))}},v.send(f.body),{cancel:()=>v.abort()}}(a,r)},Zi=function(a,r){return yi(U(a,{type:"arrayBuffer"}),r)};function Xs(a){const r=window.document.createElement("a");return r.href=a,r.protocol===window.document.location.protocol&&r.host===window.document.location.host}const $t="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Fi,Vn;Fi=[],Vn=0;const hs=function(a,r){if(ci.supported&&(a.headers||(a.headers={}),a.headers.accept="image/webp,*/*"),Vn>=rt.MAX_PARALLEL_IMAGE_REQUESTS){const v={requestParameters:a,callback:r,cancelled:!1,cancel(){this.cancelled=!0}};return Fi.push(v),v}Vn++;let u=!1;const f=()=>{if(!u)for(u=!0,Vn--;Fi.length&&Vn<rt.MAX_PARALLEL_IMAGE_REQUESTS;){const v=Fi.shift(),{requestParameters:b,callback:T,cancelled:A}=v;A||(v.cancel=hs(b,T).cancel)}},g=Zi(a,(v,b,T,A)=>{f(),v?r(v):b&&function(L,z){typeof createImageBitmap=="function"?function(F,j){const X=new Blob([new Uint8Array(F)],{type:"image/png"});createImageBitmap(X).then(Y=>{j(null,Y)}).catch(Y=>{j(new Error(`Could not load image because of ${Y.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(L,z):function(F,j){const X=new Image;X.onload=()=>{j(null,X),URL.revokeObjectURL(X.src),X.onload=null,window.requestAnimationFrame(()=>{X.src=$t})},X.onerror=()=>j(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const Y=new Blob([new Uint8Array(F)],{type:"image/png"});X.src=F.byteLength?URL.createObjectURL(Y):$t}(L,z)}(b,(L,z)=>{L!=null?r(L):z!=null&&r(null,z,{cacheControl:T,expires:A})})});return{cancel:()=>{g.cancel(),f()}}};function To(a,r,u){u[a]&&u[a].indexOf(r)!==-1||(u[a]=u[a]||[],u[a].push(r))}function Ur(a,r,u){if(u&&u[a]){const f=u[a].indexOf(r);f!==-1&&u[a].splice(f,1)}}class Vr{constructor(r,u={}){U(this,u),this.type=r}}class Ys extends Vr{constructor(r,u={}){super("error",U({error:r},u))}}class Sr{on(r,u){return this._listeners=this._listeners||{},To(r,u,this._listeners),this}off(r,u){return Ur(r,u,this._listeners),Ur(r,u,this._oneTimeListeners),this}once(r,u){return this._oneTimeListeners=this._oneTimeListeners||{},To(r,u,this._oneTimeListeners),this}fire(r,u){typeof r=="string"&&(r=new Vr(r,u||{}));const f=r.type;if(this.listens(f)){r.target=this;const g=this._listeners&&this._listeners[f]?this._listeners[f].slice():[];for(const T of g)T.call(this,r);const v=this._oneTimeListeners&&this._oneTimeListeners[f]?this._oneTimeListeners[f].slice():[];for(const T of v)Ur(f,T,this._oneTimeListeners),T.call(this,r);const b=this._eventedParent;b&&(U(r,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),b.fire(r))}else r instanceof Ys&&console.error(r.error);return this}listens(r){return this._listeners&&this._listeners[r]&&this._listeners[r].length>0||this._oneTimeListeners&&this._oneTimeListeners[r]&&this._oneTimeListeners[r].length>0||this._eventedParent&&this._eventedParent.listens(r)}setEventedParent(r,u){return this._eventedParent=r,this._eventedParentData=u,this}}var Le={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1},elevationOffset:{type:"number",default:450}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};class qe{constructor(r,u,f,g){this.message=(r?`${r}: `:"")+f,g&&(this.identifier=g),u!=null&&u.__line__&&(this.line=u.__line__)}}function ds(a){const r=a.value;return r?[new qe(a.key,r,"constants have been deprecated as of v8")]:[]}function Ii(a,...r){for(const u of r)for(const f in u)a[f]=u[f];return a}function Gt(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function Xi(a){if(Array.isArray(a))return a.map(Xi);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){const r={};for(const u in a)r[u]=Xi(a[u]);return r}return Gt(a)}class Ni extends Error{constructor(r,u){super(u),this.message=u,this.key=r}}class Bi{constructor(r,u=[]){this.parent=r,this.bindings={};for(const[f,g]of u)this.bindings[f]=g}concat(r){return new Bi(this,r)}get(r){if(this.bindings[r])return this.bindings[r];if(this.parent)return this.parent.get(r);throw new Error(`${r} not found in scope.`)}has(r){return!!this.bindings[r]||!!this.parent&&this.parent.has(r)}}const fs={kind:"null"},$e={kind:"number"},kt={kind:"string"},Lt={kind:"boolean"},ti={kind:"color"},jr={kind:"object"},Mt={kind:"value"},ur={kind:"collator"},Zn={kind:"formatted"},Ks={kind:"padding"},On={kind:"resolvedImage"};function ui(a,r){return{kind:"array",itemType:a,N:r}}function sn(a){if(a.kind==="array"){const r=sn(a.itemType);return typeof a.N=="number"?`array<${r}, ${a.N}>`:a.itemType.kind==="value"?"array":`array<${r}>`}return a.kind}const Js=[fs,$e,kt,Lt,ti,Zn,jr,ui(Mt),Ks,On];function Ar(a,r){if(r.kind==="error")return null;if(a.kind==="array"){if(r.kind==="array"&&(r.N===0&&r.itemType.kind==="value"||!Ar(a.itemType,r.itemType))&&(typeof a.N!="number"||a.N===r.N))return null}else{if(a.kind===r.kind)return null;if(a.kind==="value"){for(const u of Js)if(!Ar(u,r))return null}}return`Expected ${sn(a)} but found ${sn(r)} instead.`}function Pr(a,r){return r.some(u=>u.kind===a.kind)}function ks(a,r){return r.some(u=>u==="null"?a===null:u==="array"?Array.isArray(a):u==="object"?a&&!Array.isArray(a)&&typeof a=="object":u===typeof a)}var Qs,ps={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function ee(a){return(a=Math.round(a))<0?0:a>255?255:a}function R(a){return ee(a[a.length-1]==="%"?parseFloat(a)/100*255:parseInt(a))}function N(a){return(r=a[a.length-1]==="%"?parseFloat(a)/100:parseFloat(a))<0?0:r>1?1:r;var r}function K(a,r,u){return u<0?u+=1:u>1&&(u-=1),6*u<1?a+(r-a)*u*6:2*u<1?r:3*u<2?a+(r-a)*(2/3-u)*6:a}try{Qs={}.parseCSSColor=function(a){var r,u=a.replace(/ /g,"").toLowerCase();if(u in ps)return ps[u].slice();if(u[0]==="#")return u.length===4?(r=parseInt(u.substr(1),16))>=0&&r<=4095?[(3840&r)>>4|(3840&r)>>8,240&r|(240&r)>>4,15&r|(15&r)<<4,1]:null:u.length===7&&(r=parseInt(u.substr(1),16))>=0&&r<=16777215?[(16711680&r)>>16,(65280&r)>>8,255&r,1]:null;var f=u.indexOf("("),g=u.indexOf(")");if(f!==-1&&g+1===u.length){var v=u.substr(0,f),b=u.substr(f+1,g-(f+1)).split(","),T=1;switch(v){case"rgba":if(b.length!==4)return null;T=N(b.pop());case"rgb":return b.length!==3?null:[R(b[0]),R(b[1]),R(b[2]),T];case"hsla":if(b.length!==4)return null;T=N(b.pop());case"hsl":if(b.length!==3)return null;var A=(parseFloat(b[0])%360+360)%360/360,L=N(b[1]),z=N(b[2]),F=z<=.5?z*(L+1):z+L-z*L,j=2*z-F;return[ee(255*K(j,F,A+1/3)),ee(255*K(j,F,A)),ee(255*K(j,F,A-1/3)),T];default:return null}}return null}}catch{}class J{constructor(r,u,f,g=1){this.r=r,this.g=u,this.b=f,this.a=g}static parse(r){if(!r)return;if(r instanceof J)return r;if(typeof r!="string")return;const u=Qs(r);return u?new J(u[0]/255*u[3],u[1]/255*u[3],u[2]/255*u[3],u[3]):void 0}toString(){const[r,u,f,g]=this.toArray();return`rgba(${Math.round(r)},${Math.round(u)},${Math.round(f)},${g})`}toArray(){const{r,g:u,b:f,a:g}=this;return g===0?[0,0,0,0]:[255*r/g,255*u/g,255*f/g,g]}}J.black=new J(0,0,0,1),J.white=new J(1,1,1,1),J.transparent=new J(0,0,0,0),J.red=new J(1,0,0,1);class ue{constructor(r,u,f){this.sensitivity=r?u?"variant":"case":u?"accent":"base",this.locale=f,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(r,u){return this.collator.compare(r,u)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class pe{constructor(r,u,f,g,v){this.text=r,this.image=u,this.scale=f,this.fontStack=g,this.textColor=v}}class de{constructor(r){this.sections=r}static fromString(r){return new de([new pe(r,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(r=>r.text.length!==0||r.image&&r.image.name.length!==0)}static factory(r){return r instanceof de?r:de.fromString(r)}toString(){return this.sections.length===0?"":this.sections.map(r=>r.text).join("")}}class ce{constructor(r){this.values=r.slice()}static parse(r){if(r instanceof ce)return r;if(typeof r=="number")return new ce([r,r,r,r]);if(Array.isArray(r)&&!(r.length<1||r.length>4)){for(const u of r)if(typeof u!="number")return;switch(r.length){case 1:r=[r[0],r[0],r[0],r[0]];break;case 2:r=[r[0],r[1],r[0],r[1]];break;case 3:r=[r[0],r[1],r[2],r[1]]}return new ce(r)}}toString(){return JSON.stringify(this.values)}}class me{constructor(r){this.name=r.name,this.available=r.available}toString(){return this.name}static fromString(r){return r?new me({name:r,available:!1}):null}}function Ce(a,r,u,f){return typeof a=="number"&&a>=0&&a<=255&&typeof r=="number"&&r>=0&&r<=255&&typeof u=="number"&&u>=0&&u<=255?f===void 0||typeof f=="number"&&f>=0&&f<=1?null:`Invalid rgba value [${[a,r,u,f].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof f=="number"?[a,r,u,f]:[a,r,u]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Fe(a){if(a===null||typeof a=="string"||typeof a=="boolean"||typeof a=="number"||a instanceof J||a instanceof ue||a instanceof de||a instanceof ce||a instanceof me)return!0;if(Array.isArray(a)){for(const r of a)if(!Fe(r))return!1;return!0}if(typeof a=="object"){for(const r in a)if(!Fe(a[r]))return!1;return!0}return!1}function Ie(a){if(a===null)return fs;if(typeof a=="string")return kt;if(typeof a=="boolean")return Lt;if(typeof a=="number")return $e;if(a instanceof J)return ti;if(a instanceof ue)return ur;if(a instanceof de)return Zn;if(a instanceof ce)return Ks;if(a instanceof me)return On;if(Array.isArray(a)){const r=a.length;let u;for(const f of a){const g=Ie(f);if(u){if(u===g)continue;u=Mt;break}u=g}return ui(u||Mt,r)}return jr}function lt(a){const r=typeof a;return a===null?"":r==="string"||r==="number"||r==="boolean"?String(a):a instanceof J||a instanceof de||a instanceof ce||a instanceof me?a.toString():JSON.stringify(a)}class ht{constructor(r,u){this.type=r,this.value=u}static parse(r,u){if(r.length!==2)return u.error(`'literal' expression requires exactly one argument, but found ${r.length-1} instead.`);if(!Fe(r[1]))return u.error("invalid value");const f=r[1];let g=Ie(f);const v=u.expectedType;return g.kind!=="array"||g.N!==0||!v||v.kind!=="array"||typeof v.N=="number"&&v.N!==0||(g=v),new ht(g,f)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Ke{constructor(r){this.name="ExpressionEvaluationError",this.message=r}toJSON(){return this.message}}const xt={string:kt,number:$e,boolean:Lt,object:jr};class gt{constructor(r,u){this.type=r,this.args=u}static parse(r,u){if(r.length<2)return u.error("Expected at least one argument.");let f,g=1;const v=r[0];if(v==="array"){let T,A;if(r.length>2){const L=r[1];if(typeof L!="string"||!(L in xt)||L==="object")return u.error('The item type argument of "array" must be one of string, number, boolean',1);T=xt[L],g++}else T=Mt;if(r.length>3){if(r[2]!==null&&(typeof r[2]!="number"||r[2]<0||r[2]!==Math.floor(r[2])))return u.error('The length argument to "array" must be a positive integer literal',2);A=r[2],g++}f=ui(T,A)}else{if(!xt[v])throw new Error(`Types doesn't contain name = ${v}`);f=xt[v]}const b=[];for(;g<r.length;g++){const T=u.parse(r[g],g,Mt);if(!T)return null;b.push(T)}return new gt(f,b)}evaluate(r){for(let u=0;u<this.args.length;u++){const f=this.args[u].evaluate(r);if(!Ar(this.type,Ie(f)))return f;if(u===this.args.length-1)throw new Ke(`Expected value to be of type ${sn(this.type)}, but found ${sn(Ie(f))} instead.`)}throw new Error}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}}const Dt={"to-boolean":Lt,"to-color":ti,"to-number":$e,"to-string":kt};class Et{constructor(r,u){this.type=r,this.args=u}static parse(r,u){if(r.length<2)return u.error("Expected at least one argument.");const f=r[0];if(!Dt[f])throw new Error(`Can't parse ${f} as it is not part of the known types`);if((f==="to-boolean"||f==="to-string")&&r.length!==2)return u.error("Expected one argument.");const g=Dt[f],v=[];for(let b=1;b<r.length;b++){const T=u.parse(r[b],b,Mt);if(!T)return null;v.push(T)}return new Et(g,v)}evaluate(r){if(this.type.kind==="boolean")return!!this.args[0].evaluate(r);if(this.type.kind==="color"){let u,f;for(const g of this.args){if(u=g.evaluate(r),f=null,u instanceof J)return u;if(typeof u=="string"){const v=r.parseColor(u);if(v)return v}else if(Array.isArray(u)&&(f=u.length<3||u.length>4?`Invalid rbga value ${JSON.stringify(u)}: expected an array containing either three or four numeric values.`:Ce(u[0],u[1],u[2],u[3]),!f))return new J(u[0]/255,u[1]/255,u[2]/255,u[3])}throw new Ke(f||`Could not parse color from value '${typeof u=="string"?u:JSON.stringify(u)}'`)}if(this.type.kind==="padding"){let u;for(const f of this.args){u=f.evaluate(r);const g=ce.parse(u);if(g)return g}throw new Ke(`Could not parse padding from value '${typeof u=="string"?u:JSON.stringify(u)}'`)}if(this.type.kind==="number"){let u=null;for(const f of this.args){if(u=f.evaluate(r),u===null)return 0;const g=Number(u);if(!isNaN(g))return g}throw new Ke(`Could not convert ${JSON.stringify(u)} to number.`)}return this.type.kind==="formatted"?de.fromString(lt(this.args[0].evaluate(r))):this.type.kind==="resolvedImage"?me.fromString(lt(this.args[0].evaluate(r))):lt(this.args[0].evaluate(r))}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}}const It=["Unknown","Point","LineString","Polygon"];class Ut{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?It[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(r){let u=this._parseColorCache[r];return u||(u=this._parseColorCache[r]=J.parse(r)),u}}class Wt{constructor(r,u,f,g){this.name=r,this.type=u,this._evaluate=f,this.args=g}evaluate(r){return this._evaluate(r,this.args)}eachChild(r){this.args.forEach(r)}outputDefined(){return!1}static parse(r,u){const f=r[0],g=Wt.definitions[f];if(!g)return u.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0);const v=Array.isArray(g)?g[0]:g.type,b=Array.isArray(g)?[[g[1],g[2]]]:g.overloads,T=b.filter(([L])=>!Array.isArray(L)||L.length===r.length-1);let A=null;for(const[L,z]of T){A=new Ue(u.registry,u.path,null,u.scope);const F=[];let j=!1;for(let X=1;X<r.length;X++){const Y=r[X],le=Array.isArray(L)?L[X-1]:L.type,oe=A.parse(Y,1+F.length,le);if(!oe){j=!0;break}F.push(oe)}if(!j)if(Array.isArray(L)&&L.length!==F.length)A.error(`Expected ${L.length} arguments, but found ${F.length} instead.`);else{for(let X=0;X<F.length;X++){const Y=Array.isArray(L)?L[X]:L.type,le=F[X];A.concat(X+1).checkSubtype(Y,le.type)}if(A.errors.length===0)return new Wt(f,v,z,F)}}if(T.length===1)u.errors.push(...A.errors);else{const L=(T.length?T:b).map(([F])=>{return j=F,Array.isArray(j)?`(${j.map(sn).join(", ")})`:`(${sn(j.type)}...)`;var j}).join(" | "),z=[];for(let F=1;F<r.length;F++){const j=u.parse(r[F],1+z.length);if(!j)return null;z.push(sn(j.type))}u.error(`Expected arguments of type ${L}, but found (${z.join(", ")}) instead.`)}return null}static register(r,u){Wt.definitions=u;for(const f in u)r[f]=Wt}}class _n{constructor(r,u,f){this.type=ur,this.locale=f,this.caseSensitive=r,this.diacriticSensitive=u}static parse(r,u){if(r.length!==2)return u.error("Expected one argument.");const f=r[1];if(typeof f!="object"||Array.isArray(f))return u.error("Collator options argument must be an object.");const g=u.parse(f["case-sensitive"]!==void 0&&f["case-sensitive"],1,Lt);if(!g)return null;const v=u.parse(f["diacritic-sensitive"]!==void 0&&f["diacritic-sensitive"],1,Lt);if(!v)return null;let b=null;return f.locale&&(b=u.parse(f.locale,1,kt),!b)?null:new _n(g,v,b)}evaluate(r){return new ue(this.caseSensitive.evaluate(r),this.diacriticSensitive.evaluate(r),this.locale?this.locale.evaluate(r):null)}eachChild(r){r(this.caseSensitive),r(this.diacriticSensitive),this.locale&&r(this.locale)}outputDefined(){return!1}}const yn=8192;function ni(a,r){a[0]=Math.min(a[0],r[0]),a[1]=Math.min(a[1],r[1]),a[2]=Math.max(a[2],r[0]),a[3]=Math.max(a[3],r[1])}function Gr(a,r){return!(a[0]<=r[0]||a[2]>=r[2]||a[1]<=r[1]||a[3]>=r[3])}function vi(a,r){const u=(180+a[0])/360,f=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,g=Math.pow(2,r.z);return[Math.round(u*g*yn),Math.round(f*g*yn)]}function en(a,r,u){const f=a[0]-r[0],g=a[1]-r[1],v=a[0]-u[0],b=a[1]-u[1];return f*b-v*g==0&&f*v<=0&&g*b<=0}function So(a,r){let u=!1;for(let b=0,T=r.length;b<T;b++){const A=r[b];for(let L=0,z=A.length;L<z-1;L++){if(en(a,A[L],A[L+1]))return!1;(g=A[L])[1]>(f=a)[1]!=(v=A[L+1])[1]>f[1]&&f[0]<(v[0]-g[0])*(f[1]-g[1])/(v[1]-g[1])+g[0]&&(u=!u)}}var f,g,v;return u}function Ao(a,r){for(let u=0;u<r.length;u++)if(So(a,r[u]))return!0;return!1}function ra(a,r,u,f){const g=f[0]-u[0],v=f[1]-u[1],b=(a[0]-u[0])*v-g*(a[1]-u[1]),T=(r[0]-u[0])*v-g*(r[1]-u[1]);return b>0&&T<0||b<0&&T>0}function sa(a,r,u){for(const L of u)for(let z=0;z<L.length-1;++z)if((T=[(b=L[z+1])[0]-(v=L[z])[0],b[1]-v[1]])[0]*(A=[(g=r)[0]-(f=a)[0],g[1]-f[1]])[1]-T[1]*A[0]!=0&&ra(f,g,v,b)&&ra(v,b,f,g))return!0;var f,g,v,b,T,A;return!1}function eo(a,r){for(let u=0;u<a.length;++u)if(!So(a[u],r))return!1;for(let u=0;u<a.length-1;++u)if(sa(a[u],a[u+1],r))return!1;return!0}function Wr(a,r){for(let u=0;u<r.length;u++)if(eo(a,r[u]))return!0;return!1}function oa(a,r,u){const f=[];for(let g=0;g<a.length;g++){const v=[];for(let b=0;b<a[g].length;b++){const T=vi(a[g][b],u);ni(r,T),v.push(T)}f.push(v)}return f}function aa(a,r,u){const f=[];for(let g=0;g<a.length;g++){const v=oa(a[g],r,u);f.push(v)}return f}function la(a,r,u,f){if(a[0]<u[0]||a[0]>u[2]){const g=.5*f;let v=a[0]-u[0]>g?-f:u[0]-a[0]>g?f:0;v===0&&(v=a[0]-u[2]>g?-f:u[2]-a[0]>g?f:0),a[0]+=v}ni(r,a)}function tl(a,r,u,f){const g=Math.pow(2,f.z)*yn,v=[f.x*yn,f.y*yn],b=[];for(const T of a)for(const A of T){const L=[A.x+v[0],A.y+v[1]];la(L,r,u,g),b.push(L)}return b}function rc(a,r,u,f){const g=Math.pow(2,f.z)*yn,v=[f.x*yn,f.y*yn],b=[];for(const A of a){const L=[];for(const z of A){const F=[z.x+v[0],z.y+v[1]];ni(r,F),L.push(F)}b.push(L)}if(r[2]-r[0]<=g/2){(T=r)[0]=T[1]=1/0,T[2]=T[3]=-1/0;for(const A of b)for(const L of A)la(L,r,u,g)}var T;return b}class Rs{constructor(r,u){this.type=Lt,this.geojson=r,this.geometries=u}static parse(r,u){if(r.length!==2)return u.error(`'within' expression requires exactly one argument, but found ${r.length-1} instead.`);if(Fe(r[1])){const f=r[1];if(f.type==="FeatureCollection")for(let g=0;g<f.features.length;++g){const v=f.features[g].geometry.type;if(v==="Polygon"||v==="MultiPolygon")return new Rs(f,f.features[g].geometry)}else if(f.type==="Feature"){const g=f.geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new Rs(f,f.geometry)}else if(f.type==="Polygon"||f.type==="MultiPolygon")return new Rs(f,f)}return u.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(r){if(r.geometry()!=null&&r.canonicalID()!=null){if(r.geometryType()==="Point")return function(u,f){const g=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],b=u.canonicalID();if(f.type==="Polygon"){const T=oa(f.coordinates,v,b),A=tl(u.geometry(),g,v,b);if(!Gr(g,v))return!1;for(const L of A)if(!So(L,T))return!1}if(f.type==="MultiPolygon"){const T=aa(f.coordinates,v,b),A=tl(u.geometry(),g,v,b);if(!Gr(g,v))return!1;for(const L of A)if(!Ao(L,T))return!1}return!0}(r,this.geometries);if(r.geometryType()==="LineString")return function(u,f){const g=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],b=u.canonicalID();if(f.type==="Polygon"){const T=oa(f.coordinates,v,b),A=rc(u.geometry(),g,v,b);if(!Gr(g,v))return!1;for(const L of A)if(!eo(L,T))return!1}if(f.type==="MultiPolygon"){const T=aa(f.coordinates,v,b),A=rc(u.geometry(),g,v,b);if(!Gr(g,v))return!1;for(const L of A)if(!Wr(L,T))return!1}return!0}(r,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}function Z(a){if(a instanceof Wt&&(a.name==="get"&&a.args.length===1||a.name==="feature-state"||a.name==="has"&&a.args.length===1||a.name==="properties"||a.name==="geometry-type"||a.name==="id"||/^filter-/.test(a.name))||a instanceof Rs)return!1;let r=!0;return a.eachChild(u=>{r&&!Z(u)&&(r=!1)}),r}function Q(a){if(a instanceof Wt&&a.name==="feature-state")return!1;let r=!0;return a.eachChild(u=>{r&&!Q(u)&&(r=!1)}),r}function he(a,r){if(a instanceof Wt&&r.indexOf(a.name)>=0)return!1;let u=!0;return a.eachChild(f=>{u&&!he(f,r)&&(u=!1)}),u}class Pe{constructor(r,u){this.type=u.type,this.name=r,this.boundExpression=u}static parse(r,u){if(r.length!==2||typeof r[1]!="string")return u.error("'var' expression requires exactly one string literal argument.");const f=r[1];return u.scope.has(f)?new Pe(f,u.scope.get(f)):u.error(`Unknown variable "${f}". Make sure "${f}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(r){return this.boundExpression.evaluate(r)}eachChild(){}outputDefined(){return!1}}class Ue{constructor(r,u=[],f,g=new Bi,v=[]){this.registry=r,this.path=u,this.key=u.map(b=>`[${b}]`).join(""),this.scope=g,this.errors=v,this.expectedType=f}parse(r,u,f,g,v={}){return u?this.concat(u,f,g)._parse(r,v):this._parse(r,v)}_parse(r,u){function f(g,v,b){return b==="assert"?new gt(v,[g]):b==="coerce"?new Et(v,[g]):g}if(r!==null&&typeof r!="string"&&typeof r!="boolean"&&typeof r!="number"||(r=["literal",r]),Array.isArray(r)){if(r.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const g=r[0];if(typeof g!="string")return this.error(`Expression name must be a string, but found ${typeof g} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const v=this.registry[g];if(v){let b=v.parse(r,this);if(!b)return null;if(this.expectedType){const T=this.expectedType,A=b.type;if(T.kind!=="string"&&T.kind!=="number"&&T.kind!=="boolean"&&T.kind!=="object"&&T.kind!=="array"||A.kind!=="value")if(T.kind!=="color"&&T.kind!=="formatted"&&T.kind!=="resolvedImage"||A.kind!=="value"&&A.kind!=="string")if(T.kind!=="padding"||A.kind!=="value"&&A.kind!=="number"&&A.kind!=="array"){if(this.checkSubtype(T,A))return null}else b=f(b,T,u.typeAnnotation||"coerce");else b=f(b,T,u.typeAnnotation||"coerce");else b=f(b,T,u.typeAnnotation||"assert")}if(!(b instanceof ht)&&b.type.kind!=="resolvedImage"&&ut(b)){const T=new Ut;try{b=new ht(b.type,b.evaluate(T))}catch(A){return this.error(A.message),null}}return b}return this.error(`Unknown expression "${g}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(r===void 0?"'undefined' value invalid. Use null instead.":typeof r=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof r} instead.`)}concat(r,u,f){const g=typeof r=="number"?this.path.concat(r):this.path,v=f?this.scope.concat(f):this.scope;return new Ue(this.registry,g,u||null,v,this.errors)}error(r,...u){const f=`${this.key}${u.map(g=>`[${g}]`).join("")}`;this.errors.push(new Ni(f,r))}checkSubtype(r,u){const f=Ar(r,u);return f&&this.error(f),f}}function ut(a){if(a instanceof Pe)return ut(a.boundExpression);if(a instanceof Wt&&a.name==="error"||a instanceof _n||a instanceof Rs)return!1;const r=a instanceof Et||a instanceof gt;let u=!0;return a.eachChild(f=>{u=r?u&&ut(f):u&&f instanceof ht}),!!u&&Z(a)&&he(a,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Vt(a,r){const u=a.length-1;let f,g,v=0,b=u,T=0;for(;v<=b;)if(T=Math.floor((v+b)/2),f=a[T],g=a[T+1],f<=r){if(T===u||r<g)return T;v=T+1}else{if(!(f>r))throw new Ke("Input is not a number.");b=T-1}return 0}class Cn{constructor(r,u,f){this.type=r,this.input=u,this.labels=[],this.outputs=[];for(const[g,v]of f)this.labels.push(g),this.outputs.push(v)}static parse(r,u){if(r.length-1<4)return u.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return u.error("Expected an even number of arguments.");const f=u.parse(r[1],1,$e);if(!f)return null;const g=[];let v=null;u.expectedType&&u.expectedType.kind!=="value"&&(v=u.expectedType);for(let b=1;b<r.length;b+=2){const T=b===1?-1/0:r[b],A=r[b+1],L=b,z=b+1;if(typeof T!="number")return u.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',L);if(g.length&&g[g.length-1][0]>=T)return u.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',L);const F=u.parse(A,z,v);if(!F)return null;v=v||F.type,g.push([T,F])}return new Cn(v,f,g)}evaluate(r){const u=this.labels,f=this.outputs;if(u.length===1)return f[0].evaluate(r);const g=this.input.evaluate(r);if(g<=u[0])return f[0].evaluate(r);const v=u.length;return g>=u[v-1]?f[v-1].evaluate(r):f[Vt(u,g)].evaluate(r)}eachChild(r){r(this.input);for(const u of this.outputs)r(u)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}}function zt(a,r,u){return a*(1-u)+r*u}var jn=Object.freeze({__proto__:null,number:zt,color:function(a,r,u){return new J(zt(a.r,r.r,u),zt(a.g,r.g,u),zt(a.b,r.b,u),zt(a.a,r.a,u))},array:function(a,r,u){return a.map((f,g)=>zt(f,r[g],u))},padding:function(a,r,u){const f=a.values,g=r.values;return new ce([zt(f[0],g[0],u),zt(f[1],g[1],u),zt(f[2],g[2],u),zt(f[3],g[3],u)])}});const hr=.95047,cf=1.08883,Hu=4/29,sc=6/29,uf=3*sc*sc,kg=Math.PI/180,Rg=180/Math.PI;function $u(a){return a>.008856451679035631?Math.pow(a,1/3):a/uf+Hu}function qu(a){return a>sc?a*a*a:uf*(a-Hu)}function Zu(a){return 255*(a<=.0031308?12.92*a:1.055*Math.pow(a,1/2.4)-.055)}function Xu(a){return(a/=255)<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function nn(a){const r=Xu(a.r),u=Xu(a.g),f=Xu(a.b),g=$u((.4124564*r+.3575761*u+.1804375*f)/hr),v=$u((.2126729*r+.7151522*u+.072175*f)/1);return{l:116*v-16,a:500*(g-v),b:200*(v-$u((.0193339*r+.119192*u+.9503041*f)/cf)),alpha:a.a}}function hf(a){let r=(a.l+16)/116,u=isNaN(a.a)?r:r+a.a/500,f=isNaN(a.b)?r:r-a.b/200;return r=1*qu(r),u=hr*qu(u),f=cf*qu(f),new J(Zu(3.2404542*u-1.5371385*r-.4985314*f),Zu(-.969266*u+1.8760108*r+.041556*f),Zu(.0556434*u-.2040259*r+1.0572252*f),a.alpha)}function Dg(a,r,u){const f=r-a;return a+u*(f>180||f<-180?f-360*Math.round(f/360):f)}const nl={forward:nn,reverse:hf,interpolate:function(a,r,u){return{l:zt(a.l,r.l,u),a:zt(a.a,r.a,u),b:zt(a.b,r.b,u),alpha:zt(a.alpha,r.alpha,u)}}},il={forward:function(a){const{l:r,a:u,b:f}=nn(a),g=Math.atan2(f,u)*Rg;return{h:g<0?g+360:g,c:Math.sqrt(u*u+f*f),l:r,alpha:a.a}},reverse:function(a){const r=a.h*kg,u=a.c;return hf({l:a.l,a:Math.cos(r)*u,b:Math.sin(r)*u,alpha:a.alpha})},interpolate:function(a,r,u){return{h:Dg(a.h,r.h,u),c:zt(a.c,r.c,u),l:zt(a.l,r.l,u),alpha:zt(a.alpha,r.alpha,u)}}};var df=Object.freeze({__proto__:null,lab:nl,hcl:il});class dr{constructor(r,u,f,g,v){this.type=r,this.operator=u,this.interpolation=f,this.input=g,this.labels=[],this.outputs=[];for(const[b,T]of v)this.labels.push(b),this.outputs.push(T)}static interpolationFactor(r,u,f,g){let v=0;if(r.name==="exponential")v=Yu(u,r.base,f,g);else if(r.name==="linear")v=Yu(u,1,f,g);else if(r.name==="cubic-bezier"){const b=r.controlPoints;v=new y(b[0],b[1],b[2],b[3]).solve(Yu(u,1,f,g))}return v}static parse(r,u){let[f,g,v,...b]=r;if(!Array.isArray(g)||g.length===0)return u.error("Expected an interpolation type expression.",1);if(g[0]==="linear")g={name:"linear"};else if(g[0]==="exponential"){const L=g[1];if(typeof L!="number")return u.error("Exponential interpolation requires a numeric base.",1,1);g={name:"exponential",base:L}}else{if(g[0]!=="cubic-bezier")return u.error(`Unknown interpolation type ${String(g[0])}`,1,0);{const L=g.slice(1);if(L.length!==4||L.some(z=>typeof z!="number"||z<0||z>1))return u.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);g={name:"cubic-bezier",controlPoints:L}}}if(r.length-1<4)return u.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return u.error("Expected an even number of arguments.");if(v=u.parse(v,2,$e),!v)return null;const T=[];let A=null;f==="interpolate-hcl"||f==="interpolate-lab"?A=ti:u.expectedType&&u.expectedType.kind!=="value"&&(A=u.expectedType);for(let L=0;L<b.length;L+=2){const z=b[L],F=b[L+1],j=L+3,X=L+4;if(typeof z!="number")return u.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',j);if(T.length&&T[T.length-1][0]>=z)return u.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',j);const Y=u.parse(F,X,A);if(!Y)return null;A=A||Y.type,T.push([z,Y])}return A.kind==="number"||A.kind==="color"||A.kind==="padding"||A.kind==="array"&&A.itemType.kind==="number"&&typeof A.N=="number"?new dr(A,f,g,v,T):u.error(`Type ${sn(A)} is not interpolatable.`)}evaluate(r){const u=this.labels,f=this.outputs;if(u.length===1)return f[0].evaluate(r);const g=this.input.evaluate(r);if(g<=u[0])return f[0].evaluate(r);const v=u.length;if(g>=u[v-1])return f[v-1].evaluate(r);const b=Vt(u,g),T=dr.interpolationFactor(this.interpolation,g,u[b],u[b+1]),A=f[b].evaluate(r),L=f[b+1].evaluate(r);return this.operator==="interpolate"?jn[this.type.kind.toLowerCase()](A,L,T):this.operator==="interpolate-hcl"?il.reverse(il.interpolate(il.forward(A),il.forward(L),T)):nl.reverse(nl.interpolate(nl.forward(A),nl.forward(L),T))}eachChild(r){r(this.input);for(const u of this.outputs)r(u)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}}function Yu(a,r,u,f){const g=f-u,v=a-u;return g===0?0:r===1?v/g:(Math.pow(r,v)-1)/(Math.pow(r,g)-1)}class oc{constructor(r,u){this.type=r,this.args=u}static parse(r,u){if(r.length<2)return u.error("Expectected at least one argument.");let f=null;const g=u.expectedType;g&&g.kind!=="value"&&(f=g);const v=[];for(const T of r.slice(1)){const A=u.parse(T,1+v.length,f,void 0,{typeAnnotation:"omit"});if(!A)return null;f=f||A.type,v.push(A)}if(!f)throw new Error("No output type");const b=g&&v.some(T=>Ar(g,T.type));return new oc(b?Mt:f,v)}evaluate(r){let u,f=null,g=0;for(const v of this.args)if(g++,f=v.evaluate(r),f&&f instanceof me&&!f.available&&(u||(u=f.name),f=null,g===this.args.length&&(f=u)),f!==null)break;return f}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}}class ac{constructor(r,u){this.type=u.type,this.bindings=[].concat(r),this.result=u}evaluate(r){return this.result.evaluate(r)}eachChild(r){for(const u of this.bindings)r(u[1]);r(this.result)}static parse(r,u){if(r.length<4)return u.error(`Expected at least 3 arguments, but found ${r.length-1} instead.`);const f=[];for(let v=1;v<r.length-1;v+=2){const b=r[v];if(typeof b!="string")return u.error(`Expected string, but found ${typeof b} instead.`,v);if(/[^a-zA-Z0-9_]/.test(b))return u.error("Variable names must contain only alphanumeric characters or '_'.",v);const T=u.parse(r[v+1],v+1);if(!T)return null;f.push([b,T])}const g=u.parse(r[r.length-1],r.length-1,u.expectedType,f);return g?new ac(f,g):null}outputDefined(){return this.result.outputDefined()}}class Ku{constructor(r,u,f){this.type=r,this.index=u,this.input=f}static parse(r,u){if(r.length!==3)return u.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const f=u.parse(r[1],1,$e),g=u.parse(r[2],2,ui(u.expectedType||Mt));return f&&g?new Ku(g.type.itemType,f,g):null}evaluate(r){const u=this.index.evaluate(r),f=this.input.evaluate(r);if(u<0)throw new Ke(`Array index out of bounds: ${u} < 0.`);if(u>=f.length)throw new Ke(`Array index out of bounds: ${u} > ${f.length-1}.`);if(u!==Math.floor(u))throw new Ke(`Array index must be an integer, but found ${u} instead.`);return f[u]}eachChild(r){r(this.index),r(this.input)}outputDefined(){return!1}}class Ju{constructor(r,u){this.type=Lt,this.needle=r,this.haystack=u}static parse(r,u){if(r.length!==3)return u.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const f=u.parse(r[1],1,Mt),g=u.parse(r[2],2,Mt);return f&&g?Pr(f.type,[Lt,kt,$e,fs,Mt])?new Ju(f,g):u.error(`Expected first argument to be of type boolean, string, number or null, but found ${sn(f.type)} instead`):null}evaluate(r){const u=this.needle.evaluate(r),f=this.haystack.evaluate(r);if(!f)return!1;if(!ks(u,["boolean","string","number","null"]))throw new Ke(`Expected first argument to be of type boolean, string, number or null, but found ${sn(Ie(u))} instead.`);if(!ks(f,["string","array"]))throw new Ke(`Expected second argument to be of type array or string, but found ${sn(Ie(f))} instead.`);return f.indexOf(u)>=0}eachChild(r){r(this.needle),r(this.haystack)}outputDefined(){return!0}}class lc{constructor(r,u,f){this.type=$e,this.needle=r,this.haystack=u,this.fromIndex=f}static parse(r,u){if(r.length<=2||r.length>=5)return u.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const f=u.parse(r[1],1,Mt),g=u.parse(r[2],2,Mt);if(!f||!g)return null;if(!Pr(f.type,[Lt,kt,$e,fs,Mt]))return u.error(`Expected first argument to be of type boolean, string, number or null, but found ${sn(f.type)} instead`);if(r.length===4){const v=u.parse(r[3],3,$e);return v?new lc(f,g,v):null}return new lc(f,g)}evaluate(r){const u=this.needle.evaluate(r),f=this.haystack.evaluate(r);if(!ks(u,["boolean","string","number","null"]))throw new Ke(`Expected first argument to be of type boolean, string, number or null, but found ${sn(Ie(u))} instead.`);if(!ks(f,["string","array"]))throw new Ke(`Expected second argument to be of type array or string, but found ${sn(Ie(f))} instead.`);if(this.fromIndex){const g=this.fromIndex.evaluate(r);return f.indexOf(u,g)}return f.indexOf(u)}eachChild(r){r(this.needle),r(this.haystack),this.fromIndex&&r(this.fromIndex)}outputDefined(){return!1}}class Qu{constructor(r,u,f,g,v,b){this.inputType=r,this.type=u,this.input=f,this.cases=g,this.outputs=v,this.otherwise=b}static parse(r,u){if(r.length<5)return u.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if(r.length%2!=1)return u.error("Expected an even number of arguments.");let f,g;u.expectedType&&u.expectedType.kind!=="value"&&(g=u.expectedType);const v={},b=[];for(let L=2;L<r.length-1;L+=2){let z=r[L];const F=r[L+1];Array.isArray(z)||(z=[z]);const j=u.concat(L);if(z.length===0)return j.error("Expected at least one branch label.");for(const Y of z){if(typeof Y!="number"&&typeof Y!="string")return j.error("Branch labels must be numbers or strings.");if(typeof Y=="number"&&Math.abs(Y)>Number.MAX_SAFE_INTEGER)return j.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof Y=="number"&&Math.floor(Y)!==Y)return j.error("Numeric branch labels must be integer values.");if(f){if(j.checkSubtype(f,Ie(Y)))return null}else f=Ie(Y);if(v[String(Y)]!==void 0)return j.error("Branch labels must be unique.");v[String(Y)]=b.length}const X=u.parse(F,L,g);if(!X)return null;g=g||X.type,b.push(X)}const T=u.parse(r[1],1,Mt);if(!T)return null;const A=u.parse(r[r.length-1],r.length-1,g);return A?T.type.kind!=="value"&&u.concat(1).checkSubtype(f,T.type)?null:new Qu(f,g,T,v,b,A):null}evaluate(r){const u=this.input.evaluate(r);return(Ie(u)===this.inputType&&this.outputs[this.cases[u]]||this.otherwise).evaluate(r)}eachChild(r){r(this.input),this.outputs.forEach(r),r(this.otherwise)}outputDefined(){return this.outputs.every(r=>r.outputDefined())&&this.otherwise.outputDefined()}}class eh{constructor(r,u,f){this.type=r,this.branches=u,this.otherwise=f}static parse(r,u){if(r.length<4)return u.error(`Expected at least 3 arguments, but found only ${r.length-1}.`);if(r.length%2!=0)return u.error("Expected an odd number of arguments.");let f;u.expectedType&&u.expectedType.kind!=="value"&&(f=u.expectedType);const g=[];for(let b=1;b<r.length-1;b+=2){const T=u.parse(r[b],b,Lt);if(!T)return null;const A=u.parse(r[b+1],b+1,f);if(!A)return null;g.push([T,A]),f=f||A.type}const v=u.parse(r[r.length-1],r.length-1,f);if(!v)return null;if(!f)throw new Error("Can't infer output type");return new eh(f,g,v)}evaluate(r){for(const[u,f]of this.branches)if(u.evaluate(r))return f.evaluate(r);return this.otherwise.evaluate(r)}eachChild(r){for(const[u,f]of this.branches)r(u),r(f);r(this.otherwise)}outputDefined(){return this.branches.every(([r,u])=>u.outputDefined())&&this.otherwise.outputDefined()}}class cc{constructor(r,u,f,g){this.type=r,this.input=u,this.beginIndex=f,this.endIndex=g}static parse(r,u){if(r.length<=2||r.length>=5)return u.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const f=u.parse(r[1],1,Mt),g=u.parse(r[2],2,$e);if(!f||!g)return null;if(!Pr(f.type,[ui(Mt),kt,Mt]))return u.error(`Expected first argument to be of type array or string, but found ${sn(f.type)} instead`);if(r.length===4){const v=u.parse(r[3],3,$e);return v?new cc(f.type,f,g,v):null}return new cc(f.type,f,g)}evaluate(r){const u=this.input.evaluate(r),f=this.beginIndex.evaluate(r);if(!ks(u,["string","array"]))throw new Ke(`Expected first argument to be of type array or string, but found ${sn(Ie(u))} instead.`);if(this.endIndex){const g=this.endIndex.evaluate(r);return u.slice(f,g)}return u.slice(f)}eachChild(r){r(this.input),r(this.beginIndex),this.endIndex&&r(this.endIndex)}outputDefined(){return!1}}function ff(a,r){return a==="=="||a==="!="?r.kind==="boolean"||r.kind==="string"||r.kind==="number"||r.kind==="null"||r.kind==="value":r.kind==="string"||r.kind==="number"||r.kind==="value"}function pf(a,r,u,f){return f.compare(r,u)===0}function ca(a,r,u){const f=a!=="=="&&a!=="!=";return class RA{constructor(v,b,T){this.type=Lt,this.lhs=v,this.rhs=b,this.collator=T,this.hasUntypedArgument=v.type.kind==="value"||b.type.kind==="value"}static parse(v,b){if(v.length!==3&&v.length!==4)return b.error("Expected two or three arguments.");const T=v[0];let A=b.parse(v[1],1,Mt);if(!A)return null;if(!ff(T,A.type))return b.concat(1).error(`"${T}" comparisons are not supported for type '${sn(A.type)}'.`);let L=b.parse(v[2],2,Mt);if(!L)return null;if(!ff(T,L.type))return b.concat(2).error(`"${T}" comparisons are not supported for type '${sn(L.type)}'.`);if(A.type.kind!==L.type.kind&&A.type.kind!=="value"&&L.type.kind!=="value")return b.error(`Cannot compare types '${sn(A.type)}' and '${sn(L.type)}'.`);f&&(A.type.kind==="value"&&L.type.kind!=="value"?A=new gt(L.type,[A]):A.type.kind!=="value"&&L.type.kind==="value"&&(L=new gt(A.type,[L])));let z=null;if(v.length===4){if(A.type.kind!=="string"&&L.type.kind!=="string"&&A.type.kind!=="value"&&L.type.kind!=="value")return b.error("Cannot use collator to compare non-string types.");if(z=b.parse(v[3],3,ur),!z)return null}return new RA(A,L,z)}evaluate(v){const b=this.lhs.evaluate(v),T=this.rhs.evaluate(v);if(f&&this.hasUntypedArgument){const A=Ie(b),L=Ie(T);if(A.kind!==L.kind||A.kind!=="string"&&A.kind!=="number")throw new Ke(`Expected arguments for "${a}" to be (string, string) or (number, number), but found (${A.kind}, ${L.kind}) instead.`)}if(this.collator&&!f&&this.hasUntypedArgument){const A=Ie(b),L=Ie(T);if(A.kind!=="string"||L.kind!=="string")return r(v,b,T)}return this.collator?u(v,b,T,this.collator.evaluate(v)):r(v,b,T)}eachChild(v){v(this.lhs),v(this.rhs),this.collator&&v(this.collator)}outputDefined(){return!0}}}const zg=ca("==",function(a,r,u){return r===u},pf),Og=ca("!=",function(a,r,u){return r!==u},function(a,r,u,f){return!pf(0,r,u,f)}),Fg=ca("<",function(a,r,u){return r<u},function(a,r,u,f){return f.compare(r,u)<0}),Ng=ca(">",function(a,r,u){return r>u},function(a,r,u,f){return f.compare(r,u)>0}),Bg=ca("<=",function(a,r,u){return r<=u},function(a,r,u,f){return f.compare(r,u)<=0}),Ug=ca(">=",function(a,r,u){return r>=u},function(a,r,u,f){return f.compare(r,u)>=0});class th{constructor(r,u,f,g,v){this.type=kt,this.number=r,this.locale=u,this.currency=f,this.minFractionDigits=g,this.maxFractionDigits=v}static parse(r,u){if(r.length!==3)return u.error("Expected two arguments.");const f=u.parse(r[1],1,$e);if(!f)return null;const g=r[2];if(typeof g!="object"||Array.isArray(g))return u.error("NumberFormat options argument must be an object.");let v=null;if(g.locale&&(v=u.parse(g.locale,1,kt),!v))return null;let b=null;if(g.currency&&(b=u.parse(g.currency,1,kt),!b))return null;let T=null;if(g["min-fraction-digits"]&&(T=u.parse(g["min-fraction-digits"],1,$e),!T))return null;let A=null;return g["max-fraction-digits"]&&(A=u.parse(g["max-fraction-digits"],1,$e),!A)?null:new th(f,v,b,T,A)}evaluate(r){return new Intl.NumberFormat(this.locale?this.locale.evaluate(r):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(r):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(r):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(r):void 0}).format(this.number.evaluate(r))}eachChild(r){r(this.number),this.locale&&r(this.locale),this.currency&&r(this.currency),this.minFractionDigits&&r(this.minFractionDigits),this.maxFractionDigits&&r(this.maxFractionDigits)}outputDefined(){return!1}}class uc{constructor(r){this.type=Zn,this.sections=r}static parse(r,u){if(r.length<2)return u.error("Expected at least one argument.");const f=r[1];if(!Array.isArray(f)&&typeof f=="object")return u.error("First argument must be an image or text section.");const g=[];let v=!1;for(let b=1;b<=r.length-1;++b){const T=r[b];if(v&&typeof T=="object"&&!Array.isArray(T)){v=!1;let A=null;if(T["font-scale"]&&(A=u.parse(T["font-scale"],1,$e),!A))return null;let L=null;if(T["text-font"]&&(L=u.parse(T["text-font"],1,ui(kt)),!L))return null;let z=null;if(T["text-color"]&&(z=u.parse(T["text-color"],1,ti),!z))return null;const F=g[g.length-1];F.scale=A,F.font=L,F.textColor=z}else{const A=u.parse(r[b],1,Mt);if(!A)return null;const L=A.type.kind;if(L!=="string"&&L!=="value"&&L!=="null"&&L!=="resolvedImage")return u.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");v=!0,g.push({content:A,scale:null,font:null,textColor:null})}}return new uc(g)}evaluate(r){return new de(this.sections.map(u=>{const f=u.content.evaluate(r);return Ie(f)===On?new pe("",f,null,null,null):new pe(lt(f),null,u.scale?u.scale.evaluate(r):null,u.font?u.font.evaluate(r).join(","):null,u.textColor?u.textColor.evaluate(r):null)}))}eachChild(r){for(const u of this.sections)r(u.content),u.scale&&r(u.scale),u.font&&r(u.font),u.textColor&&r(u.textColor)}outputDefined(){return!1}}class nh{constructor(r){this.type=On,this.input=r}static parse(r,u){if(r.length!==2)return u.error("Expected two arguments.");const f=u.parse(r[1],1,kt);return f?new nh(f):u.error("No image name provided.")}evaluate(r){const u=this.input.evaluate(r),f=me.fromString(u);return f&&r.availableImages&&(f.available=r.availableImages.indexOf(u)>-1),f}eachChild(r){r(this.input)}outputDefined(){return!1}}class ih{constructor(r){this.type=$e,this.input=r}static parse(r,u){if(r.length!==2)return u.error(`Expected 1 argument, but found ${r.length-1} instead.`);const f=u.parse(r[1],1);return f?f.type.kind!=="array"&&f.type.kind!=="string"&&f.type.kind!=="value"?u.error(`Expected argument of type string or array, but found ${sn(f.type)} instead.`):new ih(f):null}evaluate(r){const u=this.input.evaluate(r);if(typeof u=="string"||Array.isArray(u))return u.length;throw new Ke(`Expected value to be of type string or array, but found ${sn(Ie(u))} instead.`)}eachChild(r){r(this.input)}outputDefined(){return!1}}const ua={"==":zg,"!=":Og,">":Ng,"<":Fg,">=":Ug,"<=":Bg,array:gt,at:Ku,boolean:gt,case:eh,coalesce:oc,collator:_n,format:uc,image:nh,in:Ju,"index-of":lc,interpolate:dr,"interpolate-hcl":dr,"interpolate-lab":dr,length:ih,let:ac,literal:ht,match:Qu,number:gt,"number-format":th,object:gt,slice:cc,step:Cn,string:gt,"to-boolean":Et,"to-color":Et,"to-number":Et,"to-string":Et,var:Pe,within:Rs};function mf(a,[r,u,f,g]){r=r.evaluate(a),u=u.evaluate(a),f=f.evaluate(a);const v=g?g.evaluate(a):1,b=Ce(r,u,f,v);if(b)throw new Ke(b);return new J(r/255*v,u/255*v,f/255*v,v)}function gf(a,r){return a in r}function hc(a,r){const u=r[a];return u===void 0?null:u}function Po(a){return{type:a}}function _f(a){return{result:"success",value:a}}function ha(a){return{result:"error",value:a}}function wn(a){return a["property-type"]==="data-driven"||a["property-type"]==="cross-faded-data-driven"}function yf(a){return!!a.expression&&a.expression.parameters.indexOf("zoom")>-1}function qt(a){return!!a.expression&&a.expression.interpolated}function rn(a){return a instanceof Number?"number":a instanceof String?"string":a instanceof Boolean?"boolean":Array.isArray(a)?"array":a===null?"null":typeof a}function xn(a){return typeof a=="object"&&a!==null&&!Array.isArray(a)}function Sn(a){return a}function rl(a,r){const u=r.type==="color",f=a.stops&&typeof a.stops[0][0]=="object",g=f||!(f||a.property!==void 0),v=a.type||(qt(r)?"exponential":"interval");if(u||r.type==="padding"){const L=u?J.parse:ce.parse;(a=Ii({},a)).stops&&(a.stops=a.stops.map(z=>[z[0],L(z[1])])),a.default=L(a.default?a.default:r.default)}if(a.colorSpace&&a.colorSpace!=="rgb"&&!df[a.colorSpace])throw new Error(`Unknown color space: ${a.colorSpace}`);let b,T,A;if(v==="exponential")b=vf;else if(v==="interval")b=jg;else if(v==="categorical"){b=Vg,T=Object.create(null);for(const L of a.stops)T[L[0]]=L[1];A=typeof a.stops[0][0]}else{if(v!=="identity")throw new Error(`Unknown function type "${v}"`);b=Gg}if(f){const L={},z=[];for(let X=0;X<a.stops.length;X++){const Y=a.stops[X],le=Y[0].zoom;L[le]===void 0&&(L[le]={zoom:le,type:a.type,property:a.property,default:a.default,stops:[]},z.push(le)),L[le].stops.push([Y[0].value,Y[1]])}const F=[];for(const X of z)F.push([L[X].zoom,rl(L[X],r)]);const j={name:"linear"};return{kind:"composite",interpolationType:j,interpolationFactor:dr.interpolationFactor.bind(void 0,j),zoomStops:F.map(X=>X[0]),evaluate:({zoom:X},Y)=>vf({stops:F,base:a.base},r,X).evaluate(X,Y)}}if(g){const L=v==="exponential"?{name:"exponential",base:a.base!==void 0?a.base:1}:null;return{kind:"camera",interpolationType:L,interpolationFactor:dr.interpolationFactor.bind(void 0,L),zoomStops:a.stops.map(z=>z[0]),evaluate:({zoom:z})=>b(a,r,z,T,A)}}return{kind:"source",evaluate(L,z){const F=z&&z.properties?z.properties[a.property]:void 0;return F===void 0?da(a.default,r.default):b(a,r,F,T,A)}}}function da(a,r,u){return a!==void 0?a:r!==void 0?r:u!==void 0?u:void 0}function Vg(a,r,u,f,g){return da(typeof u===g?f[u]:void 0,a.default,r.default)}function jg(a,r,u){if(rn(u)!=="number")return da(a.default,r.default);const f=a.stops.length;if(f===1||u<=a.stops[0][0])return a.stops[0][1];if(u>=a.stops[f-1][0])return a.stops[f-1][1];const g=Vt(a.stops.map(v=>v[0]),u);return a.stops[g][1]}function vf(a,r,u){const f=a.base!==void 0?a.base:1;if(rn(u)!=="number")return da(a.default,r.default);const g=a.stops.length;if(g===1||u<=a.stops[0][0])return a.stops[0][1];if(u>=a.stops[g-1][0])return a.stops[g-1][1];const v=Vt(a.stops.map(z=>z[0]),u),b=function(z,F,j,X){const Y=X-j,le=z-j;return Y===0?0:F===1?le/Y:(Math.pow(F,le)-1)/(Math.pow(F,Y)-1)}(u,f,a.stops[v][0],a.stops[v+1][0]),T=a.stops[v][1],A=a.stops[v+1][1];let L=jn[r.type]||Sn;if(a.colorSpace&&a.colorSpace!=="rgb"){const z=df[a.colorSpace];L=(F,j)=>z.reverse(z.interpolate(z.forward(F),z.forward(j),b))}return typeof T.evaluate=="function"?{evaluate(...z){const F=T.evaluate.apply(void 0,z),j=A.evaluate.apply(void 0,z);if(F!==void 0&&j!==void 0)return L(F,j,b)}}:L(T,A,b)}function Gg(a,r,u){switch(r.type){case"color":u=J.parse(u);break;case"formatted":u=de.fromString(u.toString());break;case"resolvedImage":u=me.fromString(u.toString());break;case"padding":u=ce.parse(u);break;default:rn(u)===r.type||r.type==="enum"&&r.values[u]||(u=void 0)}return da(u,a.default,r.default)}Wt.register(ua,{error:[{kind:"error"},[kt],(a,[r])=>{throw new Ke(r.evaluate(a))}],typeof:[kt,[Mt],(a,[r])=>sn(Ie(r.evaluate(a)))],"to-rgba":[ui($e,4),[ti],(a,[r])=>r.evaluate(a).toArray()],rgb:[ti,[$e,$e,$e],mf],rgba:[ti,[$e,$e,$e,$e],mf],has:{type:Lt,overloads:[[[kt],(a,[r])=>gf(r.evaluate(a),a.properties())],[[kt,jr],(a,[r,u])=>gf(r.evaluate(a),u.evaluate(a))]]},get:{type:Mt,overloads:[[[kt],(a,[r])=>hc(r.evaluate(a),a.properties())],[[kt,jr],(a,[r,u])=>hc(r.evaluate(a),u.evaluate(a))]]},"feature-state":[Mt,[kt],(a,[r])=>hc(r.evaluate(a),a.featureState||{})],properties:[jr,[],a=>a.properties()],"geometry-type":[kt,[],a=>a.geometryType()],id:[Mt,[],a=>a.id()],zoom:[$e,[],a=>a.globals.zoom],"heatmap-density":[$e,[],a=>a.globals.heatmapDensity||0],"line-progress":[$e,[],a=>a.globals.lineProgress||0],accumulated:[Mt,[],a=>a.globals.accumulated===void 0?null:a.globals.accumulated],"+":[$e,Po($e),(a,r)=>{let u=0;for(const f of r)u+=f.evaluate(a);return u}],"*":[$e,Po($e),(a,r)=>{let u=1;for(const f of r)u*=f.evaluate(a);return u}],"-":{type:$e,overloads:[[[$e,$e],(a,[r,u])=>r.evaluate(a)-u.evaluate(a)],[[$e],(a,[r])=>-r.evaluate(a)]]},"/":[$e,[$e,$e],(a,[r,u])=>r.evaluate(a)/u.evaluate(a)],"%":[$e,[$e,$e],(a,[r,u])=>r.evaluate(a)%u.evaluate(a)],ln2:[$e,[],()=>Math.LN2],pi:[$e,[],()=>Math.PI],e:[$e,[],()=>Math.E],"^":[$e,[$e,$e],(a,[r,u])=>Math.pow(r.evaluate(a),u.evaluate(a))],sqrt:[$e,[$e],(a,[r])=>Math.sqrt(r.evaluate(a))],log10:[$e,[$e],(a,[r])=>Math.log(r.evaluate(a))/Math.LN10],ln:[$e,[$e],(a,[r])=>Math.log(r.evaluate(a))],log2:[$e,[$e],(a,[r])=>Math.log(r.evaluate(a))/Math.LN2],sin:[$e,[$e],(a,[r])=>Math.sin(r.evaluate(a))],cos:[$e,[$e],(a,[r])=>Math.cos(r.evaluate(a))],tan:[$e,[$e],(a,[r])=>Math.tan(r.evaluate(a))],asin:[$e,[$e],(a,[r])=>Math.asin(r.evaluate(a))],acos:[$e,[$e],(a,[r])=>Math.acos(r.evaluate(a))],atan:[$e,[$e],(a,[r])=>Math.atan(r.evaluate(a))],min:[$e,Po($e),(a,r)=>Math.min(...r.map(u=>u.evaluate(a)))],max:[$e,Po($e),(a,r)=>Math.max(...r.map(u=>u.evaluate(a)))],abs:[$e,[$e],(a,[r])=>Math.abs(r.evaluate(a))],round:[$e,[$e],(a,[r])=>{const u=r.evaluate(a);return u<0?-Math.round(-u):Math.round(u)}],floor:[$e,[$e],(a,[r])=>Math.floor(r.evaluate(a))],ceil:[$e,[$e],(a,[r])=>Math.ceil(r.evaluate(a))],"filter-==":[Lt,[kt,Mt],(a,[r,u])=>a.properties()[r.value]===u.value],"filter-id-==":[Lt,[Mt],(a,[r])=>a.id()===r.value],"filter-type-==":[Lt,[kt],(a,[r])=>a.geometryType()===r.value],"filter-<":[Lt,[kt,Mt],(a,[r,u])=>{const f=a.properties()[r.value],g=u.value;return typeof f==typeof g&&f<g}],"filter-id-<":[Lt,[Mt],(a,[r])=>{const u=a.id(),f=r.value;return typeof u==typeof f&&u<f}],"filter->":[Lt,[kt,Mt],(a,[r,u])=>{const f=a.properties()[r.value],g=u.value;return typeof f==typeof g&&f>g}],"filter-id->":[Lt,[Mt],(a,[r])=>{const u=a.id(),f=r.value;return typeof u==typeof f&&u>f}],"filter-<=":[Lt,[kt,Mt],(a,[r,u])=>{const f=a.properties()[r.value],g=u.value;return typeof f==typeof g&&f<=g}],"filter-id-<=":[Lt,[Mt],(a,[r])=>{const u=a.id(),f=r.value;return typeof u==typeof f&&u<=f}],"filter->=":[Lt,[kt,Mt],(a,[r,u])=>{const f=a.properties()[r.value],g=u.value;return typeof f==typeof g&&f>=g}],"filter-id->=":[Lt,[Mt],(a,[r])=>{const u=a.id(),f=r.value;return typeof u==typeof f&&u>=f}],"filter-has":[Lt,[Mt],(a,[r])=>r.value in a.properties()],"filter-has-id":[Lt,[],a=>a.id()!==null&&a.id()!==void 0],"filter-type-in":[Lt,[ui(kt)],(a,[r])=>r.value.indexOf(a.geometryType())>=0],"filter-id-in":[Lt,[ui(Mt)],(a,[r])=>r.value.indexOf(a.id())>=0],"filter-in-small":[Lt,[kt,ui(Mt)],(a,[r,u])=>u.value.indexOf(a.properties()[r.value])>=0],"filter-in-large":[Lt,[kt,ui(Mt)],(a,[r,u])=>function(f,g,v,b){for(;v<=b;){const T=v+b>>1;if(g[T]===f)return!0;g[T]>f?b=T-1:v=T+1}return!1}(a.properties()[r.value],u.value,0,u.value.length-1)],all:{type:Lt,overloads:[[[Lt,Lt],(a,[r,u])=>r.evaluate(a)&&u.evaluate(a)],[Po(Lt),(a,r)=>{for(const u of r)if(!u.evaluate(a))return!1;return!0}]]},any:{type:Lt,overloads:[[[Lt,Lt],(a,[r,u])=>r.evaluate(a)||u.evaluate(a)],[Po(Lt),(a,r)=>{for(const u of r)if(u.evaluate(a))return!0;return!1}]]},"!":[Lt,[Lt],(a,[r])=>!r.evaluate(a)],"is-supported-script":[Lt,[kt],(a,[r])=>{const u=a.globals&&a.globals.isSupportedScript;return!u||u(r.evaluate(a))}],upcase:[kt,[kt],(a,[r])=>r.evaluate(a).toUpperCase()],downcase:[kt,[kt],(a,[r])=>r.evaluate(a).toLowerCase()],concat:[kt,Po(Mt),(a,r)=>r.map(u=>lt(u.evaluate(a))).join("")],"resolved-locale":[kt,[ur],(a,[r])=>r.evaluate(a).resolvedLocale()]});class dc{constructor(r,u){this.expression=r,this._warningHistory={},this._evaluator=new Ut,this._defaultValue=u?function(f){return f.type==="color"&&xn(f.default)?new J(0,0,0,0):f.type==="color"?J.parse(f.default)||null:f.type==="padding"?ce.parse(f.default)||null:f.default===void 0?null:f.default}(u):null,this._enumValues=u&&u.type==="enum"?u.values:null}evaluateWithoutErrorHandling(r,u,f,g,v,b){return this._evaluator.globals=r,this._evaluator.feature=u,this._evaluator.featureState=f,this._evaluator.canonical=g,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=b,this.expression.evaluate(this._evaluator)}evaluate(r,u,f,g,v,b){this._evaluator.globals=r,this._evaluator.feature=u||null,this._evaluator.featureState=f||null,this._evaluator.canonical=g,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=b||null;try{const T=this.expression.evaluate(this._evaluator);if(T==null||typeof T=="number"&&T!=T)return this._defaultValue;if(this._enumValues&&!(T in this._enumValues))throw new Ke(`Expected value to be one of ${Object.keys(this._enumValues).map(A=>JSON.stringify(A)).join(", ")}, but found ${JSON.stringify(T)} instead.`);return T}catch(T){return this._warningHistory[T.message]||(this._warningHistory[T.message]=!0,typeof console<"u"&&console.warn(T.message)),this._defaultValue}}}function sl(a){return Array.isArray(a)&&a.length>0&&typeof a[0]=="string"&&a[0]in ua}function ol(a,r){const u=new Ue(ua,[],r?function(g){const v={color:ti,string:kt,number:$e,enum:kt,boolean:Lt,formatted:Zn,padding:Ks,resolvedImage:On};return g.type==="array"?ui(v[g.value]||Mt,g.length):v[g.type]}(r):void 0),f=u.parse(a,void 0,void 0,void 0,r&&r.type==="string"?{typeAnnotation:"coerce"}:void 0);return f?_f(new dc(f,r)):ha(u.errors)}class al{constructor(r,u){this.kind=r,this._styleExpression=u,this.isStateDependent=r!=="constant"&&!Q(u.expression)}evaluateWithoutErrorHandling(r,u,f,g,v,b){return this._styleExpression.evaluateWithoutErrorHandling(r,u,f,g,v,b)}evaluate(r,u,f,g,v,b){return this._styleExpression.evaluate(r,u,f,g,v,b)}}class rh{constructor(r,u,f,g){this.kind=r,this.zoomStops=f,this._styleExpression=u,this.isStateDependent=r!=="camera"&&!Q(u.expression),this.interpolationType=g}evaluateWithoutErrorHandling(r,u,f,g,v,b){return this._styleExpression.evaluateWithoutErrorHandling(r,u,f,g,v,b)}evaluate(r,u,f,g,v,b){return this._styleExpression.evaluate(r,u,f,g,v,b)}interpolationFactor(r,u,f){return this.interpolationType?dr.interpolationFactor(this.interpolationType,r,u,f):0}}function xf(a,r){const u=ol(a,r);if(u.result==="error")return u;const f=u.value.expression,g=Z(f);if(!g&&!wn(r))return ha([new Ni("","data expressions not supported")]);const v=he(f,["zoom"]);if(!v&&!yf(r))return ha([new Ni("","zoom expressions not supported")]);const b=pc(f);return b||v?b instanceof Ni?ha([b]):b instanceof dr&&!qt(r)?ha([new Ni("",'"interpolate" expressions cannot be used with this property')]):_f(b?new rh(g?"camera":"composite",u.value,b.labels,b instanceof dr?b.interpolation:void 0):new al(g?"constant":"source",u.value)):ha([new Ni("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class fc{constructor(r,u){this._parameters=r,this._specification=u,Ii(this,rl(this._parameters,this._specification))}static deserialize(r){return new fc(r._parameters,r._specification)}static serialize(r){return{_parameters:r._parameters,_specification:r._specification}}}function pc(a){let r=null;if(a instanceof ac)r=pc(a.result);else if(a instanceof oc){for(const u of a.args)if(r=pc(u),r)break}else(a instanceof Cn||a instanceof dr)&&a.input instanceof Wt&&a.input.name==="zoom"&&(r=a);return r instanceof Ni||a.eachChild(u=>{const f=pc(u);f instanceof Ni?r=f:!r&&f?r=new Ni("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):r&&f&&r!==f&&(r=new Ni("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),r}function Hr(a){const r=a.key,u=a.value,f=a.valueSpec||{},g=a.objectElementValidators||{},v=a.style,b=a.styleSpec;let T=[];const A=rn(u);if(A!=="object")return[new qe(r,u,`object expected, ${A} found`)];for(const L in u){const z=L.split(".")[0],F=f[z]||f["*"];let j;if(g[z])j=g[z];else if(f[z])j=pr;else if(g["*"])j=g["*"];else{if(!f["*"]){T.push(new qe(r,u[L],`unknown property "${L}"`));continue}j=pr}T=T.concat(j({key:(r&&`${r}.`)+L,value:u[L],valueSpec:F,style:v,styleSpec:b,object:u,objectKey:L},u))}for(const L in f)g[L]||f[L].required&&f[L].default===void 0&&u[L]===void 0&&T.push(new qe(r,u,`missing required property "${L}"`));return T}function bf(a){const r=a.value,u=a.valueSpec,f=a.style,g=a.styleSpec,v=a.key,b=a.arrayElementValidator||pr;if(rn(r)!=="array")return[new qe(v,r,`array expected, ${rn(r)} found`)];if(u.length&&r.length!==u.length)return[new qe(v,r,`array length ${u.length} expected, length ${r.length} found`)];if(u["min-length"]&&r.length<u["min-length"])return[new qe(v,r,`array length at least ${u["min-length"]} expected, length ${r.length} found`)];let T={type:u.value,values:u.values};g.$version<7&&(T.function=u.function),rn(u.value)==="object"&&(T=u.value);let A=[];for(let L=0;L<r.length;L++)A=A.concat(b({array:r,arrayIndex:L,value:r[L],valueSpec:T,style:f,styleSpec:g,key:`${v}[${L}]`}));return A}function sh(a){const r=a.key,u=a.value,f=a.valueSpec;let g=rn(u);return g==="number"&&u!=u&&(g="NaN"),g!=="number"?[new qe(r,u,`number expected, ${g} found`)]:"minimum"in f&&u<f.minimum?[new qe(r,u,`${u} is less than the minimum value ${f.minimum}`)]:"maximum"in f&&u>f.maximum?[new qe(r,u,`${u} is greater than the maximum value ${f.maximum}`)]:[]}function wf(a){const r=a.valueSpec,u=Gt(a.value.type);let f,g,v,b={};const T=u!=="categorical"&&a.value.property===void 0,A=!T,L=rn(a.value.stops)==="array"&&rn(a.value.stops[0])==="array"&&rn(a.value.stops[0][0])==="object",z=Hr({key:a.key,value:a.value,valueSpec:a.styleSpec.function,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{stops:function(X){if(u==="identity")return[new qe(X.key,X.value,'identity function may not have a "stops" property')];let Y=[];const le=X.value;return Y=Y.concat(bf({key:X.key,value:le,valueSpec:X.valueSpec,style:X.style,styleSpec:X.styleSpec,arrayElementValidator:F})),rn(le)==="array"&&le.length===0&&Y.push(new qe(X.key,le,"array must have at least one stop")),Y},default:function(X){return pr({key:X.key,value:X.value,valueSpec:r,style:X.style,styleSpec:X.styleSpec})}}});return u==="identity"&&T&&z.push(new qe(a.key,a.value,'missing required property "property"')),u==="identity"||a.value.stops||z.push(new qe(a.key,a.value,'missing required property "stops"')),u==="exponential"&&a.valueSpec.expression&&!qt(a.valueSpec)&&z.push(new qe(a.key,a.value,"exponential functions not supported")),a.styleSpec.$version>=8&&(A&&!wn(a.valueSpec)?z.push(new qe(a.key,a.value,"property functions not supported")):T&&!yf(a.valueSpec)&&z.push(new qe(a.key,a.value,"zoom functions not supported"))),u!=="categorical"&&!L||a.value.property!==void 0||z.push(new qe(a.key,a.value,'"property" property is required')),z;function F(X){let Y=[];const le=X.value,oe=X.key;if(rn(le)!=="array")return[new qe(oe,le,`array expected, ${rn(le)} found`)];if(le.length!==2)return[new qe(oe,le,`array length 2 expected, length ${le.length} found`)];if(L){if(rn(le[0])!=="object")return[new qe(oe,le,`object expected, ${rn(le[0])} found`)];if(le[0].zoom===void 0)return[new qe(oe,le,"object stop key must have zoom")];if(le[0].value===void 0)return[new qe(oe,le,"object stop key must have value")];if(v&&v>Gt(le[0].zoom))return[new qe(oe,le[0].zoom,"stop zoom values must appear in ascending order")];Gt(le[0].zoom)!==v&&(v=Gt(le[0].zoom),g=void 0,b={}),Y=Y.concat(Hr({key:`${oe}[0]`,value:le[0],valueSpec:{zoom:{}},style:X.style,styleSpec:X.styleSpec,objectElementValidators:{zoom:sh,value:j}}))}else Y=Y.concat(j({key:`${oe}[0]`,value:le[0],valueSpec:{},style:X.style,styleSpec:X.styleSpec},le));return sl(Xi(le[1]))?Y.concat([new qe(`${oe}[1]`,le[1],"expressions are not allowed in function stops.")]):Y.concat(pr({key:`${oe}[1]`,value:le[1],valueSpec:r,style:X.style,styleSpec:X.styleSpec}))}function j(X,Y){const le=rn(X.value),oe=Gt(X.value),ve=X.value!==null?X.value:Y;if(f){if(le!==f)return[new qe(X.key,ve,`${le} stop domain type must match previous stop domain type ${f}`)]}else f=le;if(le!=="number"&&le!=="string"&&le!=="boolean")return[new qe(X.key,ve,"stop domain value must be a number, string, or boolean")];if(le!=="number"&&u!=="categorical"){let Se=`number expected, ${le} found`;return wn(r)&&u===void 0&&(Se+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new qe(X.key,ve,Se)]}return u!=="categorical"||le!=="number"||isFinite(oe)&&Math.floor(oe)===oe?u!=="categorical"&&le==="number"&&g!==void 0&&oe<g?[new qe(X.key,ve,"stop domain values must appear in ascending order")]:(g=oe,u==="categorical"&&oe in b?[new qe(X.key,ve,"stop domain values must be unique")]:(b[oe]=!0,[])):[new qe(X.key,ve,`integer expected, found ${oe}`)]}}function Io(a){const r=(a.expressionContext==="property"?xf:ol)(Xi(a.value),a.valueSpec);if(r.result==="error")return r.value.map(f=>new qe(`${a.key}${f.key}`,a.value,f.message));const u=r.value.expression||r.value._styleExpression.expression;if(a.expressionContext==="property"&&a.propertyKey==="text-font"&&!u.outputDefined())return[new qe(a.key,a.value,`Invalid data expression for "${a.propertyKey}". Output values must be contained as literals within the expression.`)];if(a.expressionContext==="property"&&a.propertyType==="layout"&&!Q(u))return[new qe(a.key,a.value,'"feature-state" data expressions are not supported with layout properties.')];if(a.expressionContext==="filter"&&!Q(u))return[new qe(a.key,a.value,'"feature-state" data expressions are not supported with filters.')];if(a.expressionContext&&a.expressionContext.indexOf("cluster")===0){if(!he(u,["zoom","feature-state"]))return[new qe(a.key,a.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(a.expressionContext==="cluster-initial"&&!Z(u))return[new qe(a.key,a.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ll(a){const r=a.key,u=a.value,f=a.valueSpec,g=[];return Array.isArray(f.values)?f.values.indexOf(Gt(u))===-1&&g.push(new qe(r,u,`expected one of [${f.values.join(", ")}], ${JSON.stringify(u)} found`)):Object.keys(f.values).indexOf(Gt(u))===-1&&g.push(new qe(r,u,`expected one of [${Object.keys(f.values).join(", ")}], ${JSON.stringify(u)} found`)),g}function fa(a){if(a===!0||a===!1)return!0;if(!Array.isArray(a)||a.length===0)return!1;switch(a[0]){case"has":return a.length>=2&&a[1]!=="$id"&&a[1]!=="$type";case"in":return a.length>=3&&(typeof a[1]!="string"||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return a.length!==3||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(const r of a.slice(1))if(!fa(r)&&typeof r!="boolean")return!1;return!0;default:return!0}}const Wg={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function mc(a){if(a==null)return{filter:()=>!0,needGeometry:!1};fa(a)||(a=cl(a));const r=ol(a,Wg);if(r.result==="error")throw new Error(r.value.map(u=>`${u.key}: ${u.message}`).join(", "));return{filter:(u,f,g)=>r.value.evaluate(u,f,{},g),needGeometry:Tf(a)}}function Ef(a,r){return a<r?-1:a>r?1:0}function Tf(a){if(!Array.isArray(a))return!1;if(a[0]==="within")return!0;for(let r=1;r<a.length;r++)if(Tf(a[r]))return!0;return!1}function cl(a){if(!a)return!0;const r=a[0];return a.length<=1?r!=="any":r==="=="?oh(a[1],a[2],"=="):r==="!="?pa(oh(a[1],a[2],"==")):r==="<"||r===">"||r==="<="||r===">="?oh(a[1],a[2],r):r==="any"?(u=a.slice(1),["any"].concat(u.map(cl))):r==="all"?["all"].concat(a.slice(1).map(cl)):r==="none"?["all"].concat(a.slice(1).map(cl).map(pa)):r==="in"?gc(a[1],a.slice(2)):r==="!in"?pa(gc(a[1],a.slice(2))):r==="has"?ul(a[1]):r==="!has"?pa(ul(a[1])):r!=="within"||a;var u}function oh(a,r,u){switch(a){case"$type":return[`filter-type-${u}`,r];case"$id":return[`filter-id-${u}`,r];default:return[`filter-${u}`,a,r]}}function gc(a,r){if(r.length===0)return!1;switch(a){case"$type":return["filter-type-in",["literal",r]];case"$id":return["filter-id-in",["literal",r]];default:return r.length>200&&!r.some(u=>typeof u!=typeof r[0])?["filter-in-large",a,["literal",r.sort(Ef)]]:["filter-in-small",a,["literal",r]]}}function ul(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function pa(a){return["!",a]}function hl(a){return fa(Xi(a.value))?Io(Ii({},a,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Sf(a)}function Sf(a){const r=a.value,u=a.key;if(rn(r)!=="array")return[new qe(u,r,`array expected, ${rn(r)} found`)];const f=a.styleSpec;let g,v=[];if(r.length<1)return[new qe(u,r,"filter array must have at least 1 element")];switch(v=v.concat(ll({key:`${u}[0]`,value:r[0],valueSpec:f.filter_operator,style:a.style,styleSpec:a.styleSpec})),Gt(r[0])){case"<":case"<=":case">":case">=":r.length>=2&&Gt(r[1])==="$type"&&v.push(new qe(u,r,`"$type" cannot be use with operator "${r[0]}"`));case"==":case"!=":r.length!==3&&v.push(new qe(u,r,`filter array for operator "${r[0]}" must have 3 elements`));case"in":case"!in":r.length>=2&&(g=rn(r[1]),g!=="string"&&v.push(new qe(`${u}[1]`,r[1],`string expected, ${g} found`)));for(let b=2;b<r.length;b++)g=rn(r[b]),Gt(r[1])==="$type"?v=v.concat(ll({key:`${u}[${b}]`,value:r[b],valueSpec:f.geometry_type,style:a.style,styleSpec:a.styleSpec})):g!=="string"&&g!=="number"&&g!=="boolean"&&v.push(new qe(`${u}[${b}]`,r[b],`string, number, or boolean expected, ${g} found`));break;case"any":case"all":case"none":for(let b=1;b<r.length;b++)v=v.concat(Sf({key:`${u}[${b}]`,value:r[b],style:a.style,styleSpec:a.styleSpec}));break;case"has":case"!has":g=rn(r[1]),r.length!==2?v.push(new qe(u,r,`filter array for "${r[0]}" operator must have 2 elements`)):g!=="string"&&v.push(new qe(`${u}[1]`,r[1],`string expected, ${g} found`));break;case"within":g=rn(r[1]),r.length!==2?v.push(new qe(u,r,`filter array for "${r[0]}" operator must have 2 elements`)):g!=="object"&&v.push(new qe(`${u}[1]`,r[1],`object expected, ${g} found`))}return v}function dl(a,r){const u=a.key,f=a.style,g=a.styleSpec,v=a.value,b=a.objectKey,T=g[`${r}_${a.layerType}`];if(!T)return[];const A=b.match(/^(.*)-transition$/);if(r==="paint"&&A&&T[A[1]]&&T[A[1]].transition)return pr({key:u,value:v,valueSpec:g.transition,style:f,styleSpec:g});const L=a.valueSpec||T[b];if(!L)return[new qe(u,v,`unknown property "${b}"`)];let z;if(rn(v)==="string"&&wn(L)&&!L.tokens&&(z=/^{([^}]+)}$/.exec(v)))return[new qe(u,v,`"${b}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(z[1])} }\`.`)];const F=[];return a.layerType==="symbol"&&(b==="text-field"&&f&&!f.glyphs&&F.push(new qe(u,v,'use of "text-field" requires a style "glyphs" property')),b==="text-font"&&xn(Xi(v))&&Gt(v.type)==="identity"&&F.push(new qe(u,v,'"text-font" does not support identity functions'))),F.concat(pr({key:a.key,value:v,valueSpec:L,style:f,styleSpec:g,expressionContext:"property",propertyType:r,propertyKey:b}))}function Af(a){return dl(a,"paint")}function Pf(a){return dl(a,"layout")}function If(a){let r=[];const u=a.value,f=a.key,g=a.style,v=a.styleSpec;u.type||u.ref||r.push(new qe(f,u,'either "type" or "ref" is required'));let b=Gt(u.type);const T=Gt(u.ref);if(u.id){const A=Gt(u.id);for(let L=0;L<a.arrayIndex;L++){const z=g.layers[L];Gt(z.id)===A&&r.push(new qe(f,u.id,`duplicate layer id "${u.id}", previously used at line ${z.id.__line__}`))}}if("ref"in u){let A;["type","source","source-layer","filter","layout"].forEach(L=>{L in u&&r.push(new qe(f,u[L],`"${L}" is prohibited for ref layers`))}),g.layers.forEach(L=>{Gt(L.id)===T&&(A=L)}),A?A.ref?r.push(new qe(f,u.ref,"ref cannot reference another ref layer")):b=Gt(A.type):r.push(new qe(f,u.ref,`ref layer "${T}" not found`))}else if(b!=="background")if(u.source){const A=g.sources&&g.sources[u.source],L=A&&Gt(A.type);A?L==="vector"&&b==="raster"?r.push(new qe(f,u.source,`layer "${u.id}" requires a raster source`)):L==="raster"&&b!=="raster"?r.push(new qe(f,u.source,`layer "${u.id}" requires a vector source`)):L!=="vector"||u["source-layer"]?L==="raster-dem"&&b!=="hillshade"?r.push(new qe(f,u.source,"raster-dem source can only be used with layer type 'hillshade'.")):b!=="line"||!u.paint||!u.paint["line-gradient"]||L==="geojson"&&A.lineMetrics||r.push(new qe(f,u,`layer "${u.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):r.push(new qe(f,u,`layer "${u.id}" must specify a "source-layer"`)):r.push(new qe(f,u.source,`source "${u.source}" not found`))}else r.push(new qe(f,u,'missing required property "source"'));return r=r.concat(Hr({key:f,value:u,valueSpec:v.layer,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{"*":()=>[],type:()=>pr({key:`${f}.type`,value:u.type,valueSpec:v.layer.type,style:a.style,styleSpec:a.styleSpec,object:u,objectKey:"type"}),filter:hl,layout:A=>Hr({layer:u,key:A.key,value:A.value,style:A.style,styleSpec:A.styleSpec,objectElementValidators:{"*":L=>Pf(Ii({layerType:b},L))}}),paint:A=>Hr({layer:u,key:A.key,value:A.value,style:A.style,styleSpec:A.styleSpec,objectElementValidators:{"*":L=>Af(Ii({layerType:b},L))}})}})),r}function ma(a){const r=a.value,u=a.key,f=rn(r);return f!=="string"?[new qe(u,r,`string expected, ${f} found`)]:[]}const Cf={promoteId:function({key:a,value:r}){if(rn(r)==="string")return ma({key:a,value:r});{const u=[];for(const f in r)u.push(...ma({key:`${a}.${f}`,value:r[f]}));return u}}};function fl(a){const r=a.value,u=a.key,f=a.styleSpec,g=a.style;if(!r.type)return[new qe(u,r,'"type" is required')];const v=Gt(r.type);let b;switch(v){case"vector":case"raster":case"raster-dem":return b=Hr({key:u,value:r,valueSpec:f[`source_${v.replace("-","_")}`],style:a.style,styleSpec:f,objectElementValidators:Cf}),b;case"geojson":if(b=Hr({key:u,value:r,valueSpec:f.source_geojson,style:g,styleSpec:f,objectElementValidators:Cf}),r.cluster)for(const T in r.clusterProperties){const[A,L]=r.clusterProperties[T],z=typeof A=="string"?[A,["accumulated"],["get",T]]:A;b.push(...Io({key:`${u}.${T}.map`,value:L,expressionContext:"cluster-map"})),b.push(...Io({key:`${u}.${T}.reduce`,value:z,expressionContext:"cluster-reduce"}))}return b;case"video":return Hr({key:u,value:r,valueSpec:f.source_video,style:g,styleSpec:f});case"image":return Hr({key:u,value:r,valueSpec:f.source_image,style:g,styleSpec:f});case"canvas":return[new qe(u,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ll({key:`${u}.type`,value:r.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:g,styleSpec:f})}}function pl(a){const r=a.value,u=a.styleSpec,f=u.light,g=a.style;let v=[];const b=rn(r);if(r===void 0)return v;if(b!=="object")return v=v.concat([new qe("light",r,`object expected, ${b} found`)]),v;for(const T in r){const A=T.match(/^(.*)-transition$/);v=v.concat(A&&f[A[1]]&&f[A[1]].transition?pr({key:T,value:r[T],valueSpec:u.transition,style:g,styleSpec:u}):f[T]?pr({key:T,value:r[T],valueSpec:f[T],style:g,styleSpec:u}):[new qe(T,r[T],`unknown property "${T}"`)])}return v}function fr(a){const r=a.value,u=a.styleSpec,f=u.terrain,g=a.style;let v=[];const b=rn(r);if(r===void 0)return v;if(b!=="object")return v=v.concat([new qe("terrain",r,`object expected, ${b} found`)]),v;for(const T in r)v=v.concat(f[T]?pr({key:T,value:r[T],valueSpec:f[T],style:g,styleSpec:u}):[new qe(T,r[T],`unknown property "${T}"`)]);return v}const ml={"*":()=>[],array:bf,boolean:function(a){const r=a.value,u=a.key,f=rn(r);return f!=="boolean"?[new qe(u,r,`boolean expected, ${f} found`)]:[]},number:sh,color:function(a){const r=a.key,u=a.value,f=rn(u);return f!=="string"?[new qe(r,u,`color expected, ${f} found`)]:Qs(u)===null?[new qe(r,u,`color expected, "${u}" found`)]:[]},constants:ds,enum:ll,filter:hl,function:wf,layer:If,object:Hr,source:fl,light:pl,terrain:fr,string:ma,formatted:function(a){return ma(a).length===0?[]:Io(a)},resolvedImage:function(a){return ma(a).length===0?[]:Io(a)},padding:function(a){const r=a.key,u=a.value;if(rn(u)==="array"){if(u.length<1||u.length>4)return[new qe(r,u,`padding requires 1 to 4 values; ${u.length} values found`)];const f={type:"number"};let g=[];for(let v=0;v<u.length;v++)g=g.concat(pr({key:`${r}[${v}]`,value:u[v],valueSpec:f}));return g}return sh({key:r,value:u,valueSpec:{}})}};function pr(a){const r=a.value,u=a.valueSpec,f=a.styleSpec;return u.expression&&xn(Gt(r))?wf(a):u.expression&&sl(Xi(r))?Io(a):u.type&&ml[u.type]?ml[u.type](a):Hr(Ii({},a,{valueSpec:u.type?f[u.type]:u}))}function Hg(a){const r=a.value,u=a.key,f=ma(a);return f.length||(r.indexOf("{fontstack}")===-1&&f.push(new qe(u,r,'"glyphs" url must include a "{fontstack}" token')),r.indexOf("{range}")===-1&&f.push(new qe(u,r,'"glyphs" url must include a "{range}" token'))),f}function to(a,r=Le){let u=[];return u=u.concat(pr({key:"",value:a,valueSpec:r.$root,styleSpec:r,style:a,objectElementValidators:{glyphs:Hg,"*":()=>[]}})),a.constants&&(u=u.concat(ds({key:"constants",value:a.constants,style:a,styleSpec:r}))),Mf(u)}function Mf(a){return[].concat(a).sort((r,u)=>r.line-u.line)}function Ds(a){return function(...r){return Mf(a.apply(this,r))}}to.source=Ds(fl),to.light=Ds(pl),to.terrain=Ds(fr),to.layer=Ds(If),to.filter=Ds(hl),to.paintProperty=Ds(Af),to.layoutProperty=Ds(Pf);const gl=to,ah=gl.light,$g=gl.paintProperty,qg=gl.layoutProperty;function _c(a,r){let u=!1;if(r&&r.length)for(const f of r)a.fire(new Ys(new Error(f.message))),u=!0;return u}class _l{constructor(r,u,f){const g=this.cells=[];if(r instanceof ArrayBuffer){this.arrayBuffer=r;const b=new Int32Array(this.arrayBuffer);r=b[0],this.d=(u=b[1])+2*(f=b[2]);for(let A=0;A<this.d*this.d;A++){const L=b[3+A],z=b[3+A+1];g.push(L===z?null:b.subarray(L,z))}const T=b[3+g.length+1];this.keys=b.subarray(b[3+g.length],T),this.bboxes=b.subarray(T),this.insert=this._insertReadonly}else{this.d=u+2*f;for(let b=0;b<this.d*this.d;b++)g.push([]);this.keys=[],this.bboxes=[]}this.n=u,this.extent=r,this.padding=f,this.scale=u/r,this.uid=0;const v=f/u*r;this.min=-v,this.max=r+v}insert(r,u,f,g,v){this._forEachCell(u,f,g,v,this._insertCell,this.uid++,void 0,void 0),this.keys.push(r),this.bboxes.push(u),this.bboxes.push(f),this.bboxes.push(g),this.bboxes.push(v)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(r,u,f,g,v,b){this.cells[v].push(b)}query(r,u,f,g,v){const b=this.min,T=this.max;if(r<=b&&u<=b&&T<=f&&T<=g&&!v)return Array.prototype.slice.call(this.keys);{const A=[];return this._forEachCell(r,u,f,g,this._queryCell,A,{},v),A}}_queryCell(r,u,f,g,v,b,T,A){const L=this.cells[v];if(L!==null){const z=this.keys,F=this.bboxes;for(let j=0;j<L.length;j++){const X=L[j];if(T[X]===void 0){const Y=4*X;(A?A(F[Y+0],F[Y+1],F[Y+2],F[Y+3]):r<=F[Y+2]&&u<=F[Y+3]&&f>=F[Y+0]&&g>=F[Y+1])?(T[X]=!0,b.push(z[X])):T[X]=!1}}}}_forEachCell(r,u,f,g,v,b,T,A){const L=this._convertToCellCoord(r),z=this._convertToCellCoord(u),F=this._convertToCellCoord(f),j=this._convertToCellCoord(g);for(let X=L;X<=F;X++)for(let Y=z;Y<=j;Y++){const le=this.d*Y+X;if((!A||A(this._convertFromCellCoord(X),this._convertFromCellCoord(Y),this._convertFromCellCoord(X+1),this._convertFromCellCoord(Y+1)))&&v.call(this,r,u,f,g,le,b,T,A))return}}_convertFromCellCoord(r){return(r-this.padding)/this.scale}_convertToCellCoord(r){return Math.max(0,Math.min(this.d-1,Math.floor(r*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const r=this.cells,u=3+this.cells.length+1+1;let f=0;for(let b=0;b<this.cells.length;b++)f+=this.cells[b].length;const g=new Int32Array(u+f+this.keys.length+this.bboxes.length);g[0]=this.extent,g[1]=this.n,g[2]=this.padding;let v=u;for(let b=0;b<r.length;b++){const T=r[b];g[3+b]=v,g.set(T,v),v+=T.length}return g[3+r.length]=v,g.set(this.keys,v),v+=this.keys.length,g[3+r.length+1]=v,g.set(this.bboxes,v),v+=this.bboxes.length,g.buffer}static serialize(r,u){const f=r.toArrayBuffer();return u&&u.push(f),{buffer:f}}static deserialize(r){return new _l(r.buffer)}}const zs={};function ct(a,r,u={}){if(zs[a])throw new Error(`${a} is already registered.`);Object.defineProperty(r,"_classRegistryKey",{value:a,writeable:!1}),zs[a]={klass:r,omit:u.omit||[],shallow:u.shallow||[]}}ct("Object",Object),ct("TransferableGridIndex",_l),ct("Color",J),ct("Error",Error),ct("AJAXError",ei),ct("ResolvedImage",me),ct("StylePropertyFunction",fc),ct("StyleExpression",dc,{omit:["_evaluator"]}),ct("ZoomDependentExpression",rh),ct("ZoomConstantExpression",al),ct("CompoundExpression",Wt,{omit:["_evaluate"]});for(const a in ua)ua[a]._classRegistryKey||ct(`Expression_${a}`,ua[a]);function Lf(a){return a&&typeof ArrayBuffer<"u"&&(a instanceof ArrayBuffer||a.constructor&&a.constructor.name==="ArrayBuffer")}function Co(a,r){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||a instanceof Blob)return a;if(Lf(a)||Bt(a))return r&&r.push(a),a;if(ArrayBuffer.isView(a)){const u=a;return r&&r.push(u.buffer),u}if(a instanceof ImageData)return r&&r.push(a.data.buffer),a;if(Array.isArray(a)){const u=[];for(const f of a)u.push(Co(f,r));return u}if(typeof a=="object"){const u=a.constructor,f=u._classRegistryKey;if(!f)throw new Error("can't serialize object of unregistered class");if(!zs[f])throw new Error(`${f} is not registered.`);const g=u.serialize?u.serialize(a,r):{};if(u.serialize){if(r&&g===r[r.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const v in a){if(!a.hasOwnProperty(v)||zs[f].omit.indexOf(v)>=0)continue;const b=a[v];g[v]=zs[f].shallow.indexOf(v)>=0?b:Co(b,r)}a instanceof Error&&(g.message=a.message)}if(g.$name)throw new Error("$name property is reserved for worker serialization logic.");return f!=="Object"&&(g.$name=f),g}throw new Error("can't serialize object of type "+typeof a)}function no(a){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||a instanceof Blob||Lf(a)||Bt(a)||ArrayBuffer.isView(a)||a instanceof ImageData)return a;if(Array.isArray(a))return a.map(no);if(typeof a=="object"){const r=a.$name||"Object";if(!zs[r])throw new Error(`can't deserialize unregistered class ${r}`);const{klass:u}=zs[r];if(!u)throw new Error(`can't deserialize unregistered class ${r}`);if(u.deserialize)return u.deserialize(a);const f=Object.create(u.prototype);for(const g of Object.keys(a)){if(g==="$name")continue;const v=a[g];f[g]=zs[r].shallow.indexOf(g)>=0?v:no(v)}return f}throw new Error("can't deserialize object of type "+typeof a)}class lh{constructor(){this.first=!0}update(r,u){const f=Math.floor(r);return this.first?(this.first=!1,this.lastIntegerZoom=f,this.lastIntegerZoomTime=0,this.lastZoom=r,this.lastFloorZoom=f,!0):(this.lastFloorZoom>f?(this.lastIntegerZoom=f+1,this.lastIntegerZoomTime=u):this.lastFloorZoom<f&&(this.lastIntegerZoom=f,this.lastIntegerZoomTime=u),r!==this.lastZoom&&(this.lastZoom=r,this.lastFloorZoom=f,!0))}}const Qe={"Latin-1 Supplement":a=>a>=128&&a<=255,Arabic:a=>a>=1536&&a<=1791,"Arabic Supplement":a=>a>=1872&&a<=1919,"Arabic Extended-A":a=>a>=2208&&a<=2303,"Hangul Jamo":a=>a>=4352&&a<=4607,"Unified Canadian Aboriginal Syllabics":a=>a>=5120&&a<=5759,Khmer:a=>a>=6016&&a<=6143,"Unified Canadian Aboriginal Syllabics Extended":a=>a>=6320&&a<=6399,"General Punctuation":a=>a>=8192&&a<=8303,"Letterlike Symbols":a=>a>=8448&&a<=8527,"Number Forms":a=>a>=8528&&a<=8591,"Miscellaneous Technical":a=>a>=8960&&a<=9215,"Control Pictures":a=>a>=9216&&a<=9279,"Optical Character Recognition":a=>a>=9280&&a<=9311,"Enclosed Alphanumerics":a=>a>=9312&&a<=9471,"Geometric Shapes":a=>a>=9632&&a<=9727,"Miscellaneous Symbols":a=>a>=9728&&a<=9983,"Miscellaneous Symbols and Arrows":a=>a>=11008&&a<=11263,"CJK Radicals Supplement":a=>a>=11904&&a<=12031,"Kangxi Radicals":a=>a>=12032&&a<=12255,"Ideographic Description Characters":a=>a>=12272&&a<=12287,"CJK Symbols and Punctuation":a=>a>=12288&&a<=12351,Hiragana:a=>a>=12352&&a<=12447,Katakana:a=>a>=12448&&a<=12543,Bopomofo:a=>a>=12544&&a<=12591,"Hangul Compatibility Jamo":a=>a>=12592&&a<=12687,Kanbun:a=>a>=12688&&a<=12703,"Bopomofo Extended":a=>a>=12704&&a<=12735,"CJK Strokes":a=>a>=12736&&a<=12783,"Katakana Phonetic Extensions":a=>a>=12784&&a<=12799,"Enclosed CJK Letters and Months":a=>a>=12800&&a<=13055,"CJK Compatibility":a=>a>=13056&&a<=13311,"CJK Unified Ideographs Extension A":a=>a>=13312&&a<=19903,"Yijing Hexagram Symbols":a=>a>=19904&&a<=19967,"CJK Unified Ideographs":a=>a>=19968&&a<=40959,"Yi Syllables":a=>a>=40960&&a<=42127,"Yi Radicals":a=>a>=42128&&a<=42191,"Hangul Jamo Extended-A":a=>a>=43360&&a<=43391,"Hangul Syllables":a=>a>=44032&&a<=55215,"Hangul Jamo Extended-B":a=>a>=55216&&a<=55295,"Private Use Area":a=>a>=57344&&a<=63743,"CJK Compatibility Ideographs":a=>a>=63744&&a<=64255,"Arabic Presentation Forms-A":a=>a>=64336&&a<=65023,"Vertical Forms":a=>a>=65040&&a<=65055,"CJK Compatibility Forms":a=>a>=65072&&a<=65103,"Small Form Variants":a=>a>=65104&&a<=65135,"Arabic Presentation Forms-B":a=>a>=65136&&a<=65279,"Halfwidth and Fullwidth Forms":a=>a>=65280&&a<=65519};function yc(a){for(const r of a)if(uh(r.charCodeAt(0)))return!0;return!1}function Zg(a){for(const r of a)if(!ch(r.charCodeAt(0)))return!1;return!0}function ch(a){return!(Qe.Arabic(a)||Qe["Arabic Supplement"](a)||Qe["Arabic Extended-A"](a)||Qe["Arabic Presentation Forms-A"](a)||Qe["Arabic Presentation Forms-B"](a))}function uh(a){return!(a!==746&&a!==747&&(a<4352||!(Qe["Bopomofo Extended"](a)||Qe.Bopomofo(a)||Qe["CJK Compatibility Forms"](a)&&!(a>=65097&&a<=65103)||Qe["CJK Compatibility Ideographs"](a)||Qe["CJK Compatibility"](a)||Qe["CJK Radicals Supplement"](a)||Qe["CJK Strokes"](a)||!(!Qe["CJK Symbols and Punctuation"](a)||a>=12296&&a<=12305||a>=12308&&a<=12319||a===12336)||Qe["CJK Unified Ideographs Extension A"](a)||Qe["CJK Unified Ideographs"](a)||Qe["Enclosed CJK Letters and Months"](a)||Qe["Hangul Compatibility Jamo"](a)||Qe["Hangul Jamo Extended-A"](a)||Qe["Hangul Jamo Extended-B"](a)||Qe["Hangul Jamo"](a)||Qe["Hangul Syllables"](a)||Qe.Hiragana(a)||Qe["Ideographic Description Characters"](a)||Qe.Kanbun(a)||Qe["Kangxi Radicals"](a)||Qe["Katakana Phonetic Extensions"](a)||Qe.Katakana(a)&&a!==12540||!(!Qe["Halfwidth and Fullwidth Forms"](a)||a===65288||a===65289||a===65293||a>=65306&&a<=65310||a===65339||a===65341||a===65343||a>=65371&&a<=65503||a===65507||a>=65512&&a<=65519)||!(!Qe["Small Form Variants"](a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||Qe["Unified Canadian Aboriginal Syllabics"](a)||Qe["Unified Canadian Aboriginal Syllabics Extended"](a)||Qe["Vertical Forms"](a)||Qe["Yijing Hexagram Symbols"](a)||Qe["Yi Syllables"](a)||Qe["Yi Radicals"](a))))}function kf(a){return!(uh(a)||function(r){return!!(Qe["Latin-1 Supplement"](r)&&(r===167||r===169||r===174||r===177||r===188||r===189||r===190||r===215||r===247)||Qe["General Punctuation"](r)&&(r===8214||r===8224||r===8225||r===8240||r===8241||r===8251||r===8252||r===8258||r===8263||r===8264||r===8265||r===8273)||Qe["Letterlike Symbols"](r)||Qe["Number Forms"](r)||Qe["Miscellaneous Technical"](r)&&(r>=8960&&r<=8967||r>=8972&&r<=8991||r>=8996&&r<=9e3||r===9003||r>=9085&&r<=9114||r>=9150&&r<=9165||r===9167||r>=9169&&r<=9179||r>=9186&&r<=9215)||Qe["Control Pictures"](r)&&r!==9251||Qe["Optical Character Recognition"](r)||Qe["Enclosed Alphanumerics"](r)||Qe["Geometric Shapes"](r)||Qe["Miscellaneous Symbols"](r)&&!(r>=9754&&r<=9759)||Qe["Miscellaneous Symbols and Arrows"](r)&&(r>=11026&&r<=11055||r>=11088&&r<=11097||r>=11192&&r<=11243)||Qe["CJK Symbols and Punctuation"](r)||Qe.Katakana(r)||Qe["Private Use Area"](r)||Qe["CJK Compatibility Forms"](r)||Qe["Small Form Variants"](r)||Qe["Halfwidth and Fullwidth Forms"](r)||r===8734||r===8756||r===8757||r>=9984&&r<=10087||r>=10102&&r<=10131||r===65532||r===65533)}(a))}function Rf(a){return a>=1424&&a<=2303||Qe["Arabic Presentation Forms-A"](a)||Qe["Arabic Presentation Forms-B"](a)}function Xg(a,r){return!(!r&&Rf(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||Qe.Khmer(a))}function Df(a){for(const r of a)if(Rf(r.charCodeAt(0)))return!0;return!1}const hh="deferred",dh="loading",fh="loaded";let ph=null,Yi="unavailable",io=null;const zf=function(a){a&&typeof a=="string"&&a.indexOf("NetworkError")>-1&&(Yi="error"),ph&&ph(a)};function ga(){mh.fire(new Vr("pluginStateChange",{pluginStatus:Yi,pluginURL:io}))}const mh=new Sr,yl=function(){return Yi},Of=function(){if(Yi!==hh||!io)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Yi=dh,ga(),io&&Zi({url:io},a=>{a?zf(a):(Yi=fh,ga())})},Ir={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Yi===fh||Ir.applyArabicShaping!=null,isLoading:()=>Yi===dh,setState(a){if(!Ne())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");Yi=a.pluginStatus,io=a.pluginURL},isParsed(){if(!Ne())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return Ir.applyArabicShaping!=null&&Ir.processBidirectionalText!=null&&Ir.processStyledBidirectionalText!=null},getPluginURL(){if(!Ne())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return io}};class An{constructor(r,u){this.zoom=r,u?(this.now=u.now,this.fadeDuration=u.fadeDuration,this.zoomHistory=u.zoomHistory,this.transition=u.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new lh,this.transition={})}isSupportedScript(r){return function(u,f){for(const g of u)if(!Xg(g.charCodeAt(0),f))return!1;return!0}(r,Ir.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const r=this.zoom,u=r-Math.floor(r),f=this.crossFadingFactor();return r>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:u+(1-u)*f}:{fromScale:.5,toScale:1,t:1-(1-f)*u}}}class vl{constructor(r,u){this.property=r,this.value=u,this.expression=function(f,g){if(xn(f))return new fc(f,g);if(sl(f)){const v=xf(f,g);if(v.result==="error")throw new Error(v.value.map(b=>`${b.key}: ${b.message}`).join(", "));return v.value}{let v=f;return g.type==="color"&&typeof f=="string"?v=J.parse(f):g.type!=="padding"||typeof f!="number"&&!Array.isArray(f)||(v=ce.parse(f)),{kind:"constant",evaluate:()=>v}}}(u===void 0?r.specification.default:u,r.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(r,u,f){return this.property.possiblyEvaluate(this,r,u,f)}}class vc{constructor(r){this.property=r,this.value=new vl(r,void 0)}transitioned(r,u){return new Nf(this.property,this.value,u,U({},r.transition,this.transition),r.now)}untransitioned(){return new Nf(this.property,this.value,null,{},0)}}class Ff{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitionablePropertyValues)}getValue(r){return W(this._values[r].value.value)}setValue(r,u){Object.prototype.hasOwnProperty.call(this._values,r)||(this._values[r]=new vc(this._values[r].property)),this._values[r].value=new vl(this._values[r].property,u===null?void 0:W(u))}getTransition(r){return W(this._values[r].transition)}setTransition(r,u){Object.prototype.hasOwnProperty.call(this._values,r)||(this._values[r]=new vc(this._values[r].property)),this._values[r].transition=W(u)||void 0}serialize(){const r={};for(const u of Object.keys(this._values)){const f=this.getValue(u);f!==void 0&&(r[u]=f);const g=this.getTransition(u);g!==void 0&&(r[`${u}-transition`]=g)}return r}transitioned(r,u){const f=new Bf(this._properties);for(const g of Object.keys(this._values))f._values[g]=this._values[g].transitioned(r,u._values[g]);return f}untransitioned(){const r=new Bf(this._properties);for(const u of Object.keys(this._values))r._values[u]=this._values[u].untransitioned();return r}}class Nf{constructor(r,u,f,g,v){this.property=r,this.value=u,this.begin=v+g.delay||0,this.end=this.begin+g.duration||0,r.specification.transition&&(g.delay||g.duration)&&(this.prior=f)}possiblyEvaluate(r,u,f){const g=r.now||0,v=this.value.possiblyEvaluate(r,u,f),b=this.prior;if(b){if(g>this.end)return this.prior=null,v;if(this.value.isDataDriven())return this.prior=null,v;if(g<this.begin)return b.possiblyEvaluate(r,u,f);{const T=(g-this.begin)/(this.end-this.begin);return this.property.interpolate(b.possiblyEvaluate(r,u,f),v,function(A){if(A<=0)return 0;if(A>=1)return 1;const L=A*A,z=L*A;return 4*(A<.5?z:3*(A-L)+z-.75)}(T))}}return v}}class Bf{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitioningPropertyValues)}possiblyEvaluate(r,u,f){const g=new xl(this._properties);for(const v of Object.keys(this._values))g._values[v]=this._values[v].possiblyEvaluate(r,u,f);return g}hasTransition(){for(const r of Object.keys(this._values))if(this._values[r].prior)return!0;return!1}}class Yg{constructor(r){this._properties=r,this._values=Object.create(r.defaultPropertyValues)}getValue(r){return W(this._values[r].value)}setValue(r,u){this._values[r]=new vl(this._values[r].property,u===null?void 0:W(u))}serialize(){const r={};for(const u of Object.keys(this._values)){const f=this.getValue(u);f!==void 0&&(r[u]=f)}return r}possiblyEvaluate(r,u,f){const g=new xl(this._properties);for(const v of Object.keys(this._values))g._values[v]=this._values[v].possiblyEvaluate(r,u,f);return g}}class ms{constructor(r,u,f){this.property=r,this.value=u,this.parameters=f}isConstant(){return this.value.kind==="constant"}constantOr(r){return this.value.kind==="constant"?this.value.value:r}evaluate(r,u,f,g){return this.property.evaluate(this.value,this.parameters,r,u,f,g)}}class xl{constructor(r){this._properties=r,this._values=Object.create(r.defaultPossiblyEvaluatedValues)}get(r){return this._values[r]}}class mt{constructor(r){this.specification=r}possiblyEvaluate(r,u){if(r.isDataDriven())throw new Error("Value should not be data driven");return r.expression.evaluate(u)}interpolate(r,u,f){const g=jn[this.specification.type];return g?g(r,u,f):r}}class St{constructor(r,u){this.specification=r,this.overrides=u}possiblyEvaluate(r,u,f,g){return new ms(this,r.expression.kind==="constant"||r.expression.kind==="camera"?{kind:"constant",value:r.expression.evaluate(u,null,{},f,g)}:r.expression,u)}interpolate(r,u,f){if(r.value.kind!=="constant"||u.value.kind!=="constant")return r;if(r.value.value===void 0||u.value.value===void 0)return new ms(this,{kind:"constant",value:void 0},r.parameters);const g=jn[this.specification.type];return g?new ms(this,{kind:"constant",value:g(r.value.value,u.value.value,f)},r.parameters):r}evaluate(r,u,f,g,v,b){return r.kind==="constant"?r.value:r.evaluate(u,f,g,v,b)}}class _a extends St{possiblyEvaluate(r,u,f,g){if(r.value===void 0)return new ms(this,{kind:"constant",value:void 0},u);if(r.expression.kind==="constant"){const v=r.expression.evaluate(u,null,{},f,g),b=r.property.specification.type==="resolvedImage"&&typeof v!="string"?v.name:v,T=this._calculate(b,b,b,u);return new ms(this,{kind:"constant",value:T},u)}if(r.expression.kind==="camera"){const v=this._calculate(r.expression.evaluate({zoom:u.zoom-1}),r.expression.evaluate({zoom:u.zoom}),r.expression.evaluate({zoom:u.zoom+1}),u);return new ms(this,{kind:"constant",value:v},u)}return new ms(this,r.expression,u)}evaluate(r,u,f,g,v,b){if(r.kind==="source"){const T=r.evaluate(u,f,g,v,b);return this._calculate(T,T,T,u)}return r.kind==="composite"?this._calculate(r.evaluate({zoom:Math.floor(u.zoom)-1},f,g),r.evaluate({zoom:Math.floor(u.zoom)},f,g),r.evaluate({zoom:Math.floor(u.zoom)+1},f,g),u):r.value}_calculate(r,u,f,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:r,to:u}:{from:f,to:u}}interpolate(r){return r}}class gh{constructor(r){this.specification=r}possiblyEvaluate(r,u,f,g){if(r.value!==void 0){if(r.expression.kind==="constant"){const v=r.expression.evaluate(u,null,{},f,g);return this._calculate(v,v,v,u)}return this._calculate(r.expression.evaluate(new An(Math.floor(u.zoom-1),u)),r.expression.evaluate(new An(Math.floor(u.zoom),u)),r.expression.evaluate(new An(Math.floor(u.zoom+1),u)),u)}}_calculate(r,u,f,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:r,to:u}:{from:f,to:u}}interpolate(r){return r}}class ro{constructor(r){this.specification=r}possiblyEvaluate(r,u,f,g){return!!r.expression.evaluate(u,null,{},f,g)}interpolate(){return!1}}class xi{constructor(r){this.properties=r,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const u in r){const f=r[u];f.specification.overridable&&this.overridableProperties.push(u);const g=this.defaultPropertyValues[u]=new vl(f,void 0),v=this.defaultTransitionablePropertyValues[u]=new vc(f);this.defaultTransitioningPropertyValues[u]=v.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=g.possiblyEvaluate({})}}}ct("DataDrivenProperty",St),ct("DataConstantProperty",mt),ct("CrossFadedDataDrivenProperty",_a),ct("CrossFadedProperty",gh),ct("ColorRampProperty",ro);const so="-transition";class gs extends Sr{constructor(r,u){if(super(),this.id=r.id,this.type=r.type,this._featureFilter={filter:()=>!0,needGeometry:!1},r.type!=="custom"&&(this.metadata=r.metadata,this.minzoom=r.minzoom,this.maxzoom=r.maxzoom,r.type!=="background"&&(this.source=r.source,this.sourceLayer=r["source-layer"],this.filter=r.filter),u.layout&&(this._unevaluatedLayout=new Yg(u.layout)),u.paint)){this._transitionablePaint=new Ff(u.paint);for(const f in r.paint)this.setPaintProperty(f,r.paint[f],{validate:!1});for(const f in r.layout)this.setLayoutProperty(f,r.layout[f],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new xl(u.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(r){return r==="visibility"?this.visibility:this._unevaluatedLayout.getValue(r)}setLayoutProperty(r,u,f={}){u!=null&&this._validate(qg,`layers.${this.id}.layout.${r}`,r,u,f)||(r!=="visibility"?this._unevaluatedLayout.setValue(r,u):this.visibility=u)}getPaintProperty(r){return r.endsWith(so)?this._transitionablePaint.getTransition(r.slice(0,-so.length)):this._transitionablePaint.getValue(r)}setPaintProperty(r,u,f={}){if(u!=null&&this._validate($g,`layers.${this.id}.paint.${r}`,r,u,f))return!1;if(r.endsWith(so))return this._transitionablePaint.setTransition(r.slice(0,-so.length),u||void 0),!1;{const g=this._transitionablePaint._values[r],v=g.property.specification["property-type"]==="cross-faded-data-driven",b=g.value.isDataDriven(),T=g.value;this._transitionablePaint.setValue(r,u),this._handleSpecialPaintPropertyUpdate(r);const A=this._transitionablePaint._values[r].value;return A.isDataDriven()||b||v||this._handleOverridablePaintPropertyUpdate(r,T,A)}}_handleSpecialPaintPropertyUpdate(r){}_handleOverridablePaintPropertyUpdate(r,u,f){return!1}isHidden(r){return!!(this.minzoom&&r<this.minzoom)||!!(this.maxzoom&&r>=this.maxzoom)||this.visibility==="none"}updateTransitions(r){this._transitioningPaint=this._transitionablePaint.transitioned(r,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(r,u){r.getCrossfadeParameters&&(this._crossfadeParameters=r.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(r,void 0,u)),this.paint=this._transitioningPaint.possiblyEvaluate(r,void 0,u)}serialize(){const r={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(r.layout=r.layout||{},r.layout.visibility=this.visibility),V(r,(u,f)=>!(u===void 0||f==="layout"&&!Object.keys(u).length||f==="paint"&&!Object.keys(u).length))}_validate(r,u,f,g,v={}){return(!v||v.validate!==!1)&&_c(this,r.call(gl,{key:u,layerType:this.type,objectKey:f,value:g,styleSpec:Le,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const r in this.paint._values){const u=this.paint.get(r);if(u instanceof ms&&wn(u.property.specification)&&(u.value.kind==="source"||u.value.kind==="composite")&&u.value.isStateDependent)return!0}return!1}}const Uf={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class oo{constructor(r,u){this._structArray=r,this._pos1=u*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Fn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(r,u){return r._trim(),u&&(r.isTransferred=!0,u.push(r.arrayBuffer)),{length:r.length,arrayBuffer:r.arrayBuffer}}static deserialize(r){const u=Object.create(this.prototype);return u.arrayBuffer=r.arrayBuffer,u.length=r.length,u.capacity=r.arrayBuffer.byteLength/u.bytesPerElement,u._refreshViews(),u}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(r){this.reserve(r),this.length=r}reserve(r){if(r>this.capacity){this.capacity=Math.max(r,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const u=this.uint8;this._refreshViews(),u&&this.uint8.set(u)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Xn(a,r=1){let u=0,f=0;return{members:a.map(g=>{const v=Uf[g.type].BYTES_PER_ELEMENT,b=u=_h(u,Math.max(r,v)),T=g.components||1;return f=Math.max(f,v),u+=v*T,{name:g.name,type:g.type,components:T,offset:b}}),size:_h(u,Math.max(f,r)),alignment:r}}function _h(a,r){return Math.ceil(a/r)*r}class Mo extends Fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,u){const f=this.length;return this.resize(f+1),this.emplace(f,r,u)}emplace(r,u,f){const g=2*r;return this.int16[g+0]=u,this.int16[g+1]=f,r}}Mo.prototype.bytesPerElement=4,ct("StructArrayLayout2i4",Mo);class m extends Fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,u,f,g){const v=this.length;return this.resize(v+1),this.emplace(v,r,u,f,g)}emplace(r,u,f,g,v){const b=4*r;return this.int16[b+0]=u,this.int16[b+1]=f,this.int16[b+2]=g,this.int16[b+3]=v,r}}m.prototype.bytesPerElement=8,ct("StructArrayLayout4i8",m);class o extends Fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,u,f,g,v,b){const T=this.length;return this.resize(T+1),this.emplace(T,r,u,f,g,v,b)}emplace(r,u,f,g,v,b,T){const A=6*r;return this.int16[A+0]=u,this.int16[A+1]=f,this.int16[A+2]=g,this.int16[A+3]=v,this.int16[A+4]=b,this.int16[A+5]=T,r}}o.prototype.bytesPerElement=12,ct("StructArrayLayout2i4i12",o);class h extends Fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,u,f,g,v,b){const T=this.length;return this.resize(T+1),this.emplace(T,r,u,f,g,v,b)}emplace(r,u,f,g,v,b,T){const A=4*r,L=8*r;return this.int16[A+0]=u,this.int16[A+1]=f,this.uint8[L+4]=g,this.uint8[L+5]=v,this.uint8[L+6]=b,this.uint8[L+7]=T,r}}h.prototype.bytesPerElement=8,ct("StructArrayLayout2i4ub8",h);class p extends Fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,u){const f=this.length;return this.resize(f+1),this.emplace(f,r,u)}emplace(r,u,f){const g=2*r;return this.float32[g+0]=u,this.float32[g+1]=f,r}}p.prototype.bytesPerElement=8,ct("StructArrayLayout2f8",p);class _ extends Fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,u,f,g,v,b,T,A,L,z){const F=this.length;return this.resize(F+1),this.emplace(F,r,u,f,g,v,b,T,A,L,z)}emplace(r,u,f,g,v,b,T,A,L,z,F){const j=10*r;return this.uint16[j+0]=u,this.uint16[j+1]=f,this.uint16[j+2]=g,this.uint16[j+3]=v,this.uint16[j+4]=b,this.uint16[j+5]=T,this.uint16[j+6]=A,this.uint16[j+7]=L,this.uint16[j+8]=z,this.uint16[j+9]=F,r}}_.prototype.bytesPerElement=20,ct("StructArrayLayout10ui20",_);class x extends Fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,u,f,g,v,b,T,A,L,z,F,j){const X=this.length;return this.resize(X+1),this.emplace(X,r,u,f,g,v,b,T,A,L,z,F,j)}emplace(r,u,f,g,v,b,T,A,L,z,F,j,X){const Y=12*r;return this.int16[Y+0]=u,this.int16[Y+1]=f,this.int16[Y+2]=g,this.int16[Y+3]=v,this.uint16[Y+4]=b,this.uint16[Y+5]=T,this.uint16[Y+6]=A,this.uint16[Y+7]=L,this.int16[Y+8]=z,this.int16[Y+9]=F,this.int16[Y+10]=j,this.int16[Y+11]=X,r}}x.prototype.bytesPerElement=24,ct("StructArrayLayout4i4ui4i24",x);class E extends Fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,u,f){const g=this.length;return this.resize(g+1),this.emplace(g,r,u,f)}emplace(r,u,f,g){const v=3*r;return this.float32[v+0]=u,this.float32[v+1]=f,this.float32[v+2]=g,r}}E.prototype.bytesPerElement=12,ct("StructArrayLayout3f12",E);class I extends Fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r){const u=this.length;return this.resize(u+1),this.emplace(u,r)}emplace(r,u){return this.uint32[1*r+0]=u,r}}I.prototype.bytesPerElement=4,ct("StructArrayLayout1ul4",I);class M extends Fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,u,f,g,v,b,T,A,L){const z=this.length;return this.resize(z+1),this.emplace(z,r,u,f,g,v,b,T,A,L)}emplace(r,u,f,g,v,b,T,A,L,z){const F=10*r,j=5*r;return this.int16[F+0]=u,this.int16[F+1]=f,this.int16[F+2]=g,this.int16[F+3]=v,this.int16[F+4]=b,this.int16[F+5]=T,this.uint32[j+3]=A,this.uint16[F+8]=L,this.uint16[F+9]=z,r}}M.prototype.bytesPerElement=20,ct("StructArrayLayout6i1ul2ui20",M);class k extends Fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,u,f,g,v,b){const T=this.length;return this.resize(T+1),this.emplace(T,r,u,f,g,v,b)}emplace(r,u,f,g,v,b,T){const A=6*r;return this.int16[A+0]=u,this.int16[A+1]=f,this.int16[A+2]=g,this.int16[A+3]=v,this.int16[A+4]=b,this.int16[A+5]=T,r}}k.prototype.bytesPerElement=12,ct("StructArrayLayout2i2i2i12",k);class O extends Fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,u,f,g,v){const b=this.length;return this.resize(b+1),this.emplace(b,r,u,f,g,v)}emplace(r,u,f,g,v,b){const T=4*r,A=8*r;return this.float32[T+0]=u,this.float32[T+1]=f,this.float32[T+2]=g,this.int16[A+6]=v,this.int16[A+7]=b,r}}O.prototype.bytesPerElement=16,ct("StructArrayLayout2f1f2i16",O);class B extends Fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,u,f,g){const v=this.length;return this.resize(v+1),this.emplace(v,r,u,f,g)}emplace(r,u,f,g,v){const b=12*r,T=3*r;return this.uint8[b+0]=u,this.uint8[b+1]=f,this.float32[T+1]=g,this.float32[T+2]=v,r}}B.prototype.bytesPerElement=12,ct("StructArrayLayout2ub2f12",B);class q extends Fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,u,f){const g=this.length;return this.resize(g+1),this.emplace(g,r,u,f)}emplace(r,u,f,g){const v=3*r;return this.uint16[v+0]=u,this.uint16[v+1]=f,this.uint16[v+2]=g,r}}q.prototype.bytesPerElement=6,ct("StructArrayLayout3ui6",q);class re extends Fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,u,f,g,v,b,T,A,L,z,F,j,X,Y,le,oe,ve){const Se=this.length;return this.resize(Se+1),this.emplace(Se,r,u,f,g,v,b,T,A,L,z,F,j,X,Y,le,oe,ve)}emplace(r,u,f,g,v,b,T,A,L,z,F,j,X,Y,le,oe,ve,Se){const ye=24*r,Ee=12*r,Oe=48*r;return this.int16[ye+0]=u,this.int16[ye+1]=f,this.uint16[ye+2]=g,this.uint16[ye+3]=v,this.uint32[Ee+2]=b,this.uint32[Ee+3]=T,this.uint32[Ee+4]=A,this.uint16[ye+10]=L,this.uint16[ye+11]=z,this.uint16[ye+12]=F,this.float32[Ee+7]=j,this.float32[Ee+8]=X,this.uint8[Oe+36]=Y,this.uint8[Oe+37]=le,this.uint8[Oe+38]=oe,this.uint32[Ee+10]=ve,this.int16[ye+22]=Se,r}}re.prototype.bytesPerElement=48,ct("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",re);class te extends Fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,u,f,g,v,b,T,A,L,z,F,j,X,Y,le,oe,ve,Se,ye,Ee,Oe,ze,ot,dt,et,Xe,We,tt){const Ye=this.length;return this.resize(Ye+1),this.emplace(Ye,r,u,f,g,v,b,T,A,L,z,F,j,X,Y,le,oe,ve,Se,ye,Ee,Oe,ze,ot,dt,et,Xe,We,tt)}emplace(r,u,f,g,v,b,T,A,L,z,F,j,X,Y,le,oe,ve,Se,ye,Ee,Oe,ze,ot,dt,et,Xe,We,tt,Ye){const Ve=34*r,wt=17*r;return this.int16[Ve+0]=u,this.int16[Ve+1]=f,this.int16[Ve+2]=g,this.int16[Ve+3]=v,this.int16[Ve+4]=b,this.int16[Ve+5]=T,this.int16[Ve+6]=A,this.int16[Ve+7]=L,this.uint16[Ve+8]=z,this.uint16[Ve+9]=F,this.uint16[Ve+10]=j,this.uint16[Ve+11]=X,this.uint16[Ve+12]=Y,this.uint16[Ve+13]=le,this.uint16[Ve+14]=oe,this.uint16[Ve+15]=ve,this.uint16[Ve+16]=Se,this.uint16[Ve+17]=ye,this.uint16[Ve+18]=Ee,this.uint16[Ve+19]=Oe,this.uint16[Ve+20]=ze,this.uint16[Ve+21]=ot,this.uint16[Ve+22]=dt,this.uint32[wt+12]=et,this.float32[wt+13]=Xe,this.float32[wt+14]=We,this.float32[wt+15]=tt,this.float32[wt+16]=Ye,r}}te.prototype.bytesPerElement=68,ct("StructArrayLayout8i15ui1ul4f68",te);class ne extends Fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r){const u=this.length;return this.resize(u+1),this.emplace(u,r)}emplace(r,u){return this.float32[1*r+0]=u,r}}ne.prototype.bytesPerElement=4,ct("StructArrayLayout1f4",ne);class fe extends Fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,u,f){const g=this.length;return this.resize(g+1),this.emplace(g,r,u,f)}emplace(r,u,f,g){const v=3*r;return this.int16[v+0]=u,this.int16[v+1]=f,this.int16[v+2]=g,r}}fe.prototype.bytesPerElement=6,ct("StructArrayLayout3i6",fe);class _e extends Fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,u,f){const g=this.length;return this.resize(g+1),this.emplace(g,r,u,f)}emplace(r,u,f,g){const v=4*r;return this.uint32[2*r+0]=u,this.uint16[v+2]=f,this.uint16[v+3]=g,r}}_e.prototype.bytesPerElement=8,ct("StructArrayLayout1ul2ui8",_e);class xe extends Fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,u){const f=this.length;return this.resize(f+1),this.emplace(f,r,u)}emplace(r,u,f){const g=2*r;return this.uint16[g+0]=u,this.uint16[g+1]=f,r}}xe.prototype.bytesPerElement=4,ct("StructArrayLayout2ui4",xe);class se extends Fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r){const u=this.length;return this.resize(u+1),this.emplace(u,r)}emplace(r,u){return this.uint16[1*r+0]=u,r}}se.prototype.bytesPerElement=2,ct("StructArrayLayout1ui2",se);class Te extends Fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,u,f,g){const v=this.length;return this.resize(v+1),this.emplace(v,r,u,f,g)}emplace(r,u,f,g,v){const b=4*r;return this.float32[b+0]=u,this.float32[b+1]=f,this.float32[b+2]=g,this.float32[b+3]=v,r}}Te.prototype.bytesPerElement=16,ct("StructArrayLayout4f16",Te);class we extends oo{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new Tt(this.anchorPointX,this.anchorPointY)}}we.prototype.size=20;class ke extends M{get(r){return new we(this,r)}}ct("CollisionBoxArray",ke);class Re extends oo{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(r){this._structArray.uint8[this._pos1+37]=r}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(r){this._structArray.uint8[this._pos1+38]=r}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(r){this._structArray.uint32[this._pos4+10]=r}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}Re.prototype.size=48;class Be extends re{get(r){return new Re(this,r)}}ct("PlacedSymbolArray",Be);class Me extends oo{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(r){this._structArray.uint32[this._pos4+12]=r}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get textOffset0(){return this._structArray.float32[this._pos4+14]}get textOffset1(){return this._structArray.float32[this._pos4+15]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+16]}}Me.prototype.size=68;class nt extends te{get(r){return new Me(this,r)}}ct("SymbolInstanceArray",nt);class Ze extends ne{getoffsetX(r){return this.float32[1*r+0]}}ct("GlyphOffsetArray",Ze);class st extends fe{getx(r){return this.int16[3*r+0]}gety(r){return this.int16[3*r+1]}gettileUnitDistanceFromAnchor(r){return this.int16[3*r+2]}}ct("SymbolLineVertexArray",st);class Rt extends oo{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Rt.prototype.size=8;class Ot extends _e{get(r){return new Rt(this,r)}}ct("FeatureIndexArray",Ot);class bt extends Mo{}class cn extends Mo{}class un extends Mo{}class Zt extends o{}class Xt extends h{}class dn extends p{}class hi extends _{}class _s extends x{}class $r extends E{}class ys extends I{}class ao extends k{}class Cr extends B{}class Ki extends q{}class Os extends xe{}const xc=Xn([{name:"a_pos",components:2,type:"Int16"}],4),{members:ii}=xc;class jt{constructor(r=[]){this.segments=r}prepareSegment(r,u,f,g){let v=this.segments[this.segments.length-1];return r>jt.MAX_VERTEX_ARRAY_LENGTH&&ge(`Max vertices per segment is ${jt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${r}`),(!v||v.vertexLength+r>jt.MAX_VERTEX_ARRAY_LENGTH||v.sortKey!==g)&&(v={vertexOffset:u.length,primitiveOffset:f.length,vertexLength:0,primitiveLength:0},g!==void 0&&(v.sortKey=g),this.segments.push(v)),v}get(){return this.segments}destroy(){for(const r of this.segments)for(const u in r.vaos)r.vaos[u].destroy()}static simpleSegment(r,u,f,g){return new jt([{vertexOffset:r,primitiveOffset:u,vertexLength:f,primitiveLength:g,vaos:{},sortKey:0}])}}function on(a,r){return 256*(a=P(Math.floor(a),0,255))+P(Math.floor(r),0,255)}jt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,ct("SegmentVector",jt);const di=Xn([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var fi={exports:{}},Pn={exports:{}};Pn.exports=function(a,r){var u,f,g,v,b,T,A,L;for(f=a.length-(u=3&a.length),g=r,b=3432918353,T=461845907,L=0;L<f;)A=255&a.charCodeAt(L)|(255&a.charCodeAt(++L))<<8|(255&a.charCodeAt(++L))<<16|(255&a.charCodeAt(++L))<<24,++L,g=27492+(65535&(v=5*(65535&(g=(g^=A=(65535&(A=(A=(65535&A)*b+(((A>>>16)*b&65535)<<16)&4294967295)<<15|A>>>17))*T+(((A>>>16)*T&65535)<<16)&4294967295)<<13|g>>>19))+((5*(g>>>16)&65535)<<16)&4294967295))+((58964+(v>>>16)&65535)<<16);switch(A=0,u){case 3:A^=(255&a.charCodeAt(L+2))<<16;case 2:A^=(255&a.charCodeAt(L+1))<<8;case 1:g^=A=(65535&(A=(A=(65535&(A^=255&a.charCodeAt(L)))*b+(((A>>>16)*b&65535)<<16)&4294967295)<<15|A>>>17))*T+(((A>>>16)*T&65535)<<16)&4294967295}return g^=a.length,g=2246822507*(65535&(g^=g>>>16))+((2246822507*(g>>>16)&65535)<<16)&4294967295,g=3266489909*(65535&(g^=g>>>13))+((3266489909*(g>>>16)&65535)<<16)&4294967295,(g^=g>>>16)>>>0};var Mr={exports:{}};Mr.exports=function(a,r){for(var u,f=a.length,g=r^f,v=0;f>=4;)u=1540483477*(65535&(u=255&a.charCodeAt(v)|(255&a.charCodeAt(++v))<<8|(255&a.charCodeAt(++v))<<16|(255&a.charCodeAt(++v))<<24))+((1540483477*(u>>>16)&65535)<<16),g=1540483477*(65535&g)+((1540483477*(g>>>16)&65535)<<16)^(u=1540483477*(65535&(u^=u>>>24))+((1540483477*(u>>>16)&65535)<<16)),f-=4,++v;switch(f){case 3:g^=(255&a.charCodeAt(v+2))<<16;case 2:g^=(255&a.charCodeAt(v+1))<<8;case 1:g=1540483477*(65535&(g^=255&a.charCodeAt(v)))+((1540483477*(g>>>16)&65535)<<16)}return g=1540483477*(65535&(g^=g>>>13))+((1540483477*(g>>>16)&65535)<<16),(g^=g>>>15)>>>0};var Lo=Pn.exports,yh=Mr.exports;fi.exports=Lo,fi.exports.murmur3=Lo,fi.exports.murmur2=yh;class ya{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(r,u,f,g){this.ids.push(Vf(r)),this.positions.push(u,f,g)}getPositions(r){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const u=Vf(r);let f=0,g=this.ids.length-1;for(;f<g;){const b=f+g>>1;this.ids[b]>=u?g=b:f=b+1}const v=[];for(;this.ids[f]===u;)v.push({index:this.positions[3*f],start:this.positions[3*f+1],end:this.positions[3*f+2]}),f++;return v}static serialize(r,u){const f=new Float64Array(r.ids),g=new Uint32Array(r.positions);return vh(f,g,0,f.length-1),u&&u.push(f.buffer,g.buffer),{ids:f,positions:g}}static deserialize(r){const u=new ya;return u.ids=r.ids,u.positions=r.positions,u.indexed=!0,u}}function Vf(a){const r=+a;return!isNaN(r)&&r<=Number.MAX_SAFE_INTEGER?r:fi.exports(String(a))}function vh(a,r,u,f){for(;u<f;){const g=a[u+f>>1];let v=u-1,b=f+1;for(;;){do v++;while(a[v]<g);do b--;while(a[b]>g);if(v>=b)break;lo(a,v,b),lo(r,3*v,3*b),lo(r,3*v+1,3*b+1),lo(r,3*v+2,3*b+2)}b-u<f-b?(vh(a,r,u,b),u=b+1):(vh(a,r,b+1,f),f=b)}}function lo(a,r,u){const f=a[r];a[r]=a[u],a[u]=f}ct("FeaturePositionMap",ya);class ko{constructor(r,u){this.gl=r.gl,this.location=u}}class Ro extends ko{constructor(r,u){super(r,u),this.current=0}set(r){this.current!==r&&(this.current=r,this.gl.uniform1f(this.location,r))}}class bc extends ko{constructor(r,u){super(r,u),this.current=[0,0,0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]&&r[3]===this.current[3]||(this.current=r,this.gl.uniform4f(this.location,r[0],r[1],r[2],r[3]))}}class Kx extends ko{constructor(r,u){super(r,u),this.current=J.transparent}set(r){r.r===this.current.r&&r.g===this.current.g&&r.b===this.current.b&&r.a===this.current.a||(this.current=r,this.gl.uniform4f(this.location,r.r,r.g,r.b,r.a))}}const eC=new Float32Array(16);function Kg(a){return[on(255*a.r,255*a.g),on(255*a.b,255*a.a)]}class xh{constructor(r,u,f){this.value=r,this.uniformNames=u.map(g=>`u_${g}`),this.type=f}setUniform(r,u,f){r.set(f.constantOr(this.value))}getBinding(r,u,f){return this.type==="color"?new Kx(r,u):new Ro(r,u)}}class wc{constructor(r,u){this.uniformNames=u.map(f=>`u_${f}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(r,u){this.pixelRatioFrom=u.pixelRatio,this.pixelRatioTo=r.pixelRatio,this.patternFrom=u.tlbr,this.patternTo=r.tlbr}setUniform(r,u,f,g){const v=g==="u_pattern_to"?this.patternTo:g==="u_pattern_from"?this.patternFrom:g==="u_pixel_ratio_to"?this.pixelRatioTo:g==="u_pixel_ratio_from"?this.pixelRatioFrom:null;v&&r.set(v)}getBinding(r,u,f){return f.substr(0,9)==="u_pattern"?new bc(r,u):new Ro(r,u)}}class Do{constructor(r,u,f,g){this.expression=r,this.type=f,this.maxValue=0,this.paintVertexAttributes=u.map(v=>({name:`a_${v}`,type:"Float32",components:f==="color"?2:1,offset:0})),this.paintVertexArray=new g}populatePaintArray(r,u,f,g,v){const b=this.paintVertexArray.length,T=this.expression.evaluate(new An(0),u,{},g,[],v);this.paintVertexArray.resize(r),this._setPaintValue(b,r,T)}updatePaintArray(r,u,f,g){const v=this.expression.evaluate({zoom:0},f,g);this._setPaintValue(r,u,v)}_setPaintValue(r,u,f){if(this.type==="color"){const g=Kg(f);for(let v=r;v<u;v++)this.paintVertexArray.emplace(v,g[0],g[1])}else{for(let g=r;g<u;g++)this.paintVertexArray.emplace(g,f);this.maxValue=Math.max(this.maxValue,Math.abs(f))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Fs{constructor(r,u,f,g,v,b){this.expression=r,this.uniformNames=u.map(T=>`u_${T}_t`),this.type=f,this.useIntegerZoom=g,this.zoom=v,this.maxValue=0,this.paintVertexAttributes=u.map(T=>({name:`a_${T}`,type:"Float32",components:f==="color"?4:2,offset:0})),this.paintVertexArray=new b}populatePaintArray(r,u,f,g,v){const b=this.expression.evaluate(new An(this.zoom),u,{},g,[],v),T=this.expression.evaluate(new An(this.zoom+1),u,{},g,[],v),A=this.paintVertexArray.length;this.paintVertexArray.resize(r),this._setPaintValue(A,r,b,T)}updatePaintArray(r,u,f,g){const v=this.expression.evaluate({zoom:this.zoom},f,g),b=this.expression.evaluate({zoom:this.zoom+1},f,g);this._setPaintValue(r,u,v,b)}_setPaintValue(r,u,f,g){if(this.type==="color"){const v=Kg(f),b=Kg(g);for(let T=r;T<u;T++)this.paintVertexArray.emplace(T,v[0],v[1],b[0],b[1])}else{for(let v=r;v<u;v++)this.paintVertexArray.emplace(v,f,g);this.maxValue=Math.max(this.maxValue,Math.abs(f),Math.abs(g))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(r,u){const f=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,g=P(this.expression.interpolationFactor(f,this.zoom,this.zoom+1),0,1);r.set(g)}getBinding(r,u,f){return new Ro(r,u)}}class va{constructor(r,u,f,g,v,b){this.expression=r,this.type=u,this.useIntegerZoom=f,this.zoom=g,this.layerId=b,this.zoomInPaintVertexArray=new v,this.zoomOutPaintVertexArray=new v}populatePaintArray(r,u,f){const g=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(r),this.zoomOutPaintVertexArray.resize(r),this._setPaintValues(g,r,u.patterns&&u.patterns[this.layerId],f)}updatePaintArray(r,u,f,g,v){this._setPaintValues(r,u,f.patterns&&f.patterns[this.layerId],v)}_setPaintValues(r,u,f,g){if(!g||!f)return;const{min:v,mid:b,max:T}=f,A=g[v],L=g[b],z=g[T];if(A&&L&&z)for(let F=r;F<u;F++)this.zoomInPaintVertexArray.emplace(F,L.tl[0],L.tl[1],L.br[0],L.br[1],A.tl[0],A.tl[1],A.br[0],A.br[1],L.pixelRatio,A.pixelRatio),this.zoomOutPaintVertexArray.emplace(F,L.tl[0],L.tl[1],L.br[0],L.br[1],z.tl[0],z.tl[1],z.br[0],z.br[1],L.pixelRatio,z.pixelRatio)}upload(r){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=r.createVertexBuffer(this.zoomInPaintVertexArray,di.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=r.createVertexBuffer(this.zoomOutPaintVertexArray,di.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Jx{constructor(r,u,f){this.binders={},this._buffers=[];const g=[];for(const v in r.paint._values){if(!f(v))continue;const b=r.paint.get(v);if(!(b instanceof ms&&wn(b.property.specification)))continue;const T=tC(v,r.type),A=b.value,L=b.property.specification.type,z=b.property.useIntegerZoom,F=b.property.specification["property-type"],j=F==="cross-faded"||F==="cross-faded-data-driven";if(A.kind==="constant")this.binders[v]=j?new wc(A.value,T):new xh(A.value,T,L),g.push(`/u_${v}`);else if(A.kind==="source"||j){const X=Qx(v,L,"source");this.binders[v]=j?new va(A,L,z,u,X,r.id):new Do(A,T,L,X),g.push(`/a_${v}`)}else{const X=Qx(v,L,"composite");this.binders[v]=new Fs(A,T,L,z,u,X),g.push(`/z_${v}`)}}this.cacheKey=g.sort().join("")}getMaxValue(r){const u=this.binders[r];return u instanceof Do||u instanceof Fs?u.maxValue:0}populatePaintArrays(r,u,f,g,v){for(const b in this.binders){const T=this.binders[b];(T instanceof Do||T instanceof Fs||T instanceof va)&&T.populatePaintArray(r,u,f,g,v)}}setConstantPatternPositions(r,u){for(const f in this.binders){const g=this.binders[f];g instanceof wc&&g.setConstantPatternPositions(r,u)}}updatePaintArrays(r,u,f,g,v){let b=!1;for(const T in r){const A=u.getPositions(T);for(const L of A){const z=f.feature(L.index);for(const F in this.binders){const j=this.binders[F];if((j instanceof Do||j instanceof Fs||j instanceof va)&&j.expression.isStateDependent===!0){const X=g.paint.get(F);j.expression=X.value,j.updatePaintArray(L.start,L.end,z,r[T],v),b=!0}}}}return b}defines(){const r=[];for(const u in this.binders){const f=this.binders[u];(f instanceof xh||f instanceof wc)&&r.push(...f.uniformNames.map(g=>`#define HAS_UNIFORM_${g}`))}return r}getBinderAttributes(){const r=[];for(const u in this.binders){const f=this.binders[u];if(f instanceof Do||f instanceof Fs)for(let g=0;g<f.paintVertexAttributes.length;g++)r.push(f.paintVertexAttributes[g].name);else if(f instanceof va)for(let g=0;g<di.members.length;g++)r.push(di.members[g].name)}return r}getBinderUniforms(){const r=[];for(const u in this.binders){const f=this.binders[u];if(f instanceof xh||f instanceof wc||f instanceof Fs)for(const g of f.uniformNames)r.push(g)}return r}getPaintVertexBuffers(){return this._buffers}getUniforms(r,u){const f=[];for(const g in this.binders){const v=this.binders[g];if(v instanceof xh||v instanceof wc||v instanceof Fs){for(const b of v.uniformNames)if(u[b]){const T=v.getBinding(r,u[b],b);f.push({name:b,property:g,binding:T})}}}return f}setUniforms(r,u,f,g){for(const{name:v,property:b,binding:T}of u)this.binders[b].setUniform(T,g,f.get(b),v)}updatePaintBuffers(r){this._buffers=[];for(const u in this.binders){const f=this.binders[u];if(r&&f instanceof va){const g=r.fromScale===2?f.zoomInPaintVertexBuffer:f.zoomOutPaintVertexBuffer;g&&this._buffers.push(g)}else(f instanceof Do||f instanceof Fs)&&f.paintVertexBuffer&&this._buffers.push(f.paintVertexBuffer)}}upload(r){for(const u in this.binders){const f=this.binders[u];(f instanceof Do||f instanceof Fs||f instanceof va)&&f.upload(r)}this.updatePaintBuffers()}destroy(){for(const r in this.binders){const u=this.binders[r];(u instanceof Do||u instanceof Fs||u instanceof va)&&u.destroy()}}}class bl{constructor(r,u,f=()=>!0){this.programConfigurations={};for(const g of r)this.programConfigurations[g.id]=new Jx(g,u,f);this.needsUpload=!1,this._featureMap=new ya,this._bufferOffset=0}populatePaintArrays(r,u,f,g,v,b){for(const T in this.programConfigurations)this.programConfigurations[T].populatePaintArrays(r,u,g,v,b);u.id!==void 0&&this._featureMap.add(u.id,f,this._bufferOffset,r),this._bufferOffset=r,this.needsUpload=!0}updatePaintArrays(r,u,f,g){for(const v of f)this.needsUpload=this.programConfigurations[v.id].updatePaintArrays(r,this._featureMap,u,v,g)||this.needsUpload}get(r){return this.programConfigurations[r]}upload(r){if(this.needsUpload){for(const u in this.programConfigurations)this.programConfigurations[u].upload(r);this.needsUpload=!1}}destroy(){for(const r in this.programConfigurations)this.programConfigurations[r].destroy()}}function tC(a,r){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[a]||[a.replace(`${r}-`,"").replace(/-/g,"_")]}function Qx(a,r,u){const f={color:{source:p,composite:Te},number:{source:ne,composite:p}},g=function(v){return{"line-pattern":{source:hi,composite:hi},"fill-pattern":{source:hi,composite:hi},"fill-extrusion-pattern":{source:hi,composite:hi}}[v]}(a);return g&&g[u]||f[r][u]}ct("ConstantBinder",xh),ct("CrossFadedConstantBinder",wc),ct("SourceExpressionBinder",Do),ct("CrossFadedCompositeBinder",va),ct("CompositeExpressionBinder",Fs),ct("ProgramConfiguration",Jx,{omit:["_buffers"]}),ct("ProgramConfigurationSet",bl);var ri=8192;const Jg=Math.pow(2,14)-1,e1=-Jg-1;function wl(a){const r=ri/a.extent,u=a.loadGeometry();for(let f=0;f<u.length;f++){const g=u[f];for(let v=0;v<g.length;v++){const b=g[v],T=Math.round(b.x*r),A=Math.round(b.y*r);b.x=P(T,e1,Jg),b.y=P(A,e1,Jg),(T<b.x||T>b.x+1||A<b.y||A>b.y+1)&&ge("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return u}function El(a,r){return{type:a.type,id:a.id,properties:a.properties,geometry:r?wl(a):[]}}function jf(a,r,u,f,g){a.emplaceBack(2*r+(f+1)/2,2*u+(g+1)/2)}class Qg{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(u=>u.id),this.index=r.index,this.hasPattern=!1,this.layoutVertexArray=new cn,this.indexArray=new Ki,this.segments=new jt,this.programConfigurations=new bl(r.layers,r.zoom),this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(r,u,f){const g=this.layers[0],v=[];let b=null,T=!1;g.type==="circle"&&(b=g.layout.get("circle-sort-key"),T=!b.isConstant());for(const{feature:A,id:L,index:z,sourceLayerIndex:F}of r){const j=this.layers[0]._featureFilter.needGeometry,X=El(A,j);if(!this.layers[0]._featureFilter.filter(new An(this.zoom),X,f))continue;const Y=T?b.evaluate(X,{},f):void 0,le={id:L,properties:A.properties,type:A.type,sourceLayerIndex:F,index:z,geometry:j?X.geometry:wl(A),patterns:{},sortKey:Y};v.push(le)}T&&v.sort((A,L)=>A.sortKey-L.sortKey);for(const A of v){const{geometry:L,index:z,sourceLayerIndex:F}=A,j=r[z].feature;this.addFeature(A,L,z,f),u.featureIndex.insert(j,L,z,F,this.index)}}update(r,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,u,this.stateDependentLayers,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,ii),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(r,u,f,g){for(const v of u)for(const b of v){const T=b.x,A=b.y;if(T<0||T>=ri||A<0||A>=ri)continue;const L=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,r.sortKey),z=L.vertexLength;jf(this.layoutVertexArray,T,A,-1,-1),jf(this.layoutVertexArray,T,A,1,-1),jf(this.layoutVertexArray,T,A,1,1),jf(this.layoutVertexArray,T,A,-1,1),this.indexArray.emplaceBack(z,z+1,z+2),this.indexArray.emplaceBack(z,z+3,z+2),L.vertexLength+=4,L.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,f,{},g)}}function t1(a,r){for(let u=0;u<a.length;u++)if(Ec(r,a[u]))return!0;for(let u=0;u<r.length;u++)if(Ec(a,r[u]))return!0;return!!e_(a,r)}function nC(a,r,u){return!!Ec(a,r)||!!t_(r,a,u)}function n1(a,r){if(a.length===1)return r1(r,a[0]);for(let u=0;u<r.length;u++){const f=r[u];for(let g=0;g<f.length;g++)if(Ec(a,f[g]))return!0}for(let u=0;u<a.length;u++)if(r1(r,a[u]))return!0;for(let u=0;u<r.length;u++)if(e_(a,r[u]))return!0;return!1}function iC(a,r,u){if(a.length>1){if(e_(a,r))return!0;for(let f=0;f<r.length;f++)if(t_(r[f],a,u))return!0}for(let f=0;f<a.length;f++)if(t_(a[f],r,u))return!0;return!1}function e_(a,r){if(a.length===0||r.length===0)return!1;for(let u=0;u<a.length-1;u++){const f=a[u],g=a[u+1];for(let v=0;v<r.length-1;v++)if(rC(f,g,r[v],r[v+1]))return!0}return!1}function rC(a,r,u,f){return be(a,u,f)!==be(r,u,f)&&be(a,r,u)!==be(a,r,f)}function t_(a,r,u){const f=u*u;if(r.length===1)return a.distSqr(r[0])<f;for(let g=1;g<r.length;g++)if(i1(a,r[g-1],r[g])<f)return!0;return!1}function i1(a,r,u){const f=r.distSqr(u);if(f===0)return a.distSqr(r);const g=((a.x-r.x)*(u.x-r.x)+(a.y-r.y)*(u.y-r.y))/f;return a.distSqr(g<0?r:g>1?u:u.sub(r)._mult(g)._add(r))}function r1(a,r){let u,f,g,v=!1;for(let b=0;b<a.length;b++){u=a[b];for(let T=0,A=u.length-1;T<u.length;A=T++)f=u[T],g=u[A],f.y>r.y!=g.y>r.y&&r.x<(g.x-f.x)*(r.y-f.y)/(g.y-f.y)+f.x&&(v=!v)}return v}function Ec(a,r){let u=!1;for(let f=0,g=a.length-1;f<a.length;g=f++){const v=a[f],b=a[g];v.y>r.y!=b.y>r.y&&r.x<(b.x-v.x)*(r.y-v.y)/(b.y-v.y)+v.x&&(u=!u)}return u}function sC(a,r,u){const f=u[0],g=u[2];if(a.x<f.x&&r.x<f.x||a.x>g.x&&r.x>g.x||a.y<f.y&&r.y<f.y||a.y>g.y&&r.y>g.y)return!1;const v=be(a,r,u[0]);return v!==be(a,r,u[1])||v!==be(a,r,u[2])||v!==be(a,r,u[3])}function bh(a,r,u){const f=r.paint.get(a).value;return f.kind==="constant"?f.value:u.programConfigurations.get(r.id).getMaxValue(a)}function Gf(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function Wf(a,r,u,f,g){if(!r[0]&&!r[1])return a;const v=Tt.convert(r)._mult(g);u==="viewport"&&v._rotate(-f);const b=[];for(let T=0;T<a.length;T++)b.push(a[T].sub(v));return b}ct("CircleBucket",Qg,{omit:["layers"]});const oC=new xi({"circle-sort-key":new St(Le.layout_circle["circle-sort-key"])});var aC={paint:new xi({"circle-radius":new St(Le.paint_circle["circle-radius"]),"circle-color":new St(Le.paint_circle["circle-color"]),"circle-blur":new St(Le.paint_circle["circle-blur"]),"circle-opacity":new St(Le.paint_circle["circle-opacity"]),"circle-translate":new mt(Le.paint_circle["circle-translate"]),"circle-translate-anchor":new mt(Le.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new mt(Le.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new mt(Le.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new St(Le.paint_circle["circle-stroke-width"]),"circle-stroke-color":new St(Le.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new St(Le.paint_circle["circle-stroke-opacity"])}),layout:oC},Ji=1e-6,Qi=typeof Float32Array<"u"?Float32Array:Array;function s1(){var a=new Qi(9);return Qi!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0),a[0]=1,a[4]=1,a[8]=1,a}function n_(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function o1(a,r,u){var f=r[0],g=r[1],v=r[2],b=r[3],T=r[4],A=r[5],L=r[6],z=r[7],F=r[8],j=r[9],X=r[10],Y=r[11],le=r[12],oe=r[13],ve=r[14],Se=r[15],ye=u[0],Ee=u[1],Oe=u[2],ze=u[3];return a[0]=ye*f+Ee*T+Oe*F+ze*le,a[1]=ye*g+Ee*A+Oe*j+ze*oe,a[2]=ye*v+Ee*L+Oe*X+ze*ve,a[3]=ye*b+Ee*z+Oe*Y+ze*Se,a[4]=(ye=u[4])*f+(Ee=u[5])*T+(Oe=u[6])*F+(ze=u[7])*le,a[5]=ye*g+Ee*A+Oe*j+ze*oe,a[6]=ye*v+Ee*L+Oe*X+ze*ve,a[7]=ye*b+Ee*z+Oe*Y+ze*Se,a[8]=(ye=u[8])*f+(Ee=u[9])*T+(Oe=u[10])*F+(ze=u[11])*le,a[9]=ye*g+Ee*A+Oe*j+ze*oe,a[10]=ye*v+Ee*L+Oe*X+ze*ve,a[11]=ye*b+Ee*z+Oe*Y+ze*Se,a[12]=(ye=u[12])*f+(Ee=u[13])*T+(Oe=u[14])*F+(ze=u[15])*le,a[13]=ye*g+Ee*A+Oe*j+ze*oe,a[14]=ye*v+Ee*L+Oe*X+ze*ve,a[15]=ye*b+Ee*z+Oe*Y+ze*Se,a}Math.hypot||(Math.hypot=function(){for(var a=0,r=arguments.length;r--;)a+=arguments[r]*arguments[r];return Math.sqrt(a)});var wh,lC=o1;function a1(){var a=new Qi(3);return Qi!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a}function l1(a,r,u){var f=new Qi(3);return f[0]=a,f[1]=r,f[2]=u,f}function Hf(a,r,u){var f=r[0],g=r[1],v=r[2],b=r[3];return a[0]=u[0]*f+u[4]*g+u[8]*v+u[12]*b,a[1]=u[1]*f+u[5]*g+u[9]*v+u[13]*b,a[2]=u[2]*f+u[6]*g+u[10]*v+u[14]*b,a[3]=u[3]*f+u[7]*g+u[11]*v+u[15]*b,a}function c1(){var a=new Qi(4);return Qi!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a[3]=1,a}function u1(a,r){const u=Hf([],[a.x,a.y,0,1],r);return new Tt(u[0]/u[3],u[1]/u[3])}a1(),wh=new Qi(4),Qi!=Float32Array&&(wh[0]=0,wh[1]=0,wh[2]=0,wh[3]=0),a1(),l1(1,0,0),l1(0,1,0),c1(),c1(),s1(),function(){var a;a=new Qi(2),Qi!=Float32Array&&(a[0]=0,a[1]=0)}();class h1 extends Qg{}ct("HeatmapBucket",h1,{omit:["layers"]});var cC={paint:new xi({"heatmap-radius":new St(Le.paint_heatmap["heatmap-radius"]),"heatmap-weight":new St(Le.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new mt(Le.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ro(Le.paint_heatmap["heatmap-color"]),"heatmap-opacity":new mt(Le.paint_heatmap["heatmap-opacity"])})};function i_(a,{width:r,height:u},f,g){if(g){if(g instanceof Uint8ClampedArray)g=new Uint8Array(g.buffer);else if(g.length!==r*u*f)throw new RangeError(`mismatched image size. expected: ${g.length} but got: ${r*u*f}`)}else g=new Uint8Array(r*u*f);return a.width=r,a.height=u,a.data=g,a}function d1(a,{width:r,height:u},f){if(r===a.width&&u===a.height)return;const g=i_({},{width:r,height:u},f);r_(a,g,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,r),height:Math.min(a.height,u)},f),a.width=r,a.height=u,a.data=g.data}function r_(a,r,u,f,g,v){if(g.width===0||g.height===0)return r;if(g.width>a.width||g.height>a.height||u.x>a.width-g.width||u.y>a.height-g.height)throw new RangeError("out of range source coordinates for image copy");if(g.width>r.width||g.height>r.height||f.x>r.width-g.width||f.y>r.height-g.height)throw new RangeError("out of range destination coordinates for image copy");const b=a.data,T=r.data;if(b===T)throw new Error("srcData equals dstData, so image is already copied");for(let A=0;A<g.height;A++){const L=((u.y+A)*a.width+u.x)*v,z=((f.y+A)*r.width+f.x)*v;for(let F=0;F<g.width*v;F++)T[z+F]=b[L+F]}return r}class Eh{constructor(r,u){i_(this,r,1,u)}resize(r){d1(this,r,1)}clone(){return new Eh({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,u,f,g,v){r_(r,u,f,g,v,1)}}class qr{constructor(r,u){i_(this,r,4,u)}resize(r){d1(this,r,4)}replace(r,u){u?this.data.set(r):this.data=r instanceof Uint8ClampedArray?new Uint8Array(r.buffer):r}clone(){return new qr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,u,f,g,v){r_(r,u,f,g,v,4)}}function f1(a){const r={},u=a.resolution||256,f=a.clips?a.clips.length:1,g=a.image||new qr({width:u,height:f});if(Math.log(u)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${u}`);const v=(b,T,A)=>{r[a.evaluationKey]=A;const L=a.expression.evaluate(r);g.data[b+T+0]=Math.floor(255*L.r/L.a),g.data[b+T+1]=Math.floor(255*L.g/L.a),g.data[b+T+2]=Math.floor(255*L.b/L.a),g.data[b+T+3]=Math.floor(255*L.a)};if(a.clips)for(let b=0,T=0;b<f;++b,T+=4*u)for(let A=0,L=0;A<u;A++,L+=4){const z=A/(u-1),{start:F,end:j}=a.clips[b];v(T,L,F*(1-z)+j*z)}else for(let b=0,T=0;b<u;b++,T+=4)v(0,T,b/(u-1));return g}ct("AlphaImage",Eh),ct("RGBAImage",qr);var uC={paint:new xi({"hillshade-illumination-direction":new mt(Le.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new mt(Le.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new mt(Le.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new mt(Le.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new mt(Le.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new mt(Le.paint_hillshade["hillshade-accent-color"])})};const hC=Xn([{name:"a_pos",components:2,type:"Int16"}],4),{members:dC}=hC;var $f={exports:{}};function qf(a,r,u){u=u||2;var f,g,v,b,T,A,L,z=r&&r.length,F=z?r[0]*u:a.length,j=p1(a,0,F,u,!0),X=[];if(!j||j.next===j.prev)return X;if(z&&(j=function(le,oe,ve,Se){var ye,Ee,Oe,ze=[];for(ye=0,Ee=oe.length;ye<Ee;ye++)(Oe=p1(le,oe[ye]*Se,ye<Ee-1?oe[ye+1]*Se:le.length,Se,!1))===Oe.next&&(Oe.steiner=!0),ze.push(xC(Oe));for(ze.sort(_C),ye=0;ye<ze.length;ye++)ve=yC(ze[ye],ve);return ve}(a,r,j,u)),a.length>80*u){f=v=a[0],g=b=a[1];for(var Y=u;Y<F;Y+=u)(T=a[Y])<f&&(f=T),(A=a[Y+1])<g&&(g=A),T>v&&(v=T),A>b&&(b=A);L=(L=Math.max(v-f,b-g))!==0?32767/L:0}return Th(j,X,u,f,g,L,0),X}function p1(a,r,u,f,g){var v,b;if(g===a_(a,r,u,f)>0)for(v=r;v<u;v+=f)b=_1(v,a[v],a[v+1],b);else for(v=u-f;v>=r;v-=f)b=_1(v,a[v],a[v+1],b);return b&&Zf(b,b.next)&&(Ah(b),b=b.next),b}function Tl(a,r){if(!a)return a;r||(r=a);var u,f=a;do if(u=!1,f.steiner||!Zf(f,f.next)&&Gn(f.prev,f,f.next)!==0)f=f.next;else{if(Ah(f),(f=r=f.prev)===f.next)break;u=!0}while(u||f!==r);return r}function Th(a,r,u,f,g,v,b){if(a){!b&&v&&function(z,F,j,X){var Y=z;do Y.z===0&&(Y.z=s_(Y.x,Y.y,F,j,X)),Y.prevZ=Y.prev,Y.nextZ=Y.next,Y=Y.next;while(Y!==z);Y.prevZ.nextZ=null,Y.prevZ=null,function(le){var oe,ve,Se,ye,Ee,Oe,ze,ot,dt=1;do{for(ve=le,le=null,Ee=null,Oe=0;ve;){for(Oe++,Se=ve,ze=0,oe=0;oe<dt&&(ze++,Se=Se.nextZ);oe++);for(ot=dt;ze>0||ot>0&&Se;)ze!==0&&(ot===0||!Se||ve.z<=Se.z)?(ye=ve,ve=ve.nextZ,ze--):(ye=Se,Se=Se.nextZ,ot--),Ee?Ee.nextZ=ye:le=ye,ye.prevZ=Ee,Ee=ye;ve=Se}Ee.nextZ=null,dt*=2}while(Oe>1)}(Y)}(a,f,g,v);for(var T,A,L=a;a.prev!==a.next;)if(T=a.prev,A=a.next,v?pC(a,f,g,v):fC(a))r.push(T.i/u|0),r.push(a.i/u|0),r.push(A.i/u|0),Ah(a),a=A.next,L=A.next;else if((a=A)===L){b?b===1?Th(a=mC(Tl(a),r,u),r,u,f,g,v,2):b===2&&gC(a,r,u,f,g,v):Th(Tl(a),r,u,f,g,v,1);break}}}function fC(a){var r=a.prev,u=a,f=a.next;if(Gn(r,u,f)>=0)return!1;for(var g=r.x,v=u.x,b=f.x,T=r.y,A=u.y,L=f.y,z=g<v?g<b?g:b:v<b?v:b,F=T<A?T<L?T:L:A<L?A:L,j=g>v?g>b?g:b:v>b?v:b,X=T>A?T>L?T:L:A>L?A:L,Y=f.next;Y!==r;){if(Y.x>=z&&Y.x<=j&&Y.y>=F&&Y.y<=X&&Tc(g,T,v,A,b,L,Y.x,Y.y)&&Gn(Y.prev,Y,Y.next)>=0)return!1;Y=Y.next}return!0}function pC(a,r,u,f){var g=a.prev,v=a,b=a.next;if(Gn(g,v,b)>=0)return!1;for(var T=g.x,A=v.x,L=b.x,z=g.y,F=v.y,j=b.y,X=T<A?T<L?T:L:A<L?A:L,Y=z<F?z<j?z:j:F<j?F:j,le=T>A?T>L?T:L:A>L?A:L,oe=z>F?z>j?z:j:F>j?F:j,ve=s_(X,Y,r,u,f),Se=s_(le,oe,r,u,f),ye=a.prevZ,Ee=a.nextZ;ye&&ye.z>=ve&&Ee&&Ee.z<=Se;){if(ye.x>=X&&ye.x<=le&&ye.y>=Y&&ye.y<=oe&&ye!==g&&ye!==b&&Tc(T,z,A,F,L,j,ye.x,ye.y)&&Gn(ye.prev,ye,ye.next)>=0||(ye=ye.prevZ,Ee.x>=X&&Ee.x<=le&&Ee.y>=Y&&Ee.y<=oe&&Ee!==g&&Ee!==b&&Tc(T,z,A,F,L,j,Ee.x,Ee.y)&&Gn(Ee.prev,Ee,Ee.next)>=0))return!1;Ee=Ee.nextZ}for(;ye&&ye.z>=ve;){if(ye.x>=X&&ye.x<=le&&ye.y>=Y&&ye.y<=oe&&ye!==g&&ye!==b&&Tc(T,z,A,F,L,j,ye.x,ye.y)&&Gn(ye.prev,ye,ye.next)>=0)return!1;ye=ye.prevZ}for(;Ee&&Ee.z<=Se;){if(Ee.x>=X&&Ee.x<=le&&Ee.y>=Y&&Ee.y<=oe&&Ee!==g&&Ee!==b&&Tc(T,z,A,F,L,j,Ee.x,Ee.y)&&Gn(Ee.prev,Ee,Ee.next)>=0)return!1;Ee=Ee.nextZ}return!0}function mC(a,r,u){var f=a;do{var g=f.prev,v=f.next.next;!Zf(g,v)&&m1(g,f,f.next,v)&&Sh(g,v)&&Sh(v,g)&&(r.push(g.i/u|0),r.push(f.i/u|0),r.push(v.i/u|0),Ah(f),Ah(f.next),f=a=v),f=f.next}while(f!==a);return Tl(f)}function gC(a,r,u,f,g,v){var b=a;do{for(var T=b.next.next;T!==b.prev;){if(b.i!==T.i&&bC(b,T)){var A=g1(b,T);return b=Tl(b,b.next),A=Tl(A,A.next),Th(b,r,u,f,g,v,0),void Th(A,r,u,f,g,v,0)}T=T.next}b=b.next}while(b!==a)}function _C(a,r){return a.x-r.x}function yC(a,r){var u=function(g,v){var b,T=v,A=g.x,L=g.y,z=-1/0;do{if(L<=T.y&&L>=T.next.y&&T.next.y!==T.y){var F=T.x+(L-T.y)*(T.next.x-T.x)/(T.next.y-T.y);if(F<=A&&F>z&&(z=F,b=T.x<T.next.x?T:T.next,F===A))return b}T=T.next}while(T!==v);if(!b)return null;var j,X=b,Y=b.x,le=b.y,oe=1/0;T=b;do A>=T.x&&T.x>=Y&&A!==T.x&&Tc(L<le?A:z,L,Y,le,L<le?z:A,L,T.x,T.y)&&(j=Math.abs(L-T.y)/(A-T.x),Sh(T,g)&&(j<oe||j===oe&&(T.x>b.x||T.x===b.x&&vC(b,T)))&&(b=T,oe=j)),T=T.next;while(T!==X);return b}(a,r);if(!u)return r;var f=g1(u,a);return Tl(f,f.next),Tl(u,u.next)}function vC(a,r){return Gn(a.prev,a,r.prev)<0&&Gn(r.next,a,a.next)<0}function s_(a,r,u,f,g){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=(a-u)*g|0)|a<<8))|a<<4))|a<<2))|a<<1))|(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-f)*g|0)|r<<8))|r<<4))|r<<2))|r<<1))<<1}function xC(a){var r=a,u=a;do(r.x<u.x||r.x===u.x&&r.y<u.y)&&(u=r),r=r.next;while(r!==a);return u}function Tc(a,r,u,f,g,v,b,T){return(g-b)*(r-T)>=(a-b)*(v-T)&&(a-b)*(f-T)>=(u-b)*(r-T)&&(u-b)*(v-T)>=(g-b)*(f-T)}function bC(a,r){return a.next.i!==r.i&&a.prev.i!==r.i&&!function(u,f){var g=u;do{if(g.i!==u.i&&g.next.i!==u.i&&g.i!==f.i&&g.next.i!==f.i&&m1(g,g.next,u,f))return!0;g=g.next}while(g!==u);return!1}(a,r)&&(Sh(a,r)&&Sh(r,a)&&function(u,f){var g=u,v=!1,b=(u.x+f.x)/2,T=(u.y+f.y)/2;do g.y>T!=g.next.y>T&&g.next.y!==g.y&&b<(g.next.x-g.x)*(T-g.y)/(g.next.y-g.y)+g.x&&(v=!v),g=g.next;while(g!==u);return v}(a,r)&&(Gn(a.prev,a,r.prev)||Gn(a,r.prev,r))||Zf(a,r)&&Gn(a.prev,a,a.next)>0&&Gn(r.prev,r,r.next)>0)}function Gn(a,r,u){return(r.y-a.y)*(u.x-r.x)-(r.x-a.x)*(u.y-r.y)}function Zf(a,r){return a.x===r.x&&a.y===r.y}function m1(a,r,u,f){var g=Yf(Gn(a,r,u)),v=Yf(Gn(a,r,f)),b=Yf(Gn(u,f,a)),T=Yf(Gn(u,f,r));return g!==v&&b!==T||!(g!==0||!Xf(a,u,r))||!(v!==0||!Xf(a,f,r))||!(b!==0||!Xf(u,a,f))||!(T!==0||!Xf(u,r,f))}function Xf(a,r,u){return r.x<=Math.max(a.x,u.x)&&r.x>=Math.min(a.x,u.x)&&r.y<=Math.max(a.y,u.y)&&r.y>=Math.min(a.y,u.y)}function Yf(a){return a>0?1:a<0?-1:0}function Sh(a,r){return Gn(a.prev,a,a.next)<0?Gn(a,r,a.next)>=0&&Gn(a,a.prev,r)>=0:Gn(a,r,a.prev)<0||Gn(a,a.next,r)<0}function g1(a,r){var u=new o_(a.i,a.x,a.y),f=new o_(r.i,r.x,r.y),g=a.next,v=r.prev;return a.next=r,r.prev=a,u.next=g,g.prev=u,f.next=u,u.prev=f,v.next=f,f.prev=v,f}function _1(a,r,u,f){var g=new o_(a,r,u);return f?(g.next=f.next,g.prev=f,f.next.prev=g,f.next=g):(g.prev=g,g.next=g),g}function Ah(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function o_(a,r,u){this.i=a,this.x=r,this.y=u,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function a_(a,r,u,f){for(var g=0,v=r,b=u-f;v<u;v+=f)g+=(a[b]-a[v])*(a[v+1]+a[b+1]),b=v;return g}function wC(a,r,u,f,g){y1(a,r,u||0,f||a.length-1,g||EC)}function y1(a,r,u,f,g){for(;f>u;){if(f-u>600){var v=f-u+1,b=r-u+1,T=Math.log(v),A=.5*Math.exp(2*T/3),L=.5*Math.sqrt(T*A*(v-A)/v)*(b-v/2<0?-1:1);y1(a,r,Math.max(u,Math.floor(r-b*A/v+L)),Math.min(f,Math.floor(r+(v-b)*A/v+L)),g)}var z=a[r],F=u,j=f;for(Ph(a,u,r),g(a[f],z)>0&&Ph(a,u,f);F<j;){for(Ph(a,F,j),F++,j--;g(a[F],z)<0;)F++;for(;g(a[j],z)>0;)j--}g(a[u],z)===0?Ph(a,u,j):Ph(a,++j,f),j<=r&&(u=j+1),r<=j&&(f=j-1)}}function Ph(a,r,u){var f=a[r];a[r]=a[u],a[u]=f}function EC(a,r){return a<r?-1:a>r?1:0}function l_(a,r){const u=a.length;if(u<=1)return[a];const f=[];let g,v;for(let b=0;b<u;b++){const T=De(a[b]);T!==0&&(a[b].area=Math.abs(T),v===void 0&&(v=T<0),v===T<0?(g&&f.push(g),g=[a[b]]):g.push(a[b]))}if(g&&f.push(g),r>1)for(let b=0;b<f.length;b++)f[b].length<=r||(wC(f[b],r,1,f[b].length-1,TC),f[b]=f[b].slice(0,r));return f}function TC(a,r){return r.area-a.area}function c_(a,r,u){const f=u.patternDependencies;let g=!1;for(const v of r){const b=v.paint.get(`${a}-pattern`);b.isConstant()||(g=!0);const T=b.constantOr(null);T&&(g=!0,f[T.to]=!0,f[T.from]=!0)}return g}function u_(a,r,u,f,g){const v=g.patternDependencies;for(const b of r){const T=b.paint.get(`${a}-pattern`).value;if(T.kind!=="constant"){let A=T.evaluate({zoom:f-1},u,{},g.availableImages),L=T.evaluate({zoom:f},u,{},g.availableImages),z=T.evaluate({zoom:f+1},u,{},g.availableImages);A=A&&A.name?A.name:A,L=L&&L.name?L.name:L,z=z&&z.name?z.name:z,v[A]=!0,v[L]=!0,v[z]=!0,u.patterns[b.id]={min:A,mid:L,max:z}}}return u}$f.exports=qf,$f.exports.default=qf,qf.deviation=function(a,r,u,f){var g=r&&r.length,v=Math.abs(a_(a,0,g?r[0]*u:a.length,u));if(g)for(var b=0,T=r.length;b<T;b++)v-=Math.abs(a_(a,r[b]*u,b<T-1?r[b+1]*u:a.length,u));var A=0;for(b=0;b<f.length;b+=3){var L=f[b]*u,z=f[b+1]*u,F=f[b+2]*u;A+=Math.abs((a[L]-a[F])*(a[z+1]-a[L+1])-(a[L]-a[z])*(a[F+1]-a[L+1]))}return v===0&&A===0?0:Math.abs((A-v)/v)},qf.flatten=function(a){for(var r=a[0][0].length,u={vertices:[],holes:[],dimensions:r},f=0,g=0;g<a.length;g++){for(var v=0;v<a[g].length;v++)for(var b=0;b<r;b++)u.vertices.push(a[g][v][b]);g>0&&u.holes.push(f+=a[g-1].length)}return u};class h_{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(u=>u.id),this.index=r.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new un,this.indexArray=new Ki,this.indexArray2=new Os,this.programConfigurations=new bl(r.layers,r.zoom),this.segments=new jt,this.segments2=new jt,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(r,u,f){this.hasPattern=c_("fill",this.layers,u);const g=this.layers[0].layout.get("fill-sort-key"),v=!g.isConstant(),b=[];for(const{feature:T,id:A,index:L,sourceLayerIndex:z}of r){const F=this.layers[0]._featureFilter.needGeometry,j=El(T,F);if(!this.layers[0]._featureFilter.filter(new An(this.zoom),j,f))continue;const X=v?g.evaluate(j,{},f,u.availableImages):void 0,Y={id:A,properties:T.properties,type:T.type,sourceLayerIndex:z,index:L,geometry:F?j.geometry:wl(T),patterns:{},sortKey:X};b.push(Y)}v&&b.sort((T,A)=>T.sortKey-A.sortKey);for(const T of b){const{geometry:A,index:L,sourceLayerIndex:z}=T;if(this.hasPattern){const F=u_("fill",this.layers,T,this.zoom,u);this.patternFeatures.push(F)}else this.addFeature(T,A,L,f,{});u.featureIndex.insert(r[L].feature,A,L,z,this.index)}}update(r,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,u,this.stateDependentLayers,f)}addFeatures(r,u,f){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,u,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,dC),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.indexBuffer2=r.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(r,u,f,g,v){for(const b of l_(u,500)){let T=0;for(const X of b)T+=X.length;const A=this.segments.prepareSegment(T,this.layoutVertexArray,this.indexArray),L=A.vertexLength,z=[],F=[];for(const X of b){if(X.length===0)continue;X!==b[0]&&F.push(z.length/2);const Y=this.segments2.prepareSegment(X.length,this.layoutVertexArray,this.indexArray2),le=Y.vertexLength;this.layoutVertexArray.emplaceBack(X[0].x,X[0].y),this.indexArray2.emplaceBack(le+X.length-1,le),z.push(X[0].x),z.push(X[0].y);for(let oe=1;oe<X.length;oe++)this.layoutVertexArray.emplaceBack(X[oe].x,X[oe].y),this.indexArray2.emplaceBack(le+oe-1,le+oe),z.push(X[oe].x),z.push(X[oe].y);Y.vertexLength+=X.length,Y.primitiveLength+=X.length}const j=$f.exports(z,F);for(let X=0;X<j.length;X+=3)this.indexArray.emplaceBack(L+j[X],L+j[X+1],L+j[X+2]);A.vertexLength+=T,A.primitiveLength+=j.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,f,v,g)}}ct("FillBucket",h_,{omit:["layers","patternFeatures"]});const SC=new xi({"fill-sort-key":new St(Le.layout_fill["fill-sort-key"])});var AC={paint:new xi({"fill-antialias":new mt(Le.paint_fill["fill-antialias"]),"fill-opacity":new St(Le.paint_fill["fill-opacity"]),"fill-color":new St(Le.paint_fill["fill-color"]),"fill-outline-color":new St(Le.paint_fill["fill-outline-color"]),"fill-translate":new mt(Le.paint_fill["fill-translate"]),"fill-translate-anchor":new mt(Le.paint_fill["fill-translate-anchor"]),"fill-pattern":new _a(Le.paint_fill["fill-pattern"])}),layout:SC};const PC=Xn([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),IC=Xn([{name:"a_centroid",components:2,type:"Int16"}],4),{members:CC}=PC;var xa={},MC=Tt,v1=Sc;function Sc(a,r,u,f,g){this.properties={},this.extent=u,this.type=0,this._pbf=a,this._geometry=-1,this._keys=f,this._values=g,a.readFields(LC,this,r)}function LC(a,r,u){a==1?r.id=u.readVarint():a==2?function(f,g){for(var v=f.readVarint()+f.pos;f.pos<v;){var b=g._keys[f.readVarint()],T=g._values[f.readVarint()];g.properties[b]=T}}(u,r):a==3?r.type=u.readVarint():a==4&&(r._geometry=u.pos)}function kC(a){for(var r,u,f=0,g=0,v=a.length,b=v-1;g<v;b=g++)f+=((u=a[b]).x-(r=a[g]).x)*(r.y+u.y);return f}Sc.types=["Unknown","Point","LineString","Polygon"],Sc.prototype.loadGeometry=function(){var a=this._pbf;a.pos=this._geometry;for(var r,u=a.readVarint()+a.pos,f=1,g=0,v=0,b=0,T=[];a.pos<u;){if(g<=0){var A=a.readVarint();f=7&A,g=A>>3}if(g--,f===1||f===2)v+=a.readSVarint(),b+=a.readSVarint(),f===1&&(r&&T.push(r),r=[]),r.push(new MC(v,b));else{if(f!==7)throw new Error("unknown command "+f);r&&r.push(r[0].clone())}}return r&&T.push(r),T},Sc.prototype.bbox=function(){var a=this._pbf;a.pos=this._geometry;for(var r=a.readVarint()+a.pos,u=1,f=0,g=0,v=0,b=1/0,T=-1/0,A=1/0,L=-1/0;a.pos<r;){if(f<=0){var z=a.readVarint();u=7&z,f=z>>3}if(f--,u===1||u===2)(g+=a.readSVarint())<b&&(b=g),g>T&&(T=g),(v+=a.readSVarint())<A&&(A=v),v>L&&(L=v);else if(u!==7)throw new Error("unknown command "+u)}return[b,A,T,L]},Sc.prototype.toGeoJSON=function(a,r,u){var f,g,v=this.extent*Math.pow(2,u),b=this.extent*a,T=this.extent*r,A=this.loadGeometry(),L=Sc.types[this.type];function z(X){for(var Y=0;Y<X.length;Y++){var le=X[Y];X[Y]=[360*(le.x+b)/v-180,360/Math.PI*Math.atan(Math.exp((180-360*(le.y+T)/v)*Math.PI/180))-90]}}switch(this.type){case 1:var F=[];for(f=0;f<A.length;f++)F[f]=A[f][0];z(A=F);break;case 2:for(f=0;f<A.length;f++)z(A[f]);break;case 3:for(A=function(X){var Y=X.length;if(Y<=1)return[X];for(var le,oe,ve=[],Se=0;Se<Y;Se++){var ye=kC(X[Se]);ye!==0&&(oe===void 0&&(oe=ye<0),oe===ye<0?(le&&ve.push(le),le=[X[Se]]):le.push(X[Se]))}return le&&ve.push(le),ve}(A),f=0;f<A.length;f++)for(g=0;g<A[f].length;g++)z(A[f][g])}A.length===1?A=A[0]:L="Multi"+L;var j={type:"Feature",geometry:{type:L,coordinates:A},properties:this.properties};return"id"in this&&(j.id=this.id),j};var RC=v1,x1=b1;function b1(a,r){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=a,this._keys=[],this._values=[],this._features=[],a.readFields(DC,this,r),this.length=this._features.length}function DC(a,r,u){a===15?r.version=u.readVarint():a===1?r.name=u.readString():a===5?r.extent=u.readVarint():a===2?r._features.push(u.pos):a===3?r._keys.push(u.readString()):a===4&&r._values.push(function(f){for(var g=null,v=f.readVarint()+f.pos;f.pos<v;){var b=f.readVarint()>>3;g=b===1?f.readString():b===2?f.readFloat():b===3?f.readDouble():b===4?f.readVarint64():b===5?f.readVarint():b===6?f.readSVarint():b===7?f.readBoolean():null}return g}(u))}b1.prototype.feature=function(a){if(a<0||a>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[a];var r=this._pbf.readVarint()+this._pbf.pos;return new RC(this._pbf,r,this.extent,this._keys,this._values)};var zC=x1;function OC(a,r,u){if(a===3){var f=new zC(u,u.readVarint()+u.pos);f.length&&(r[f.name]=f)}}xa.VectorTile=function(a,r){this.layers=a.readFields(OC,{},r)},xa.VectorTileFeature=v1,xa.VectorTileLayer=x1;const FC=xa.VectorTileFeature.types,d_=Math.pow(2,13);function Ih(a,r,u,f,g,v,b,T){a.emplaceBack(r,u,2*Math.floor(f*d_)+b,g*d_*2,v*d_*2,Math.round(T))}class f_{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(u=>u.id),this.index=r.index,this.hasPattern=!1,this.layoutVertexArray=new Zt,this.centroidVertexArray=new bt,this.indexArray=new Ki,this.programConfigurations=new bl(r.layers,r.zoom),this.segments=new jt,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(r,u,f){this.features=[],this.hasPattern=c_("fill-extrusion",this.layers,u);for(const{feature:g,id:v,index:b,sourceLayerIndex:T}of r){const A=this.layers[0]._featureFilter.needGeometry,L=El(g,A);if(!this.layers[0]._featureFilter.filter(new An(this.zoom),L,f))continue;const z={id:v,sourceLayerIndex:T,index:b,geometry:A?L.geometry:wl(g),properties:g.properties,type:g.type,patterns:{}};this.hasPattern?this.features.push(u_("fill-extrusion",this.layers,z,this.zoom,u)):this.addFeature(z,z.geometry,b,f,{}),u.featureIndex.insert(g,z.geometry,b,T,this.index,!0)}}addFeatures(r,u,f){for(const g of this.features){const{geometry:v}=g;this.addFeature(g,v,g.index,u,f)}}update(r,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,u,this.stateDependentLayers,f)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,CC),this.centroidVertexBuffer=r.createVertexBuffer(this.centroidVertexArray,IC.members,!0),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(r,u,f,g,v){const b={x:0,y:0,vertexCount:0};for(const T of l_(u,500)){let A=0;for(const Y of T)A+=Y.length;let L=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const Y of T){if(Y.length===0||BC(Y))continue;let le=0;for(let oe=0;oe<Y.length;oe++){const ve=Y[oe];if(oe>=1){const Se=Y[oe-1];if(!NC(ve,Se)){L.vertexLength+4>jt.MAX_VERTEX_ARRAY_LENGTH&&(L=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const ye=ve.sub(Se)._perp()._unit(),Ee=Se.dist(ve);le+Ee>32768&&(le=0),Ih(this.layoutVertexArray,ve.x,ve.y,ye.x,ye.y,0,0,le),Ih(this.layoutVertexArray,ve.x,ve.y,ye.x,ye.y,0,1,le),b.x+=2*ve.x,b.y+=2*ve.y,b.vertexCount+=2,le+=Ee,Ih(this.layoutVertexArray,Se.x,Se.y,ye.x,ye.y,0,0,le),Ih(this.layoutVertexArray,Se.x,Se.y,ye.x,ye.y,0,1,le),b.x+=2*Se.x,b.y+=2*Se.y,b.vertexCount+=2;const Oe=L.vertexLength;this.indexArray.emplaceBack(Oe,Oe+2,Oe+1),this.indexArray.emplaceBack(Oe+1,Oe+2,Oe+3),L.vertexLength+=4,L.primitiveLength+=2}}}}if(L.vertexLength+A>jt.MAX_VERTEX_ARRAY_LENGTH&&(L=this.segments.prepareSegment(A,this.layoutVertexArray,this.indexArray)),FC[r.type]!=="Polygon")continue;const z=[],F=[],j=L.vertexLength;for(const Y of T)if(Y.length!==0){Y!==T[0]&&F.push(z.length/2);for(let le=0;le<Y.length;le++){const oe=Y[le];Ih(this.layoutVertexArray,oe.x,oe.y,0,0,1,1,0),b.x+=oe.x,b.y+=oe.y,b.vertexCount+=1,z.push(oe.x),z.push(oe.y)}}const X=$f.exports(z,F);for(let Y=0;Y<X.length;Y+=3)this.indexArray.emplaceBack(j+X[Y],j+X[Y+2],j+X[Y+1]);L.primitiveLength+=X.length/3,L.vertexLength+=A}for(let T=0;T<b.vertexCount;T++)this.centroidVertexArray.emplaceBack(Math.floor(b.x/b.vertexCount),Math.floor(b.y/b.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,f,v,g)}}function NC(a,r){return a.x===r.x&&(a.x<0||a.x>ri)||a.y===r.y&&(a.y<0||a.y>ri)}function BC(a){return a.every(r=>r.x<0)||a.every(r=>r.x>ri)||a.every(r=>r.y<0)||a.every(r=>r.y>ri)}ct("FillExtrusionBucket",f_,{omit:["layers","features"]});var UC={paint:new xi({"fill-extrusion-opacity":new mt(Le["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new St(Le["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new mt(Le["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new mt(Le["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new _a(Le["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new St(Le["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new St(Le["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new mt(Le["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function Ch(a,r){return a.x*r.x+a.y*r.y}function w1(a,r){if(a.length===1){let u=0;const f=r[u++];let g;for(;!g||f.equals(g);)if(g=r[u++],!g)return 1/0;for(;u<r.length;u++){const v=r[u],b=a[0],T=g.sub(f),A=v.sub(f),L=b.sub(f),z=Ch(T,T),F=Ch(T,A),j=Ch(A,A),X=Ch(L,T),Y=Ch(L,A),le=z*j-F*F,oe=(j*X-F*Y)/le,ve=(z*Y-F*X)/le,Se=f.z*(1-oe-ve)+g.z*oe+v.z*ve;if(isFinite(Se))return Se}return 1/0}{let u=1/0;for(const f of r)u=Math.min(u,f.z);return u}}const VC=Xn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:jC}=VC,GC=Xn([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:WC}=GC,HC=xa.VectorTileFeature.types,$C=Math.cos(Math.PI/180*37.5),E1=Math.pow(2,14)/.5;class p_{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(u=>u.id),this.index=r.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(u=>{this.gradients[u.id]={}}),this.layoutVertexArray=new Xt,this.layoutVertexArray2=new dn,this.indexArray=new Ki,this.programConfigurations=new bl(r.layers,r.zoom),this.segments=new jt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(r,u,f){this.hasPattern=c_("line",this.layers,u);const g=this.layers[0].layout.get("line-sort-key"),v=!g.isConstant(),b=[];for(const{feature:T,id:A,index:L,sourceLayerIndex:z}of r){const F=this.layers[0]._featureFilter.needGeometry,j=El(T,F);if(!this.layers[0]._featureFilter.filter(new An(this.zoom),j,f))continue;const X=v?g.evaluate(j,{},f):void 0,Y={id:A,properties:T.properties,type:T.type,sourceLayerIndex:z,index:L,geometry:F?j.geometry:wl(T),patterns:{},sortKey:X};b.push(Y)}v&&b.sort((T,A)=>T.sortKey-A.sortKey);for(const T of b){const{geometry:A,index:L,sourceLayerIndex:z}=T;if(this.hasPattern){const F=u_("line",this.layers,T,this.zoom,u);this.patternFeatures.push(F)}else this.addFeature(T,A,L,f,{});u.featureIndex.insert(r[L].feature,A,L,z,this.index)}}update(r,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,u,this.stateDependentLayers,f)}addFeatures(r,u,f){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,u,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=r.createVertexBuffer(this.layoutVertexArray2,WC)),this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,jC),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(r){if(r.properties&&Object.prototype.hasOwnProperty.call(r.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(r.properties,"mapbox_clip_end"))return{start:+r.properties.mapbox_clip_start,end:+r.properties.mapbox_clip_end}}addFeature(r,u,f,g,v){const b=this.layers[0].layout,T=b.get("line-join").evaluate(r,{}),A=b.get("line-cap"),L=b.get("line-miter-limit"),z=b.get("line-round-limit");this.lineClips=this.lineFeatureClips(r);for(const F of u)this.addLine(F,r,T,A,L,z);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,f,v,g)}addLine(r,u,f,g,v,b){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ve=0;ve<r.length-1;ve++)this.totalDistance+=r[ve].dist(r[ve+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const T=HC[u.type]==="Polygon";let A=r.length;for(;A>=2&&r[A-1].equals(r[A-2]);)A--;let L=0;for(;L<A-1&&r[L].equals(r[L+1]);)L++;if(A<(T?3:2))return;f==="bevel"&&(v=1.05);const z=this.overscaling<=16?122880/(512*this.overscaling):0,F=this.segments.prepareSegment(10*A,this.layoutVertexArray,this.indexArray);let j,X,Y,le,oe;this.e1=this.e2=-1,T&&(j=r[A-2],oe=r[L].sub(j)._unit()._perp());for(let ve=L;ve<A;ve++){if(Y=ve===A-1?T?r[L+1]:void 0:r[ve+1],Y&&r[ve].equals(Y))continue;oe&&(le=oe),j&&(X=j),j=r[ve],oe=Y?Y.sub(j)._unit()._perp():le,le=le||oe;let Se=le.add(oe);Se.x===0&&Se.y===0||Se._unit();const ye=le.x*oe.x+le.y*oe.y,Ee=Se.x*oe.x+Se.y*oe.y,Oe=Ee!==0?1/Ee:1/0,ze=2*Math.sqrt(2-2*Ee),ot=Ee<$C&&X&&Y,dt=le.x*oe.y-le.y*oe.x>0;if(ot&&ve>L){const We=j.dist(X);if(We>2*z){const tt=j.sub(j.sub(X)._mult(z/We)._round());this.updateDistance(X,tt),this.addCurrentVertex(tt,le,0,0,F),X=tt}}const et=X&&Y;let Xe=et?f:T?"butt":g;if(et&&Xe==="round"&&(Oe<b?Xe="miter":Oe<=2&&(Xe="fakeround")),Xe==="miter"&&Oe>v&&(Xe="bevel"),Xe==="bevel"&&(Oe>2&&(Xe="flipbevel"),Oe<v&&(Xe="miter")),X&&this.updateDistance(X,j),Xe==="miter")Se._mult(Oe),this.addCurrentVertex(j,Se,0,0,F);else if(Xe==="flipbevel"){if(Oe>100)Se=oe.mult(-1);else{const We=Oe*le.add(oe).mag()/le.sub(oe).mag();Se._perp()._mult(We*(dt?-1:1))}this.addCurrentVertex(j,Se,0,0,F),this.addCurrentVertex(j,Se.mult(-1),0,0,F)}else if(Xe==="bevel"||Xe==="fakeround"){const We=-Math.sqrt(Oe*Oe-1),tt=dt?We:0,Ye=dt?0:We;if(X&&this.addCurrentVertex(j,le,tt,Ye,F),Xe==="fakeround"){const Ve=Math.round(180*ze/Math.PI/20);for(let wt=1;wt<Ve;wt++){let _t=wt/Ve;if(_t!==.5){const En=_t-.5;_t+=_t*En*(_t-1)*((1.0904+ye*(ye*(3.55645-1.43519*ye)-3.2452))*En*En+(.848013+ye*(.215638*ye-1.06021)))}const Ft=oe.sub(le)._mult(_t)._add(le)._unit()._mult(dt?-1:1);this.addHalfVertex(j,Ft.x,Ft.y,!1,dt,0,F)}}Y&&this.addCurrentVertex(j,oe,-tt,-Ye,F)}else if(Xe==="butt")this.addCurrentVertex(j,Se,0,0,F);else if(Xe==="square"){const We=X?1:-1;this.addCurrentVertex(j,Se,We,We,F)}else Xe==="round"&&(X&&(this.addCurrentVertex(j,le,0,0,F),this.addCurrentVertex(j,le,1,1,F,!0)),Y&&(this.addCurrentVertex(j,oe,-1,-1,F,!0),this.addCurrentVertex(j,oe,0,0,F)));if(ot&&ve<A-1){const We=j.dist(Y);if(We>2*z){const tt=j.add(Y.sub(j)._mult(z/We)._round());this.updateDistance(j,tt),this.addCurrentVertex(tt,oe,0,0,F),j=tt}}}}addCurrentVertex(r,u,f,g,v,b=!1){const T=u.y*g-u.x,A=-u.y-u.x*g;this.addHalfVertex(r,u.x+u.y*f,u.y-u.x*f,b,!1,f,v),this.addHalfVertex(r,T,A,b,!0,-g,v),this.distance>E1/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(r,u,f,g,v,b))}addHalfVertex({x:r,y:u},f,g,v,b,T,A){const L=.5*(this.lineClips?this.scaledDistance*(E1-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((r<<1)+(v?1:0),(u<<1)+(b?1:0),Math.round(63*f)+128,Math.round(63*g)+128,1+(T===0?0:T<0?-1:1)|(63&L)<<2,L>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const z=A.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,z),A.primitiveLength++),b?this.e2=z:this.e1=z}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(r,u){this.distance+=r.dist(u),this.updateScaledDistance()}}ct("LineBucket",p_,{omit:["layers","patternFeatures"]});const qC=new xi({"line-cap":new mt(Le.layout_line["line-cap"]),"line-join":new St(Le.layout_line["line-join"]),"line-miter-limit":new mt(Le.layout_line["line-miter-limit"]),"line-round-limit":new mt(Le.layout_line["line-round-limit"]),"line-sort-key":new St(Le.layout_line["line-sort-key"])});var T1={paint:new xi({"line-opacity":new St(Le.paint_line["line-opacity"]),"line-color":new St(Le.paint_line["line-color"]),"line-translate":new mt(Le.paint_line["line-translate"]),"line-translate-anchor":new mt(Le.paint_line["line-translate-anchor"]),"line-width":new St(Le.paint_line["line-width"]),"line-gap-width":new St(Le.paint_line["line-gap-width"]),"line-offset":new St(Le.paint_line["line-offset"]),"line-blur":new St(Le.paint_line["line-blur"]),"line-dasharray":new gh(Le.paint_line["line-dasharray"]),"line-pattern":new _a(Le.paint_line["line-pattern"]),"line-gradient":new ro(Le.paint_line["line-gradient"])}),layout:qC};const S1=new class extends St{possiblyEvaluate(a,r){return r=new An(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),super.possiblyEvaluate(a,r)}evaluate(a,r,u,f){return r=U({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(a,r,u,f)}}(T1.paint.properties["line-width"].specification);function A1(a,r){return r>0?r+2*a:a}S1.useIntegerZoom=!0;const ZC=Xn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),XC=Xn([{name:"a_projected_pos",components:3,type:"Float32"}],4);Xn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const YC=Xn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);Xn([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const P1=Xn([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),KC=Xn([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function JC(a,r,u){return a.sections.forEach(f=>{f.text=function(g,v,b){const T=v.layout.get("text-transform").evaluate(b,{});return T==="uppercase"?g=g.toLocaleUpperCase():T==="lowercase"&&(g=g.toLocaleLowerCase()),Ir.applyArabicShaping&&(g=Ir.applyArabicShaping(g)),g}(f.text,r,u)}),a}Xn([{name:"triangle",components:3,type:"Uint16"}]),Xn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Xn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Xn([{type:"Float32",name:"offsetX"}]),Xn([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const Mh={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var bi=24,m_=mn,I1=function(a,r,u,f,g){var v,b,T=8*g-f-1,A=(1<<T)-1,L=A>>1,z=-7,F=u?g-1:0,j=u?-1:1,X=a[r+F];for(F+=j,v=X&(1<<-z)-1,X>>=-z,z+=T;z>0;v=256*v+a[r+F],F+=j,z-=8);for(b=v&(1<<-z)-1,v>>=-z,z+=f;z>0;b=256*b+a[r+F],F+=j,z-=8);if(v===0)v=1-L;else{if(v===A)return b?NaN:1/0*(X?-1:1);b+=Math.pow(2,f),v-=L}return(X?-1:1)*b*Math.pow(2,v-f)},C1=function(a,r,u,f,g,v){var b,T,A,L=8*v-g-1,z=(1<<L)-1,F=z>>1,j=g===23?Math.pow(2,-24)-Math.pow(2,-77):0,X=f?0:v-1,Y=f?1:-1,le=r<0||r===0&&1/r<0?1:0;for(r=Math.abs(r),isNaN(r)||r===1/0?(T=isNaN(r)?1:0,b=z):(b=Math.floor(Math.log(r)/Math.LN2),r*(A=Math.pow(2,-b))<1&&(b--,A*=2),(r+=b+F>=1?j/A:j*Math.pow(2,1-F))*A>=2&&(b++,A/=2),b+F>=z?(T=0,b=z):b+F>=1?(T=(r*A-1)*Math.pow(2,g),b+=F):(T=r*Math.pow(2,F-1)*Math.pow(2,g),b=0));g>=8;a[u+X]=255&T,X+=Y,T/=256,g-=8);for(b=b<<g|T,L+=g;L>0;a[u+X]=255&b,X+=Y,b/=256,L-=8);a[u+X-Y]|=128*le};function mn(a){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(a)?a:new Uint8Array(a||0),this.pos=0,this.type=0,this.length=this.buf.length}mn.Varint=0,mn.Fixed64=1,mn.Bytes=2,mn.Fixed32=5;var ba,g_=4294967296,M1=1/g_,L1=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function zo(a){return a.type===mn.Bytes?a.readVarint()+a.pos:a.pos+1}function Ac(a,r,u){return u?4294967296*r+(a>>>0):4294967296*(r>>>0)+(a>>>0)}function k1(a,r,u){var f=r<=16383?1:r<=2097151?2:r<=268435455?3:Math.floor(Math.log(r)/(7*Math.LN2));u.realloc(f);for(var g=u.pos-1;g>=a;g--)u.buf[g+f]=u.buf[g]}function QC(a,r){for(var u=0;u<a.length;u++)r.writeVarint(a[u])}function eM(a,r){for(var u=0;u<a.length;u++)r.writeSVarint(a[u])}function tM(a,r){for(var u=0;u<a.length;u++)r.writeFloat(a[u])}function nM(a,r){for(var u=0;u<a.length;u++)r.writeDouble(a[u])}function iM(a,r){for(var u=0;u<a.length;u++)r.writeBoolean(a[u])}function rM(a,r){for(var u=0;u<a.length;u++)r.writeFixed32(a[u])}function sM(a,r){for(var u=0;u<a.length;u++)r.writeSFixed32(a[u])}function oM(a,r){for(var u=0;u<a.length;u++)r.writeFixed64(a[u])}function aM(a,r){for(var u=0;u<a.length;u++)r.writeSFixed64(a[u])}function Kf(a,r){return(a[r]|a[r+1]<<8|a[r+2]<<16)+16777216*a[r+3]}function Pc(a,r,u){a[u]=r,a[u+1]=r>>>8,a[u+2]=r>>>16,a[u+3]=r>>>24}function R1(a,r){return(a[r]|a[r+1]<<8|a[r+2]<<16)+(a[r+3]<<24)}function lM(a,r,u){a===1&&u.readMessage(cM,r)}function cM(a,r,u){if(a===3){const{id:f,bitmap:g,width:v,height:b,left:T,top:A,advance:L}=u.readMessage(uM,{});r.push({id:f,bitmap:new Eh({width:v+6,height:b+6},g),metrics:{width:v,height:b,left:T,top:A,advance:L}})}}function uM(a,r,u){a===1?r.id=u.readVarint():a===2?r.bitmap=u.readBytes():a===3?r.width=u.readVarint():a===4?r.height=u.readVarint():a===5?r.left=u.readSVarint():a===6?r.top=u.readSVarint():a===7&&(r.advance=u.readVarint())}function D1(a){let r=0,u=0;for(const b of a)r+=b.w*b.h,u=Math.max(u,b.w);a.sort((b,T)=>T.h-b.h);const f=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(r/.95)),u),h:1/0}];let g=0,v=0;for(const b of a)for(let T=f.length-1;T>=0;T--){const A=f[T];if(!(b.w>A.w||b.h>A.h)){if(b.x=A.x,b.y=A.y,v=Math.max(v,b.y+b.h),g=Math.max(g,b.x+b.w),b.w===A.w&&b.h===A.h){const L=f.pop();T<f.length&&(f[T]=L)}else b.h===A.h?(A.x+=b.w,A.w-=b.w):b.w===A.w?(A.y+=b.h,A.h-=b.h):(f.push({x:A.x+b.w,y:A.y,w:A.w-b.w,h:b.h}),A.y+=b.h,A.h-=b.h);break}}return{w:g,h:v,fill:r/(g*v)||0}}mn.prototype={destroy:function(){this.buf=null},readFields:function(a,r,u){for(u=u||this.length;this.pos<u;){var f=this.readVarint(),g=f>>3,v=this.pos;this.type=7&f,a(g,r,this),this.pos===v&&this.skip(f)}return r},readMessage:function(a,r){return this.readFields(a,r,this.readVarint()+this.pos)},readFixed32:function(){var a=Kf(this.buf,this.pos);return this.pos+=4,a},readSFixed32:function(){var a=R1(this.buf,this.pos);return this.pos+=4,a},readFixed64:function(){var a=Kf(this.buf,this.pos)+Kf(this.buf,this.pos+4)*g_;return this.pos+=8,a},readSFixed64:function(){var a=Kf(this.buf,this.pos)+R1(this.buf,this.pos+4)*g_;return this.pos+=8,a},readFloat:function(){var a=I1(this.buf,this.pos,!0,23,4);return this.pos+=4,a},readDouble:function(){var a=I1(this.buf,this.pos,!0,52,8);return this.pos+=8,a},readVarint:function(a){var r,u,f=this.buf;return r=127&(u=f[this.pos++]),u<128?r:(r|=(127&(u=f[this.pos++]))<<7,u<128?r:(r|=(127&(u=f[this.pos++]))<<14,u<128?r:(r|=(127&(u=f[this.pos++]))<<21,u<128?r:function(g,v,b){var T,A,L=b.buf;if(T=(112&(A=L[b.pos++]))>>4,A<128||(T|=(127&(A=L[b.pos++]))<<3,A<128)||(T|=(127&(A=L[b.pos++]))<<10,A<128)||(T|=(127&(A=L[b.pos++]))<<17,A<128)||(T|=(127&(A=L[b.pos++]))<<24,A<128)||(T|=(1&(A=L[b.pos++]))<<31,A<128))return Ac(g,T,v);throw new Error("Expected varint not more than 10 bytes")}(r|=(15&(u=f[this.pos]))<<28,a,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var a=this.readVarint();return a%2==1?(a+1)/-2:a/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var a=this.readVarint()+this.pos,r=this.pos;return this.pos=a,a-r>=12&&L1?function(u,f,g){return L1.decode(u.subarray(f,g))}(this.buf,r,a):function(u,f,g){for(var v="",b=f;b<g;){var T,A,L,z=u[b],F=null,j=z>239?4:z>223?3:z>191?2:1;if(b+j>g)break;j===1?z<128&&(F=z):j===2?(192&(T=u[b+1]))==128&&(F=(31&z)<<6|63&T)<=127&&(F=null):j===3?(A=u[b+2],(192&(T=u[b+1]))==128&&(192&A)==128&&((F=(15&z)<<12|(63&T)<<6|63&A)<=2047||F>=55296&&F<=57343)&&(F=null)):j===4&&(A=u[b+2],L=u[b+3],(192&(T=u[b+1]))==128&&(192&A)==128&&(192&L)==128&&((F=(15&z)<<18|(63&T)<<12|(63&A)<<6|63&L)<=65535||F>=1114112)&&(F=null)),F===null?(F=65533,j=1):F>65535&&(F-=65536,v+=String.fromCharCode(F>>>10&1023|55296),F=56320|1023&F),v+=String.fromCharCode(F),b+=j}return v}(this.buf,r,a)},readBytes:function(){var a=this.readVarint()+this.pos,r=this.buf.subarray(this.pos,a);return this.pos=a,r},readPackedVarint:function(a,r){if(this.type!==mn.Bytes)return a.push(this.readVarint(r));var u=zo(this);for(a=a||[];this.pos<u;)a.push(this.readVarint(r));return a},readPackedSVarint:function(a){if(this.type!==mn.Bytes)return a.push(this.readSVarint());var r=zo(this);for(a=a||[];this.pos<r;)a.push(this.readSVarint());return a},readPackedBoolean:function(a){if(this.type!==mn.Bytes)return a.push(this.readBoolean());var r=zo(this);for(a=a||[];this.pos<r;)a.push(this.readBoolean());return a},readPackedFloat:function(a){if(this.type!==mn.Bytes)return a.push(this.readFloat());var r=zo(this);for(a=a||[];this.pos<r;)a.push(this.readFloat());return a},readPackedDouble:function(a){if(this.type!==mn.Bytes)return a.push(this.readDouble());var r=zo(this);for(a=a||[];this.pos<r;)a.push(this.readDouble());return a},readPackedFixed32:function(a){if(this.type!==mn.Bytes)return a.push(this.readFixed32());var r=zo(this);for(a=a||[];this.pos<r;)a.push(this.readFixed32());return a},readPackedSFixed32:function(a){if(this.type!==mn.Bytes)return a.push(this.readSFixed32());var r=zo(this);for(a=a||[];this.pos<r;)a.push(this.readSFixed32());return a},readPackedFixed64:function(a){if(this.type!==mn.Bytes)return a.push(this.readFixed64());var r=zo(this);for(a=a||[];this.pos<r;)a.push(this.readFixed64());return a},readPackedSFixed64:function(a){if(this.type!==mn.Bytes)return a.push(this.readSFixed64());var r=zo(this);for(a=a||[];this.pos<r;)a.push(this.readSFixed64());return a},skip:function(a){var r=7&a;if(r===mn.Varint)for(;this.buf[this.pos++]>127;);else if(r===mn.Bytes)this.pos=this.readVarint()+this.pos;else if(r===mn.Fixed32)this.pos+=4;else{if(r!==mn.Fixed64)throw new Error("Unimplemented type: "+r);this.pos+=8}},writeTag:function(a,r){this.writeVarint(a<<3|r)},realloc:function(a){for(var r=this.length||16;r<this.pos+a;)r*=2;if(r!==this.length){var u=new Uint8Array(r);u.set(this.buf),this.buf=u,this.length=r}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(a){this.realloc(4),Pc(this.buf,a,this.pos),this.pos+=4},writeSFixed32:function(a){this.realloc(4),Pc(this.buf,a,this.pos),this.pos+=4},writeFixed64:function(a){this.realloc(8),Pc(this.buf,-1&a,this.pos),Pc(this.buf,Math.floor(a*M1),this.pos+4),this.pos+=8},writeSFixed64:function(a){this.realloc(8),Pc(this.buf,-1&a,this.pos),Pc(this.buf,Math.floor(a*M1),this.pos+4),this.pos+=8},writeVarint:function(a){(a=+a||0)>268435455||a<0?function(r,u){var f,g;if(r>=0?(f=r%4294967296|0,g=r/4294967296|0):(g=~(-r/4294967296),4294967295^(f=~(-r%4294967296))?f=f+1|0:(f=0,g=g+1|0)),r>=18446744073709552e3||r<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");u.realloc(10),function(v,b,T){T.buf[T.pos++]=127&v|128,v>>>=7,T.buf[T.pos++]=127&v|128,v>>>=7,T.buf[T.pos++]=127&v|128,v>>>=7,T.buf[T.pos++]=127&v|128,T.buf[T.pos]=127&(v>>>=7)}(f,0,u),function(v,b){var T=(7&v)<<4;b.buf[b.pos++]|=T|((v>>>=3)?128:0),v&&(b.buf[b.pos++]=127&v|((v>>>=7)?128:0),v&&(b.buf[b.pos++]=127&v|((v>>>=7)?128:0),v&&(b.buf[b.pos++]=127&v|((v>>>=7)?128:0),v&&(b.buf[b.pos++]=127&v|((v>>>=7)?128:0),v&&(b.buf[b.pos++]=127&v)))))}(g,u)}(a,this):(this.realloc(4),this.buf[this.pos++]=127&a|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=a>>>7&127))))},writeSVarint:function(a){this.writeVarint(a<0?2*-a-1:2*a)},writeBoolean:function(a){this.writeVarint(!!a)},writeString:function(a){a=String(a),this.realloc(4*a.length),this.pos++;var r=this.pos;this.pos=function(f,g,v){for(var b,T,A=0;A<g.length;A++){if((b=g.charCodeAt(A))>55295&&b<57344){if(!T){b>56319||A+1===g.length?(f[v++]=239,f[v++]=191,f[v++]=189):T=b;continue}if(b<56320){f[v++]=239,f[v++]=191,f[v++]=189,T=b;continue}b=T-55296<<10|b-56320|65536,T=null}else T&&(f[v++]=239,f[v++]=191,f[v++]=189,T=null);b<128?f[v++]=b:(b<2048?f[v++]=b>>6|192:(b<65536?f[v++]=b>>12|224:(f[v++]=b>>18|240,f[v++]=b>>12&63|128),f[v++]=b>>6&63|128),f[v++]=63&b|128)}return v}(this.buf,a,this.pos);var u=this.pos-r;u>=128&&k1(r,u,this),this.pos=r-1,this.writeVarint(u),this.pos+=u},writeFloat:function(a){this.realloc(4),C1(this.buf,a,this.pos,!0,23,4),this.pos+=4},writeDouble:function(a){this.realloc(8),C1(this.buf,a,this.pos,!0,52,8),this.pos+=8},writeBytes:function(a){var r=a.length;this.writeVarint(r),this.realloc(r);for(var u=0;u<r;u++)this.buf[this.pos++]=a[u]},writeRawMessage:function(a,r){this.pos++;var u=this.pos;a(r,this);var f=this.pos-u;f>=128&&k1(u,f,this),this.pos=u-1,this.writeVarint(f),this.pos+=f},writeMessage:function(a,r,u){this.writeTag(a,mn.Bytes),this.writeRawMessage(r,u)},writePackedVarint:function(a,r){r.length&&this.writeMessage(a,QC,r)},writePackedSVarint:function(a,r){r.length&&this.writeMessage(a,eM,r)},writePackedBoolean:function(a,r){r.length&&this.writeMessage(a,iM,r)},writePackedFloat:function(a,r){r.length&&this.writeMessage(a,tM,r)},writePackedDouble:function(a,r){r.length&&this.writeMessage(a,nM,r)},writePackedFixed32:function(a,r){r.length&&this.writeMessage(a,rM,r)},writePackedSFixed32:function(a,r){r.length&&this.writeMessage(a,sM,r)},writePackedFixed64:function(a,r){r.length&&this.writeMessage(a,oM,r)},writePackedSFixed64:function(a,r){r.length&&this.writeMessage(a,aM,r)},writeBytesField:function(a,r){this.writeTag(a,mn.Bytes),this.writeBytes(r)},writeFixed32Field:function(a,r){this.writeTag(a,mn.Fixed32),this.writeFixed32(r)},writeSFixed32Field:function(a,r){this.writeTag(a,mn.Fixed32),this.writeSFixed32(r)},writeFixed64Field:function(a,r){this.writeTag(a,mn.Fixed64),this.writeFixed64(r)},writeSFixed64Field:function(a,r){this.writeTag(a,mn.Fixed64),this.writeSFixed64(r)},writeVarintField:function(a,r){this.writeTag(a,mn.Varint),this.writeVarint(r)},writeSVarintField:function(a,r){this.writeTag(a,mn.Varint),this.writeSVarint(r)},writeStringField:function(a,r){this.writeTag(a,mn.Bytes),this.writeString(r)},writeFloatField:function(a,r){this.writeTag(a,mn.Fixed32),this.writeFloat(r)},writeDoubleField:function(a,r){this.writeTag(a,mn.Fixed64),this.writeDouble(r)},writeBooleanField:function(a,r){this.writeVarintField(a,!!r)}};class __{constructor(r,{pixelRatio:u,version:f,stretchX:g,stretchY:v,content:b}){this.paddedRect=r,this.pixelRatio=u,this.stretchX=g,this.stretchY=v,this.content=b,this.version=f}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class z1{constructor(r,u){const f={},g={};this.haveRenderCallbacks=[];const v=[];this.addImages(r,f,v),this.addImages(u,g,v);const{w:b,h:T}=D1(v),A=new qr({width:b||1,height:T||1});for(const L in r){const z=r[L],F=f[L].paddedRect;qr.copy(z.data,A,{x:0,y:0},{x:F.x+1,y:F.y+1},z.data)}for(const L in u){const z=u[L],F=g[L].paddedRect,j=F.x+1,X=F.y+1,Y=z.data.width,le=z.data.height;qr.copy(z.data,A,{x:0,y:0},{x:j,y:X},z.data),qr.copy(z.data,A,{x:0,y:le-1},{x:j,y:X-1},{width:Y,height:1}),qr.copy(z.data,A,{x:0,y:0},{x:j,y:X+le},{width:Y,height:1}),qr.copy(z.data,A,{x:Y-1,y:0},{x:j-1,y:X},{width:1,height:le}),qr.copy(z.data,A,{x:0,y:0},{x:j+Y,y:X},{width:1,height:le})}this.image=A,this.iconPositions=f,this.patternPositions=g}addImages(r,u,f){for(const g in r){const v=r[g],b={x:0,y:0,w:v.data.width+2,h:v.data.height+2};f.push(b),u[g]=new __(b,v),v.hasRenderCallback&&this.haveRenderCallbacks.push(g)}}patchUpdatedImages(r,u){r.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const f in r.updatedImages)this.patchUpdatedImage(this.iconPositions[f],r.getImage(f),u),this.patchUpdatedImage(this.patternPositions[f],r.getImage(f),u)}patchUpdatedImage(r,u,f){if(!r||!u||r.version===u.version)return;r.version=u.version;const[g,v]=r.tl;f.update(u.data,void 0,{x:g,y:v})}}ct("ImagePosition",__),ct("ImageAtlas",z1),l.WritingMode=void 0,(ba=l.WritingMode||(l.WritingMode={}))[ba.none=0]="none",ba[ba.horizontal=1]="horizontal",ba[ba.vertical=2]="vertical",ba[ba.horizontalOnly=3]="horizontalOnly";const Jf=-17;class Lh{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(r,u){const f=new Lh;return f.scale=r||1,f.fontStack=u,f}static forImage(r){const u=new Lh;return u.imageName=r,u}}class Ic{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(r,u){const f=new Ic;for(let g=0;g<r.sections.length;g++){const v=r.sections[g];v.image?f.addImageSection(v):f.addTextSection(v,u)}return f}length(){return this.text.length}getSection(r){return this.sections[this.sectionIndex[r]]}getSectionIndex(r){return this.sectionIndex[r]}getCharCode(r){return this.text.charCodeAt(r)}verticalizePunctuation(){this.text=function(r){let u="";for(let f=0;f<r.length;f++){const g=r.charCodeAt(f+1)||null,v=r.charCodeAt(f-1)||null;u+=g&&kf(g)&&!Mh[r[f+1]]||v&&kf(v)&&!Mh[r[f-1]]||!Mh[r[f]]?r[f]:Mh[r[f]]}return u}(this.text)}trim(){let r=0;for(let f=0;f<this.text.length&&ep[this.text.charCodeAt(f)];f++)r++;let u=this.text.length;for(let f=this.text.length-1;f>=0&&f>=r&&ep[this.text.charCodeAt(f)];f--)u--;this.text=this.text.substring(r,u),this.sectionIndex=this.sectionIndex.slice(r,u)}substring(r,u){const f=new Ic;return f.text=this.text.substring(r,u),f.sectionIndex=this.sectionIndex.slice(r,u),f.sections=this.sections,f}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((r,u)=>Math.max(r,this.sections[u].scale),0)}addTextSection(r,u){this.text+=r.text,this.sections.push(Lh.forText(r.scale,r.fontStack||u));const f=this.sections.length-1;for(let g=0;g<r.text.length;++g)this.sectionIndex.push(f)}addImageSection(r){const u=r.image?r.image.name:"";if(u.length===0)return void ge("Can't add FormattedSection with an empty image.");const f=this.getNextImageSectionCharCode();f?(this.text+=String.fromCharCode(f),this.sections.push(Lh.forImage(u)),this.sectionIndex.push(this.sections.length-1)):ge("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Qf(a,r,u,f,g,v,b,T,A,L,z,F,j,X,Y,le){const oe=Ic.fromFeature(a,g);let ve;F===l.WritingMode.vertical&&oe.verticalizePunctuation();const{processBidirectionalText:Se,processStyledBidirectionalText:ye}=Ir;if(Se&&oe.sections.length===1){ve=[];const ze=Se(oe.toString(),y_(oe,L,v,r,f,X,Y));for(const ot of ze){const dt=new Ic;dt.text=ot,dt.sections=oe.sections;for(let et=0;et<ot.length;et++)dt.sectionIndex.push(0);ve.push(dt)}}else if(ye){ve=[];const ze=ye(oe.text,oe.sectionIndex,y_(oe,L,v,r,f,X,Y));for(const ot of ze){const dt=new Ic;dt.text=ot[0],dt.sectionIndex=ot[1],dt.sections=oe.sections,ve.push(dt)}}else ve=function(ze,ot){const dt=[],et=ze.text;let Xe=0;for(const We of ot)dt.push(ze.substring(Xe,We)),Xe=We;return Xe<et.length&&dt.push(ze.substring(Xe,et.length)),dt}(oe,y_(oe,L,v,r,f,X,Y));const Ee=[],Oe={positionedLines:Ee,text:oe.toString(),top:z[1],bottom:z[1],left:z[0],right:z[0],writingMode:F,iconsInText:!1,verticalizable:!1};return function(ze,ot,dt,et,Xe,We,tt,Ye,Ve,wt,_t,Ft){let En=0,In=Jf,si=0,Xr=0;const Ci=Ye==="right"?1:Ye==="left"?0:.5;let Yn=0;for(const Kn of Xe){Kn.trim();const Li=Kn.getMaxScale(),Vi=(Li-1)*bi,er={positionedGlyphs:[],lineOffset:0};ze.positionedLines[Yn]=er;const gr=er.positionedGlyphs;let _r=0;if(!Kn.length()){In+=We,++Yn;continue}for(let mi=0;mi<Kn.length();mi++){const Ht=Kn.getSection(mi),Lr=Kn.getSectionIndex(mi),ki=Kn.getCharCode(mi);let ji=0,vs=null,Ns=null,Bs=null,Fo=bi;const xs=!(Ve===l.WritingMode.horizontal||!_t&&!uh(ki)||_t&&(ep[ki]||(pi=ki,Qe.Arabic(pi)||Qe["Arabic Supplement"](pi)||Qe["Arabic Extended-A"](pi)||Qe["Arabic Presentation Forms-A"](pi)||Qe["Arabic Presentation Forms-B"](pi))));if(Ht.imageName){const Yr=et[Ht.imageName];if(!Yr)continue;Bs=Ht.imageName,ze.iconsInText=ze.iconsInText||!0,Ns=Yr.paddedRect;const yr=Yr.displaySize;Ht.scale=Ht.scale*bi/Ft,vs={width:yr[0],height:yr[1],left:1,top:-3,advance:xs?yr[1]:yr[0]},ji=Vi+(bi-yr[1]*Ht.scale),Fo=vs.advance;const No=xs?yr[0]*Ht.scale-bi*Li:yr[1]*Ht.scale-bi*Li;No>0&&No>_r&&(_r=No)}else{const Yr=dt[Ht.fontStack],yr=Yr&&Yr[ki];if(yr&&yr.rect)Ns=yr.rect,vs=yr.metrics;else{const No=ot[Ht.fontStack],Dh=No&&No[ki];if(!Dh)continue;vs=Dh.metrics}ji=(Li-Ht.scale)*bi}xs?(ze.verticalizable=!0,gr.push({glyph:ki,imageName:Bs,x:En,y:In+ji,vertical:xs,scale:Ht.scale,fontStack:Ht.fontStack,sectionIndex:Lr,metrics:vs,rect:Ns}),En+=Fo*Ht.scale+wt):(gr.push({glyph:ki,imageName:Bs,x:En,y:In+ji,vertical:xs,scale:Ht.scale,fontStack:Ht.fontStack,sectionIndex:Lr,metrics:vs,rect:Ns}),En+=vs.advance*Ht.scale+wt)}gr.length!==0&&(si=Math.max(En-wt,si),fM(gr,0,gr.length-1,Ci,_r)),En=0;const Mn=We*Li+_r;er.lineOffset=Math.max(_r,Vi),In+=Mn,Xr=Math.max(Mn,Xr),++Yn}var pi;const Mi=In-Jf,{horizontalAlign:Ui,verticalAlign:mr}=v_(tt);(function(Kn,Li,Vi,er,gr,_r,Mn,mi,Ht){const Lr=(Li-Vi)*gr;let ki=0;ki=_r!==Mn?-mi*er-Jf:(-er*Ht+.5)*Mn;for(const ji of Kn)for(const vs of ji.positionedGlyphs)vs.x+=Lr,vs.y+=ki})(ze.positionedLines,Ci,Ui,mr,si,Xr,We,Mi,Xe.length),ze.top+=-mr*Mi,ze.bottom=ze.top+Mi,ze.left+=-Ui*si,ze.right=ze.left+si}(Oe,r,u,f,ve,b,T,A,F,L,j,le),!function(ze){for(const ot of ze)if(ot.positionedGlyphs.length!==0)return!1;return!0}(Ee)&&Oe}const ep={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},hM={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function O1(a,r,u,f,g,v){if(r.imageName){const b=f[r.imageName];return b?b.displaySize[0]*r.scale*bi/v+g:0}{const b=u[r.fontStack],T=b&&b[a];return T?T.metrics.advance*r.scale+g:0}}function F1(a,r,u,f){const g=Math.pow(a-r,2);return f?a<r?g/2:2*g:g+Math.abs(u)*u}function dM(a,r,u){let f=0;return a===10&&(f-=1e4),u&&(f+=150),a!==40&&a!==65288||(f+=50),r!==41&&r!==65289||(f+=50),f}function N1(a,r,u,f,g,v){let b=null,T=F1(r,u,g,v);for(const A of f){const L=F1(r-A.x,u,g,v)+A.badness;L<=T&&(b=A,T=L)}return{index:a,x:r,priorBreak:b,badness:T}}function B1(a){return a?B1(a.priorBreak).concat(a.index):[]}function y_(a,r,u,f,g,v,b){if(v!=="point")return[];if(!a)return[];const T=[],A=function(j,X,Y,le,oe,ve){let Se=0;for(let ye=0;ye<j.length();ye++){const Ee=j.getSection(ye);Se+=O1(j.getCharCode(ye),Ee,le,oe,X,ve)}return Se/Math.max(1,Math.ceil(Se/Y))}(a,r,u,f,g,b),L=a.text.indexOf("")>=0;let z=0;for(let j=0;j<a.length();j++){const X=a.getSection(j),Y=a.getCharCode(j);if(ep[Y]||(z+=O1(Y,X,f,g,r,b)),j<a.length()-1){const le=!((F=Y)<11904||!(Qe["Bopomofo Extended"](F)||Qe.Bopomofo(F)||Qe["CJK Compatibility Forms"](F)||Qe["CJK Compatibility Ideographs"](F)||Qe["CJK Compatibility"](F)||Qe["CJK Radicals Supplement"](F)||Qe["CJK Strokes"](F)||Qe["CJK Symbols and Punctuation"](F)||Qe["CJK Unified Ideographs Extension A"](F)||Qe["CJK Unified Ideographs"](F)||Qe["Enclosed CJK Letters and Months"](F)||Qe["Halfwidth and Fullwidth Forms"](F)||Qe.Hiragana(F)||Qe["Ideographic Description Characters"](F)||Qe["Kangxi Radicals"](F)||Qe["Katakana Phonetic Extensions"](F)||Qe.Katakana(F)||Qe["Vertical Forms"](F)||Qe["Yi Radicals"](F)||Qe["Yi Syllables"](F)));(hM[Y]||le||X.imageName)&&T.push(N1(j+1,z,A,T,dM(Y,a.getCharCode(j+1),le&&L),!1))}}var F;return B1(N1(a.length(),z,A,T,0,!0))}function v_(a){let r=.5,u=.5;switch(a){case"right":case"top-right":case"bottom-right":r=1;break;case"left":case"top-left":case"bottom-left":r=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":u=1;break;case"top":case"top-right":case"top-left":u=0}return{horizontalAlign:r,verticalAlign:u}}function fM(a,r,u,f,g){if(!f&&!g)return;const v=a[u],b=(a[u].x+v.metrics.advance*v.scale)*f;for(let T=r;T<=u;T++)a[T].x-=b,a[T].y+=g}function pM(a,r,u){const{horizontalAlign:f,verticalAlign:g}=v_(u),v=r[0]-a.displaySize[0]*f,b=r[1]-a.displaySize[1]*g;return{image:a,top:b,bottom:b+a.displaySize[1],left:v,right:v+a.displaySize[0]}}function U1(a,r,u,f,g,v){const b=a.image;let T;if(b.content){const oe=b.content,ve=b.pixelRatio||1;T=[oe[0]/ve,oe[1]/ve,b.displaySize[0]-oe[2]/ve,b.displaySize[1]-oe[3]/ve]}const A=r.left*v,L=r.right*v;let z,F,j,X;u==="width"||u==="both"?(X=g[0]+A-f[3],F=g[0]+L+f[1]):(X=g[0]+(A+L-b.displaySize[0])/2,F=X+b.displaySize[0]);const Y=r.top*v,le=r.bottom*v;return u==="height"||u==="both"?(z=g[1]+Y-f[0],j=g[1]+le+f[2]):(z=g[1]+(Y+le-b.displaySize[1])/2,j=z+b.displaySize[1]),{image:b,top:z,right:F,bottom:j,left:X,collisionPadding:T}}const Oo=128;function V1(a,r){const{expression:u}=r;if(u.kind==="constant")return{kind:"constant",layoutSize:u.evaluate(new An(a+1))};if(u.kind==="source")return{kind:"source"};{const{zoomStops:f,interpolationType:g}=u;let v=0;for(;v<f.length&&f[v]<=a;)v++;v=Math.max(0,v-1);let b=v;for(;b<f.length&&f[b]<a+1;)b++;b=Math.min(f.length-1,b);const T=f[v],A=f[b];return u.kind==="composite"?{kind:"composite",minZoom:T,maxZoom:A,interpolationType:g}:{kind:"camera",minZoom:T,maxZoom:A,minSize:u.evaluate(new An(T)),maxSize:u.evaluate(new An(A)),interpolationType:g}}}class wa extends Tt{constructor(r,u,f,g){super(r,u),this.angle=f,g!==void 0&&(this.segment=g)}clone(){return new wa(this.x,this.y,this.angle,this.segment)}}function j1(a,r,u,f,g){if(r.segment===void 0)return!0;let v=r,b=r.segment+1,T=0;for(;T>-u/2;){if(b--,b<0)return!1;T-=a[b].dist(v),v=a[b]}T+=a[b].dist(a[b+1]),b++;const A=[];let L=0;for(;T<u/2;){const z=a[b],F=a[b+1];if(!F)return!1;let j=a[b-1].angleTo(z)-z.angleTo(F);for(j=Math.abs((j+3*Math.PI)%(2*Math.PI)-Math.PI),A.push({distance:T,angleDelta:j}),L+=j;T-A[0].distance>f;)L-=A.shift().angleDelta;if(L>g)return!1;b++,T+=z.dist(F)}return!0}function G1(a){let r=0;for(let u=0;u<a.length-1;u++)r+=a[u].dist(a[u+1]);return r}function W1(a,r,u){return a?.6*r*u:0}function H1(a,r){return Math.max(a?a.right-a.left:0,r?r.right-r.left:0)}function mM(a,r,u,f,g,v){const b=W1(u,g,v),T=H1(u,f)*v;let A=0;const L=G1(a)/2;for(let z=0;z<a.length-1;z++){const F=a[z],j=a[z+1],X=F.dist(j);if(A+X>L){const Y=(L-A)/X,le=zt(F.x,j.x,Y),oe=zt(F.y,j.y,Y),ve=new wa(le,oe,j.angleTo(F),z);return ve._round(),!b||j1(a,ve,T,b,r)?ve:void 0}A+=X}}function gM(a,r,u,f,g,v,b,T,A){const L=W1(f,v,b),z=H1(f,g),F=z*b,j=a[0].x===0||a[0].x===A||a[0].y===0||a[0].y===A;return r-F<r/4&&(r=F+r/4),$1(a,j?r/2*T%r:(z/2+2*v)*b*T%r,r,L,u,F,j,!1,A)}function $1(a,r,u,f,g,v,b,T,A){const L=v/2,z=G1(a);let F=0,j=r-u,X=[];for(let Y=0;Y<a.length-1;Y++){const le=a[Y],oe=a[Y+1],ve=le.dist(oe),Se=oe.angleTo(le);for(;j+u<F+ve;){j+=u;const ye=(j-F)/ve,Ee=zt(le.x,oe.x,ye),Oe=zt(le.y,oe.y,ye);if(Ee>=0&&Ee<A&&Oe>=0&&Oe<A&&j-L>=0&&j+L<=z){const ze=new wa(Ee,Oe,Se,Y);ze._round(),f&&!j1(a,ze,v,f,g)||X.push(ze)}}F+=ve}return T||X.length||b||(X=$1(a,F/2,u,f,g,v,b,!0,A)),X}function q1(a,r,u,f,g){const v=[];for(let b=0;b<a.length;b++){const T=a[b];let A;for(let L=0;L<T.length-1;L++){let z=T[L],F=T[L+1];z.x<r&&F.x<r||(z.x<r?z=new Tt(r,z.y+(r-z.x)/(F.x-z.x)*(F.y-z.y))._round():F.x<r&&(F=new Tt(r,z.y+(r-z.x)/(F.x-z.x)*(F.y-z.y))._round()),z.y<u&&F.y<u||(z.y<u?z=new Tt(z.x+(u-z.y)/(F.y-z.y)*(F.x-z.x),u)._round():F.y<u&&(F=new Tt(z.x+(u-z.y)/(F.y-z.y)*(F.x-z.x),u)._round()),z.x>=f&&F.x>=f||(z.x>=f?z=new Tt(f,z.y+(f-z.x)/(F.x-z.x)*(F.y-z.y))._round():F.x>=f&&(F=new Tt(f,z.y+(f-z.x)/(F.x-z.x)*(F.y-z.y))._round()),z.y>=g&&F.y>=g||(z.y>=g?z=new Tt(z.x+(g-z.y)/(F.y-z.y)*(F.x-z.x),g)._round():F.y>=g&&(F=new Tt(z.x+(g-z.y)/(F.y-z.y)*(F.x-z.x),g)._round()),A&&z.equals(A[A.length-1])||(A=[z],v.push(A)),A.push(F)))))}}return v}function Z1(a,r,u,f){const g=[],v=a.image,b=v.pixelRatio,T=v.paddedRect.w-2,A=v.paddedRect.h-2,L=a.right-a.left,z=a.bottom-a.top,F=v.stretchX||[[0,T]],j=v.stretchY||[[0,A]],X=(We,tt)=>We+tt[1]-tt[0],Y=F.reduce(X,0),le=j.reduce(X,0),oe=T-Y,ve=A-le;let Se=0,ye=Y,Ee=0,Oe=le,ze=0,ot=oe,dt=0,et=ve;if(v.content&&f){const We=v.content;Se=tp(F,0,We[0]),Ee=tp(j,0,We[1]),ye=tp(F,We[0],We[2]),Oe=tp(j,We[1],We[3]),ze=We[0]-Se,dt=We[1]-Ee,ot=We[2]-We[0]-ye,et=We[3]-We[1]-Oe}const Xe=(We,tt,Ye,Ve)=>{const wt=np(We.stretch-Se,ye,L,a.left),_t=ip(We.fixed-ze,ot,We.stretch,Y),Ft=np(tt.stretch-Ee,Oe,z,a.top),En=ip(tt.fixed-dt,et,tt.stretch,le),In=np(Ye.stretch-Se,ye,L,a.left),si=ip(Ye.fixed-ze,ot,Ye.stretch,Y),Xr=np(Ve.stretch-Ee,Oe,z,a.top),Ci=ip(Ve.fixed-dt,et,Ve.stretch,le),Yn=new Tt(wt,Ft),pi=new Tt(In,Ft),Mi=new Tt(In,Xr),Ui=new Tt(wt,Xr),mr=new Tt(_t/b,En/b),Kn=new Tt(si/b,Ci/b),Li=r*Math.PI/180;if(Li){const gr=Math.sin(Li),_r=Math.cos(Li),Mn=[_r,-gr,gr,_r];Yn._matMult(Mn),pi._matMult(Mn),Ui._matMult(Mn),Mi._matMult(Mn)}const Vi=We.stretch+We.fixed,er=tt.stretch+tt.fixed;return{tl:Yn,tr:pi,bl:Ui,br:Mi,tex:{x:v.paddedRect.x+1+Vi,y:v.paddedRect.y+1+er,w:Ye.stretch+Ye.fixed-Vi,h:Ve.stretch+Ve.fixed-er},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:mr,pixelOffsetBR:Kn,minFontScaleX:ot/b/L,minFontScaleY:et/b/z,isSDF:u}};if(f&&(v.stretchX||v.stretchY)){const We=X1(F,oe,Y),tt=X1(j,ve,le);for(let Ye=0;Ye<We.length-1;Ye++){const Ve=We[Ye],wt=We[Ye+1];for(let _t=0;_t<tt.length-1;_t++)g.push(Xe(Ve,tt[_t],wt,tt[_t+1]))}}else g.push(Xe({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:T+1},{fixed:0,stretch:A+1}));return g}function tp(a,r,u){let f=0;for(const g of a)f+=Math.max(r,Math.min(u,g[1]))-Math.max(r,Math.min(u,g[0]));return f}function X1(a,r,u){const f=[{fixed:-1,stretch:0}];for(const[g,v]of a){const b=f[f.length-1];f.push({fixed:g-b.stretch,stretch:b.stretch}),f.push({fixed:g-b.stretch,stretch:b.stretch+(v-g)})}return f.push({fixed:r+1,stretch:u}),f}function np(a,r,u,f){return a/r*u+f}function ip(a,r,u,f){return a-r*u/f}ct("Anchor",wa);class rp{constructor(r,u,f,g,v,b,T,A,L,z){if(this.boxStartIndex=r.length,L){let F=b.top,j=b.bottom;const X=b.collisionPadding;X&&(F-=X[1],j+=X[3]);let Y=j-F;Y>0&&(Y=Math.max(10,Y),this.circleDiameter=Y)}else{let F=b.top*T-A[0],j=b.bottom*T+A[2],X=b.left*T-A[3],Y=b.right*T+A[1];const le=b.collisionPadding;if(le&&(X-=le[0]*T,F-=le[1]*T,Y+=le[2]*T,j+=le[3]*T),z){const oe=new Tt(X,F),ve=new Tt(Y,F),Se=new Tt(X,j),ye=new Tt(Y,j),Ee=z*Math.PI/180;oe._rotate(Ee),ve._rotate(Ee),Se._rotate(Ee),ye._rotate(Ee),X=Math.min(oe.x,ve.x,Se.x,ye.x),Y=Math.max(oe.x,ve.x,Se.x,ye.x),F=Math.min(oe.y,ve.y,Se.y,ye.y),j=Math.max(oe.y,ve.y,Se.y,ye.y)}r.emplaceBack(u.x,u.y,X,F,Y,j,f,g,v)}this.boxEndIndex=r.length}}class _M{constructor(r=[],u=yM){if(this.data=r,this.length=this.data.length,this.compare=u,this.length>0)for(let f=(this.length>>1)-1;f>=0;f--)this._down(f)}push(r){this.data.push(r),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const r=this.data[0],u=this.data.pop();return this.length--,this.length>0&&(this.data[0]=u,this._down(0)),r}peek(){return this.data[0]}_up(r){const{data:u,compare:f}=this,g=u[r];for(;r>0;){const v=r-1>>1,b=u[v];if(f(g,b)>=0)break;u[r]=b,r=v}u[r]=g}_down(r){const{data:u,compare:f}=this,g=this.length>>1,v=u[r];for(;r<g;){let b=1+(r<<1),T=u[b];const A=b+1;if(A<this.length&&f(u[A],T)<0&&(b=A,T=u[A]),f(T,v)>=0)break;u[r]=T,r=b}u[r]=v}}function yM(a,r){return a<r?-1:a>r?1:0}function vM(a,r=1,u=!1){let f=1/0,g=1/0,v=-1/0,b=-1/0;const T=a[0];for(let X=0;X<T.length;X++){const Y=T[X];(!X||Y.x<f)&&(f=Y.x),(!X||Y.y<g)&&(g=Y.y),(!X||Y.x>v)&&(v=Y.x),(!X||Y.y>b)&&(b=Y.y)}const A=Math.min(v-f,b-g);let L=A/2;const z=new _M([],xM);if(A===0)return new Tt(f,g);for(let X=f;X<v;X+=A)for(let Y=g;Y<b;Y+=A)z.push(new Cc(X+L,Y+L,L,a));let F=function(X){let Y=0,le=0,oe=0;const ve=X[0];for(let Se=0,ye=ve.length,Ee=ye-1;Se<ye;Ee=Se++){const Oe=ve[Se],ze=ve[Ee],ot=Oe.x*ze.y-ze.x*Oe.y;le+=(Oe.x+ze.x)*ot,oe+=(Oe.y+ze.y)*ot,Y+=3*ot}return new Cc(le/Y,oe/Y,0,X)}(a),j=z.length;for(;z.length;){const X=z.pop();(X.d>F.d||!F.d)&&(F=X,u&&console.log("found best %d after %d probes",Math.round(1e4*X.d)/1e4,j)),X.max-F.d<=r||(L=X.h/2,z.push(new Cc(X.p.x-L,X.p.y-L,L,a)),z.push(new Cc(X.p.x+L,X.p.y-L,L,a)),z.push(new Cc(X.p.x-L,X.p.y+L,L,a)),z.push(new Cc(X.p.x+L,X.p.y+L,L,a)),j+=4)}return u&&(console.log(`num probes: ${j}`),console.log(`best distance: ${F.d}`)),F.p}function xM(a,r){return r.max-a.max}function Cc(a,r,u,f){this.p=new Tt(a,r),this.h=u,this.d=function(g,v){let b=!1,T=1/0;for(let A=0;A<v.length;A++){const L=v[A];for(let z=0,F=L.length,j=F-1;z<F;j=z++){const X=L[z],Y=L[j];X.y>g.y!=Y.y>g.y&&g.x<(Y.x-X.x)*(g.y-X.y)/(Y.y-X.y)+X.x&&(b=!b),T=Math.min(T,i1(g,X,Y))}}return(b?1:-1)*Math.sqrt(T)}(this.p,f),this.max=this.d+this.h*Math.SQRT2}const x_=Number.POSITIVE_INFINITY;function Y1(a,r){return r[1]!==x_?function(u,f,g){let v=0,b=0;switch(f=Math.abs(f),g=Math.abs(g),u){case"top-right":case"top-left":case"top":b=g-7;break;case"bottom-right":case"bottom-left":case"bottom":b=7-g}switch(u){case"top-right":case"bottom-right":case"right":v=-f;break;case"top-left":case"bottom-left":case"left":v=f}return[v,b]}(a,r[0],r[1]):function(u,f){let g=0,v=0;f<0&&(f=0);const b=f/Math.sqrt(2);switch(u){case"top-right":case"top-left":v=b-7;break;case"bottom-right":case"bottom-left":v=7-b;break;case"bottom":v=7-f;break;case"top":v=f-7}switch(u){case"top-right":case"bottom-right":g=-b;break;case"top-left":case"bottom-left":g=b;break;case"left":g=f;break;case"right":g=-f}return[g,v]}(a,r[0])}function b_(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function bM(a,r,u,f,g,v,b,T,A,L,z){let F=v.textMaxSize.evaluate(r,{});F===void 0&&(F=b);const j=a.layers[0].layout,X=j.get("icon-offset").evaluate(r,{},z),Y=J1(u.horizontal),le=b/24,oe=a.tilePixelRatio*le,ve=a.tilePixelRatio*F/24,Se=a.tilePixelRatio*T,ye=a.tilePixelRatio*j.get("symbol-spacing"),Ee=j.get("text-padding")*a.tilePixelRatio,Oe=function(Ve,wt,_t,Ft=1){const En=Ve.get("icon-padding").evaluate(wt,{},_t),In=En&&En.values;return[In[0]*Ft,In[1]*Ft,In[2]*Ft,In[3]*Ft]}(j,r,z,a.tilePixelRatio),ze=j.get("text-max-angle")/180*Math.PI,ot=j.get("text-rotation-alignment")!=="viewport"&&j.get("symbol-placement")!=="point",dt=j.get("icon-rotation-alignment")==="map"&&j.get("symbol-placement")!=="point",et=j.get("symbol-placement"),Xe=ye/2,We=j.get("icon-text-fit");let tt;f&&We!=="none"&&(a.allowVerticalPlacement&&u.vertical&&(tt=U1(f,u.vertical,We,j.get("icon-text-fit-padding"),X,le)),Y&&(f=U1(f,Y,We,j.get("icon-text-fit-padding"),X,le)));const Ye=(Ve,wt)=>{wt.x<0||wt.x>=ri||wt.y<0||wt.y>=ri||function(_t,Ft,En,In,si,Xr,Ci,Yn,pi,Mi,Ui,mr,Kn,Li,Vi,er,gr,_r,Mn,mi,Ht,Lr,ki,ji,vs){const Ns=_t.addToLineVertexArray(Ft,En);let Bs,Fo,xs,Yr,yr=0,No=0,Dh=0,pb=0,L_=-1,k_=-1;const Bo={};let mb=fi.exports(""),R_=0,D_=0;if(Yn._unevaluatedLayout.getValue("text-radial-offset")===void 0?[R_,D_]=Yn.layout.get("text-offset").evaluate(Ht,{},ji).map(vr=>vr*bi):(R_=Yn.layout.get("text-radial-offset").evaluate(Ht,{},ji)*bi,D_=x_),_t.allowVerticalPlacement&&In.vertical){const vr=Yn.layout.get("text-rotate").evaluate(Ht,{},ji)+90;xs=new rp(pi,Ft,Mi,Ui,mr,In.vertical,Kn,Li,Vi,vr),Ci&&(Yr=new rp(pi,Ft,Mi,Ui,mr,Ci,gr,_r,Vi,vr))}if(si){const vr=Yn.layout.get("icon-rotate").evaluate(Ht,{}),co=Yn.layout.get("icon-text-fit")!=="none",zh=Z1(si,vr,ki,co),Oh=Ci?Z1(Ci,vr,ki,co):void 0;Fo=new rp(pi,Ft,Mi,Ui,mr,si,gr,_r,!1,vr),yr=4*zh.length;const yb=_t.iconSizeData;let Al=null;yb.kind==="source"?(Al=[Oo*Yn.layout.get("icon-size").evaluate(Ht,{})],Al[0]>Ea&&ge(`${_t.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):yb.kind==="composite"&&(Al=[Oo*Lr.compositeIconSizes[0].evaluate(Ht,{},ji),Oo*Lr.compositeIconSizes[1].evaluate(Ht,{},ji)],(Al[0]>Ea||Al[1]>Ea)&&ge(`${_t.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),_t.addSymbols(_t.icon,zh,Al,mi,Mn,Ht,l.WritingMode.none,Ft,Ns.lineStartIndex,Ns.lineLength,-1,ji),L_=_t.icon.placedSymbolArray.length-1,Oh&&(No=4*Oh.length,_t.addSymbols(_t.icon,Oh,Al,mi,Mn,Ht,l.WritingMode.vertical,Ft,Ns.lineStartIndex,Ns.lineLength,-1,ji),k_=_t.icon.placedSymbolArray.length-1)}const gb=Object.keys(In.horizontal);for(const vr of gb){const co=In.horizontal[vr];if(!Bs){mb=fi.exports(co.text);const Oh=Yn.layout.get("text-rotate").evaluate(Ht,{},ji);Bs=new rp(pi,Ft,Mi,Ui,mr,co,Kn,Li,Vi,Oh)}const zh=co.positionedLines.length===1;if(Dh+=K1(_t,Ft,co,Xr,Yn,Vi,Ht,er,Ns,In.vertical?l.WritingMode.horizontal:l.WritingMode.horizontalOnly,zh?gb:[vr],Bo,L_,Lr,ji),zh)break}In.vertical&&(pb+=K1(_t,Ft,In.vertical,Xr,Yn,Vi,Ht,er,Ns,l.WritingMode.vertical,["vertical"],Bo,k_,Lr,ji));const DM=Bs?Bs.boxStartIndex:_t.collisionBoxArray.length,zM=Bs?Bs.boxEndIndex:_t.collisionBoxArray.length,OM=xs?xs.boxStartIndex:_t.collisionBoxArray.length,FM=xs?xs.boxEndIndex:_t.collisionBoxArray.length,NM=Fo?Fo.boxStartIndex:_t.collisionBoxArray.length,BM=Fo?Fo.boxEndIndex:_t.collisionBoxArray.length,UM=Yr?Yr.boxStartIndex:_t.collisionBoxArray.length,VM=Yr?Yr.boxEndIndex:_t.collisionBoxArray.length;let Us=-1;const cp=(vr,co)=>vr&&vr.circleDiameter?Math.max(vr.circleDiameter,co):co;Us=cp(Bs,Us),Us=cp(xs,Us),Us=cp(Fo,Us),Us=cp(Yr,Us);const _b=Us>-1?1:0;_b&&(Us*=vs/bi),_t.glyphOffsetArray.length>=Mc.MAX_GLYPHS&&ge("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Ht.sortKey!==void 0&&_t.addToSortKeyRanges(_t.symbolInstances.length,Ht.sortKey),_t.symbolInstances.emplaceBack(Ft.x,Ft.y,Bo.right>=0?Bo.right:-1,Bo.center>=0?Bo.center:-1,Bo.left>=0?Bo.left:-1,Bo.vertical||-1,L_,k_,mb,DM,zM,OM,FM,NM,BM,UM,VM,Mi,Dh,pb,yr,No,_b,0,Kn,R_,D_,Us)}(a,wt,Ve,u,f,g,tt,a.layers[0],a.collisionBoxArray,r.index,r.sourceLayerIndex,a.index,oe,[Ee,Ee,Ee,Ee],ot,A,Se,Oe,dt,X,r,v,L,z,b)};if(et==="line")for(const Ve of q1(r.geometry,0,0,ri,ri)){const wt=gM(Ve,ye,ze,u.vertical||Y,f,24,ve,a.overscaling,ri);for(const _t of wt){const Ft=Y;Ft&&wM(a,Ft.text,Xe,_t)||Ye(Ve,_t)}}else if(et==="line-center"){for(const Ve of r.geometry)if(Ve.length>1){const wt=mM(Ve,ze,u.vertical||Y,f,24,ve);wt&&Ye(Ve,wt)}}else if(r.type==="Polygon")for(const Ve of l_(r.geometry,0)){const wt=vM(Ve,16);Ye(Ve[0],new wa(wt.x,wt.y,0))}else if(r.type==="LineString")for(const Ve of r.geometry)Ye(Ve,new wa(Ve[0].x,Ve[0].y,0));else if(r.type==="Point")for(const Ve of r.geometry)for(const wt of Ve)Ye([wt],new wa(wt.x,wt.y,0))}const Ea=32640;function K1(a,r,u,f,g,v,b,T,A,L,z,F,j,X,Y){const le=function(Se,ye,Ee,Oe,ze,ot,dt,et){const Xe=Oe.layout.get("text-rotate").evaluate(ot,{})*Math.PI/180,We=[];for(const tt of ye.positionedLines)for(const Ye of tt.positionedGlyphs){if(!Ye.rect)continue;const Ve=Ye.rect||{};let wt=4,_t=!0,Ft=1,En=0;const In=(ze||et)&&Ye.vertical,si=Ye.metrics.advance*Ye.scale/2;if(et&&ye.verticalizable){const Mn=(Ye.scale-1)*bi,mi=(bi-Ye.metrics.width*Ye.scale)/2;En=tt.lineOffset/2-(Ye.imageName?-mi:Mn)}if(Ye.imageName){const Mn=dt[Ye.imageName];_t=Mn.sdf,Ft=Mn.pixelRatio,wt=1/Ft}const Xr=ze?[Ye.x+si,Ye.y]:[0,0];let Ci=ze?[0,0]:[Ye.x+si+Ee[0],Ye.y+Ee[1]-En],Yn=[0,0];In&&(Yn=Ci,Ci=[0,0]);const pi=(Ye.metrics.left-wt)*Ye.scale-si+Ci[0],Mi=(-Ye.metrics.top-wt)*Ye.scale+Ci[1],Ui=pi+Ve.w*Ye.scale/Ft,mr=Mi+Ve.h*Ye.scale/Ft,Kn=new Tt(pi,Mi),Li=new Tt(Ui,Mi),Vi=new Tt(pi,mr),er=new Tt(Ui,mr);if(In){const Mn=new Tt(-si,si-Jf),mi=-Math.PI/2,Ht=12-si,Lr=new Tt(22-Ht,-(Ye.imageName?Ht:0)),ki=new Tt(...Yn);Kn._rotateAround(mi,Mn)._add(Lr)._add(ki),Li._rotateAround(mi,Mn)._add(Lr)._add(ki),Vi._rotateAround(mi,Mn)._add(Lr)._add(ki),er._rotateAround(mi,Mn)._add(Lr)._add(ki)}if(Xe){const Mn=Math.sin(Xe),mi=Math.cos(Xe),Ht=[mi,-Mn,Mn,mi];Kn._matMult(Ht),Li._matMult(Ht),Vi._matMult(Ht),er._matMult(Ht)}const gr=new Tt(0,0),_r=new Tt(0,0);We.push({tl:Kn,tr:Li,bl:Vi,br:er,tex:Ve,writingMode:ye.writingMode,glyphOffset:Xr,sectionIndex:Ye.sectionIndex,isSDF:_t,pixelOffsetTL:gr,pixelOffsetBR:_r,minFontScaleX:0,minFontScaleY:0})}return We}(0,u,T,g,v,b,f,a.allowVerticalPlacement),oe=a.textSizeData;let ve=null;oe.kind==="source"?(ve=[Oo*g.layout.get("text-size").evaluate(b,{})],ve[0]>Ea&&ge(`${a.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):oe.kind==="composite"&&(ve=[Oo*X.compositeTextSizes[0].evaluate(b,{},Y),Oo*X.compositeTextSizes[1].evaluate(b,{},Y)],(ve[0]>Ea||ve[1]>Ea)&&ge(`${a.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),a.addSymbols(a.text,le,ve,T,v,b,L,r,A.lineStartIndex,A.lineLength,j,Y);for(const Se of z)F[Se]=a.text.placedSymbolArray.length-1;return 4*le.length}function J1(a){for(const r in a)return a[r];return null}function wM(a,r,u,f){const g=a.compareText;if(r in g){const v=g[r];for(let b=v.length-1;b>=0;b--)if(f.dist(v[b])<u)return!0}else g[r]=[];return g[r].push(f),!1}const EM=xa.VectorTileFeature.types,TM=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function sp(a,r,u,f,g,v,b,T,A,L,z,F,j){const X=T?Math.min(Ea,Math.round(T[0])):0,Y=T?Math.min(Ea,Math.round(T[1])):0;a.emplaceBack(r,u,Math.round(32*f),Math.round(32*g),v,b,(X<<1)+(A?1:0),Y,16*L,16*z,256*F,256*j)}function w_(a,r,u){a.emplaceBack(r.x,r.y,u),a.emplaceBack(r.x,r.y,u),a.emplaceBack(r.x,r.y,u),a.emplaceBack(r.x,r.y,u)}function SM(a){for(const r of a.sections)if(Df(r.text))return!0;return!1}class E_{constructor(r){this.layoutVertexArray=new _s,this.indexArray=new Ki,this.programConfigurations=r,this.segments=new jt,this.dynamicLayoutVertexArray=new $r,this.opacityVertexArray=new ys,this.placedSymbolArray=new Be}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(r,u,f,g){this.isEmpty()||(f&&(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,ZC.members),this.indexBuffer=r.createIndexBuffer(this.indexArray,u),this.dynamicLayoutVertexBuffer=r.createVertexBuffer(this.dynamicLayoutVertexArray,XC.members,!0),this.opacityVertexBuffer=r.createVertexBuffer(this.opacityVertexArray,TM,!0),this.opacityVertexBuffer.itemSize=1),(f||g)&&this.programConfigurations.upload(r))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}ct("SymbolBuffers",E_);class T_{constructor(r,u,f){this.layoutVertexArray=new r,this.layoutAttributes=u,this.indexArray=new f,this.segments=new jt,this.collisionVertexArray=new Cr}upload(r){this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=r.createVertexBuffer(this.collisionVertexArray,YC.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}ct("CollisionBuffers",T_);class Mc{constructor(r){this.collisionBoxArray=r.collisionBoxArray,this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(b=>b.id),this.index=r.index,this.pixelRatio=r.pixelRatio,this.sourceLayerIndex=r.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=n_([]),this.placementViewportMatrix=n_([]);const u=this.layers[0]._unevaluatedLayout._values;this.textSizeData=V1(this.zoom,u["text-size"]),this.iconSizeData=V1(this.zoom,u["icon-size"]);const f=this.layers[0].layout,g=f.get("symbol-sort-key"),v=f.get("symbol-z-order");this.canOverlap=A_(f,"text-overlap","text-allow-overlap")!=="never"||A_(f,"icon-overlap","icon-allow-overlap")!=="never"||f.get("text-ignore-placement")||f.get("icon-ignore-placement"),this.sortFeaturesByKey=v!=="viewport-y"&&!g.isConstant(),this.sortFeaturesByY=(v==="viewport-y"||v==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,f.get("symbol-placement")==="point"&&(this.writingModes=f.get("text-writing-mode").map(b=>l.WritingMode[b])),this.stateDependentLayerIds=this.layers.filter(b=>b.isStateDependent()).map(b=>b.id),this.sourceID=r.sourceID}createArrays(){this.text=new E_(new bl(this.layers,this.zoom,r=>/^text/.test(r))),this.icon=new E_(new bl(this.layers,this.zoom,r=>/^icon/.test(r))),this.glyphOffsetArray=new Ze,this.lineVertexArray=new st,this.symbolInstances=new nt}calculateGlyphDependencies(r,u,f,g,v){for(let b=0;b<r.length;b++)if(u[r.charCodeAt(b)]=!0,(f||g)&&v){const T=Mh[r.charAt(b)];T&&(u[T.charCodeAt(0)]=!0)}}populate(r,u,f){const g=this.layers[0],v=g.layout,b=v.get("text-font"),T=v.get("text-field"),A=v.get("icon-image"),L=(T.value.kind!=="constant"||T.value.value instanceof de&&!T.value.value.isEmpty()||T.value.value.toString().length>0)&&(b.value.kind!=="constant"||b.value.value.length>0),z=A.value.kind!=="constant"||!!A.value.value||Object.keys(A.parameters).length>0,F=v.get("symbol-sort-key");if(this.features=[],!L&&!z)return;const j=u.iconDependencies,X=u.glyphDependencies,Y=u.availableImages,le=new An(this.zoom);for(const{feature:oe,id:ve,index:Se,sourceLayerIndex:ye}of r){const Ee=g._featureFilter.needGeometry,Oe=El(oe,Ee);if(!g._featureFilter.filter(le,Oe,f))continue;let ze,ot;if(Ee||(Oe.geometry=wl(oe)),L){const et=g.getValueAndResolveTokens("text-field",Oe,f,Y),Xe=de.factory(et);SM(Xe)&&(this.hasRTLText=!0),(!this.hasRTLText||yl()==="unavailable"||this.hasRTLText&&Ir.isParsed())&&(ze=JC(Xe,g,Oe))}if(z){const et=g.getValueAndResolveTokens("icon-image",Oe,f,Y);ot=et instanceof me?et:me.fromString(et)}if(!ze&&!ot)continue;const dt=this.sortFeaturesByKey?F.evaluate(Oe,{},f):void 0;if(this.features.push({id:ve,text:ze,icon:ot,index:Se,sourceLayerIndex:ye,geometry:Oe.geometry,properties:oe.properties,type:EM[oe.type],sortKey:dt}),ot&&(j[ot.name]=!0),ze){const et=b.evaluate(Oe,{},f).join(","),Xe=v.get("text-rotation-alignment")!=="viewport"&&v.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(l.WritingMode.vertical)>=0;for(const We of ze.sections)if(We.image)j[We.image.name]=!0;else{const tt=yc(ze.toString()),Ye=We.fontStack||et,Ve=X[Ye]=X[Ye]||{};this.calculateGlyphDependencies(We.text,Ve,Xe,this.allowVerticalPlacement,tt)}}}v.get("symbol-placement")==="line"&&(this.features=function(oe){const ve={},Se={},ye=[];let Ee=0;function Oe(et){ye.push(oe[et]),Ee++}function ze(et,Xe,We){const tt=Se[et];return delete Se[et],Se[Xe]=tt,ye[tt].geometry[0].pop(),ye[tt].geometry[0]=ye[tt].geometry[0].concat(We[0]),tt}function ot(et,Xe,We){const tt=ve[Xe];return delete ve[Xe],ve[et]=tt,ye[tt].geometry[0].shift(),ye[tt].geometry[0]=We[0].concat(ye[tt].geometry[0]),tt}function dt(et,Xe,We){const tt=We?Xe[0][Xe[0].length-1]:Xe[0][0];return`${et}:${tt.x}:${tt.y}`}for(let et=0;et<oe.length;et++){const Xe=oe[et],We=Xe.geometry,tt=Xe.text?Xe.text.toString():null;if(!tt){Oe(et);continue}const Ye=dt(tt,We),Ve=dt(tt,We,!0);if(Ye in Se&&Ve in ve&&Se[Ye]!==ve[Ve]){const wt=ot(Ye,Ve,We),_t=ze(Ye,Ve,ye[wt].geometry);delete ve[Ye],delete Se[Ve],Se[dt(tt,ye[_t].geometry,!0)]=_t,ye[wt].geometry=null}else Ye in Se?ze(Ye,Ve,We):Ve in ve?ot(Ye,Ve,We):(Oe(et),ve[Ye]=Ee-1,Se[Ve]=Ee-1)}return ye.filter(et=>et.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((oe,ve)=>oe.sortKey-ve.sortKey)}update(r,u,f){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(r,u,this.layers,f),this.icon.programConfigurations.updatePaintArrays(r,u,this.layers,f))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(r){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(r),this.iconCollisionBox.upload(r)),this.text.upload(r,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(r,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(r,u){const f=this.lineVertexArray.length;if(r.segment!==void 0){let g=r.dist(u[r.segment+1]),v=r.dist(u[r.segment]);const b={};for(let T=r.segment+1;T<u.length;T++)b[T]={x:u[T].x,y:u[T].y,tileUnitDistanceFromAnchor:g},T<u.length-1&&(g+=u[T+1].dist(u[T]));for(let T=r.segment||0;T>=0;T--)b[T]={x:u[T].x,y:u[T].y,tileUnitDistanceFromAnchor:v},T>0&&(v+=u[T-1].dist(u[T]));for(let T=0;T<u.length;T++){const A=b[T];this.lineVertexArray.emplaceBack(A.x,A.y,A.tileUnitDistanceFromAnchor)}}return{lineStartIndex:f,lineLength:this.lineVertexArray.length-f}}addSymbols(r,u,f,g,v,b,T,A,L,z,F,j){const X=r.indexArray,Y=r.layoutVertexArray,le=r.segments.prepareSegment(4*u.length,Y,X,this.canOverlap?b.sortKey:void 0),oe=this.glyphOffsetArray.length,ve=le.vertexLength,Se=this.allowVerticalPlacement&&T===l.WritingMode.vertical?Math.PI/2:0,ye=b.text&&b.text.sections;for(let Ee=0;Ee<u.length;Ee++){const{tl:Oe,tr:ze,bl:ot,br:dt,tex:et,pixelOffsetTL:Xe,pixelOffsetBR:We,minFontScaleX:tt,minFontScaleY:Ye,glyphOffset:Ve,isSDF:wt,sectionIndex:_t}=u[Ee],Ft=le.vertexLength,En=Ve[1];sp(Y,A.x,A.y,Oe.x,En+Oe.y,et.x,et.y,f,wt,Xe.x,Xe.y,tt,Ye),sp(Y,A.x,A.y,ze.x,En+ze.y,et.x+et.w,et.y,f,wt,We.x,Xe.y,tt,Ye),sp(Y,A.x,A.y,ot.x,En+ot.y,et.x,et.y+et.h,f,wt,Xe.x,We.y,tt,Ye),sp(Y,A.x,A.y,dt.x,En+dt.y,et.x+et.w,et.y+et.h,f,wt,We.x,We.y,tt,Ye),w_(r.dynamicLayoutVertexArray,A,Se),X.emplaceBack(Ft,Ft+1,Ft+2),X.emplaceBack(Ft+1,Ft+2,Ft+3),le.vertexLength+=4,le.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ve[0]),Ee!==u.length-1&&_t===u[Ee+1].sectionIndex||r.programConfigurations.populatePaintArrays(Y.length,b,b.index,{},j,ye&&ye[_t])}r.placedSymbolArray.emplaceBack(A.x,A.y,oe,this.glyphOffsetArray.length-oe,ve,L,z,A.segment,f?f[0]:0,f?f[1]:0,g[0],g[1],T,0,!1,0,F)}_addCollisionDebugVertex(r,u,f,g,v,b){return u.emplaceBack(0,0),r.emplaceBack(f.x,f.y,g,v,Math.round(b.x),Math.round(b.y))}addCollisionDebugVertices(r,u,f,g,v,b,T){const A=v.segments.prepareSegment(4,v.layoutVertexArray,v.indexArray),L=A.vertexLength,z=v.layoutVertexArray,F=v.collisionVertexArray,j=T.anchorX,X=T.anchorY;this._addCollisionDebugVertex(z,F,b,j,X,new Tt(r,u)),this._addCollisionDebugVertex(z,F,b,j,X,new Tt(f,u)),this._addCollisionDebugVertex(z,F,b,j,X,new Tt(f,g)),this._addCollisionDebugVertex(z,F,b,j,X,new Tt(r,g)),A.vertexLength+=4;const Y=v.indexArray;Y.emplaceBack(L,L+1),Y.emplaceBack(L+1,L+2),Y.emplaceBack(L+2,L+3),Y.emplaceBack(L+3,L),A.primitiveLength+=4}addDebugCollisionBoxes(r,u,f,g){for(let v=r;v<u;v++){const b=this.collisionBoxArray.get(v);this.addCollisionDebugVertices(b.x1,b.y1,b.x2,b.y2,g?this.textCollisionBox:this.iconCollisionBox,b.anchorPoint,f)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new T_(ao,P1.members,Os),this.iconCollisionBox=new T_(ao,P1.members,Os);for(let r=0;r<this.symbolInstances.length;r++){const u=this.symbolInstances.get(r);this.addDebugCollisionBoxes(u.textBoxStartIndex,u.textBoxEndIndex,u,!0),this.addDebugCollisionBoxes(u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u,!0),this.addDebugCollisionBoxes(u.iconBoxStartIndex,u.iconBoxEndIndex,u,!1),this.addDebugCollisionBoxes(u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex,u,!1)}}_deserializeCollisionBoxesForSymbol(r,u,f,g,v,b,T,A,L){const z={};for(let F=u;F<f;F++){const j=r.get(F);z.textBox={x1:j.x1,y1:j.y1,x2:j.x2,y2:j.y2,anchorPointX:j.anchorPointX,anchorPointY:j.anchorPointY},z.textFeatureIndex=j.featureIndex;break}for(let F=g;F<v;F++){const j=r.get(F);z.verticalTextBox={x1:j.x1,y1:j.y1,x2:j.x2,y2:j.y2,anchorPointX:j.anchorPointX,anchorPointY:j.anchorPointY},z.verticalTextFeatureIndex=j.featureIndex;break}for(let F=b;F<T;F++){const j=r.get(F);z.iconBox={x1:j.x1,y1:j.y1,x2:j.x2,y2:j.y2,anchorPointX:j.anchorPointX,anchorPointY:j.anchorPointY},z.iconFeatureIndex=j.featureIndex;break}for(let F=A;F<L;F++){const j=r.get(F);z.verticalIconBox={x1:j.x1,y1:j.y1,x2:j.x2,y2:j.y2,anchorPointX:j.anchorPointX,anchorPointY:j.anchorPointY},z.verticalIconFeatureIndex=j.featureIndex;break}return z}deserializeCollisionBoxes(r){this.collisionArrays=[];for(let u=0;u<this.symbolInstances.length;u++){const f=this.symbolInstances.get(u);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(r,f.textBoxStartIndex,f.textBoxEndIndex,f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f.iconBoxStartIndex,f.iconBoxEndIndex,f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(r,u){const f=r.placedSymbolArray.get(u),g=f.vertexStartIndex+4*f.numGlyphs;for(let v=f.vertexStartIndex;v<g;v+=4)r.indexArray.emplaceBack(v,v+1,v+2),r.indexArray.emplaceBack(v+1,v+2,v+3)}getSortedSymbolIndexes(r){if(this.sortedAngle===r&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const u=Math.sin(r),f=Math.cos(r),g=[],v=[],b=[];for(let T=0;T<this.symbolInstances.length;++T){b.push(T);const A=this.symbolInstances.get(T);g.push(0|Math.round(u*A.anchorX+f*A.anchorY)),v.push(A.featureIndex)}return b.sort((T,A)=>g[T]-g[A]||v[A]-v[T]),b}addToSortKeyRanges(r,u){const f=this.sortKeyRanges[this.sortKeyRanges.length-1];f&&f.sortKey===u?f.symbolInstanceEnd=r+1:this.sortKeyRanges.push({sortKey:u,symbolInstanceStart:r,symbolInstanceEnd:r+1})}sortFeatures(r){if(this.sortFeaturesByY&&this.sortedAngle!==r&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(r),this.sortedAngle=r,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const u of this.symbolInstanceIndexes){const f=this.symbolInstances.get(u);this.featureSortOrder.push(f.featureIndex),[f.rightJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.leftJustifiedTextSymbolIndex].forEach((g,v,b)=>{g>=0&&b.indexOf(g)===v&&this.addIndicesForPlacedSymbol(this.text,g)}),f.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,f.verticalPlacedTextSymbolIndex),f.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,f.placedIconSymbolIndex),f.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,f.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}ct("SymbolBucket",Mc,{omit:["layers","collisionBoxArray","features","compareText"]}),Mc.MAX_GLYPHS=65535,Mc.addDynamicAttributes=w_;const AM=new xi({"symbol-placement":new mt(Le.layout_symbol["symbol-placement"]),"symbol-spacing":new mt(Le.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new mt(Le.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new St(Le.layout_symbol["symbol-sort-key"]),"symbol-z-order":new mt(Le.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new mt(Le.layout_symbol["icon-allow-overlap"]),"icon-overlap":new mt(Le.layout_symbol["icon-overlap"]),"icon-ignore-placement":new mt(Le.layout_symbol["icon-ignore-placement"]),"icon-optional":new mt(Le.layout_symbol["icon-optional"]),"icon-rotation-alignment":new mt(Le.layout_symbol["icon-rotation-alignment"]),"icon-size":new St(Le.layout_symbol["icon-size"]),"icon-text-fit":new mt(Le.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new mt(Le.layout_symbol["icon-text-fit-padding"]),"icon-image":new St(Le.layout_symbol["icon-image"]),"icon-rotate":new St(Le.layout_symbol["icon-rotate"]),"icon-padding":new St(Le.layout_symbol["icon-padding"]),"icon-keep-upright":new mt(Le.layout_symbol["icon-keep-upright"]),"icon-offset":new St(Le.layout_symbol["icon-offset"]),"icon-anchor":new St(Le.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new mt(Le.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new mt(Le.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new mt(Le.layout_symbol["text-rotation-alignment"]),"text-field":new St(Le.layout_symbol["text-field"]),"text-font":new St(Le.layout_symbol["text-font"]),"text-size":new St(Le.layout_symbol["text-size"]),"text-max-width":new St(Le.layout_symbol["text-max-width"]),"text-line-height":new mt(Le.layout_symbol["text-line-height"]),"text-letter-spacing":new St(Le.layout_symbol["text-letter-spacing"]),"text-justify":new St(Le.layout_symbol["text-justify"]),"text-radial-offset":new St(Le.layout_symbol["text-radial-offset"]),"text-variable-anchor":new mt(Le.layout_symbol["text-variable-anchor"]),"text-anchor":new St(Le.layout_symbol["text-anchor"]),"text-max-angle":new mt(Le.layout_symbol["text-max-angle"]),"text-writing-mode":new mt(Le.layout_symbol["text-writing-mode"]),"text-rotate":new St(Le.layout_symbol["text-rotate"]),"text-padding":new mt(Le.layout_symbol["text-padding"]),"text-keep-upright":new mt(Le.layout_symbol["text-keep-upright"]),"text-transform":new St(Le.layout_symbol["text-transform"]),"text-offset":new St(Le.layout_symbol["text-offset"]),"text-allow-overlap":new mt(Le.layout_symbol["text-allow-overlap"]),"text-overlap":new mt(Le.layout_symbol["text-overlap"]),"text-ignore-placement":new mt(Le.layout_symbol["text-ignore-placement"]),"text-optional":new mt(Le.layout_symbol["text-optional"])});var S_={paint:new xi({"icon-opacity":new St(Le.paint_symbol["icon-opacity"]),"icon-color":new St(Le.paint_symbol["icon-color"]),"icon-halo-color":new St(Le.paint_symbol["icon-halo-color"]),"icon-halo-width":new St(Le.paint_symbol["icon-halo-width"]),"icon-halo-blur":new St(Le.paint_symbol["icon-halo-blur"]),"icon-translate":new mt(Le.paint_symbol["icon-translate"]),"icon-translate-anchor":new mt(Le.paint_symbol["icon-translate-anchor"]),"text-opacity":new St(Le.paint_symbol["text-opacity"]),"text-color":new St(Le.paint_symbol["text-color"],{runtimeType:ti,getOverride:a=>a.textColor,hasOverride:a=>!!a.textColor}),"text-halo-color":new St(Le.paint_symbol["text-halo-color"]),"text-halo-width":new St(Le.paint_symbol["text-halo-width"]),"text-halo-blur":new St(Le.paint_symbol["text-halo-blur"]),"text-translate":new mt(Le.paint_symbol["text-translate"]),"text-translate-anchor":new mt(Le.paint_symbol["text-translate-anchor"])}),layout:AM};class Q1{constructor(r){if(r.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=r.property.overrides?r.property.overrides.runtimeType:fs,this.defaultValue=r}evaluate(r){if(r.formattedSection){const u=this.defaultValue.property.overrides;if(u&&u.hasOverride(r.formattedSection))return u.getOverride(r.formattedSection)}return r.feature&&r.featureState?this.defaultValue.evaluate(r.feature,r.featureState):this.defaultValue.property.specification.default}eachChild(r){this.defaultValue.isConstant()||r(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}ct("FormatSectionOverride",Q1,{omit:["defaultValue"]});class op extends gs{constructor(r){super(r,S_)}recalculate(r,u){if(super.recalculate(r,u),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const f=this.layout.get("text-writing-mode");if(f){const g=[];for(const v of f)g.indexOf(v)<0&&g.push(v);this.layout._values["text-writing-mode"]=g}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(r,u,f,g){const v=this.layout.get(r).evaluate(u,{},f,g),b=this._unevaluatedLayout._values[r];return b.isDataDriven()||sl(b.value)||!v?v:function(T,A){return A.replace(/{([^{}]+)}/g,(L,z)=>z in T?String(T[z]):"")}(u.properties,v)}createBucket(r){return new Mc(r)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const r of S_.paint.overridableProperties){if(!op.hasPaintOverride(this.layout,r))continue;const u=this.paint.get(r),f=new Q1(u),g=new dc(f,u.property.specification);let v=null;v=u.value.kind==="constant"||u.value.kind==="source"?new al("source",g):new rh("composite",g,u.value.zoomStops),this.paint._values[r]=new ms(u.property,v,u.parameters)}}_handleOverridablePaintPropertyUpdate(r,u,f){return!(!this.layout||u.isDataDriven()||f.isDataDriven())&&op.hasPaintOverride(this.layout,r)}static hasPaintOverride(r,u){const f=r.get("text-field"),g=S_.paint.properties[u];let v=!1;const b=T=>{for(const A of T)if(g.overrides&&g.overrides.hasOverride(A))return void(v=!0)};if(f.value.kind==="constant"&&f.value.value instanceof de)b(f.value.value.sections);else if(f.value.kind==="source"){const T=L=>{v||(L instanceof ht&&Ie(L.value)===Zn?b(L.value.sections):L instanceof uc?b(L.sections):L.eachChild(T))},A=f.value;A._styleExpression&&T(A._styleExpression.expression)}return v}}function A_(a,r,u){let f="never";const g=a.get(r);return g?f=g:a.get(u)&&(f="always"),f}var PM={paint:new xi({"background-color":new mt(Le.paint_background["background-color"]),"background-pattern":new gh(Le.paint_background["background-pattern"]),"background-opacity":new mt(Le.paint_background["background-opacity"])})},IM={paint:new xi({"raster-opacity":new mt(Le.paint_raster["raster-opacity"]),"raster-hue-rotate":new mt(Le.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new mt(Le.paint_raster["raster-brightness-min"]),"raster-brightness-max":new mt(Le.paint_raster["raster-brightness-max"]),"raster-saturation":new mt(Le.paint_raster["raster-saturation"]),"raster-contrast":new mt(Le.paint_raster["raster-contrast"]),"raster-resampling":new mt(Le.paint_raster["raster-resampling"]),"raster-fade-duration":new mt(Le.paint_raster["raster-fade-duration"])})};class CM extends gs{constructor(r){super(r,{}),this.onAdd=u=>{this.implementation.onAdd&&this.implementation.onAdd(u,u.painter.context.gl)},this.onRemove=u=>{this.implementation.onRemove&&this.implementation.onRemove(u,u.painter.context.gl)},this.implementation=r}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}const MM={circle:class extends gs{constructor(a){super(a,aC)}createBucket(a){return new Qg(a)}queryRadius(a){const r=a;return bh("circle-radius",this,r)+bh("circle-stroke-width",this,r)+Gf(this.paint.get("circle-translate"))}queryIntersectsFeature(a,r,u,f,g,v,b,T){const A=Wf(a,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),v.angle,b),L=this.paint.get("circle-radius").evaluate(r,u)+this.paint.get("circle-stroke-width").evaluate(r,u),z=this.paint.get("circle-pitch-alignment")==="map",F=z?A:function(X,Y){return X.map(le=>u1(le,Y))}(A,T),j=z?L*b:L;for(const X of f)for(const Y of X){const le=z?Y:u1(Y,T);let oe=j;const ve=Hf([],[Y.x,Y.y,0,1],T);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?oe*=ve[3]/v.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(oe*=v.cameraToCenterDistance/ve[3]),nC(F,le,oe))return!0}return!1}},heatmap:class extends gs{constructor(a){super(a,cC),this._updateColorRamp()}createBucket(a){return new h1(a)}_handleSpecialPaintPropertyUpdate(a){a==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=f1({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}},hillshade:class extends gs{constructor(a){super(a,uC)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}},fill:class extends gs{constructor(a){super(a,AC)}recalculate(a,r){super.recalculate(a,r);const u=this.paint._values["fill-outline-color"];u.value.kind==="constant"&&u.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(a){return new h_(a)}queryRadius(){return Gf(this.paint.get("fill-translate"))}queryIntersectsFeature(a,r,u,f,g,v,b){return n1(Wf(a,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),v.angle,b),f)}isTileClipped(){return!0}},"fill-extrusion":class extends gs{constructor(a){super(a,UC)}createBucket(a){return new f_(a)}queryRadius(){return Gf(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(a,r,u,f,g,v,b,T){const A=Wf(a,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),v.angle,b),L=this.paint.get("fill-extrusion-height").evaluate(r,u),z=this.paint.get("fill-extrusion-base").evaluate(r,u),F=function(X,Y,le,oe){const ve=[];for(const Se of X){const ye=[Se.x,Se.y,0,1];Hf(ye,ye,Y),ve.push(new Tt(ye[0]/ye[3],ye[1]/ye[3]))}return ve}(A,T),j=function(X,Y,le,oe){const ve=[],Se=[],ye=oe[8]*Y,Ee=oe[9]*Y,Oe=oe[10]*Y,ze=oe[11]*Y,ot=oe[8]*le,dt=oe[9]*le,et=oe[10]*le,Xe=oe[11]*le;for(const We of X){const tt=[],Ye=[];for(const Ve of We){const wt=Ve.x,_t=Ve.y,Ft=oe[0]*wt+oe[4]*_t+oe[12],En=oe[1]*wt+oe[5]*_t+oe[13],In=oe[2]*wt+oe[6]*_t+oe[14],si=oe[3]*wt+oe[7]*_t+oe[15],Xr=In+Oe,Ci=si+ze,Yn=Ft+ot,pi=En+dt,Mi=In+et,Ui=si+Xe,mr=new Tt((Ft+ye)/Ci,(En+Ee)/Ci);mr.z=Xr/Ci,tt.push(mr);const Kn=new Tt(Yn/Ui,pi/Ui);Kn.z=Mi/Ui,Ye.push(Kn)}ve.push(tt),Se.push(Ye)}return[ve,Se]}(f,z,L,T);return function(X,Y,le){let oe=1/0;n1(le,Y)&&(oe=w1(le,Y[0]));for(let ve=0;ve<Y.length;ve++){const Se=Y[ve],ye=X[ve];for(let Ee=0;Ee<Se.length-1;Ee++){const Oe=Se[Ee],ze=[Oe,Se[Ee+1],ye[Ee+1],ye[Ee],Oe];t1(le,ze)&&(oe=Math.min(oe,w1(le,ze)))}}return oe!==1/0&&oe}(j[0],j[1],F)}},line:class extends gs{constructor(a){super(a,T1),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(a){a==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Cn,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER)}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(a,r){super.recalculate(a,r),this.paint._values["line-floorwidth"]=S1.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,a)}createBucket(a){return new p_(a)}queryRadius(a){const r=a,u=A1(bh("line-width",this,r),bh("line-gap-width",this,r)),f=bh("line-offset",this,r);return u/2+Math.abs(f)+Gf(this.paint.get("line-translate"))}queryIntersectsFeature(a,r,u,f,g,v,b){const T=Wf(a,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),v.angle,b),A=b/2*A1(this.paint.get("line-width").evaluate(r,u),this.paint.get("line-gap-width").evaluate(r,u)),L=this.paint.get("line-offset").evaluate(r,u);return L&&(f=function(z,F){const j=[];for(let X=0;X<z.length;X++){const Y=z[X],le=[];for(let oe=0;oe<Y.length;oe++){const ve=Y[oe-1],Se=Y[oe],ye=Y[oe+1],Ee=oe===0?new Tt(0,0):Se.sub(ve)._unit()._perp(),Oe=oe===Y.length-1?new Tt(0,0):ye.sub(Se)._unit()._perp(),ze=Ee._add(Oe)._unit(),ot=ze.x*Oe.x+ze.y*Oe.y;ot!==0&&ze._mult(1/ot),le.push(ze._mult(F)._add(Se))}j.push(le)}return j}(f,L*b)),function(z,F,j){for(let X=0;X<F.length;X++){const Y=F[X];if(z.length>=3){for(let le=0;le<Y.length;le++)if(Ec(z,Y[le]))return!0}if(iC(z,Y,j))return!0}return!1}(T,f,A)}isTileClipped(){return!0}},symbol:op,background:class extends gs{constructor(a){super(a,PM)}},raster:class extends gs{constructor(a){super(a,IM)}}};class LM{constructor(r){this._callback=r,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const eb=63710088e-1;class Nn{constructor(r,u){if(isNaN(r)||isNaN(u))throw new Error(`Invalid LngLat object: (${r}, ${u})`);if(this.lng=+r,this.lat=+u,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Nn(D(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(r){const u=Math.PI/180,f=this.lat*u,g=r.lat*u,v=Math.sin(f)*Math.sin(g)+Math.cos(f)*Math.cos(g)*Math.cos((r.lng-this.lng)*u);return eb*Math.acos(Math.min(v,1))}toBounds(r=0){const u=360*r/40075017,f=u/Math.cos(Math.PI/180*this.lat);return new Sl(new Nn(this.lng-f,this.lat-u),new Nn(this.lng+f,this.lat+u))}static convert(r){if(r instanceof Nn)return r;if(Array.isArray(r)&&(r.length===2||r.length===3))return new Nn(Number(r[0]),Number(r[1]));if(!Array.isArray(r)&&typeof r=="object"&&r!==null)return new Nn(Number("lng"in r?r.lng:r.lon),Number(r.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class Sl{constructor(r,u){r&&(u?this.setSouthWest(r).setNorthEast(u):r.length===4?this.setSouthWest([r[0],r[1]]).setNorthEast([r[2],r[3]]):this.setSouthWest(r[0]).setNorthEast(r[1]))}setNorthEast(r){return this._ne=r instanceof Nn?new Nn(r.lng,r.lat):Nn.convert(r),this}setSouthWest(r){return this._sw=r instanceof Nn?new Nn(r.lng,r.lat):Nn.convert(r),this}extend(r){const u=this._sw,f=this._ne;let g,v;if(r instanceof Nn)g=r,v=r;else{if(!(r instanceof Sl))return Array.isArray(r)?r.length===4||r.every(Array.isArray)?this.extend(Sl.convert(r)):this.extend(Nn.convert(r)):this;if(g=r._sw,v=r._ne,!g||!v)return this}return u||f?(u.lng=Math.min(g.lng,u.lng),u.lat=Math.min(g.lat,u.lat),f.lng=Math.max(v.lng,f.lng),f.lat=Math.max(v.lat,f.lat)):(this._sw=new Nn(g.lng,g.lat),this._ne=new Nn(v.lng,v.lat)),this}getCenter(){return new Nn((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Nn(this.getWest(),this.getNorth())}getSouthEast(){return new Nn(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(r){const{lng:u,lat:f}=Nn.convert(r);let g=this._sw.lng<=u&&u<=this._ne.lng;return this._sw.lng>this._ne.lng&&(g=this._sw.lng>=u&&u>=this._ne.lng),this._sw.lat<=f&&f<=this._ne.lat&&g}static convert(r){return r instanceof Sl?r:r&&new Sl(r)}}const tb=2*Math.PI*eb;function nb(a){return tb*Math.cos(a*Math.PI/180)}function ib(a){return(180+a)/360}function rb(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function sb(a,r){return a/nb(r)}function P_(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}class ap{constructor(r,u,f=0){this.x=+r,this.y=+u,this.z=+f}static fromLngLat(r,u=0){const f=Nn.convert(r);return new ap(ib(f.lng),rb(f.lat),sb(u,f.lat))}toLngLat(){return new Nn(360*this.x-180,P_(this.y))}toAltitude(){return this.z*nb(P_(this.y))}meterInMercatorCoordinateUnits(){return 1/tb*(r=P_(this.y),1/Math.cos(r*Math.PI/180));var r}}function ob(a,r,u){var f=2*Math.PI*6378137/256/Math.pow(2,u);return[a*f-2*Math.PI*6378137/2,r*f-2*Math.PI*6378137/2]}class I_{constructor(r,u,f){if(r<0||r>25||f<0||f>=Math.pow(2,r)||u<0||u>=Math.pow(2,r))throw new Error(`x=${u}, y=${f}, z=${r} outside of bounds. 0<=x<${Math.pow(2,r)}, 0<=y<${Math.pow(2,r)} 0<=z<=25 `);this.z=r,this.x=u,this.y=f,this.key=kh(0,r,r,u,f)}equals(r){return this.z===r.z&&this.x===r.x&&this.y===r.y}url(r,u,f){const g=(b=this.y,T=this.z,A=ob(256*(v=this.x),256*(b=Math.pow(2,T)-b-1),T),L=ob(256*(v+1),256*(b+1),T),A[0]+","+A[1]+","+L[0]+","+L[1]);var v,b,T,A,L;const z=function(F,j,X){let Y,le="";for(let oe=F;oe>0;oe--)Y=1<<oe-1,le+=(j&Y?1:0)+(X&Y?2:0);return le}(this.z,this.x,this.y);return r[(this.x+this.y)%r.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(f==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,u>1?"@2x":"").replace(/{quadkey}/g,z).replace(/{bbox-epsg-3857}/g,g)}isChildOf(r){const u=this.z-r.z;return u>0&&r.x===this.x>>u&&r.y===this.y>>u}getTilePoint(r){const u=Math.pow(2,this.z);return new Tt((r.x*u-this.x)*ri,(r.y*u-this.y)*ri)}toString(){return`${this.z}/${this.x}/${this.y}`}}class ab{constructor(r,u){this.wrap=r,this.canonical=u,this.key=kh(r,u.z,u.z,u.x,u.y)}}class Zr{constructor(r,u,f,g,v){if(r<f)throw new Error(`overscaledZ should be >= z; overscaledZ = ${r}; z = ${f}`);this.overscaledZ=r,this.wrap=u,this.canonical=new I_(f,+g,+v),this.key=kh(u,r,f,g,v)}clone(){return new Zr(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(r){return this.overscaledZ===r.overscaledZ&&this.wrap===r.wrap&&this.canonical.equals(r.canonical)}scaledTo(r){if(r>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${r}; overscaledZ = ${this.overscaledZ}`);const u=this.canonical.z-r;return r>this.canonical.z?new Zr(r,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Zr(r,this.wrap,r,this.canonical.x>>u,this.canonical.y>>u)}calculateScaledKey(r,u){if(r>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${r}; overscaledZ = ${this.overscaledZ}`);const f=this.canonical.z-r;return r>this.canonical.z?kh(this.wrap*+u,r,this.canonical.z,this.canonical.x,this.canonical.y):kh(this.wrap*+u,r,r,this.canonical.x>>f,this.canonical.y>>f)}isChildOf(r){if(r.wrap!==this.wrap)return!1;const u=this.canonical.z-r.canonical.z;return r.overscaledZ===0||r.overscaledZ<this.overscaledZ&&r.canonical.x===this.canonical.x>>u&&r.canonical.y===this.canonical.y>>u}children(r){if(this.overscaledZ>=r)return[new Zr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const u=this.canonical.z+1,f=2*this.canonical.x,g=2*this.canonical.y;return[new Zr(u,this.wrap,u,f,g),new Zr(u,this.wrap,u,f+1,g),new Zr(u,this.wrap,u,f,g+1),new Zr(u,this.wrap,u,f+1,g+1)]}isLessThan(r){return this.wrap<r.wrap||!(this.wrap>r.wrap)&&(this.overscaledZ<r.overscaledZ||!(this.overscaledZ>r.overscaledZ)&&(this.canonical.x<r.canonical.x||!(this.canonical.x>r.canonical.x)&&this.canonical.y<r.canonical.y))}wrapped(){return new Zr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(r){return new Zr(this.overscaledZ,r,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new ab(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(r){return this.canonical.getTilePoint(new ap(r.x-this.wrap,r.y))}}function kh(a,r,u,f,g){(a*=2)<0&&(a=-1*a-1);const v=1<<u;return(v*v*a+v*g+f).toString(36)+u.toString(36)+r.toString(36)}ct("CanonicalTileID",I_),ct("OverscaledTileID",Zr,{omit:["posMatrix"]});class lb{constructor(r,u,f){if(this.uid=r,u.height!==u.width)throw new RangeError("DEM tiles must be square");if(f&&f!=="mapbox"&&f!=="terrarium")return void ge(`"${f}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=u.height;const g=this.dim=u.height-2;this.data=new Uint32Array(u.data.buffer),this.encoding=f||"mapbox";for(let v=0;v<g;v++)this.data[this._idx(-1,v)]=this.data[this._idx(0,v)],this.data[this._idx(g,v)]=this.data[this._idx(g-1,v)],this.data[this._idx(v,-1)]=this.data[this._idx(v,0)],this.data[this._idx(v,g)]=this.data[this._idx(v,g-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(g,-1)]=this.data[this._idx(g-1,0)],this.data[this._idx(-1,g)]=this.data[this._idx(0,g-1)],this.data[this._idx(g,g)]=this.data[this._idx(g-1,g-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let v=0;v<g;v++)for(let b=0;b<g;b++){const T=this.get(v,b);T>this.max&&(this.max=T),T<this.min&&(this.min=T)}}get(r,u){const f=new Uint8Array(this.data.buffer),g=4*this._idx(r,u);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(f[g],f[g+1],f[g+2])}getUnpackVector(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]}_idx(r,u){if(r<-1||r>=this.dim+1||u<-1||u>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(u+1)*this.stride+(r+1)}_unpackMapbox(r,u,f){return(256*r*256+256*u+f)/10-1e4}_unpackTerrarium(r,u,f){return 256*r+u+f/256-32768}getPixels(){return new qr({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(r,u,f){if(this.dim!==r.dim)throw new Error("dem dimension mismatch");let g=u*this.dim,v=u*this.dim+this.dim,b=f*this.dim,T=f*this.dim+this.dim;switch(u){case-1:g=v-1;break;case 1:v=g+1}switch(f){case-1:b=T-1;break;case 1:T=b+1}const A=-u*this.dim,L=-f*this.dim;for(let z=b;z<T;z++)for(let F=g;F<v;F++)this.data[this._idx(F,z)]=r.data[this._idx(F+A,z+L)]}}ct("DEMData",lb);class cb{constructor(r){this._stringToNumber={},this._numberToString=[];for(let u=0;u<r.length;u++){const f=r[u];this._stringToNumber[f]=u,this._numberToString[u]=f}}encode(r){return this._stringToNumber[r]}decode(r){if(r>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${r} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[r]}}class ub{constructor(r,u,f,g,v){this.type="Feature",this._vectorTileFeature=r,r._z=u,r._x=f,r._y=g,this.properties=r.properties,this.id=v}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(r){this._geometry=r}toJSON(){const r={geometry:this.geometry};for(const u in this)u!=="_geometry"&&u!=="_vectorTileFeature"&&(r[u]=this[u]);return r}}class hb{constructor(r,u){this.tileID=r,this.x=r.canonical.x,this.y=r.canonical.y,this.z=r.canonical.z,this.grid=new _l(ri,16,0),this.grid3D=new _l(ri,16,0),this.featureIndexArray=new Ot,this.promoteId=u}insert(r,u,f,g,v,b){const T=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(f,g,v);const A=b?this.grid3D:this.grid;for(let L=0;L<u.length;L++){const z=u[L],F=[1/0,1/0,-1/0,-1/0];for(let j=0;j<z.length;j++){const X=z[j];F[0]=Math.min(F[0],X.x),F[1]=Math.min(F[1],X.y),F[2]=Math.max(F[2],X.x),F[3]=Math.max(F[3],X.y)}F[0]<ri&&F[1]<ri&&F[2]>=0&&F[3]>=0&&A.insert(T,F[0],F[1],F[2],F[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new xa.VectorTile(new m_(this.rawTileData)).layers,this.sourceLayerCoder=new cb(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(r,u,f,g){this.loadVTLayers();const v=r.params||{},b=ri/r.tileSize/r.scale,T=mc(v.filter),A=r.queryGeometry,L=r.queryPadding*b,z=fb(A),F=this.grid.query(z.minX-L,z.minY-L,z.maxX+L,z.maxY+L),j=fb(r.cameraQueryGeometry),X=this.grid3D.query(j.minX-L,j.minY-L,j.maxX+L,j.maxY+L,(oe,ve,Se,ye)=>function(Ee,Oe,ze,ot,dt){for(const Xe of Ee)if(Oe<=Xe.x&&ze<=Xe.y&&ot>=Xe.x&&dt>=Xe.y)return!0;const et=[new Tt(Oe,ze),new Tt(Oe,dt),new Tt(ot,dt),new Tt(ot,ze)];if(Ee.length>2){for(const Xe of et)if(Ec(Ee,Xe))return!0}for(let Xe=0;Xe<Ee.length-1;Xe++)if(sC(Ee[Xe],Ee[Xe+1],et))return!0;return!1}(r.cameraQueryGeometry,oe-L,ve-L,Se+L,ye+L));for(const oe of X)F.push(oe);F.sort(kM);const Y={};let le;for(let oe=0;oe<F.length;oe++){const ve=F[oe];if(ve===le)continue;le=ve;const Se=this.featureIndexArray.get(ve);let ye=null;this.loadMatchingFeature(Y,Se.bucketIndex,Se.sourceLayerIndex,Se.featureIndex,T,v.layers,v.availableImages,u,f,g,(Ee,Oe,ze)=>(ye||(ye=wl(Ee)),Oe.queryIntersectsFeature(A,Ee,ze,ye,this.z,r.transform,b,r.pixelPosMatrix)))}return Y}loadMatchingFeature(r,u,f,g,v,b,T,A,L,z,F){const j=this.bucketLayerIDs[u];if(b&&!function(oe,ve){for(let Se=0;Se<oe.length;Se++)if(ve.indexOf(oe[Se])>=0)return!0;return!1}(b,j))return;const X=this.sourceLayerCoder.decode(f),Y=this.vtLayers[X].feature(g);if(v.needGeometry){const oe=El(Y,!0);if(!v.filter(new An(this.tileID.overscaledZ),oe,this.tileID.canonical))return}else if(!v.filter(new An(this.tileID.overscaledZ),Y))return;const le=this.getId(Y,X);for(let oe=0;oe<j.length;oe++){const ve=j[oe];if(b&&b.indexOf(ve)<0)continue;const Se=A[ve];if(!Se)continue;let ye={};le&&z&&(ye=z.getState(Se.sourceLayer||"_geojsonTileLayer",le));const Ee=U({},L[ve]);Ee.paint=db(Ee.paint,Se.paint,Y,ye,T),Ee.layout=db(Ee.layout,Se.layout,Y,ye,T);const Oe=!F||F(Y,Se,ye);if(!Oe)continue;const ze=new ub(Y,this.z,this.x,this.y,le);ze.layer=Ee;let ot=r[ve];ot===void 0&&(ot=r[ve]=[]),ot.push({featureIndex:g,feature:ze,intersectionZ:Oe})}}lookupSymbolFeatures(r,u,f,g,v,b,T,A){const L={};this.loadVTLayers();const z=mc(v);for(const F of r)this.loadMatchingFeature(L,f,g,F,z,b,T,A,u);return L}hasLayer(r){for(const u of this.bucketLayerIDs)for(const f of u)if(r===f)return!0;return!1}getId(r,u){let f=r.id;return this.promoteId&&(f=r.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[u]],typeof f=="boolean"&&(f=Number(f))),f}}function db(a,r,u,f,g){return G(a,(v,b)=>{const T=r instanceof xl?r.get(b):null;return T&&T.evaluate?T.evaluate(u,f,g):T})}function fb(a){let r=1/0,u=1/0,f=-1/0,g=-1/0;for(const v of a)r=Math.min(r,v.x),u=Math.min(u,v.y),f=Math.max(f,v.x),g=Math.max(g,v.y);return{minX:r,minY:u,maxX:f,maxY:g}}function kM(a,r){return r-a}var C_;ct("FeatureIndex",hb,{omit:["rawTileData","sourceLayerCoder"]}),l.PerformanceMarkers=void 0,(C_=l.PerformanceMarkers||(l.PerformanceMarkers={})).create="create",C_.load="load",C_.fullLoad="fullLoad";let lp=null,Rh=[];const M_=1e3/30,RM={mark(a){performance.mark(a)},frame(a){const r=a;lp!=null&&Rh.push(r-lp),lp=r},clearMetrics(){lp=null,Rh=[],performance.clearMeasures("loadTime"),performance.clearMeasures("fullLoadTime");for(const a in l.PerformanceMarkers)performance.clearMarks(l.PerformanceMarkers[a])},getPerformanceMetrics(){performance.measure("loadTime",l.PerformanceMarkers.create,l.PerformanceMarkers.load),performance.measure("fullLoadTime",l.PerformanceMarkers.create,l.PerformanceMarkers.fullLoad);const a=performance.getEntriesByName("loadTime")[0].duration,r=performance.getEntriesByName("fullLoadTime")[0].duration,u=Rh.length,f=1/(Rh.reduce((v,b)=>v+b,0)/u/1e3),g=Rh.filter(v=>v>M_).reduce((v,b)=>v+(b-M_)/M_,0);return{loadTime:a,fullLoadTime:r,fps:f,percentDroppedFrames:g/(u+g)*100}}};l.AJAXError=ei,l.ARRAY_TYPE=Qi,l.Actor=class{constructor(a,r,u){this.target=a,this.parent=r,this.mapId=u,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},ae(["receive","process"],this),this.invoker=new LM(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=Ne()?a:window}send(a,r,u,f,g=!1){const v=Math.round(1e18*Math.random()).toString(36).substring(0,10);u&&(this.callbacks[v]=u);const b=Qt(this.globalScope)?void 0:[];return this.target.postMessage({id:v,type:a,hasCallback:!!u,targetMapId:f,mustQueue:g,sourceMapId:this.mapId,data:Co(r,b)},b),{cancel:()=>{u&&delete this.callbacks[v],this.target.postMessage({id:v,type:"<cancel>",targetMapId:f,sourceMapId:this.mapId})}}}receive(a){const r=a.data,u=r.id;if(u&&(!r.targetMapId||this.mapId===r.targetMapId))if(r.type==="<cancel>"){delete this.tasks[u];const f=this.cancelCallbacks[u];delete this.cancelCallbacks[u],f&&f()}else Ne()||r.mustQueue?(this.tasks[u]=r,this.taskQueue.push(u),this.invoker.trigger()):this.processTask(u,r)}process(){if(!this.taskQueue.length)return;const a=this.taskQueue.shift(),r=this.tasks[a];delete this.tasks[a],this.taskQueue.length&&this.invoker.trigger(),r&&this.processTask(a,r)}processTask(a,r){if(r.type==="<response>"){const u=this.callbacks[a];delete this.callbacks[a],u&&(r.error?u(no(r.error)):u(null,no(r.data)))}else{let u=!1;const f=Qt(this.globalScope)?void 0:[],g=r.hasCallback?(T,A)=>{u=!0,delete this.cancelCallbacks[a],this.target.postMessage({id:a,type:"<response>",sourceMapId:this.mapId,error:T?Co(T):null,data:Co(A,f)},f)}:T=>{u=!0};let v=null;const b=no(r.data);if(this.parent[r.type])v=this.parent[r.type](r.sourceMapId,b,g);else if(this.parent.getWorkerSource){const T=r.type.split(".");v=this.parent.getWorkerSource(r.sourceMapId,T[0],b.source)[T[1]](b,g)}else g(new Error(`Could not find function ${r.type}`));!u&&v&&v.cancel&&(this.cancelCallbacks[a]=v.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},l.AlphaImage=Eh,l.CanonicalTileID=I_,l.CollisionBoxArray=ke,l.CollisionCircleLayoutArray=class extends O{},l.Color=J,l.DEMData=lb,l.DataConstantProperty=mt,l.DictionaryCoder=cb,l.EXTENT=ri,l.ErrorEvent=Ys,l.EvaluationParameters=An,l.Event=Vr,l.Evented=Sr,l.FeatureIndex=hb,l.FillBucket=h_,l.FillExtrusionBucket=f_,l.GeoJSONFeature=ub,l.ImageAtlas=z1,l.ImagePosition=__,l.LineBucket=p_,l.LineStripIndexArray=class extends se{},l.LngLat=Nn,l.LngLatBounds=Sl,l.MercatorCoordinate=ap,l.ONE_EM=bi,l.OverscaledTileID=Zr,l.PerformanceUtils=RM,l.PosArray=bt,l.Properties=xi,l.QuadTriangleArray=class extends q{},l.RGBAImage=qr,l.RasterBoundsArray=class extends m{},l.RequestPerformance=class{constructor(a){this._marks={start:[a.url,"start"].join("#"),end:[a.url,"end"].join("#"),measure:a.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let a=performance.getEntriesByName(this._marks.measure);return a.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),a=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),a}},l.ResourceType=Oi,l.SegmentVector=jt,l.SymbolBucket=Mc,l.Transitionable=Ff,l.TriangleIndexArray=Ki,l.Uniform1f=Ro,l.Uniform1i=class extends ko{constructor(a,r){super(a,r),this.current=0}set(a){this.current!==a&&(this.current=a,this.gl.uniform1i(this.location,a))}},l.Uniform2f=class extends ko{constructor(a,r){super(a,r),this.current=[0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]||(this.current=a,this.gl.uniform2f(this.location,a[0],a[1]))}},l.Uniform3f=class extends ko{constructor(a,r){super(a,r),this.current=[0,0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]||(this.current=a,this.gl.uniform3f(this.location,a[0],a[1],a[2]))}},l.Uniform4f=bc,l.UniformColor=Kx,l.UniformMatrix4f=class extends ko{constructor(a,r){super(a,r),this.current=eC}set(a){if(a[12]!==this.current[12]||a[0]!==this.current[0])return this.current=a,void this.gl.uniformMatrix4fv(this.location,!1,a);for(let r=1;r<16;r++)if(a[r]!==this.current[r]){this.current=a,this.gl.uniformMatrix4fv(this.location,!1,a);break}}},l.UnwrappedTileID=ab,l.ValidationError=qe,l.ZoomHistory=lh,l.add=function(a,r,u){return a[0]=r[0]+u[0],a[1]=r[1]+u[1],a[2]=r[2]+u[2],a},l.addDynamicAttributes=w_,l.asyncAll=function(a,r,u){if(!a.length)return u(null,[]);let f=a.length;const g=new Array(a.length);let v=null;a.forEach((b,T)=>{r(b,(A,L)=>{A&&(v=A),g[T]=L,--f==0&&u(v,g)})})},l.bezier=S,l.bindAll=ae,l.cacheEntryPossiblyAdded=function(a){Ai++,Ai>cr&&(a.getActor().send("enforceCacheSizeLimit",ln),Ai=0)},l.clamp=P,l.clearTileCache=function(a){const r=caches.delete(At);a&&r.catch(a).then(()=>a())},l.clipLine=q1,l.clone=function(a){var r=new Qi(16);return r[0]=a[0],r[1]=a[1],r[2]=a[2],r[3]=a[3],r[4]=a[4],r[5]=a[5],r[6]=a[6],r[7]=a[7],r[8]=a[8],r[9]=a[9],r[10]=a[10],r[11]=a[11],r[12]=a[12],r[13]=a[13],r[14]=a[14],r[15]=a[15],r},l.clone$1=W,l.clone$2=function(a){var r=new Qi(3);return r[0]=a[0],r[1]=a[1],r[2]=a[2],r},l.collisionCircleLayout=KC,l.config=rt,l.copy=function(a,r){return a[0]=r[0],a[1]=r[1],a[2]=r[2],a[3]=r[3],a[4]=r[4],a[5]=r[5],a[6]=r[6],a[7]=r[7],a[8]=r[8],a[9]=r[9],a[10]=r[10],a[11]=r[11],a[12]=r[12],a[13]=r[13],a[14]=r[14],a[15]=r[15],a},l.create=function(){var a=new Qi(16);return Qi!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a},l.create$1=s1,l.createExpression=ol,l.createFilter=mc,l.createLayout=Xn,l.createStyleLayer=function(a){return a.type==="custom"?new CM(a):new MM[a.type](a)},l.cross=function(a,r,u){var f=r[0],g=r[1],v=r[2],b=u[0],T=u[1],A=u[2];return a[0]=g*A-v*T,a[1]=v*b-f*A,a[2]=f*T-g*b,a},l.dot=function(a,r){return a[0]*r[0]+a[1]*r[1]+a[2]*r[2]},l.dot$1=function(a,r){return a[0]*r[0]+a[1]*r[1]+a[2]*r[2]+a[3]*r[3]},l.ease=C,l.emitValidationErrors=_c,l.enforceCacheSizeLimit=function(a){li(),Ct&&Ct.then(r=>{r.keys().then(u=>{for(let f=0;f<u.length-a;f++)r.delete(u[f])})})},l.equals=function(a,r){var u=a[0],f=a[1],g=a[2],v=a[3],b=a[4],T=a[5],A=a[6],L=a[7],z=a[8],F=a[9],j=a[10],X=a[11],Y=a[12],le=a[13],oe=a[14],ve=a[15],Se=r[0],ye=r[1],Ee=r[2],Oe=r[3],ze=r[4],ot=r[5],dt=r[6],et=r[7],Xe=r[8],We=r[9],tt=r[10],Ye=r[11],Ve=r[12],wt=r[13],_t=r[14],Ft=r[15];return Math.abs(u-Se)<=Ji*Math.max(1,Math.abs(u),Math.abs(Se))&&Math.abs(f-ye)<=Ji*Math.max(1,Math.abs(f),Math.abs(ye))&&Math.abs(g-Ee)<=Ji*Math.max(1,Math.abs(g),Math.abs(Ee))&&Math.abs(v-Oe)<=Ji*Math.max(1,Math.abs(v),Math.abs(Oe))&&Math.abs(b-ze)<=Ji*Math.max(1,Math.abs(b),Math.abs(ze))&&Math.abs(T-ot)<=Ji*Math.max(1,Math.abs(T),Math.abs(ot))&&Math.abs(A-dt)<=Ji*Math.max(1,Math.abs(A),Math.abs(dt))&&Math.abs(L-et)<=Ji*Math.max(1,Math.abs(L),Math.abs(et))&&Math.abs(z-Xe)<=Ji*Math.max(1,Math.abs(z),Math.abs(Xe))&&Math.abs(F-We)<=Ji*Math.max(1,Math.abs(F),Math.abs(We))&&Math.abs(j-tt)<=Ji*Math.max(1,Math.abs(j),Math.abs(tt))&&Math.abs(X-Ye)<=Ji*Math.max(1,Math.abs(X),Math.abs(Ye))&&Math.abs(Y-Ve)<=Ji*Math.max(1,Math.abs(Y),Math.abs(Ve))&&Math.abs(le-wt)<=Ji*Math.max(1,Math.abs(le),Math.abs(wt))&&Math.abs(oe-_t)<=Ji*Math.max(1,Math.abs(oe),Math.abs(_t))&&Math.abs(ve-Ft)<=Ji*Math.max(1,Math.abs(ve),Math.abs(Ft))},l.evaluateSizeForFeature=function(a,{uSize:r,uSizeT:u},{lowerSize:f,upperSize:g}){return a.kind==="source"?f/Oo:a.kind==="composite"?zt(f/Oo,g/Oo,u):r},l.evaluateSizeForZoom=function(a,r){let u=0,f=0;if(a.kind==="constant")f=a.layoutSize;else if(a.kind!=="source"){const{interpolationType:g,minZoom:v,maxZoom:b}=a,T=g?P(dr.interpolationFactor(g,r,v,b),0,1):0;a.kind==="camera"?f=zt(a.minSize,a.maxSize,T):u=T}return{uSizeT:u,uSize:f}},l.evaluateVariableOffset=Y1,l.evented=mh,l.exported=ai,l.exported$1=ci,l.extend=U,l.filterObject=V,l.fromRotation=function(a,r){var u=Math.sin(r),f=Math.cos(r);return a[0]=f,a[1]=u,a[2]=0,a[3]=-u,a[4]=f,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},l.fromScaling=function(a,r){return a[0]=r[0],a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=r[1],a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=r[2],a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},l.getAnchorAlignment=v_,l.getAnchorJustification=b_,l.getArrayBuffer=Zi,l.getImage=hs,l.getJSON=function(a,r){return yi(U(a,{type:"json"}),r)},l.getOverlapMode=A_,l.getRTLTextPluginStatus=yl,l.getReferrer=Br,l.getVideo=function(a,r){const u=window.document.createElement("video");u.muted=!0,u.onloadstart=function(){r(null,u)};for(let f=0;f<a.length;f++){const g=window.document.createElement("source");Xs(a[f])||(u.crossOrigin="Anonymous"),g.src=a[f],u.appendChild(g)}return{cancel:()=>{}}},l.identity=n_,l.invert=function(a,r){var u=r[0],f=r[1],g=r[2],v=r[3],b=r[4],T=r[5],A=r[6],L=r[7],z=r[8],F=r[9],j=r[10],X=r[11],Y=r[12],le=r[13],oe=r[14],ve=r[15],Se=u*T-f*b,ye=u*A-g*b,Ee=u*L-v*b,Oe=f*A-g*T,ze=f*L-v*T,ot=g*L-v*A,dt=z*le-F*Y,et=z*oe-j*Y,Xe=z*ve-X*Y,We=F*oe-j*le,tt=F*ve-X*le,Ye=j*ve-X*oe,Ve=Se*Ye-ye*tt+Ee*We+Oe*Xe-ze*et+ot*dt;return Ve?(a[0]=(T*Ye-A*tt+L*We)*(Ve=1/Ve),a[1]=(g*tt-f*Ye-v*We)*Ve,a[2]=(le*ot-oe*ze+ve*Oe)*Ve,a[3]=(j*ze-F*ot-X*Oe)*Ve,a[4]=(A*Xe-b*Ye-L*et)*Ve,a[5]=(u*Ye-g*Xe+v*et)*Ve,a[6]=(oe*Ee-Y*ot-ve*ye)*Ve,a[7]=(z*ot-j*Ee+X*ye)*Ve,a[8]=(b*tt-T*Xe+L*dt)*Ve,a[9]=(f*Xe-u*tt-v*dt)*Ve,a[10]=(Y*ze-le*Ee+ve*Se)*Ve,a[11]=(F*Ee-z*ze-X*Se)*Ve,a[12]=(T*et-b*We-A*dt)*Ve,a[13]=(u*We-f*et+g*dt)*Ve,a[14]=(le*ye-Y*Oe-oe*Se)*Ve,a[15]=(z*Oe-F*ye+j*Se)*Ve,a):null},l.isImageBitmap=Bt,l.isSafari=Qt,l.isWorker=Ne,l.keysDifference=function(a,r){const u=[];for(const f in a)f in r||u.push(f);return u},l.lazyLoadRTLTextPlugin=function(){Ir.isLoading()||Ir.isLoaded()||yl()!=="deferred"||Of()},l.makeRequest=yi,l.mapObject=G,l.mercatorXfromLng=ib,l.mercatorYfromLat=rb,l.mercatorZfromAltitude=sb,l.mul=lC,l.mul$1=function(a,r,u){return a[0]=r[0]*u[0],a[1]=r[1]*u[1],a[2]=r[2]*u[2],a[3]=r[3]*u[3],a},l.multiply=o1,l.nextPowerOfTwo=function(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))},l.normalize=function(a,r){var u=r[0],f=r[1],g=r[2],v=u*u+f*f+g*g;return v>0&&(v=1/Math.sqrt(v)),a[0]=r[0]*v,a[1]=r[1]*v,a[2]=r[2]*v,a},l.number=zt,l.ortho=function(a,r,u,f,g,v,b){var T=1/(r-u),A=1/(f-g),L=1/(v-b);return a[0]=-2*T,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*A,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*L,a[11]=0,a[12]=(r+u)*T,a[13]=(g+f)*A,a[14]=(b+v)*L,a[15]=1,a},l.parseCacheControl=He,l.parseGlyphPbf=function(a){return new m_(a).readFields(lM,[])},l.pbf=m_,l.performSymbolLayout=function(a){a.bucket.createArrays(),a.bucket.tilePixelRatio=ri/(512*a.bucket.overscaling),a.bucket.compareText={},a.bucket.iconsNeedLinear=!1;const r=a.bucket.layers[0].layout,u=a.bucket.layers[0]._unevaluatedLayout._values,f={layoutIconSize:u["icon-size"].possiblyEvaluate(new An(a.bucket.zoom+1),a.canonical),layoutTextSize:u["text-size"].possiblyEvaluate(new An(a.bucket.zoom+1),a.canonical),textMaxSize:u["text-size"].possiblyEvaluate(new An(18))};if(a.bucket.textSizeData.kind==="composite"){const{minZoom:A,maxZoom:L}=a.bucket.textSizeData;f.compositeTextSizes=[u["text-size"].possiblyEvaluate(new An(A),a.canonical),u["text-size"].possiblyEvaluate(new An(L),a.canonical)]}if(a.bucket.iconSizeData.kind==="composite"){const{minZoom:A,maxZoom:L}=a.bucket.iconSizeData;f.compositeIconSizes=[u["icon-size"].possiblyEvaluate(new An(A),a.canonical),u["icon-size"].possiblyEvaluate(new An(L),a.canonical)]}const g=r.get("text-line-height")*bi,v=r.get("text-rotation-alignment")!=="viewport"&&r.get("symbol-placement")!=="point",b=r.get("text-keep-upright"),T=r.get("text-size");for(const A of a.bucket.features){const L=r.get("text-font").evaluate(A,{},a.canonical).join(","),z=T.evaluate(A,{},a.canonical),F=f.layoutTextSize.evaluate(A,{},a.canonical),j=f.layoutIconSize.evaluate(A,{},a.canonical),X={horizontal:{},vertical:void 0},Y=A.text;let le,oe=[0,0];if(Y){const ye=Y.toString(),Ee=r.get("text-letter-spacing").evaluate(A,{},a.canonical)*bi,Oe=Zg(ye)?Ee:0,ze=r.get("text-anchor").evaluate(A,{},a.canonical),ot=r.get("text-variable-anchor");if(!ot){const tt=r.get("text-radial-offset").evaluate(A,{},a.canonical);oe=tt?Y1(ze,[tt*bi,x_]):r.get("text-offset").evaluate(A,{},a.canonical).map(Ye=>Ye*bi)}let dt=v?"center":r.get("text-justify").evaluate(A,{},a.canonical);const et=r.get("symbol-placement"),Xe=et==="point"?r.get("text-max-width").evaluate(A,{},a.canonical)*bi:0,We=()=>{a.bucket.allowVerticalPlacement&&yc(ye)&&(X.vertical=Qf(Y,a.glyphMap,a.glyphPositions,a.imagePositions,L,Xe,g,ze,"left",Oe,oe,l.WritingMode.vertical,!0,et,F,z))};if(!v&&ot){const tt=dt==="auto"?ot.map(Ve=>b_(Ve)):[dt];let Ye=!1;for(let Ve=0;Ve<tt.length;Ve++){const wt=tt[Ve];if(!X.horizontal[wt])if(Ye)X.horizontal[wt]=X.horizontal[0];else{const _t=Qf(Y,a.glyphMap,a.glyphPositions,a.imagePositions,L,Xe,g,"center",wt,Oe,oe,l.WritingMode.horizontal,!1,et,F,z);_t&&(X.horizontal[wt]=_t,Ye=_t.positionedLines.length===1)}}We()}else{dt==="auto"&&(dt=b_(ze));const tt=Qf(Y,a.glyphMap,a.glyphPositions,a.imagePositions,L,Xe,g,ze,dt,Oe,oe,l.WritingMode.horizontal,!1,et,F,z);tt&&(X.horizontal[dt]=tt),We(),yc(ye)&&v&&b&&(X.vertical=Qf(Y,a.glyphMap,a.glyphPositions,a.imagePositions,L,Xe,g,ze,dt,Oe,oe,l.WritingMode.vertical,!1,et,F,z))}}let ve=!1;if(A.icon&&A.icon.name){const ye=a.imageMap[A.icon.name];ye&&(le=pM(a.imagePositions[A.icon.name],r.get("icon-offset").evaluate(A,{},a.canonical),r.get("icon-anchor").evaluate(A,{},a.canonical)),ve=!!ye.sdf,a.bucket.sdfIcons===void 0?a.bucket.sdfIcons=ve:a.bucket.sdfIcons!==ve&&ge("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ye.pixelRatio!==a.bucket.pixelRatio||r.get("icon-rotate").constantOr(1)!==0)&&(a.bucket.iconsNeedLinear=!0))}const Se=J1(X.horizontal)||X.vertical;a.bucket.iconsInText=!!Se&&Se.iconsInText,(Se||le)&&bM(a.bucket,A,X,le,a.imageMap,f,F,j,oe,ve,a.canonical)}a.showCollisionBoxes&&a.bucket.generateCollisionDebugBuffers()},l.perspective=function(a,r,u,f,g){var v,b=1/Math.tan(r/2);return a[0]=b/u,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=b,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,g!=null&&g!==1/0?(a[10]=(g+f)*(v=1/(f-g)),a[14]=2*g*f*v):(a[10]=-1,a[14]=-2*f),a},l.pick=function(a,r){const u={};for(let f=0;f<r.length;f++){const g=r[f];g in a&&(u[g]=a[g])}return u},l.plugin=Ir,l.pointGeometry=Tt,l.polygonIntersectsPolygon=t1,l.potpack=D1,l.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],l.register=ct,l.registerForPluginStateChange=function(a){return a({pluginStatus:Yi,pluginURL:io}),mh.on("pluginStateChange",a),a},l.renderColorRamp=f1,l.rotateX=function(a,r,u){var f=Math.sin(u),g=Math.cos(u),v=r[4],b=r[5],T=r[6],A=r[7],L=r[8],z=r[9],F=r[10],j=r[11];return r!==a&&(a[0]=r[0],a[1]=r[1],a[2]=r[2],a[3]=r[3],a[12]=r[12],a[13]=r[13],a[14]=r[14],a[15]=r[15]),a[4]=v*g+L*f,a[5]=b*g+z*f,a[6]=T*g+F*f,a[7]=A*g+j*f,a[8]=L*g-v*f,a[9]=z*g-b*f,a[10]=F*g-T*f,a[11]=j*g-A*f,a},l.rotateZ=function(a,r,u){var f=Math.sin(u),g=Math.cos(u),v=r[0],b=r[1],T=r[2],A=r[3],L=r[4],z=r[5],F=r[6],j=r[7];return r!==a&&(a[8]=r[8],a[9]=r[9],a[10]=r[10],a[11]=r[11],a[12]=r[12],a[13]=r[13],a[14]=r[14],a[15]=r[15]),a[0]=v*g+L*f,a[1]=b*g+z*f,a[2]=T*g+F*f,a[3]=A*g+j*f,a[4]=L*g-v*f,a[5]=z*g-b*f,a[6]=F*g-T*f,a[7]=j*g-A*f,a},l.scale=function(a,r,u){var f=u[0],g=u[1],v=u[2];return a[0]=r[0]*f,a[1]=r[1]*f,a[2]=r[2]*f,a[3]=r[3]*f,a[4]=r[4]*g,a[5]=r[5]*g,a[6]=r[6]*g,a[7]=r[7]*g,a[8]=r[8]*v,a[9]=r[9]*v,a[10]=r[10]*v,a[11]=r[11]*v,a[12]=r[12],a[13]=r[13],a[14]=r[14],a[15]=r[15],a},l.scale$1=function(a,r,u){return a[0]=r[0]*u,a[1]=r[1]*u,a[2]=r[2]*u,a},l.setCacheLimits=function(a,r){ln=a,cr=r},l.setRTLTextPlugin=function(a,r,u=!1){if(Yi===hh||Yi===dh||Yi===fh)throw new Error("setRTLTextPlugin cannot be called multiple times.");io=ai.resolveURL(a),Yi=hh,ph=r,ga(),u||Of()},l.spec=Le,l.sphericalToCartesian=function([a,r,u]){return r+=90,r*=Math.PI/180,u*=Math.PI/180,{x:a*Math.cos(r)*Math.sin(u),y:a*Math.sin(r)*Math.sin(u),z:a*Math.cos(u)}},l.sqrLen=function(a){var r=a[0],u=a[1];return r*r+u*u},l.sub=function(a,r,u){return a[0]=r[0]-u[0],a[1]=r[1]-u[1],a[2]=r[2]-u[2],a},l.toEvaluationFeature=El,l.transformMat3=function(a,r,u){var f=r[0],g=r[1],v=r[2];return a[0]=f*u[0]+g*u[3]+v*u[6],a[1]=f*u[1]+g*u[4]+v*u[7],a[2]=f*u[2]+g*u[5]+v*u[8],a},l.transformMat4=Hf,l.transformMat4$1=function(a,r,u){var f=r[0],g=r[1];return a[0]=u[0]*f+u[4]*g+u[12],a[1]=u[1]*f+u[5]*g+u[13],a},l.translate=function(a,r,u){var f,g,v,b,T,A,L,z,F,j,X,Y,le=u[0],oe=u[1],ve=u[2];return r===a?(a[12]=r[0]*le+r[4]*oe+r[8]*ve+r[12],a[13]=r[1]*le+r[5]*oe+r[9]*ve+r[13],a[14]=r[2]*le+r[6]*oe+r[10]*ve+r[14],a[15]=r[3]*le+r[7]*oe+r[11]*ve+r[15]):(g=r[1],v=r[2],b=r[3],T=r[4],A=r[5],L=r[6],z=r[7],F=r[8],j=r[9],X=r[10],Y=r[11],a[0]=f=r[0],a[1]=g,a[2]=v,a[3]=b,a[4]=T,a[5]=A,a[6]=L,a[7]=z,a[8]=F,a[9]=j,a[10]=X,a[11]=Y,a[12]=f*le+T*oe+F*ve+r[12],a[13]=g*le+A*oe+j*ve+r[13],a[14]=v*le+L*oe+X*ve+r[14],a[15]=b*le+z*oe+Y*ve+r[15]),a},l.triggerPluginCompletionEvent=zf,l.unicodeBlockLookup=Qe,l.uniqueId=function(){return H++},l.validateCustomStyleLayer=function(a){const r=[],u=a.id;return u===void 0&&r.push({message:`layers.${u}: missing required property "id"`}),a.render===void 0&&r.push({message:`layers.${u}: missing required method "render"`}),a.renderingMode&&a.renderingMode!=="2d"&&a.renderingMode!=="3d"&&r.push({message:`layers.${u}: property "renderingMode" must be either "2d" or "3d"`}),r},l.validateLight=ah,l.validateStyle=gl,l.vectorTile=xa,l.warnOnce=ge,l.wrap=D}),c(["./shared"],function(l){function y(ee){const R=typeof ee;if(R==="number"||R==="boolean"||R==="string"||ee==null)return JSON.stringify(ee);if(Array.isArray(ee)){let J="[";for(const ue of ee)J+=`${y(ue)},`;return`${J}]`}const N=Object.keys(ee).sort();let K="{";for(let J=0;J<N.length;J++)K+=`${JSON.stringify(N[J])}:${y(ee[N[J]])},`;return`${K}}`}function w(ee){let R="";for(const N of l.refProperties)R+=`/${y(ee[N])}`;return R}class S{constructor(R){this.keyCache={},R&&this.replace(R)}replace(R){this._layerConfigs={},this._layers={},this.update(R,[])}update(R,N){for(const J of R){this._layerConfigs[J.id]=J;const ue=this._layers[J.id]=l.createStyleLayer(J);ue._featureFilter=l.createFilter(ue.filter),this.keyCache[J.id]&&delete this.keyCache[J.id]}for(const J of N)delete this.keyCache[J],delete this._layerConfigs[J],delete this._layers[J];this.familiesBySource={};const K=function(J,ue){const pe={};for(let ce=0;ce<J.length;ce++){const me=ue&&ue[J[ce].id]||w(J[ce]);ue&&(ue[J[ce].id]=me);let Ce=pe[me];Ce||(Ce=pe[me]=[]),Ce.push(J[ce])}const de=[];for(const ce in pe)de.push(pe[ce]);return de}(Object.values(this._layerConfigs),this.keyCache);for(const J of K){const ue=J.map(Fe=>this._layers[Fe.id]),pe=ue[0];if(pe.visibility==="none")continue;const de=pe.source||"";let ce=this.familiesBySource[de];ce||(ce=this.familiesBySource[de]={});const me=pe.sourceLayer||"_geojsonTileLayer";let Ce=ce[me];Ce||(Ce=ce[me]=[]),Ce.push(ue)}}}class C{constructor(R){const N={},K=[];for(const de in R){const ce=R[de],me=N[de]={};for(const Ce in ce){const Fe=ce[+Ce];if(!Fe||Fe.bitmap.width===0||Fe.bitmap.height===0)continue;const Ie={x:0,y:0,w:Fe.bitmap.width+2,h:Fe.bitmap.height+2};K.push(Ie),me[Ce]={rect:Ie,metrics:Fe.metrics}}}const{w:J,h:ue}=l.potpack(K),pe=new l.AlphaImage({width:J||1,height:ue||1});for(const de in R){const ce=R[de];for(const me in ce){const Ce=ce[+me];if(!Ce||Ce.bitmap.width===0||Ce.bitmap.height===0)continue;const Fe=N[de][me].rect;l.AlphaImage.copy(Ce.bitmap,pe,{x:0,y:0},{x:Fe.x+1,y:Fe.y+1},Ce.bitmap)}}this.image=pe,this.positions=N}}l.register("GlyphAtlas",C);class P{constructor(R){this.tileID=new l.OverscaledTileID(R.tileID.overscaledZ,R.tileID.wrap,R.tileID.canonical.z,R.tileID.canonical.x,R.tileID.canonical.y),this.uid=R.uid,this.zoom=R.zoom,this.pixelRatio=R.pixelRatio,this.tileSize=R.tileSize,this.source=R.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=R.showCollisionBoxes,this.collectResourceTiming=!!R.collectResourceTiming,this.returnDependencies=!!R.returnDependencies,this.promoteId=R.promoteId}parse(R,N,K,J,ue){this.status="parsing",this.data=R,this.collisionBoxArray=new l.CollisionBoxArray;const pe=new l.DictionaryCoder(Object.keys(R.layers).sort()),de=new l.FeatureIndex(this.tileID,this.promoteId);de.bucketLayerIDs=[];const ce={},me={featureIndex:de,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:K},Ce=N.familiesBySource[this.source];for(const Et in Ce){const It=R.layers[Et];if(!It)continue;It.version===1&&l.warnOnce(`Vector tile source "${this.source}" layer "${Et}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ut=pe.encode(Et),Wt=[];for(let _n=0;_n<It.length;_n++){const yn=It.feature(_n),ni=de.getId(yn,Et);Wt.push({feature:yn,id:ni,index:_n,sourceLayerIndex:Ut})}for(const _n of Ce[Et]){const yn=_n[0];yn.source!==this.source&&l.warnOnce(`layer.source = ${yn.source} does not equal this.source = ${this.source}`),yn.minzoom&&this.zoom<Math.floor(yn.minzoom)||yn.maxzoom&&this.zoom>=yn.maxzoom||yn.visibility!=="none"&&(D(_n,this.zoom,K),(ce[yn.id]=yn.createBucket({index:de.bucketLayerIDs.length,layers:_n,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ut,sourceID:this.source})).populate(Wt,me,this.tileID.canonical),de.bucketLayerIDs.push(_n.map(ni=>ni.id)))}}let Fe,Ie,lt,ht;const Ke=l.mapObject(me.glyphDependencies,Et=>Object.keys(Et).map(Number));Object.keys(Ke).length?J.send("getGlyphs",{uid:this.uid,stacks:Ke},(Et,It)=>{Fe||(Fe=Et,Ie=It,Dt.call(this))}):Ie={};const xt=Object.keys(me.iconDependencies);xt.length?J.send("getImages",{icons:xt,source:this.source,tileID:this.tileID,type:"icons"},(Et,It)=>{Fe||(Fe=Et,lt=It,Dt.call(this))}):lt={};const gt=Object.keys(me.patternDependencies);function Dt(){if(Fe)return ue(Fe);if(Ie&&lt&&ht){const Et=new C(Ie),It=new l.ImageAtlas(lt,ht);for(const Ut in ce){const Wt=ce[Ut];Wt instanceof l.SymbolBucket?(D(Wt.layers,this.zoom,K),l.performSymbolLayout({bucket:Wt,glyphMap:Ie,glyphPositions:Et.positions,imageMap:lt,imagePositions:It.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Wt.hasPattern&&(Wt instanceof l.LineBucket||Wt instanceof l.FillBucket||Wt instanceof l.FillExtrusionBucket)&&(D(Wt.layers,this.zoom,K),Wt.addFeatures(me,this.tileID.canonical,It.patternPositions))}this.status="done",ue(null,{buckets:Object.values(ce).filter(Ut=>!Ut.isEmpty()),featureIndex:de,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Et.image,imageAtlas:It,glyphMap:this.returnDependencies?Ie:null,iconMap:this.returnDependencies?lt:null,glyphPositions:this.returnDependencies?Et.positions:null})}}gt.length?J.send("getImages",{icons:gt,source:this.source,tileID:this.tileID,type:"patterns"},(Et,It)=>{Fe||(Fe=Et,ht=It,Dt.call(this))}):ht={},Dt.call(this)}}function D(ee,R,N){const K=new l.EvaluationParameters(R);for(const J of ee)J.recalculate(K,N)}function U(ee,R){const N=l.getArrayBuffer(ee.request,(K,J,ue,pe)=>{K?R(K):J&&R(null,{vectorTile:new l.vectorTile.VectorTile(new l.pbf(J)),rawData:J,cacheControl:ue,expires:pe})});return()=>{N.cancel(),R()}}class H{constructor(R,N,K,J){this.actor=R,this.layerIndex=N,this.availableImages=K,this.loadVectorData=J||U,this.loading={},this.loaded={}}loadTile(R,N){const K=R.uid;this.loading||(this.loading={});const J=!!(R&&R.request&&R.request.collectResourceTiming)&&new l.RequestPerformance(R.request),ue=this.loading[K]=new P(R);ue.abort=this.loadVectorData(R,(pe,de)=>{if(delete this.loading[K],pe||!de)return ue.status="done",this.loaded[K]=ue,N(pe);const ce=de.rawData,me={};de.expires&&(me.expires=de.expires),de.cacheControl&&(me.cacheControl=de.cacheControl);const Ce={};if(J){const Fe=J.finish();Fe&&(Ce.resourceTiming=JSON.parse(JSON.stringify(Fe)))}ue.vectorTile=de.vectorTile,ue.parse(de.vectorTile,this.layerIndex,this.availableImages,this.actor,(Fe,Ie)=>{if(Fe||!Ie)return N(Fe);N(null,l.extend({rawTileData:ce.slice(0)},Ie,me,Ce))}),this.loaded=this.loaded||{},this.loaded[K]=ue})}reloadTile(R,N){const K=this.loaded,J=R.uid,ue=this;if(K&&K[J]){const pe=K[J];pe.showCollisionBoxes=R.showCollisionBoxes;const de=(ce,me)=>{const Ce=pe.reloadCallback;Ce&&(delete pe.reloadCallback,pe.parse(pe.vectorTile,ue.layerIndex,this.availableImages,ue.actor,Ce)),N(ce,me)};pe.status==="parsing"?pe.reloadCallback=de:pe.status==="done"&&(pe.vectorTile?pe.parse(pe.vectorTile,this.layerIndex,this.availableImages,this.actor,de):de())}}abortTile(R,N){const K=this.loading,J=R.uid;K&&K[J]&&K[J].abort&&(K[J].abort(),delete K[J]),N()}removeTile(R,N){const K=this.loaded,J=R.uid;K&&K[J]&&delete K[J],N()}}class ae{constructor(){this.loaded={}}loadTile(R,N){const{uid:K,encoding:J,rawImageData:ue}=R,pe=l.isImageBitmap(ue)?this.getImageData(ue):ue,de=new l.DEMData(K,pe,J);this.loaded=this.loaded||{},this.loaded[K]=de,N(null,de)}getImageData(R){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(R.width,R.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=R.width,this.offscreenCanvas.height=R.height,this.offscreenCanvasContext.drawImage(R,0,0,R.width,R.height);const N=this.offscreenCanvasContext.getImageData(-1,-1,R.width+2,R.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new l.RGBAImage({width:N.width,height:N.height},N.data)}removeTile(R){const N=this.loaded,K=R.uid;N&&N[K]&&delete N[K]}}var G=function ee(R,N){var K,J=R&&R.type;if(J==="FeatureCollection")for(K=0;K<R.features.length;K++)ee(R.features[K],N);else if(J==="GeometryCollection")for(K=0;K<R.geometries.length;K++)ee(R.geometries[K],N);else if(J==="Feature")ee(R.geometry,N);else if(J==="Polygon")V(R.coordinates,N);else if(J==="MultiPolygon")for(K=0;K<R.coordinates.length;K++)V(R.coordinates[K],N);return R};function V(ee,R){if(ee.length!==0){W(ee[0],R);for(var N=1;N<ee.length;N++)W(ee[N],!R)}}function W(ee,R){for(var N=0,K=0,J=0,ue=ee.length,pe=ue-1;J<ue;pe=J++){var de=(ee[J][0]-ee[pe][0])*(ee[pe][1]+ee[J][1]),ce=N+de;K+=Math.abs(N)>=Math.abs(de)?N-ce+de:de-ce+N,N=ce}N+K>=0!=!!R&&ee.reverse()}const ie=l.vectorTile.VectorTileFeature.prototype.toGeoJSON;class ge{constructor(R){this._feature=R,this.extent=l.EXTENT,this.type=R.type,this.properties=R.tags,"id"in R&&!isNaN(R.id)&&(this.id=parseInt(R.id,10))}loadGeometry(){if(this._feature.type===1){const R=[];for(const N of this._feature.geometry)R.push([new l.pointGeometry(N[0],N[1])]);return R}{const R=[];for(const N of this._feature.geometry){const K=[];for(const J of N)K.push(new l.pointGeometry(J[0],J[1]));R.push(K)}return R}}toGeoJSON(R,N,K){return ie.call(this,R,N,K)}}class be{constructor(R){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=l.EXTENT,this.length=R.length,this._features=R}feature(R){return new ge(this._features[R])}}var De={exports:{}},Ne=l.pointGeometry,He=l.vectorTile.VectorTileFeature,je=vt;function vt(ee,R){this.options=R||{},this.features=ee,this.length=ee.length}function Nt(ee,R){this.id=typeof ee.id=="number"?ee.id:void 0,this.type=ee.type,this.rawGeometry=ee.type===1?[ee.geometry]:ee.geometry,this.properties=ee.tags,this.extent=R||4096}vt.prototype.feature=function(ee){return new Nt(this.features[ee],this.options.extent)},Nt.prototype.loadGeometry=function(){var ee=this.rawGeometry;this.geometry=[];for(var R=0;R<ee.length;R++){for(var N=ee[R],K=[],J=0;J<N.length;J++)K.push(new Ne(N[J][0],N[J][1]));this.geometry.push(K)}return this.geometry},Nt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ee=this.geometry,R=1/0,N=-1/0,K=1/0,J=-1/0,ue=0;ue<ee.length;ue++)for(var pe=ee[ue],de=0;de<pe.length;de++){var ce=pe[de];R=Math.min(R,ce.x),N=Math.max(N,ce.x),K=Math.min(K,ce.y),J=Math.max(J,ce.y)}return[R,K,N,J]},Nt.prototype.toGeoJSON=He.prototype.toGeoJSON;var Qt=l.pbf,Bt=je;function ai(ee){var R=new Qt;return function(N,K){for(var J in N.layers)K.writeMessage(3,Tt,N.layers[J])}(ee,R),R.finish()}function Tt(ee,R){var N;R.writeVarintField(15,ee.version||1),R.writeStringField(1,ee.name||""),R.writeVarintField(5,ee.extent||4096);var K={keys:[],values:[],keycache:{},valuecache:{}};for(N=0;N<ee.length;N++)K.feature=ee.feature(N),R.writeMessage(2,Si,K);var J=K.keys;for(N=0;N<J.length;N++)R.writeStringField(3,J[N]);var ue=K.values;for(N=0;N<ue.length;N++)R.writeMessage(4,ln,ue[N])}function Si(ee,R){var N=ee.feature;N.id!==void 0&&R.writeVarintField(1,N.id),R.writeMessage(2,rt,ee),R.writeVarintField(3,N.type),R.writeMessage(4,an,N)}function rt(ee,R){var N=ee.feature,K=ee.keys,J=ee.values,ue=ee.keycache,pe=ee.valuecache;for(var de in N.properties){var ce=N.properties[de],me=ue[de];if(ce!==null){me===void 0&&(K.push(de),ue[de]=me=K.length-1),R.writeVarint(me);var Ce=typeof ce;Ce!=="string"&&Ce!=="boolean"&&Ce!=="number"&&(ce=JSON.stringify(ce));var Fe=Ce+":"+ce,Ie=pe[Fe];Ie===void 0&&(J.push(ce),pe[Fe]=Ie=J.length-1),R.writeVarint(Ie)}}}function At(ee,R){return(R<<3)+(7&ee)}function Ct(ee){return ee<<1^ee>>31}function an(ee,R){for(var N=ee.loadGeometry(),K=ee.type,J=0,ue=0,pe=N.length,de=0;de<pe;de++){var ce=N[de],me=1;K===1&&(me=ce.length),R.writeVarint(At(1,me));for(var Ce=K===3?ce.length-1:ce.length,Fe=0;Fe<Ce;Fe++){Fe===1&&K!==1&&R.writeVarint(At(2,Ce-1));var Ie=ce[Fe].x-J,lt=ce[Fe].y-ue;R.writeVarint(Ct(Ie)),R.writeVarint(Ct(lt)),J+=Ie,ue+=lt}K===3&&R.writeVarint(At(7,1))}}function ln(ee,R){var N=typeof ee;N==="string"?R.writeStringField(1,ee):N==="boolean"?R.writeBooleanField(7,ee):N==="number"&&(ee%1!=0?R.writeDoubleField(3,ee):ee<0?R.writeSVarintField(6,ee):R.writeVarintField(5,ee))}function cr(ee,R,N,K,J,ue){if(J-K<=N)return;const pe=K+J>>1;li(ee,R,pe,K,J,ue%2),cr(ee,R,N,K,pe-1,ue+1),cr(ee,R,N,pe+1,J,ue+1)}function li(ee,R,N,K,J,ue){for(;J>K;){if(J-K>600){const me=J-K+1,Ce=N-K+1,Fe=Math.log(me),Ie=.5*Math.exp(2*Fe/3),lt=.5*Math.sqrt(Fe*Ie*(me-Ie)/me)*(Ce-me/2<0?-1:1);li(ee,R,N,Math.max(K,Math.floor(N-Ce*Ie/me+lt)),Math.min(J,Math.floor(N+(me-Ce)*Ie/me+lt)),ue)}const pe=R[2*N+ue];let de=K,ce=J;for(Ai(ee,R,K,N),R[2*J+ue]>pe&&Ai(ee,R,K,J);de<ce;){for(Ai(ee,R,de,ce),de++,ce--;R[2*de+ue]<pe;)de++;for(;R[2*ce+ue]>pe;)ce--}R[2*K+ue]===pe?Ai(ee,R,K,ce):(ce++,Ai(ee,R,ce,J)),ce<=N&&(K=ce+1),N<=ce&&(J=ce-1)}}function Ai(ee,R,N,K){ci(ee,N,K),ci(R,2*N,2*K),ci(R,2*N+1,2*K+1)}function ci(ee,R,N){const K=ee[R];ee[R]=ee[N],ee[N]=K}function pn(ee,R,N,K){const J=ee-N,ue=R-K;return J*J+ue*ue}De.exports=ai,De.exports.fromVectorTileJs=ai,De.exports.fromGeojsonVt=function(ee,R){R=R||{};var N={};for(var K in ee)N[K]=new Bt(ee[K].features,R),N[K].name=K,N[K].version=R.version,N[K].extent=R.extent;return ai({layers:N})},De.exports.GeoJSONWrapper=Bt;const Pi=ee=>ee[0],Kt=ee=>ee[1];class Un{constructor(R,N=Pi,K=Kt,J=64,ue=Float64Array){this.nodeSize=J,this.points=R;const pe=R.length<65536?Uint16Array:Uint32Array,de=this.ids=new pe(R.length),ce=this.coords=new ue(2*R.length);for(let me=0;me<R.length;me++)de[me]=me,ce[2*me]=N(R[me]),ce[2*me+1]=K(R[me]);cr(de,ce,J,0,de.length-1,0)}range(R,N,K,J){return function(ue,pe,de,ce,me,Ce,Fe){const Ie=[0,ue.length-1,0],lt=[];let ht,Ke;for(;Ie.length;){const xt=Ie.pop(),gt=Ie.pop(),Dt=Ie.pop();if(gt-Dt<=Fe){for(let Ut=Dt;Ut<=gt;Ut++)ht=pe[2*Ut],Ke=pe[2*Ut+1],ht>=de&&ht<=me&&Ke>=ce&&Ke<=Ce&&lt.push(ue[Ut]);continue}const Et=Math.floor((Dt+gt)/2);ht=pe[2*Et],Ke=pe[2*Et+1],ht>=de&&ht<=me&&Ke>=ce&&Ke<=Ce&&lt.push(ue[Et]);const It=(xt+1)%2;(xt===0?de<=ht:ce<=Ke)&&(Ie.push(Dt),Ie.push(Et-1),Ie.push(It)),(xt===0?me>=ht:Ce>=Ke)&&(Ie.push(Et+1),Ie.push(gt),Ie.push(It))}return lt}(this.ids,this.coords,R,N,K,J,this.nodeSize)}within(R,N,K){return function(J,ue,pe,de,ce,me){const Ce=[0,J.length-1,0],Fe=[],Ie=ce*ce;for(;Ce.length;){const lt=Ce.pop(),ht=Ce.pop(),Ke=Ce.pop();if(ht-Ke<=me){for(let It=Ke;It<=ht;It++)pn(ue[2*It],ue[2*It+1],pe,de)<=Ie&&Fe.push(J[It]);continue}const xt=Math.floor((Ke+ht)/2),gt=ue[2*xt],Dt=ue[2*xt+1];pn(gt,Dt,pe,de)<=Ie&&Fe.push(J[xt]);const Et=(lt+1)%2;(lt===0?pe-ce<=gt:de-ce<=Dt)&&(Ce.push(Ke),Ce.push(xt-1),Ce.push(Et)),(lt===0?pe+ce>=gt:de+ce>=Dt)&&(Ce.push(xt+1),Ce.push(ht),Ce.push(Et))}return Fe}(this.ids,this.coords,R,N,K,this.nodeSize)}}const us={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ee=>ee},Oi=Math.fround||(ei=new Float32Array(1),ee=>(ei[0]=+ee,ei[0]));var ei;class Br{constructor(R){this.options=hs(Object.create(us),R),this.trees=new Array(this.options.maxZoom+1)}load(R){const{log:N,minZoom:K,maxZoom:J,nodeSize:ue}=this.options;N&&console.time("total time");const pe=`prepare ${R.length} points`;N&&console.time(pe),this.points=R;let de=[];for(let ce=0;ce<R.length;ce++)R[ce].geometry&&de.push(yi(R[ce],ce));this.trees[J+1]=new Un(de,To,Ur,ue,Float32Array),N&&console.timeEnd(pe);for(let ce=J;ce>=K;ce--){const me=+Date.now();de=this._cluster(de,ce),this.trees[ce]=new Un(de,To,Ur,ue,Float32Array),N&&console.log("z%d: %d clusters in %dms",ce,de.length,+Date.now()-me)}return N&&console.timeEnd("total time"),this}getClusters(R,N){let K=((R[0]+180)%360+360)%360-180;const J=Math.max(-90,Math.min(90,R[1]));let ue=R[2]===180?180:((R[2]+180)%360+360)%360-180;const pe=Math.max(-90,Math.min(90,R[3]));if(R[2]-R[0]>=360)K=-180,ue=180;else if(K>ue){const Ce=this.getClusters([K,J,180,pe],N),Fe=this.getClusters([-180,J,ue,pe],N);return Ce.concat(Fe)}const de=this.trees[this._limitZoom(N)],ce=de.range($t(K),Fi(pe),$t(ue),Fi(J)),me=[];for(const Ce of ce){const Fe=de.points[Ce];me.push(Fe.numPoints?Zi(Fe):this.points[Fe.index])}return me}getChildren(R){const N=this._getOriginId(R),K=this._getOriginZoom(R),J="No cluster with the specified id.",ue=this.trees[K];if(!ue)throw new Error(J);const pe=ue.points[N];if(!pe)throw new Error(J);const de=this.options.radius/(this.options.extent*Math.pow(2,K-1)),ce=ue.within(pe.x,pe.y,de),me=[];for(const Ce of ce){const Fe=ue.points[Ce];Fe.parentId===R&&me.push(Fe.numPoints?Zi(Fe):this.points[Fe.index])}if(me.length===0)throw new Error(J);return me}getLeaves(R,N,K){const J=[];return this._appendLeaves(J,R,N=N||10,K=K||0,0),J}getTile(R,N,K){const J=this.trees[this._limitZoom(R)],ue=Math.pow(2,R),{extent:pe,radius:de}=this.options,ce=de/pe,me=(K-ce)/ue,Ce=(K+1+ce)/ue,Fe={features:[]};return this._addTileFeatures(J.range((N-ce)/ue,me,(N+1+ce)/ue,Ce),J.points,N,K,ue,Fe),N===0&&this._addTileFeatures(J.range(1-ce/ue,me,1,Ce),J.points,ue,K,ue,Fe),N===ue-1&&this._addTileFeatures(J.range(0,me,ce/ue,Ce),J.points,-1,K,ue,Fe),Fe.features.length?Fe:null}getClusterExpansionZoom(R){let N=this._getOriginZoom(R)-1;for(;N<=this.options.maxZoom;){const K=this.getChildren(R);if(N++,K.length!==1)break;R=K[0].properties.cluster_id}return N}_appendLeaves(R,N,K,J,ue){const pe=this.getChildren(N);for(const de of pe){const ce=de.properties;if(ce&&ce.cluster?ue+ce.point_count<=J?ue+=ce.point_count:ue=this._appendLeaves(R,ce.cluster_id,K,J,ue):ue<J?ue++:R.push(de),R.length===K)break}return ue}_addTileFeatures(R,N,K,J,ue,pe){for(const de of R){const ce=N[de],me=ce.numPoints;let Ce,Fe,Ie;if(me)Ce=Xs(ce),Fe=ce.x,Ie=ce.y;else{const Ke=this.points[ce.index];Ce=Ke.properties,Fe=$t(Ke.geometry.coordinates[0]),Ie=Fi(Ke.geometry.coordinates[1])}const lt={type:1,geometry:[[Math.round(this.options.extent*(Fe*ue-K)),Math.round(this.options.extent*(Ie*ue-J))]],tags:Ce};let ht;me?ht=ce.id:this.options.generateId?ht=ce.index:this.points[ce.index].id&&(ht=this.points[ce.index].id),ht!==void 0&&(lt.id=ht),pe.features.push(lt)}}_limitZoom(R){return Math.max(this.options.minZoom,Math.min(Math.floor(+R),this.options.maxZoom+1))}_cluster(R,N){const K=[],{radius:J,extent:ue,reduce:pe,minPoints:de}=this.options,ce=J/(ue*Math.pow(2,N));for(let me=0;me<R.length;me++){const Ce=R[me];if(Ce.zoom<=N)continue;Ce.zoom=N;const Fe=this.trees[N+1],Ie=Fe.within(Ce.x,Ce.y,ce),lt=Ce.numPoints||1;let ht=lt;for(const Ke of Ie){const xt=Fe.points[Ke];xt.zoom>N&&(ht+=xt.numPoints||1)}if(ht>lt&&ht>=de){let Ke=Ce.x*lt,xt=Ce.y*lt,gt=pe&&lt>1?this._map(Ce,!0):null;const Dt=(me<<5)+(N+1)+this.points.length;for(const Et of Ie){const It=Fe.points[Et];if(It.zoom<=N)continue;It.zoom=N;const Ut=It.numPoints||1;Ke+=It.x*Ut,xt+=It.y*Ut,It.parentId=Dt,pe&&(gt||(gt=this._map(Ce,!0)),pe(gt,this._map(It)))}Ce.parentId=Dt,K.push(qi(Ke/ht,xt/ht,Dt,ht,gt))}else if(K.push(Ce),ht>1)for(const Ke of Ie){const xt=Fe.points[Ke];xt.zoom<=N||(xt.zoom=N,K.push(xt))}}return K}_getOriginId(R){return R-this.points.length>>5}_getOriginZoom(R){return(R-this.points.length)%32}_map(R,N){if(R.numPoints)return N?hs({},R.properties):R.properties;const K=this.points[R.index].properties,J=this.options.map(K);return N&&J===K?hs({},J):J}}function qi(ee,R,N,K,J){return{x:Oi(ee),y:Oi(R),zoom:1/0,id:N,parentId:-1,numPoints:K,properties:J}}function yi(ee,R){const[N,K]=ee.geometry.coordinates;return{x:Oi($t(N)),y:Oi(Fi(K)),zoom:1/0,index:R,parentId:-1}}function Zi(ee){return{type:"Feature",id:ee.id,properties:Xs(ee),geometry:{type:"Point",coordinates:[(R=ee.x,360*(R-.5)),Vn(ee.y)]}};var R}function Xs(ee){const R=ee.numPoints,N=R>=1e4?`${Math.round(R/1e3)}k`:R>=1e3?Math.round(R/100)/10+"k":R;return hs(hs({},ee.properties),{cluster:!0,cluster_id:ee.id,point_count:R,point_count_abbreviated:N})}function $t(ee){return ee/360+.5}function Fi(ee){const R=Math.sin(ee*Math.PI/180),N=.5-.25*Math.log((1+R)/(1-R))/Math.PI;return N<0?0:N>1?1:N}function Vn(ee){const R=(180-360*ee)*Math.PI/180;return 360*Math.atan(Math.exp(R))/Math.PI-90}function hs(ee,R){for(const N in R)ee[N]=R[N];return ee}function To(ee){return ee.x}function Ur(ee){return ee.y}function Vr(ee,R,N,K){for(var J,ue=K,pe=N-R>>1,de=N-R,ce=ee[R],me=ee[R+1],Ce=ee[N],Fe=ee[N+1],Ie=R+3;Ie<N;Ie+=3){var lt=Ys(ee[Ie],ee[Ie+1],ce,me,Ce,Fe);if(lt>ue)J=Ie,ue=lt;else if(lt===ue){var ht=Math.abs(Ie-pe);ht<de&&(J=Ie,de=ht)}}ue>K&&(J-R>3&&Vr(ee,R,J,K),ee[J+2]=ue,N-J>3&&Vr(ee,J,N,K))}function Ys(ee,R,N,K,J,ue){var pe=J-N,de=ue-K;if(pe!==0||de!==0){var ce=((ee-N)*pe+(R-K)*de)/(pe*pe+de*de);ce>1?(N=J,K=ue):ce>0&&(N+=pe*ce,K+=de*ce)}return(pe=ee-N)*pe+(de=R-K)*de}function Sr(ee,R,N,K){var J={id:ee===void 0?null:ee,type:R,geometry:N,tags:K,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(ue){var pe=ue.geometry,de=ue.type;if(de==="Point"||de==="MultiPoint"||de==="LineString")Le(ue,pe);else if(de==="Polygon"||de==="MultiLineString")for(var ce=0;ce<pe.length;ce++)Le(ue,pe[ce]);else if(de==="MultiPolygon")for(ce=0;ce<pe.length;ce++)for(var me=0;me<pe[ce].length;me++)Le(ue,pe[ce][me])}(J),J}function Le(ee,R){for(var N=0;N<R.length;N+=3)ee.minX=Math.min(ee.minX,R[N]),ee.minY=Math.min(ee.minY,R[N+1]),ee.maxX=Math.max(ee.maxX,R[N]),ee.maxY=Math.max(ee.maxY,R[N+1])}function qe(ee,R,N,K){if(R.geometry){var J=R.geometry.coordinates,ue=R.geometry.type,pe=Math.pow(N.tolerance/((1<<N.maxZoom)*N.extent),2),de=[],ce=R.id;if(N.promoteId?ce=R.properties[N.promoteId]:N.generateId&&(ce=K||0),ue==="Point")ds(J,de);else if(ue==="MultiPoint")for(var me=0;me<J.length;me++)ds(J[me],de);else if(ue==="LineString")Ii(J,de,pe,!1);else if(ue==="MultiLineString"){if(N.lineMetrics){for(me=0;me<J.length;me++)Ii(J[me],de=[],pe,!1),ee.push(Sr(ce,"LineString",de,R.properties));return}Gt(J,de,pe,!1)}else if(ue==="Polygon")Gt(J,de,pe,!0);else{if(ue!=="MultiPolygon"){if(ue==="GeometryCollection"){for(me=0;me<R.geometry.geometries.length;me++)qe(ee,{id:ce,geometry:R.geometry.geometries[me],properties:R.properties},N,K);return}throw new Error("Input data is not a valid GeoJSON object.")}for(me=0;me<J.length;me++){var Ce=[];Gt(J[me],Ce,pe,!0),de.push(Ce)}}ee.push(Sr(ce,ue,de,R.properties))}}function ds(ee,R){R.push(Xi(ee[0])),R.push(Ni(ee[1])),R.push(0)}function Ii(ee,R,N,K){for(var J,ue,pe=0,de=0;de<ee.length;de++){var ce=Xi(ee[de][0]),me=Ni(ee[de][1]);R.push(ce),R.push(me),R.push(0),de>0&&(pe+=K?(J*me-ce*ue)/2:Math.sqrt(Math.pow(ce-J,2)+Math.pow(me-ue,2))),J=ce,ue=me}var Ce=R.length-3;R[2]=1,Vr(R,0,Ce,N),R[Ce+2]=1,R.size=Math.abs(pe),R.start=0,R.end=R.size}function Gt(ee,R,N,K){for(var J=0;J<ee.length;J++){var ue=[];Ii(ee[J],ue,N,K),R.push(ue)}}function Xi(ee){return ee/360+.5}function Ni(ee){var R=Math.sin(ee*Math.PI/180),N=.5-.25*Math.log((1+R)/(1-R))/Math.PI;return N<0?0:N>1?1:N}function Bi(ee,R,N,K,J,ue,pe,de){if(K/=R,ue>=(N/=R)&&pe<K)return ee;if(pe<N||ue>=K)return null;for(var ce=[],me=0;me<ee.length;me++){var Ce=ee[me],Fe=Ce.geometry,Ie=Ce.type,lt=J===0?Ce.minX:Ce.minY,ht=J===0?Ce.maxX:Ce.maxY;if(lt>=N&&ht<K)ce.push(Ce);else if(!(ht<N||lt>=K)){var Ke=[];if(Ie==="Point"||Ie==="MultiPoint")fs(Fe,Ke,N,K,J);else if(Ie==="LineString")$e(Fe,Ke,N,K,J,!1,de.lineMetrics);else if(Ie==="MultiLineString")Lt(Fe,Ke,N,K,J,!1);else if(Ie==="Polygon")Lt(Fe,Ke,N,K,J,!0);else if(Ie==="MultiPolygon")for(var xt=0;xt<Fe.length;xt++){var gt=[];Lt(Fe[xt],gt,N,K,J,!0),gt.length&&Ke.push(gt)}if(Ke.length){if(de.lineMetrics&&Ie==="LineString"){for(xt=0;xt<Ke.length;xt++)ce.push(Sr(Ce.id,Ie,Ke[xt],Ce.tags));continue}Ie!=="LineString"&&Ie!=="MultiLineString"||(Ke.length===1?(Ie="LineString",Ke=Ke[0]):Ie="MultiLineString"),Ie!=="Point"&&Ie!=="MultiPoint"||(Ie=Ke.length===3?"Point":"MultiPoint"),ce.push(Sr(Ce.id,Ie,Ke,Ce.tags))}}}return ce.length?ce:null}function fs(ee,R,N,K,J){for(var ue=0;ue<ee.length;ue+=3){var pe=ee[ue+J];pe>=N&&pe<=K&&(R.push(ee[ue]),R.push(ee[ue+1]),R.push(ee[ue+2]))}}function $e(ee,R,N,K,J,ue,pe){for(var de,ce,me=kt(ee),Ce=J===0?jr:Mt,Fe=ee.start,Ie=0;Ie<ee.length-3;Ie+=3){var lt=ee[Ie],ht=ee[Ie+1],Ke=ee[Ie+2],xt=ee[Ie+3],gt=ee[Ie+4],Dt=J===0?lt:ht,Et=J===0?xt:gt,It=!1;pe&&(de=Math.sqrt(Math.pow(lt-xt,2)+Math.pow(ht-gt,2))),Dt<N?Et>N&&(ce=Ce(me,lt,ht,xt,gt,N),pe&&(me.start=Fe+de*ce)):Dt>K?Et<K&&(ce=Ce(me,lt,ht,xt,gt,K),pe&&(me.start=Fe+de*ce)):ti(me,lt,ht,Ke),Et<N&&Dt>=N&&(ce=Ce(me,lt,ht,xt,gt,N),It=!0),Et>K&&Dt<=K&&(ce=Ce(me,lt,ht,xt,gt,K),It=!0),!ue&&It&&(pe&&(me.end=Fe+de*ce),R.push(me),me=kt(ee)),pe&&(Fe+=de)}var Ut=ee.length-3;lt=ee[Ut],ht=ee[Ut+1],Ke=ee[Ut+2],(Dt=J===0?lt:ht)>=N&&Dt<=K&&ti(me,lt,ht,Ke),Ut=me.length-3,ue&&Ut>=3&&(me[Ut]!==me[0]||me[Ut+1]!==me[1])&&ti(me,me[0],me[1],me[2]),me.length&&R.push(me)}function kt(ee){var R=[];return R.size=ee.size,R.start=ee.start,R.end=ee.end,R}function Lt(ee,R,N,K,J,ue){for(var pe=0;pe<ee.length;pe++)$e(ee[pe],R,N,K,J,ue,!1)}function ti(ee,R,N,K){ee.push(R),ee.push(N),ee.push(K)}function jr(ee,R,N,K,J,ue){var pe=(ue-R)/(K-R);return ee.push(ue),ee.push(N+(J-N)*pe),ee.push(1),pe}function Mt(ee,R,N,K,J,ue){var pe=(ue-N)/(J-N);return ee.push(R+(K-R)*pe),ee.push(ue),ee.push(1),pe}function ur(ee,R){for(var N=[],K=0;K<ee.length;K++){var J,ue=ee[K],pe=ue.type;if(pe==="Point"||pe==="MultiPoint"||pe==="LineString")J=Zn(ue.geometry,R);else if(pe==="MultiLineString"||pe==="Polygon"){J=[];for(var de=0;de<ue.geometry.length;de++)J.push(Zn(ue.geometry[de],R))}else if(pe==="MultiPolygon")for(J=[],de=0;de<ue.geometry.length;de++){for(var ce=[],me=0;me<ue.geometry[de].length;me++)ce.push(Zn(ue.geometry[de][me],R));J.push(ce)}N.push(Sr(ue.id,pe,J,ue.tags))}return N}function Zn(ee,R){var N=[];N.size=ee.size,ee.start!==void 0&&(N.start=ee.start,N.end=ee.end);for(var K=0;K<ee.length;K+=3)N.push(ee[K]+R,ee[K+1],ee[K+2]);return N}function Ks(ee,R){if(ee.transformed)return ee;var N,K,J,ue=1<<ee.z,pe=ee.x,de=ee.y;for(N=0;N<ee.features.length;N++){var ce=ee.features[N],me=ce.geometry,Ce=ce.type;if(ce.geometry=[],Ce===1)for(K=0;K<me.length;K+=2)ce.geometry.push(On(me[K],me[K+1],R,ue,pe,de));else for(K=0;K<me.length;K++){var Fe=[];for(J=0;J<me[K].length;J+=2)Fe.push(On(me[K][J],me[K][J+1],R,ue,pe,de));ce.geometry.push(Fe)}}return ee.transformed=!0,ee}function On(ee,R,N,K,J,ue){return[Math.round(N*(ee*K-J)),Math.round(N*(R*K-ue))]}function ui(ee,R,N,K,J){for(var ue=R===J.maxZoom?0:J.tolerance/((1<<R)*J.extent),pe={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:N,y:K,z:R,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},de=0;de<ee.length;de++){pe.numFeatures++,sn(pe,ee[de],ue,J);var ce=ee[de].minX,me=ee[de].minY,Ce=ee[de].maxX,Fe=ee[de].maxY;ce<pe.minX&&(pe.minX=ce),me<pe.minY&&(pe.minY=me),Ce>pe.maxX&&(pe.maxX=Ce),Fe>pe.maxY&&(pe.maxY=Fe)}return pe}function sn(ee,R,N,K){var J=R.geometry,ue=R.type,pe=[];if(ue==="Point"||ue==="MultiPoint")for(var de=0;de<J.length;de+=3)pe.push(J[de]),pe.push(J[de+1]),ee.numPoints++,ee.numSimplified++;else if(ue==="LineString")Js(pe,J,ee,N,!1,!1);else if(ue==="MultiLineString"||ue==="Polygon")for(de=0;de<J.length;de++)Js(pe,J[de],ee,N,ue==="Polygon",de===0);else if(ue==="MultiPolygon")for(var ce=0;ce<J.length;ce++){var me=J[ce];for(de=0;de<me.length;de++)Js(pe,me[de],ee,N,!0,de===0)}if(pe.length){var Ce=R.tags||null;if(ue==="LineString"&&K.lineMetrics){for(var Fe in Ce={},R.tags)Ce[Fe]=R.tags[Fe];Ce.mapbox_clip_start=J.start/J.size,Ce.mapbox_clip_end=J.end/J.size}var Ie={geometry:pe,type:ue==="Polygon"||ue==="MultiPolygon"?3:ue==="LineString"||ue==="MultiLineString"?2:1,tags:Ce};R.id!==null&&(Ie.id=R.id),ee.features.push(Ie)}}function Js(ee,R,N,K,J,ue){var pe=K*K;if(K>0&&R.size<(J?pe:K))N.numPoints+=R.length/3;else{for(var de=[],ce=0;ce<R.length;ce+=3)(K===0||R[ce+2]>pe)&&(N.numSimplified++,de.push(R[ce]),de.push(R[ce+1])),N.numPoints++;J&&function(me,Ce){for(var Fe=0,Ie=0,lt=me.length,ht=lt-2;Ie<lt;ht=Ie,Ie+=2)Fe+=(me[Ie]-me[ht])*(me[Ie+1]+me[ht+1]);if(Fe>0===Ce)for(Ie=0,lt=me.length;Ie<lt/2;Ie+=2){var Ke=me[Ie],xt=me[Ie+1];me[Ie]=me[lt-2-Ie],me[Ie+1]=me[lt-1-Ie],me[lt-2-Ie]=Ke,me[lt-1-Ie]=xt}}(de,ue),ee.push(de)}}function Ar(ee,R){var N=(R=this.options=function(J,ue){for(var pe in ue)J[pe]=ue[pe];return J}(Object.create(this.options),R)).debug;if(N&&console.time("preprocess data"),R.maxZoom<0||R.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(R.promoteId&&R.generateId)throw new Error("promoteId and generateId cannot be used together.");var K=function(J,ue){var pe=[];if(J.type==="FeatureCollection")for(var de=0;de<J.features.length;de++)qe(pe,J.features[de],ue,de);else qe(pe,J.type==="Feature"?J:{geometry:J},ue);return pe}(ee,R);this.tiles={},this.tileCoords=[],N&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",R.indexMaxZoom,R.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),K=function(J,ue){var pe=ue.buffer/ue.extent,de=J,ce=Bi(J,1,-1-pe,pe,0,-1,2,ue),me=Bi(J,1,1-pe,2+pe,0,-1,2,ue);return(ce||me)&&(de=Bi(J,1,-pe,1+pe,0,-1,2,ue)||[],ce&&(de=ur(ce,1).concat(de)),me&&(de=de.concat(ur(me,-1)))),de}(K,R),K.length&&this.splitTile(K,0,0,0),N&&(K.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Pr(ee,R,N){return 32*((1<<ee)*N+R)+ee}function ks(ee,R){const N=ee.tileID.canonical;if(!this._geoJSONIndex)return R(null,null);const K=this._geoJSONIndex.getTile(N.z,N.x,N.y);if(!K)return R(null,null);const J=new be(K.features);let ue=De.exports(J);ue.byteOffset===0&&ue.byteLength===ue.buffer.byteLength||(ue=new Uint8Array(ue)),R(null,{vectorTile:J,rawData:ue.buffer})}Ar.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Ar.prototype.splitTile=function(ee,R,N,K,J,ue,pe){for(var de=[ee,R,N,K],ce=this.options,me=ce.debug;de.length;){K=de.pop(),N=de.pop(),R=de.pop(),ee=de.pop();var Ce=1<<R,Fe=Pr(R,N,K),Ie=this.tiles[Fe];if(!Ie&&(me>1&&console.time("creation"),Ie=this.tiles[Fe]=ui(ee,R,N,K,ce),this.tileCoords.push({z:R,x:N,y:K}),me)){me>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",R,N,K,Ie.numFeatures,Ie.numPoints,Ie.numSimplified),console.timeEnd("creation"));var lt="z"+R;this.stats[lt]=(this.stats[lt]||0)+1,this.total++}if(Ie.source=ee,J){if(R===ce.maxZoom||R===J)continue;var ht=1<<J-R;if(N!==Math.floor(ue/ht)||K!==Math.floor(pe/ht))continue}else if(R===ce.indexMaxZoom||Ie.numPoints<=ce.indexMaxPoints)continue;if(Ie.source=null,ee.length!==0){me>1&&console.time("clipping");var Ke,xt,gt,Dt,Et,It,Ut=.5*ce.buffer/ce.extent,Wt=.5-Ut,_n=.5+Ut,yn=1+Ut;Ke=xt=gt=Dt=null,Et=Bi(ee,Ce,N-Ut,N+_n,0,Ie.minX,Ie.maxX,ce),It=Bi(ee,Ce,N+Wt,N+yn,0,Ie.minX,Ie.maxX,ce),ee=null,Et&&(Ke=Bi(Et,Ce,K-Ut,K+_n,1,Ie.minY,Ie.maxY,ce),xt=Bi(Et,Ce,K+Wt,K+yn,1,Ie.minY,Ie.maxY,ce),Et=null),It&&(gt=Bi(It,Ce,K-Ut,K+_n,1,Ie.minY,Ie.maxY,ce),Dt=Bi(It,Ce,K+Wt,K+yn,1,Ie.minY,Ie.maxY,ce),It=null),me>1&&console.timeEnd("clipping"),de.push(Ke||[],R+1,2*N,2*K),de.push(xt||[],R+1,2*N,2*K+1),de.push(gt||[],R+1,2*N+1,2*K),de.push(Dt||[],R+1,2*N+1,2*K+1)}}},Ar.prototype.getTile=function(ee,R,N){var K=this.options,J=K.extent,ue=K.debug;if(ee<0||ee>24)return null;var pe=1<<ee,de=Pr(ee,R=(R%pe+pe)%pe,N);if(this.tiles[de])return Ks(this.tiles[de],J);ue>1&&console.log("drilling down to z%d-%d-%d",ee,R,N);for(var ce,me=ee,Ce=R,Fe=N;!ce&&me>0;)me--,Ce=Math.floor(Ce/2),Fe=Math.floor(Fe/2),ce=this.tiles[Pr(me,Ce,Fe)];return ce&&ce.source?(ue>1&&console.log("found parent tile z%d-%d-%d",me,Ce,Fe),ue>1&&console.time("drilling down"),this.splitTile(ce.source,me,Ce,Fe,ee,R,N),ue>1&&console.timeEnd("drilling down"),this.tiles[de]?Ks(this.tiles[de],J):null):null};class Qs extends H{constructor(R,N,K,J){super(R,N,K,ks),J&&(this.loadGeoJSON=J)}loadData(R,N){var K;(K=this._pendingRequest)===null||K===void 0||K.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const J=!!(R&&R.request&&R.request.collectResourceTiming)&&new l.RequestPerformance(R.request);this._pendingCallback=N,this._pendingRequest=this.loadGeoJSON(R,(ue,pe)=>{if(delete this._pendingCallback,delete this._pendingRequest,ue||!pe)return N(ue);if(typeof pe!="object")return N(new Error(`Input data given to '${R.source}' is not a valid GeoJSON object.`));{G(pe,!0);try{if(R.filter){const ce=l.createExpression(R.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ce.result==="error")throw new Error(ce.value.map(Ce=>`${Ce.key}: ${Ce.message}`).join(", "));pe={type:"FeatureCollection",features:pe.features.filter(Ce=>ce.value.evaluate({zoom:0},Ce))}}this._geoJSONIndex=R.cluster?new Br(function({superclusterOptions:ce,clusterProperties:me}){if(!me||!ce)return ce;const Ce={},Fe={},Ie={accumulated:null,zoom:0},lt={properties:null},ht=Object.keys(me);for(const Ke of ht){const[xt,gt]=me[Ke],Dt=l.createExpression(gt),Et=l.createExpression(typeof xt=="string"?[xt,["accumulated"],["get",Ke]]:xt);Ce[Ke]=Dt.value,Fe[Ke]=Et.value}return ce.map=Ke=>{lt.properties=Ke;const xt={};for(const gt of ht)xt[gt]=Ce[gt].evaluate(Ie,lt);return xt},ce.reduce=(Ke,xt)=>{lt.properties=xt;for(const gt of ht)Ie.accumulated=Ke[gt],Ke[gt]=Fe[gt].evaluate(Ie,lt)},ce}(R)).load(pe.features):function(ce,me){return new Ar(ce,me)}(pe,R.geojsonVtOptions)}catch(ce){return N(ce)}this.loaded={};const de={};if(J){const ce=J.finish();ce&&(de.resourceTiming={},de.resourceTiming[R.source]=JSON.parse(JSON.stringify(ce)))}N(null,de)}})}reloadTile(R,N){const K=this.loaded;return K&&K[R.uid]?super.reloadTile(R,N):this.loadTile(R,N)}loadGeoJSON(R,N){if(R.request)return l.getJSON(R.request,N);if(typeof R.data=="string")try{N(null,JSON.parse(R.data))}catch{N(new Error(`Input data given to '${R.source}' is not a valid GeoJSON object.`))}else N(new Error(`Input data given to '${R.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}}removeSource(R,N){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),N()}getClusterExpansionZoom(R,N){try{N(null,this._geoJSONIndex.getClusterExpansionZoom(R.clusterId))}catch(K){N(K)}}getClusterChildren(R,N){try{N(null,this._geoJSONIndex.getChildren(R.clusterId))}catch(K){N(K)}}getClusterLeaves(R,N){try{N(null,this._geoJSONIndex.getLeaves(R.clusterId,R.limit,R.offset))}catch(K){N(K)}}}class ps{constructor(R){this.self=R,this.actor=new l.Actor(R,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:H,geojson:Qs},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(N,K)=>{if(this.workerSourceTypes[N])throw new Error(`Worker source with name "${N}" already registered.`);this.workerSourceTypes[N]=K},this.self.registerRTLTextPlugin=N=>{if(l.plugin.isParsed())throw new Error("RTL text plugin already registered.");l.plugin.applyArabicShaping=N.applyArabicShaping,l.plugin.processBidirectionalText=N.processBidirectionalText,l.plugin.processStyledBidirectionalText=N.processStyledBidirectionalText}}setReferrer(R,N){this.referrer=N}setImages(R,N,K){this.availableImages[R]=N;for(const J in this.workerSources[R]){const ue=this.workerSources[R][J];for(const pe in ue)ue[pe].availableImages=N}K()}setLayers(R,N,K){this.getLayerIndex(R).replace(N),K()}updateLayers(R,N,K){this.getLayerIndex(R).update(N.layers,N.removedIds),K()}loadTile(R,N,K){this.getWorkerSource(R,N.type,N.source).loadTile(N,K)}loadDEMTile(R,N,K){this.getDEMWorkerSource(R,N.source).loadTile(N,K)}reloadTile(R,N,K){this.getWorkerSource(R,N.type,N.source).reloadTile(N,K)}abortTile(R,N,K){this.getWorkerSource(R,N.type,N.source).abortTile(N,K)}removeTile(R,N,K){this.getWorkerSource(R,N.type,N.source).removeTile(N,K)}removeDEMTile(R,N){this.getDEMWorkerSource(R,N.source).removeTile(N)}removeSource(R,N,K){if(!this.workerSources[R]||!this.workerSources[R][N.type]||!this.workerSources[R][N.type][N.source])return;const J=this.workerSources[R][N.type][N.source];delete this.workerSources[R][N.type][N.source],J.removeSource!==void 0?J.removeSource(N,K):K()}loadWorkerSource(R,N,K){try{this.self.importScripts(N.url),K()}catch(J){K(J.toString())}}syncRTLPluginState(R,N,K){try{l.plugin.setState(N);const J=l.plugin.getPluginURL();if(l.plugin.isLoaded()&&!l.plugin.isParsed()&&J!=null){this.self.importScripts(J);const ue=l.plugin.isParsed();K(ue?void 0:new Error(`RTL Text Plugin failed to import scripts from ${J}`),ue)}}catch(J){K(J.toString())}}getAvailableImages(R){let N=this.availableImages[R];return N||(N=[]),N}getLayerIndex(R){let N=this.layerIndexes[R];return N||(N=this.layerIndexes[R]=new S),N}getWorkerSource(R,N,K){if(this.workerSources[R]||(this.workerSources[R]={}),this.workerSources[R][N]||(this.workerSources[R][N]={}),!this.workerSources[R][N][K]){const J={send:(ue,pe,de)=>{this.actor.send(ue,pe,de,R)}};this.workerSources[R][N][K]=new this.workerSourceTypes[N](J,this.getLayerIndex(R),this.getAvailableImages(R))}return this.workerSources[R][N][K]}getDEMWorkerSource(R,N){return this.demWorkerSources[R]||(this.demWorkerSources[R]={}),this.demWorkerSources[R][N]||(this.demWorkerSources[R][N]=new ae),this.demWorkerSources[R][N]}enforceCacheSizeLimit(R,N){l.enforceCacheSizeLimit(N)}}return l.isWorker()&&(self.worker=new ps(self)),ps}),c(["./shared"],function(l){var y=w;function w(m){return!function(o){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var p,_,x=new Blob([""],{type:"text/javascript"}),E=URL.createObjectURL(x);try{_=new Worker(E),p=!0}catch{p=!1}return _&&_.terminate(),URL.revokeObjectURL(E),p}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var p=document.createElement("canvas");p.width=p.height=1;var _=p.getContext("2d");if(!_)return!1;var x=_.getImageData(0,0,1,1);return x&&x.width===p.width}()?(S[h=o&&o.failIfMajorPerformanceCaveat]===void 0&&(S[h]=function(p){var _,x=function(E){var I=document.createElement("canvas"),M=Object.create(w.webGLContextAttributes);return M.failIfMajorPerformanceCaveat=E,I.getContext("webgl",M)||I.getContext("experimental-webgl",M)}(p);if(!x)return!1;try{_=x.createShader(x.VERTEX_SHADER)}catch{return!1}return!(!_||x.isContextLost())&&(x.shaderSource(_,"void main() {}"),x.compileShader(_),x.getShaderParameter(_,x.COMPILE_STATUS)===!0)}(h)),S[h]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var h}(m)}var S={};function C(m,o){if(Array.isArray(m)){if(!Array.isArray(o)||m.length!==o.length)return!1;for(let h=0;h<m.length;h++)if(!C(m[h],o[h]))return!1;return!0}if(typeof m=="object"&&m!==null&&o!==null){if(typeof o!="object"||Object.keys(m).length!==Object.keys(o).length)return!1;for(const h in m)if(!C(m[h],o[h]))return!1;return!0}return m===o}w.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};class P{static testProp(o){if(!P.docStyle)return o[0];for(let h=0;h<o.length;h++)if(o[h]in P.docStyle)return o[h];return o[0]}static create(o,h,p){const _=window.document.createElement(o);return h!==void 0&&(_.className=h),p&&p.appendChild(_),_}static createNS(o,h){return window.document.createElementNS(o,h)}static disableDrag(){P.docStyle&&P.selectProp&&(P.userSelect=P.docStyle[P.selectProp],P.docStyle[P.selectProp]="none")}static enableDrag(){P.docStyle&&P.selectProp&&(P.docStyle[P.selectProp]=P.userSelect)}static setTransform(o,h){o.style[P.transformProp]=h}static addEventListener(o,h,p,_={}){o.addEventListener(h,p,"passive"in _?_:_.capture)}static removeEventListener(o,h,p,_={}){o.removeEventListener(h,p,"passive"in _?_:_.capture)}static suppressClickInternal(o){o.preventDefault(),o.stopPropagation(),window.removeEventListener("click",P.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",P.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",P.suppressClickInternal,!0)},0)}static mousePos(o,h){const p=o.getBoundingClientRect();return new l.pointGeometry(h.clientX-p.left-o.clientLeft,h.clientY-p.top-o.clientTop)}static touchPos(o,h){const p=o.getBoundingClientRect(),_=[];for(let x=0;x<h.length;x++)_.push(new l.pointGeometry(h[x].clientX-p.left-o.clientLeft,h[x].clientY-p.top-o.clientTop));return _}static mouseButton(o){return o.button}static remove(o){o.parentNode&&o.parentNode.removeChild(o)}}P.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,P.selectProp=P.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),P.transformProp=P.testProp(["transform","WebkitTransform"]);class D{constructor(o){this._transformRequestFn=o}transformRequest(o,h){return this._transformRequestFn&&this._transformRequestFn(o,h)||{url:o}}normalizeSpriteURL(o,h,p){const _=function(x){const E=x.match(U);if(!E)throw new Error(`Unable to parse URL "${x}"`);return{protocol:E[1],authority:E[2],path:E[3]||"/",params:E[4]?E[4].split("&"):[]}}(o);return _.path+=`${h}${p}`,function(x){const E=x.params.length?`?${x.params.join("&")}`:"";return`${x.protocol}://${x.authority}${x.path}${E}`}(_)}setTransformRequest(o){this._transformRequestFn=o}}const U=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;class H{constructor(o,h,p,_){this.context=o,this.format=p,this.texture=o.gl.createTexture(),this.update(h,_)}update(o,h,p){const{width:_,height:x}=o,E=!(this.size&&this.size[0]===_&&this.size[1]===x||p),{context:I}=this,{gl:M}=I;if(this.useMipmap=!!(h&&h.useMipmap),M.bindTexture(M.TEXTURE_2D,this.texture),I.pixelStoreUnpackFlipY.set(!1),I.pixelStoreUnpack.set(1),I.pixelStoreUnpackPremultiplyAlpha.set(this.format===M.RGBA&&(!h||h.premultiply!==!1)),E)this.size=[_,x],o instanceof HTMLImageElement||o instanceof HTMLCanvasElement||o instanceof HTMLVideoElement||o instanceof ImageData||l.isImageBitmap(o)?M.texImage2D(M.TEXTURE_2D,0,this.format,this.format,M.UNSIGNED_BYTE,o):M.texImage2D(M.TEXTURE_2D,0,this.format,_,x,0,this.format,M.UNSIGNED_BYTE,o.data);else{const{x:k,y:O}=p||{x:0,y:0};o instanceof HTMLImageElement||o instanceof HTMLCanvasElement||o instanceof HTMLVideoElement||o instanceof ImageData||l.isImageBitmap(o)?M.texSubImage2D(M.TEXTURE_2D,0,k,O,M.RGBA,M.UNSIGNED_BYTE,o):M.texSubImage2D(M.TEXTURE_2D,0,k,O,_,x,M.RGBA,M.UNSIGNED_BYTE,o.data)}this.useMipmap&&this.isSizePowerOfTwo()&&M.generateMipmap(M.TEXTURE_2D)}bind(o,h,p){const{context:_}=this,{gl:x}=_;x.bindTexture(x.TEXTURE_2D,this.texture),p!==x.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(p=x.LINEAR),o!==this.filter&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MAG_FILTER,o),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MIN_FILTER,p||o),this.filter=o),h!==this.wrap&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_S,h),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_T,h),this.wrap=h)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:o}=this.context;o.deleteTexture(this.texture),this.texture=null}}function ae(m){const{userImage:o}=m;return!!(o&&o.render&&o.render())&&(m.data.replace(new Uint8Array(o.data.buffer)),!0)}class G extends l.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new l.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(o){if(this.loaded!==o&&(this.loaded=o,o)){for(const{ids:h,callback:p}of this.requestors)this._notify(h,p);this.requestors=[]}}getImage(o){return this.images[o]}addImage(o,h){if(this.images[o])throw new Error(`Image id ${o} already exist, use updateImage instead`);this._validate(o,h)&&(this.images[o]=h)}_validate(o,h){let p=!0;return this._validateStretch(h.stretchX,h.data&&h.data.width)||(this.fire(new l.ErrorEvent(new Error(`Image "${o}" has invalid "stretchX" value`))),p=!1),this._validateStretch(h.stretchY,h.data&&h.data.height)||(this.fire(new l.ErrorEvent(new Error(`Image "${o}" has invalid "stretchY" value`))),p=!1),this._validateContent(h.content,h)||(this.fire(new l.ErrorEvent(new Error(`Image "${o}" has invalid "content" value`))),p=!1),p}_validateStretch(o,h){if(!o)return!0;let p=0;for(const _ of o){if(_[0]<p||_[1]<_[0]||h<_[1])return!1;p=_[1]}return!0}_validateContent(o,h){return!(o&&(o.length!==4||o[0]<0||h.data.width<o[0]||o[1]<0||h.data.height<o[1]||o[2]<0||h.data.width<o[2]||o[3]<0||h.data.height<o[3]||o[2]<o[0]||o[3]<o[1]))}updateImage(o,h){const p=this.images[o];if(p.data.width!==h.data.width||p.data.height!==h.data.height)throw new Error(`size mismatch between old image (${p.data.width}x${p.data.height}) and new image (${h.data.width}x${h.data.height}).`);h.version=p.version+1,this.images[o]=h,this.updatedImages[o]=!0}removeImage(o){const h=this.images[o];delete this.images[o],delete this.patterns[o],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(o,h){let p=!0;if(!this.isLoaded())for(const _ of o)this.images[_]||(p=!1);this.isLoaded()||p?this._notify(o,h):this.requestors.push({ids:o,callback:h})}_notify(o,h){const p={};for(const _ of o){this.images[_]||this.fire(new l.Event("styleimagemissing",{id:_}));const x=this.images[_];x?p[_]={data:x.data.clone(),pixelRatio:x.pixelRatio,sdf:x.sdf,version:x.version,stretchX:x.stretchX,stretchY:x.stretchY,content:x.content,hasRenderCallback:!!(x.userImage&&x.userImage.render)}:l.warnOnce(`Image "${_}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}h(null,p)}getPixelSize(){const{width:o,height:h}=this.atlasImage;return{width:o,height:h}}getPattern(o){const h=this.patterns[o],p=this.getImage(o);if(!p)return null;if(h&&h.position.version===p.version)return h.position;if(h)h.position.version=p.version;else{const _={w:p.data.width+2,h:p.data.height+2,x:0,y:0},x=new l.ImagePosition(_,p);this.patterns[o]={bin:_,position:x}}return this._updatePatternAtlas(),this.patterns[o].position}bind(o){const h=o.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new H(o,this.atlasImage,h.RGBA),this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)}_updatePatternAtlas(){const o=[];for(const x in this.patterns)o.push(this.patterns[x].bin);const{w:h,h:p}=l.potpack(o),_=this.atlasImage;_.resize({width:h||1,height:p||1});for(const x in this.patterns){const{bin:E}=this.patterns[x],I=E.x+1,M=E.y+1,k=this.images[x].data,O=k.width,B=k.height;l.RGBAImage.copy(k,_,{x:0,y:0},{x:I,y:M},{width:O,height:B}),l.RGBAImage.copy(k,_,{x:0,y:B-1},{x:I,y:M-1},{width:O,height:1}),l.RGBAImage.copy(k,_,{x:0,y:0},{x:I,y:M+B},{width:O,height:1}),l.RGBAImage.copy(k,_,{x:O-1,y:0},{x:I-1,y:M},{width:1,height:B}),l.RGBAImage.copy(k,_,{x:0,y:0},{x:I+O,y:M},{width:1,height:B})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(o){for(const h of o){if(this.callbackDispatchedThisFrame[h])continue;this.callbackDispatchedThisFrame[h]=!0;const p=this.images[h];p||l.warnOnce(`Image with ID: "${h}" was not found`),ae(p)&&this.updateImage(h,p)}}}const V=1e20;function W(m,o,h,p,_,x,E,I,M){for(let k=o;k<o+p;k++)ie(m,h*x+k,x,_,E,I,M);for(let k=h;k<h+_;k++)ie(m,k*x+o,1,p,E,I,M)}function ie(m,o,h,p,_,x,E){x[0]=0,E[0]=-V,E[1]=V,_[0]=m[o];for(let I=1,M=0,k=0;I<p;I++){_[I]=m[o+I*h];const O=I*I;do{const B=x[M];k=(_[I]-_[B]+O-B*B)/(I-B)/2}while(k<=E[M]&&--M>-1);M++,x[M]=I,E[M]=k,E[M+1]=V}for(let I=0,M=0;I<p;I++){for(;E[M+1]<I;)M++;const k=x[M],O=I-k;m[o+I*h]=_[k]+O*O}}class ge{constructor(o,h){this.requestManager=o,this.localIdeographFontFamily=h,this.entries={}}setURL(o){this.url=o}getGlyphs(o,h){const p=[];for(const _ in o)for(const x of o[_])p.push({stack:_,id:x});l.asyncAll(p,({stack:_,id:x},E)=>{let I=this.entries[_];I||(I=this.entries[_]={glyphs:{},requests:{},ranges:{}});let M=I.glyphs[x];if(M!==void 0)return void E(null,{stack:_,id:x,glyph:M});if(M=this._tinySDF(I,_,x),M)return I.glyphs[x]=M,void E(null,{stack:_,id:x,glyph:M});const k=Math.floor(x/256);if(256*k>65535)return void E(new Error("glyphs > 65535 not supported"));if(I.ranges[k])return void E(null,{stack:_,id:x,glyph:M});let O=I.requests[k];O||(O=I.requests[k]=[],ge.loadGlyphRange(_,k,this.url,this.requestManager,(B,q)=>{if(q){for(const re in q)this._doesCharSupportLocalGlyph(+re)||(I.glyphs[+re]=q[+re]);I.ranges[k]=!0}for(const re of O)re(B,q);delete I.requests[k]})),O.push((B,q)=>{B?E(B):q&&E(null,{stack:_,id:x,glyph:q[x]||null})})},(_,x)=>{if(_)h(_);else if(x){const E={};for(const{stack:I,id:M,glyph:k}of x)(E[I]||(E[I]={}))[M]=k&&{id:k.id,bitmap:k.bitmap.clone(),metrics:k.metrics};h(null,E)}})}_doesCharSupportLocalGlyph(o){return!!this.localIdeographFontFamily&&(l.unicodeBlockLookup["CJK Unified Ideographs"](o)||l.unicodeBlockLookup["Hangul Syllables"](o)||l.unicodeBlockLookup.Hiragana(o)||l.unicodeBlockLookup.Katakana(o))}_tinySDF(o,h,p){const _=this.localIdeographFontFamily;if(!_||!this._doesCharSupportLocalGlyph(p))return;let x=o.tinySDF;if(!x){let I="400";/bold/i.test(h)?I="900":/medium/i.test(h)?I="500":/light/i.test(h)&&(I="200"),x=o.tinySDF=new ge.TinySDF({fontSize:24,buffer:3,radius:8,cutoff:.25,fontFamily:_,fontWeight:I})}const E=x.draw(String.fromCharCode(p));return{id:p,bitmap:new l.AlphaImage({width:E.width||30,height:E.height||30},E.data),metrics:{width:E.glyphWidth||24,height:E.glyphHeight||24,left:E.glyphLeft||0,top:E.glyphTop-27||-8,advance:E.glyphAdvance||24}}}}ge.loadGlyphRange=function(m,o,h,p,_){const x=256*o,E=x+255,I=p.transformRequest(h.replace("{fontstack}",m).replace("{range}",`${x}-${E}`),l.ResourceType.Glyphs);l.getArrayBuffer(I,(M,k)=>{if(M)_(M);else if(k){const O={};for(const B of l.parseGlyphPbf(k))O[B.id]=B;_(null,O)}})},ge.TinySDF=class{constructor({fontSize:m=24,buffer:o=3,radius:h=8,cutoff:p=.25,fontFamily:_="sans-serif",fontWeight:x="normal",fontStyle:E="normal"}={}){this.buffer=o,this.cutoff=p,this.radius=h;const I=this.size=m+4*o,M=this._createCanvas(I),k=this.ctx=M.getContext("2d",{willReadFrequently:!0});k.font=`${E} ${x} ${m}px ${_}`,k.textBaseline="alphabetic",k.textAlign="left",k.fillStyle="black",this.gridOuter=new Float64Array(I*I),this.gridInner=new Float64Array(I*I),this.f=new Float64Array(I),this.z=new Float64Array(I+1),this.v=new Uint16Array(I)}_createCanvas(m){const o=document.createElement("canvas");return o.width=o.height=m,o}draw(m){const{width:o,actualBoundingBoxAscent:h,actualBoundingBoxDescent:p,actualBoundingBoxLeft:_,actualBoundingBoxRight:x}=this.ctx.measureText(m),E=Math.ceil(h),I=Math.min(this.size-this.buffer,Math.ceil(x-_)),M=Math.min(this.size-this.buffer,E+Math.ceil(p)),k=I+2*this.buffer,O=M+2*this.buffer,B=Math.max(k*O,0),q=new Uint8ClampedArray(B),re={data:q,width:k,height:O,glyphWidth:I,glyphHeight:M,glyphTop:E,glyphLeft:0,glyphAdvance:o};if(I===0||M===0)return re;const{ctx:te,buffer:ne,gridInner:fe,gridOuter:_e}=this;te.clearRect(ne,ne,I,M),te.fillText(m,ne,ne+E);const xe=te.getImageData(ne,ne,I,M);_e.fill(V,0,B),fe.fill(0,0,B);for(let se=0;se<M;se++)for(let Te=0;Te<I;Te++){const we=xe.data[4*(se*I+Te)+3]/255;if(we===0)continue;const ke=(se+ne)*k+Te+ne;if(we===1)_e[ke]=0,fe[ke]=V;else{const Re=.5-we;_e[ke]=Re>0?Re*Re:0,fe[ke]=Re<0?Re*Re:0}}W(_e,0,0,k,O,k,this.f,this.v,this.z),W(fe,ne,ne,I,M,k,this.f,this.v,this.z);for(let se=0;se<B;se++){const Te=Math.sqrt(_e[se])-Math.sqrt(fe[se]);q[se]=Math.round(255-255*(Te/this.radius+this.cutoff))}return re}};const be=new l.Properties({anchor:new l.DataConstantProperty(l.spec.light.anchor),position:new class{constructor(){this.specification=l.spec.light.position}possiblyEvaluate(m,o){return l.sphericalToCartesian(m.expression.evaluate(o))}interpolate(m,o,h){return{x:l.number(m.x,o.x,h),y:l.number(m.y,o.y,h),z:l.number(m.z,o.z,h)}}},color:new l.DataConstantProperty(l.spec.light.color),intensity:new l.DataConstantProperty(l.spec.light.intensity)}),De="-transition";class Ne extends l.Evented{constructor(o){super(),this._transitionable=new l.Transitionable(be),this.setLight(o),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(o,h={}){if(!this._validate(l.validateLight,o,h))for(const p in o){const _=o[p];p.endsWith(De)?this._transitionable.setTransition(p.slice(0,-De.length),_):this._transitionable.setValue(p,_)}}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,h,p){return(!p||p.validate!==!1)&&l.emitValidationErrors(this,o.call(l.validateStyle,l.extend({value:h,style:{glyphs:!0,sprite:!0},styleSpec:l.spec})))}}class He{constructor(o,h){this.width=o,this.height=h,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(o,h){const p=o.join(",")+String(h);return this.dashEntry[p]||(this.dashEntry[p]=this.addDash(o,h)),this.dashEntry[p]}getDashRanges(o,h,p){const _=[];let x=o.length%2==1?-o[o.length-1]*p:0,E=o[0]*p,I=!0;_.push({left:x,right:E,isDash:I,zeroLength:o[0]===0});let M=o[0];for(let k=1;k<o.length;k++){I=!I;const O=o[k];x=M*p,M+=O,E=M*p,_.push({left:x,right:E,isDash:I,zeroLength:O===0})}return _}addRoundDash(o,h,p){const _=h/2;for(let x=-p;x<=p;x++){const E=this.width*(this.nextRow+p+x);let I=0,M=o[I];for(let k=0;k<this.width;k++){k/M.right>1&&(M=o[++I]);const O=Math.abs(k-M.left),B=Math.abs(k-M.right),q=Math.min(O,B);let re;const te=x/p*(_+1);if(M.isDash){const ne=_-Math.abs(te);re=Math.sqrt(q*q+ne*ne)}else re=_-Math.sqrt(q*q+te*te);this.data[E+k]=Math.max(0,Math.min(255,re+128))}}}addRegularDash(o){for(let I=o.length-1;I>=0;--I){const M=o[I],k=o[I+1];M.zeroLength?o.splice(I,1):k&&k.isDash===M.isDash&&(k.left=M.left,o.splice(I,1))}const h=o[0],p=o[o.length-1];h.isDash===p.isDash&&(h.left=p.left-this.width,p.right=h.right+this.width);const _=this.width*this.nextRow;let x=0,E=o[x];for(let I=0;I<this.width;I++){I/E.right>1&&(E=o[++x]);const M=Math.abs(I-E.left),k=Math.abs(I-E.right),O=Math.min(M,k);this.data[_+I]=Math.max(0,Math.min(255,(E.isDash?O:-O)+128))}}addDash(o,h){const p=h?7:0,_=2*p+1;if(this.nextRow+_>this.height)return l.warnOnce("LineAtlas out of space"),null;let x=0;for(let I=0;I<o.length;I++)x+=o[I];if(x!==0){const I=this.width/x,M=this.getDashRanges(o,this.width,I);h?this.addRoundDash(M,I,p):this.addRegularDash(M)}const E={y:(this.nextRow+p+.5)/this.height,height:2*p/this.height,width:x};return this.nextRow+=_,this.dirty=!0,E}bind(o){const h=o.gl;this.texture?(h.bindTexture(h.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,h.texSubImage2D(h.TEXTURE_2D,0,0,0,this.width,this.height,h.ALPHA,h.UNSIGNED_BYTE,this.data))):(this.texture=h.createTexture(),h.bindTexture(h.TEXTURE_2D,this.texture),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.LINEAR),h.texImage2D(h.TEXTURE_2D,0,h.ALPHA,this.width,this.height,0,h.ALPHA,h.UNSIGNED_BYTE,this.data))}}class je{constructor(o,h){this.workerPool=o,this.actors=[],this.currentActor=0,this.id=l.uniqueId();const p=this.workerPool.acquire(this.id);for(let _=0;_<p.length;_++){const x=new je.Actor(p[_],h,this.id);x.name=`Worker ${_}`,this.actors.push(x)}if(!this.actors.length)throw new Error("No actors found")}broadcast(o,h,p){l.asyncAll(this.actors,(_,x)=>{_.send(o,h,x)},p=p||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(o=>{o.remove()}),this.actors=[],this.workerPool.release(this.id)}}function vt(m,o,h){const p=function(_,x){if(_)return h(_);if(x){const E=l.pick(l.extend(x,m),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);x.vector_layers&&(E.vectorLayers=x.vector_layers,E.vectorLayerIds=E.vectorLayers.map(I=>I.id)),h(null,E)}};return m.url?l.getJSON(o.transformRequest(m.url,l.ResourceType.Source),p):l.exported.frame(()=>p(null,m))}je.Actor=l.Actor;class Nt{constructor(o,h,p){this.bounds=l.LngLatBounds.convert(this.validateBounds(o)),this.minzoom=h||0,this.maxzoom=p||24}validateBounds(o){return Array.isArray(o)&&o.length===4?[Math.max(-180,o[0]),Math.max(-90,o[1]),Math.min(180,o[2]),Math.min(90,o[3])]:[-180,-90,180,90]}contains(o){const h=Math.pow(2,o.z),p=Math.floor(l.mercatorXfromLng(this.bounds.getWest())*h),_=Math.floor(l.mercatorYfromLat(this.bounds.getNorth())*h),x=Math.ceil(l.mercatorXfromLng(this.bounds.getEast())*h),E=Math.ceil(l.mercatorYfromLat(this.bounds.getSouth())*h);return o.x>=p&&o.x<x&&o.y>=_&&o.y<E}}class Qt extends l.Evented{constructor(o,h,p,_){if(super(),this.id=o,this.dispatcher=p,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,l.extend(this,l.pick(h,["url","scheme","tileSize","promoteId"])),this._options=l.extend({type:"vector"},h),this._collectResourceTiming=h.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(_)}load(){this._loaded=!1,this.fire(new l.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=vt(this._options,this.map._requestManager,(o,h)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),o?this.fire(new l.ErrorEvent(o)):h&&(l.extend(this,h),h.bounds&&(this.tileBounds=new Nt(h.bounds,this.minzoom,this.maxzoom)),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}onAdd(o){this.map=o,this.load()}setSourceProperty(o){this._tileJSONRequest&&this._tileJSONRequest.cancel(),o(),this.load()}setTiles(o){return this.setSourceProperty(()=>{this._options.tiles=o}),this}setUrl(o){return this.setSourceProperty(()=>{this.url=o,this._options.url=o}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return l.extend({},this._options)}loadTile(o,h){const p=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),_={request:this.map._requestManager.transformRequest(p,l.ResourceType.Tile),uid:o.uid,tileID:o.tileID,zoom:o.tileID.overscaledZ,tileSize:this.tileSize*o.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function x(E,I){return delete o.request,o.aborted?h(null):E&&E.status!==404?h(E):(I&&I.resourceTiming&&(o.resourceTiming=I.resourceTiming),this.map._refreshExpiredTiles&&I&&o.setExpiryData(I),o.loadVectorData(I,this.map.painter),l.cacheEntryPossiblyAdded(this.dispatcher),h(null),void(o.reloadCallback&&(this.loadTile(o,o.reloadCallback),o.reloadCallback=null)))}_.request.collectResourceTiming=this._collectResourceTiming,o.actor&&o.state!=="expired"?o.state==="loading"?o.reloadCallback=h:o.request=o.actor.send("reloadTile",_,x.bind(this)):(o.actor=this.dispatcher.getActor(),o.request=o.actor.send("loadTile",_,x.bind(this)))}abortTile(o){o.request&&(o.request.cancel(),delete o.request),o.actor&&o.actor.send("abortTile",{uid:o.uid,type:this.type,source:this.id},void 0)}unloadTile(o){o.unloadVectorData(),o.actor&&o.actor.send("removeTile",{uid:o.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class Bt extends l.Evented{constructor(o,h,p,_){super(),this.id=o,this.dispatcher=p,this.setEventedParent(_),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=l.extend({type:"raster"},h),l.extend(this,l.pick(h,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new l.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=vt(this._options,this.map._requestManager,(o,h)=>{this._tileJSONRequest=null,this._loaded=!0,o?this.fire(new l.ErrorEvent(o)):h&&(l.extend(this,h),h.bounds&&(this.tileBounds=new Nt(h.bounds,this.minzoom,this.maxzoom)),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(o){this.map=o,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return l.extend({},this._options)}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}loadTile(o,h){const p=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);o.request=l.getImage(this.map._requestManager.transformRequest(p,l.ResourceType.Tile),(_,x,E)=>{if(delete o.request,o.aborted)o.state="unloaded",h(null);else if(_)o.state="errored",h(_);else if(x){this.map._refreshExpiredTiles&&o.setExpiryData(E);const I=this.map.painter.context,M=I.gl;o.texture=this.map.painter.getTileTexture(x.width),o.texture?o.texture.update(x,{useMipmap:!0}):(o.texture=new H(I,x,M.RGBA,{useMipmap:!0}),o.texture.bind(M.LINEAR,M.CLAMP_TO_EDGE,M.LINEAR_MIPMAP_NEAREST),I.extTextureFilterAnisotropic&&M.texParameterf(M.TEXTURE_2D,I.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,I.extTextureFilterAnisotropicMax)),o.state="loaded",l.cacheEntryPossiblyAdded(this.dispatcher),h(null)}})}abortTile(o,h){o.request&&(o.request.cancel(),delete o.request),h()}unloadTile(o,h){o.texture&&this.map.painter.saveTileTexture(o.texture),h()}hasTransition(){return!1}}let ai;class Tt extends Bt{constructor(o,h,p,_){super(o,h,p,_),this.type="raster-dem",this.maxzoom=22,this._options=l.extend({type:"raster-dem"},h),this.encoding=h.encoding||"mapbox"}serialize(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}}loadTile(o,h){const p=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);function _(x,E){x&&(o.state="errored",h(x)),E&&(o.dem=E,o.needsHillshadePrepare=!0,o.needsTerrainPrepare=!0,o.state="loaded",h(null))}o.request=l.getImage(this.map._requestManager.transformRequest(p,l.ResourceType.Tile),(function(x,E){if(delete o.request,o.aborted)o.state="unloaded",h(null);else if(x)o.state="errored",h(x);else if(E){this.map._refreshExpiredTiles&&o.setExpiryData(E),delete E.cacheControl,delete E.expires;const I=l.isImageBitmap(E)&&(ai==null&&(ai=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),ai)?E:l.exported.getImageData(E,1),M={uid:o.uid,coord:o.tileID,source:this.id,rawImageData:I,encoding:this.encoding};o.actor&&o.state!=="expired"||(o.actor=this.dispatcher.getActor(),o.actor.send("loadDEMTile",M,_.bind(this)))}}).bind(this)),o.neighboringTiles=this._getNeighboringTiles(o.tileID)}_getNeighboringTiles(o){const h=o.canonical,p=Math.pow(2,h.z),_=(h.x-1+p)%p,x=h.x===0?o.wrap-1:o.wrap,E=(h.x+1+p)%p,I=h.x+1===p?o.wrap+1:o.wrap,M={};return M[new l.OverscaledTileID(o.overscaledZ,x,h.z,_,h.y).key]={backfilled:!1},M[new l.OverscaledTileID(o.overscaledZ,I,h.z,E,h.y).key]={backfilled:!1},h.y>0&&(M[new l.OverscaledTileID(o.overscaledZ,x,h.z,_,h.y-1).key]={backfilled:!1},M[new l.OverscaledTileID(o.overscaledZ,o.wrap,h.z,h.x,h.y-1).key]={backfilled:!1},M[new l.OverscaledTileID(o.overscaledZ,I,h.z,E,h.y-1).key]={backfilled:!1}),h.y+1<p&&(M[new l.OverscaledTileID(o.overscaledZ,x,h.z,_,h.y+1).key]={backfilled:!1},M[new l.OverscaledTileID(o.overscaledZ,o.wrap,h.z,h.x,h.y+1).key]={backfilled:!1},M[new l.OverscaledTileID(o.overscaledZ,I,h.z,E,h.y+1).key]={backfilled:!1}),M}unloadTile(o){o.demTexture&&this.map.painter.saveTileTexture(o.demTexture),o.fbo&&(o.fbo.destroy(),delete o.fbo),o.dem&&delete o.dem,delete o.neighboringTiles,o.state="unloaded",o.actor&&o.actor.send("removeDEMTile",{uid:o.uid,source:this.id})}}class Si extends l.Evented{constructor(o,h,p,_){super(),this.id=o,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=p.getActor(),this.setEventedParent(_),this._data=h.data,this._options=l.extend({},h),this._collectResourceTiming=h.collectResourceTiming,h.maxzoom!==void 0&&(this.maxzoom=h.maxzoom),h.type&&(this.type=h.type),h.attribution&&(this.attribution=h.attribution),this.promoteId=h.promoteId;const x=l.EXTENT/this.tileSize;this.workerOptions=l.extend({source:this.id,cluster:h.cluster||!1,geojsonVtOptions:{buffer:(h.buffer!==void 0?h.buffer:128)*x,tolerance:(h.tolerance!==void 0?h.tolerance:.375)*x,extent:l.EXTENT,maxZoom:this.maxzoom,lineMetrics:h.lineMetrics||!1,generateId:h.generateId||!1},superclusterOptions:{maxZoom:h.clusterMaxZoom!==void 0?h.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,h.clusterMinPoints||2),extent:l.EXTENT,radius:(h.clusterRadius||50)*x,log:!1,generateId:h.generateId||!1},clusterProperties:h.clusterProperties,filter:h.filter},h.workerOptions)}load(){this._updateWorkerData("metadata")}onAdd(o){this.map=o,this.load()}setData(o){return this._data=o,this._updateWorkerData("content"),this}getClusterExpansionZoom(o,h){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:o,source:this.id},h),this}getClusterChildren(o,h){return this.actor.send("geojson.getClusterChildren",{clusterId:o,source:this.id},h),this}getClusterLeaves(o,h,p,_){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:o,limit:h,offset:p},_),this}_updateWorkerData(o){const h=l.extend({},this.workerOptions),p=this._data;typeof p=="string"?(h.request=this.map._requestManager.transformRequest(l.exported.resolveURL(p),l.ResourceType.Source),h.request.collectResourceTiming=this._collectResourceTiming):h.data=JSON.stringify(p),this._pendingLoads++,this.fire(new l.Event("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,h,(_,x)=>{if(this._pendingLoads--,this._removed||x&&x.abandoned)return void this.fire(new l.Event("dataabort",{dataType:"source",sourceDataType:o}));let E=null;if(x&&x.resourceTiming&&x.resourceTiming[this.id]&&(E=x.resourceTiming[this.id].slice(0)),_)return void this.fire(new l.ErrorEvent(_));const I={dataType:"source",sourceDataType:o};this._collectResourceTiming&&E&&E.length>0&&l.extend(I,{resourceTiming:E}),this.fire(new l.Event("data",I))})}loaded(){return this._pendingLoads===0}loadTile(o,h){const p=o.actor?"reloadTile":"loadTile";o.actor=this.actor;const _={type:this.type,uid:o.uid,tileID:o.tileID,zoom:o.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};o.request=this.actor.send(p,_,(x,E)=>(delete o.request,o.unloadVectorData(),o.aborted?h(null):x?h(x):(o.loadVectorData(E,this.map.painter,p==="reloadTile"),h(null))))}abortTile(o){o.request&&(o.request.cancel(),delete o.request),o.aborted=!0}unloadTile(o){o.unloadVectorData(),this.actor.send("removeTile",{uid:o.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}serialize(){return l.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var rt=l.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class At extends l.Evented{constructor(o,h,p,_){super(),this.id=o,this.dispatcher=p,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(_),this.options=h}load(o,h){this._loaded=!1,this.fire(new l.Event("dataloading",{dataType:"source"})),this.url=this.options.url,l.getImage(this.map._requestManager.transformRequest(this.url,l.ResourceType.Image),(p,_)=>{this._loaded=!0,p?this.fire(new l.ErrorEvent(p)):_&&(this.image=_,o&&(this.coordinates=o),h&&h(),this._finishLoading())})}loaded(){return this._loaded}updateImage(o){return this.image&&o.url?(this.options.url=o.url,this.load(o.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(o){this.map=o,this.load()}setCoordinates(o){this.coordinates=o;const h=o.map(l.MercatorCoordinate.fromLngLat);this.tileID=function(_){let x=1/0,E=1/0,I=-1/0,M=-1/0;for(const q of _)x=Math.min(x,q.x),E=Math.min(E,q.y),I=Math.max(I,q.x),M=Math.max(M,q.y);const k=Math.max(I-x,M-E),O=Math.max(0,Math.floor(-Math.log(k)/Math.LN2)),B=Math.pow(2,O);return new l.CanonicalTileID(O,Math.floor((x+I)/2*B),Math.floor((E+M)/2*B))}(h),this.minzoom=this.maxzoom=this.tileID.z;const p=h.map(_=>this.tileID.getTilePoint(_)._round());return this._boundsArray=new l.RasterBoundsArray,this._boundsArray.emplaceBack(p[0].x,p[0].y,0,0),this._boundsArray.emplaceBack(p[1].x,p[1].y,l.EXTENT,0),this._boundsArray.emplaceBack(p[3].x,p[3].y,0,l.EXTENT),this._boundsArray.emplaceBack(p[2].x,p[2].y,l.EXTENT,l.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const o=this.map.painter.context,h=o.gl;this.boundsBuffer||(this.boundsBuffer=o.createVertexBuffer(this._boundsArray,rt.members)),this.boundsSegments||(this.boundsSegments=l.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new H(o,this.image,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));for(const p in this.tiles){const _=this.tiles[p];_.state!=="loaded"&&(_.state="loaded",_.texture=this.texture)}}loadTile(o,h){this.tileID&&this.tileID.equals(o.tileID.canonical)?(this.tiles[String(o.tileID.wrap)]=o,o.buckets={},h(null)):(o.state="errored",h(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Ct extends At{constructor(o,h,p,_){super(o,h,p,_),this.roundZoom=!0,this.type="video",this.options=h}load(){this._loaded=!1;const o=this.options;this.urls=[];for(const h of o.urls)this.urls.push(this.map._requestManager.transformRequest(h,l.ResourceType.Source).url);l.getVideo(this.urls,(h,p)=>{this._loaded=!0,h?this.fire(new l.ErrorEvent(h)):p&&(this.video=p,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(o){if(this.video){const h=this.video.seekable;o<h.start(0)||o>h.end(0)?this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${h.start(0)} and ${h.end(0)}-second mark.`))):this.video.currentTime=o}}getVideo(){return this.video}onAdd(o){this.map||(this.map=o,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const o=this.map.painter.context,h=o.gl;this.boundsBuffer||(this.boundsBuffer=o.createVertexBuffer(this._boundsArray,rt.members)),this.boundsSegments||(this.boundsSegments=l.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE),h.texSubImage2D(h.TEXTURE_2D,0,0,0,h.RGBA,h.UNSIGNED_BYTE,this.video)):(this.texture=new H(o,this.video,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));for(const p in this.tiles){const _=this.tiles[p];_.state!=="loaded"&&(_.state="loaded",_.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class an extends At{constructor(o,h,p,_){super(o,h,p,_),h.coordinates?Array.isArray(h.coordinates)&&h.coordinates.length===4&&!h.coordinates.some(x=>!Array.isArray(x)||x.length!==2||x.some(E=>typeof E!="number"))||this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${o}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${o}`,null,'missing required property "coordinates"'))),h.animate&&typeof h.animate!="boolean"&&this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${o}`,null,'optional "animate" property must be a boolean value'))),h.canvas?typeof h.canvas=="string"||h.canvas instanceof HTMLCanvasElement||this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${o}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${o}`,null,'missing required property "canvas"'))),this.options=h,this.animate=h.animate===void 0||h.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new l.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(o){this.map=o,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let o=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,o=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,o=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const h=this.map.painter.context,p=h.gl;this.boundsBuffer||(this.boundsBuffer=h.createVertexBuffer(this._boundsArray,rt.members)),this.boundsSegments||(this.boundsSegments=l.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(o||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new H(h,this.canvas,p.RGBA,{premultiply:!0});for(const _ in this.tiles){const x=this.tiles[_];x.state!=="loaded"&&(x.state="loaded",x.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const o of[this.canvas.width,this.canvas.height])if(isNaN(o)||o<=0)return!0;return!1}}const ln={vector:Qt,raster:Bt,"raster-dem":Tt,geojson:Si,video:Ct,image:At,canvas:an};function cr(m,o){const h=l.create();return l.translate(h,h,[1,1,0]),l.scale(h,h,[.5*m.width,.5*m.height,1]),l.multiply(h,h,m.calculatePosMatrix(o.toUnwrapped()))}function li(m,o,h,p,_,x){const E=function(B,q,re){if(B)for(const te of B){const ne=q[te];if(ne&&ne.source===re&&ne.type==="fill-extrusion")return!0}else for(const te in q){const ne=q[te];if(ne.source===re&&ne.type==="fill-extrusion")return!0}return!1}(_&&_.layers,o,m.id),I=x.maxPitchScaleFactor(),M=m.tilesIn(p,I,E);M.sort(Ai);const k=[];for(const B of M)k.push({wrappedTileID:B.tileID.wrapped().key,queryResults:B.tile.queryRenderedFeatures(o,h,m._state,B.queryGeometry,B.cameraQueryGeometry,B.scale,_,x,I,cr(m.transform,B.tileID))});const O=function(B){const q={},re={};for(const te of B){const ne=te.queryResults,fe=te.wrappedTileID,_e=re[fe]=re[fe]||{};for(const xe in ne){const se=ne[xe],Te=_e[xe]=_e[xe]||{},we=q[xe]=q[xe]||[];for(const ke of se)Te[ke.featureIndex]||(Te[ke.featureIndex]=!0,we.push(ke))}}return q}(k);for(const B in O)O[B].forEach(q=>{const re=q.feature,te=m.getFeatureState(re.layer["source-layer"],re.id);re.source=re.layer.source,re.layer["source-layer"]&&(re.sourceLayer=re.layer["source-layer"]),re.state=te});return O}function Ai(m,o){const h=m.tileID,p=o.tileID;return h.overscaledZ-p.overscaledZ||h.canonical.y-p.canonical.y||h.wrap-p.wrap||h.canonical.x-p.canonical.x}class ci{constructor(o,h){this.tileID=o,this.uid=l.uniqueId(),this.uses=0,this.tileSize=h,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.textures=[],this.textureCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(o){const h=o+this.timeAdded;h<l.exported.now()||this.fadeEndTime&&h<this.fadeEndTime||(this.fadeEndTime=h)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(o){this.demTexture&&o.saveTileTexture(this.demTexture),this.textures.forEach(h=>o.saveTileTexture(h)),this.demTexture=null,this.textures=[],this.textureCoords={}}loadVectorData(o,h,p){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",o){o.featureIndex&&(this.latestFeatureIndex=o.featureIndex,o.rawTileData?(this.latestRawTileData=o.rawTileData,this.latestFeatureIndex.rawTileData=o.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=o.collisionBoxArray,this.buckets=function(_,x){const E={};if(!x)return E;for(const I of _){const M=I.layerIds.map(k=>x.getLayer(k)).filter(Boolean);if(M.length!==0){I.layers=M,I.stateDependentLayerIds&&(I.stateDependentLayers=I.stateDependentLayerIds.map(k=>M.filter(O=>O.id===k)[0]));for(const k of M)E[k.id]=I}}return E}(o.buckets,h.style),this.hasSymbolBuckets=!1;for(const _ in this.buckets){const x=this.buckets[_];if(x instanceof l.SymbolBucket){if(this.hasSymbolBuckets=!0,!p)break;x.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const _ in this.buckets){const x=this.buckets[_];if(x instanceof l.SymbolBucket&&x.hasRTLText){this.hasRTLText=!0,l.lazyLoadRTLTextPlugin();break}}this.queryPadding=0;for(const _ in this.buckets){const x=this.buckets[_];this.queryPadding=Math.max(this.queryPadding,h.style.getLayer(_).queryRadius(x))}o.imageAtlas&&(this.imageAtlas=o.imageAtlas),o.glyphAtlasImage&&(this.glyphAtlasImage=o.glyphAtlasImage)}else this.collisionBoxArray=new l.CollisionBoxArray}unloadVectorData(){for(const o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(o){return this.buckets[o.id]}upload(o){for(const p in this.buckets){const _=this.buckets[p];_.uploadPending()&&_.upload(o)}const h=o.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new H(o,this.imageAtlas.image,h.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new H(o,this.glyphAtlasImage,h.ALPHA),this.glyphAtlasImage=null)}prepare(o){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(o,this.imageAtlasTexture)}queryRenderedFeatures(o,h,p,_,x,E,I,M,k,O){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:_,cameraQueryGeometry:x,scale:E,tileSize:this.tileSize,pixelPosMatrix:O,transform:M,params:I,queryPadding:this.queryPadding*k},o,h,p):{}}querySourceFeatures(o,h){const p=this.latestFeatureIndex;if(!p||!p.rawTileData)return;const _=p.loadVTLayers(),x=h?h.sourceLayer:"",E=_._geojsonTileLayer||_[x];if(!E)return;const I=l.createFilter(h&&h.filter),{z:M,x:k,y:O}=this.tileID.canonical,B={z:M,x:k,y:O};for(let q=0;q<E.length;q++){const re=E.feature(q);if(I.needGeometry){const fe=l.toEvaluationFeature(re,!0);if(!I.filter(new l.EvaluationParameters(this.tileID.overscaledZ),fe,this.tileID.canonical))continue}else if(!I.filter(new l.EvaluationParameters(this.tileID.overscaledZ),re))continue;const te=p.getId(re,x),ne=new l.GeoJSONFeature(re,M,k,O,te);ne.tile=B,o.push(ne)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(o){const h=this.expirationTime;if(o.cacheControl){const p=l.parseCacheControl(o.cacheControl);p["max-age"]&&(this.expirationTime=Date.now()+1e3*p["max-age"])}else o.expires&&(this.expirationTime=new Date(o.expires).getTime());if(this.expirationTime){const p=Date.now();let _=!1;if(this.expirationTime>p)_=!1;else if(h)if(this.expirationTime<h)_=!0;else{const x=this.expirationTime-h;x?this.expirationTime=p+Math.max(x,3e4):_=!0}else _=!0;_?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(o,h){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(o).length===0)return;const p=this.latestFeatureIndex.loadVTLayers();for(const _ in this.buckets){if(!h.style.hasLayer(_))continue;const x=this.buckets[_],E=x.layers[0].sourceLayer||"_geojsonTileLayer",I=p[E],M=o[E];if(!I||!M||Object.keys(M).length===0)continue;x.update(M,I,this.imageAtlas&&this.imageAtlas.patternPositions||{});const k=h&&h.style&&h.style.getLayer(_);k&&(this.queryPadding=Math.max(this.queryPadding,k.queryRadius(x)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<l.exported.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(o){this.symbolFadeHoldUntil=l.exported.now()+o}setDependencies(o,h){const p={};for(const _ of h)p[_]=!0;this.dependencies[o]=p}hasDependency(o,h){for(const p of o){const _=this.dependencies[p];if(_){for(const x of h)if(_[x])return!0}}return!1}}class pn{constructor(o,h){this.max=o,this.onRemove=h,this.reset()}reset(){for(const o in this.data)for(const h of this.data[o])h.timeout&&clearTimeout(h.timeout),this.onRemove(h.value);return this.data={},this.order=[],this}add(o,h,p){const _=o.wrapped().key;this.data[_]===void 0&&(this.data[_]=[]);const x={value:h,timeout:void 0};if(p!==void 0&&(x.timeout=setTimeout(()=>{this.remove(o,x)},p)),this.data[_].push(x),this.order.push(_),this.order.length>this.max){const E=this._getAndRemoveByKey(this.order[0]);E&&this.onRemove(E)}return this}has(o){return o.wrapped().key in this.data}getAndRemove(o){return this.has(o)?this._getAndRemoveByKey(o.wrapped().key):null}_getAndRemoveByKey(o){const h=this.data[o].shift();return h.timeout&&clearTimeout(h.timeout),this.data[o].length===0&&delete this.data[o],this.order.splice(this.order.indexOf(o),1),h.value}getByKey(o){const h=this.data[o];return h?h[0].value:null}get(o){return this.has(o)?this.data[o.wrapped().key][0].value:null}remove(o,h){if(!this.has(o))return this;const p=o.wrapped().key,_=h===void 0?0:this.data[p].indexOf(h),x=this.data[p][_];return this.data[p].splice(_,1),x.timeout&&clearTimeout(x.timeout),this.data[p].length===0&&delete this.data[p],this.onRemove(x.value),this.order.splice(this.order.indexOf(p),1),this}setMaxSize(o){for(this.max=o;this.order.length>this.max;){const h=this._getAndRemoveByKey(this.order[0]);h&&this.onRemove(h)}return this}filter(o){const h=[];for(const p in this.data)for(const _ of this.data[p])o(_.value)||h.push(_);for(const p of h)this.remove(p.value.tileID,p)}}class Pi{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(o,h,p){const _=String(h);if(this.stateChanges[o]=this.stateChanges[o]||{},this.stateChanges[o][_]=this.stateChanges[o][_]||{},l.extend(this.stateChanges[o][_],p),this.deletedStates[o]===null){this.deletedStates[o]={};for(const x in this.state[o])x!==_&&(this.deletedStates[o][x]=null)}else if(this.deletedStates[o]&&this.deletedStates[o][_]===null){this.deletedStates[o][_]={};for(const x in this.state[o][_])p[x]||(this.deletedStates[o][_][x]=null)}else for(const x in p)this.deletedStates[o]&&this.deletedStates[o][_]&&this.deletedStates[o][_][x]===null&&delete this.deletedStates[o][_][x]}removeFeatureState(o,h,p){if(this.deletedStates[o]===null)return;const _=String(h);if(this.deletedStates[o]=this.deletedStates[o]||{},p&&h!==void 0)this.deletedStates[o][_]!==null&&(this.deletedStates[o][_]=this.deletedStates[o][_]||{},this.deletedStates[o][_][p]=null);else if(h!==void 0)if(this.stateChanges[o]&&this.stateChanges[o][_])for(p in this.deletedStates[o][_]={},this.stateChanges[o][_])this.deletedStates[o][_][p]=null;else this.deletedStates[o][_]=null;else this.deletedStates[o]=null}getState(o,h){const p=String(h),_=l.extend({},(this.state[o]||{})[p],(this.stateChanges[o]||{})[p]);if(this.deletedStates[o]===null)return{};if(this.deletedStates[o]){const x=this.deletedStates[o][h];if(x===null)return{};for(const E in x)delete _[E]}return _}initializeTileState(o,h){o.setFeatureState(this.state,h)}coalesceChanges(o,h){const p={};for(const _ in this.stateChanges){this.state[_]=this.state[_]||{};const x={};for(const E in this.stateChanges[_])this.state[_][E]||(this.state[_][E]={}),l.extend(this.state[_][E],this.stateChanges[_][E]),x[E]=this.state[_][E];p[_]=x}for(const _ in this.deletedStates){this.state[_]=this.state[_]||{};const x={};if(this.deletedStates[_]===null)for(const E in this.state[_])x[E]={},this.state[_][E]={};else for(const E in this.deletedStates[_]){if(this.deletedStates[_][E]===null)this.state[_][E]={};else for(const I of Object.keys(this.deletedStates[_][E]))delete this.state[_][E][I];x[E]=this.state[_][E]}p[_]=p[_]||{},l.extend(p[_],x)}if(this.stateChanges={},this.deletedStates={},Object.keys(p).length!==0)for(const _ in o)o[_].setFeatureState(p,h)}}class Kt extends l.Evented{constructor(o,h,p){super(),this.id=o,this.dispatcher=p,this.on("data",_=>{_.dataType==="source"&&_.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&_.dataType==="source"&&_.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain))}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=function(_,x,E,I){const M=new ln[x.type](_,x,E,I);if(M.id!==_)throw new Error(`Expected Source id to be ${_} instead of ${M.id}`);return l.bindAll(["load","abort","unload","serialize","prepare"],M),M}(o,h,p,this),this._tiles={},this._cache=new pn(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Pi}onAdd(o){this.map=o,this._maxTileCacheSize=o?o._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(o)}onRemove(o){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(o)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const o in this._tiles){const h=this._tiles[o];if(h.state!=="loaded"&&h.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const o=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,o&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(o,h){return this._source.loadTile(o,h)}_unloadTile(o){if(this._source.unloadTile)return this._source.unloadTile(o,()=>{})}_abortTile(o){this._source.abortTile&&this._source.abortTile(o,()=>{}),this._source.fire(new l.Event("dataabort",{tile:o,coord:o.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(o){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const h in this._tiles){const p=this._tiles[h];p.upload(o),p.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(o=>o.tileID).sort(Un).map(o=>o.key)}getRenderableIds(o){const h=[];for(const p in this._tiles)this._isIdRenderable(p,o)&&h.push(this._tiles[p]);return o?h.sort((p,_)=>{const x=p.tileID,E=_.tileID,I=new l.pointGeometry(x.canonical.x,x.canonical.y)._rotate(this.transform.angle),M=new l.pointGeometry(E.canonical.x,E.canonical.y)._rotate(this.transform.angle);return x.overscaledZ-E.overscaledZ||M.y-I.y||M.x-I.x}).map(p=>p.tileID.key):h.map(p=>p.tileID).sort(Un).map(p=>p.key)}hasRenderableParent(o){const h=this.findLoadedParent(o,0);return!!h&&this._isIdRenderable(h.tileID.key)}_isIdRenderable(o,h){return this._tiles[o]&&this._tiles[o].hasData()&&!this._coveredTiles[o]&&(h||!this._tiles[o].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const o in this._tiles)this._tiles[o].state!=="errored"&&this._reloadTile(o,"reloading")}}_reloadTile(o,h){const p=this._tiles[o];p&&(p.state!=="loading"&&(p.state=h),this._loadTile(p,this._tileLoaded.bind(this,p,o,h)))}_tileLoaded(o,h,p,_){if(_)return o.state="errored",void(_.status!==404?this._source.fire(new l.ErrorEvent(_,{tile:o})):this.update(this.transform,this.terrain));o.timeAdded=l.exported.now(),p==="expired"&&(o.refreshedUponExpiration=!0),this._setTileReloadTimer(h,o),this.getSource().type==="raster-dem"&&o.dem&&this._backfillDEM(o),this._state.initializeTileState(o,this.map?this.map.painter:null),o.aborted||this._source.fire(new l.Event("data",{dataType:"source",tile:o,coord:o.tileID}))}_backfillDEM(o){const h=this.getRenderableIds();for(let _=0;_<h.length;_++){const x=h[_];if(o.neighboringTiles&&o.neighboringTiles[x]){const E=this.getTileByID(x);p(o,E),p(E,o)}}function p(_,x){_.needsHillshadePrepare=!0,_.needsTerrainPrepare=!0;let E=x.tileID.canonical.x-_.tileID.canonical.x;const I=x.tileID.canonical.y-_.tileID.canonical.y,M=Math.pow(2,_.tileID.canonical.z),k=x.tileID.key;E===0&&I===0||Math.abs(I)>1||(Math.abs(E)>1&&(Math.abs(E+M)===1?E+=M:Math.abs(E-M)===1&&(E-=M)),x.dem&&_.dem&&(_.dem.backfillBorder(x.dem,E,I),_.neighboringTiles&&_.neighboringTiles[k]&&(_.neighboringTiles[k].backfilled=!0)))}}getTile(o){return this.getTileByID(o.key)}getTileByID(o){return this._tiles[o]}_retainLoadedChildren(o,h,p,_){for(const x in this._tiles){let E=this._tiles[x];if(_[x]||!E.hasData()||E.tileID.overscaledZ<=h||E.tileID.overscaledZ>p)continue;let I=E.tileID;for(;E&&E.tileID.overscaledZ>h+1;){const k=E.tileID.scaledTo(E.tileID.overscaledZ-1);E=this._tiles[k.key],E&&E.hasData()&&(I=k)}let M=I;for(;M.overscaledZ>h;)if(M=M.scaledTo(M.overscaledZ-1),o[M.key]){_[I.key]=I;break}}}findLoadedParent(o,h){if(o.key in this._loadedParentTiles){const p=this._loadedParentTiles[o.key];return p&&p.tileID.overscaledZ>=h?p:null}for(let p=o.overscaledZ-1;p>=h;p--){const _=o.scaledTo(p),x=this._getLoadedTile(_);if(x)return x}}_getLoadedTile(o){const h=this._tiles[o.key];return h&&h.hasData()?h:this._cache.getByKey(o.wrapped().key)}updateCacheSize(o){const h=Math.ceil(o.width/this._source.tileSize)+1,p=Math.ceil(o.height/this._source.tileSize)+1,_=Math.floor(h*p*5),x=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,_):_;this._cache.setMaxSize(x)}handleWrapJump(o){const h=Math.round((o-(this._prevLng===void 0?o:this._prevLng))/360);if(this._prevLng=o,h){const p={};for(const _ in this._tiles){const x=this._tiles[_];x.tileID=x.tileID.unwrapTo(x.tileID.wrap+h),p[x.tileID.key]=x}this._tiles=p;for(const _ in this._timers)clearTimeout(this._timers[_]),delete this._timers[_];for(const _ in this._tiles)this._setTileReloadTimer(_,this._tiles[_])}}update(o,h){if(this.transform=o,this.terrain=h,!this._sourceLoaded||this._paused)return;let p;this.updateCacheSize(o),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?p=o.getVisibleUnwrappedCoordinates(this._source.tileID).map(k=>new l.OverscaledTileID(k.canonical.z,k.wrap,k.canonical.z,k.canonical.x,k.canonical.y)):(p=o.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:h}),this._source.hasTile&&(p=p.filter(k=>this._source.hasTile(k)))):p=[];const _=o.coveringZoomLevel(this._source),x=Math.max(_-Kt.maxOverzooming,this._source.minzoom),E=Math.max(_+Kt.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const k={};for(const O of p)if(O.canonical.z>this._source.minzoom){const B=O.scaledTo(O.canonical.z-1);k[B.key]=B;const q=O.scaledTo(Math.max(this._source.minzoom,Math.min(O.canonical.z,5)));k[q.key]=q}p=p.concat(Object.values(k))}const I=this._updateRetainedTiles(p,_);if(us(this._source.type)){const k={},O={},B=Object.keys(I);for(const q of B){const re=I[q],te=this._tiles[q];if(!te||te.fadeEndTime&&te.fadeEndTime<=l.exported.now())continue;const ne=this.findLoadedParent(re,x);ne&&(this._addTile(ne.tileID),k[ne.tileID.key]=ne.tileID),O[q]=re}this._retainLoadedChildren(O,_,E,I);for(const q in k)I[q]||(this._coveredTiles[q]=!0,I[q]=k[q]);if(h){const q={},re={};for(const te of p)this._tiles[te.key].hasData()?q[te.key]=te:re[te.key]=te;for(const te in re){const ne=re[te].children(this._source.maxzoom);this._tiles[ne[0].key]&&this._tiles[ne[1].key]&&this._tiles[ne[2].key]&&this._tiles[ne[3].key]&&(q[ne[0].key]=I[ne[0].key]=ne[0],q[ne[1].key]=I[ne[1].key]=ne[1],q[ne[2].key]=I[ne[2].key]=ne[2],q[ne[3].key]=I[ne[3].key]=ne[3],delete re[te])}for(const te in re){const ne=this.findLoadedParent(re[te],this._source.minzoom);if(ne){q[ne.tileID.key]=I[ne.tileID.key]=ne.tileID;for(const fe in q)q[fe].isChildOf(ne.tileID)&&delete q[fe]}}for(const te in this._tiles)q[te]||(this._coveredTiles[te]=!0)}}for(const k in I)this._tiles[k].clearFadeHold();const M=l.keysDifference(this._tiles,I);for(const k of M){const O=this._tiles[k];O.hasSymbolBuckets&&!O.holdingForFade()?O.setHoldDuration(this.map._fadeDuration):O.hasSymbolBuckets&&!O.symbolFadeFinished()||this._removeTile(k)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const o in this._tiles)this._tiles[o].holdingForFade()&&this._removeTile(o)}_updateRetainedTiles(o,h){const p={},_={},x=Math.max(h-Kt.maxOverzooming,this._source.minzoom),E=Math.max(h+Kt.maxUnderzooming,this._source.minzoom),I={};for(const M of o){const k=this._addTile(M);p[M.key]=M,k.hasData()||h<this._source.maxzoom&&(I[M.key]=M)}this._retainLoadedChildren(I,h,E,p);for(const M of o){let k=this._tiles[M.key];if(k.hasData())continue;if(h+1>this._source.maxzoom){const B=M.children(this._source.maxzoom)[0],q=this.getTile(B);if(q&&q.hasData()){p[B.key]=B;continue}}else{const B=M.children(this._source.maxzoom);if(p[B[0].key]&&p[B[1].key]&&p[B[2].key]&&p[B[3].key])continue}let O=k.wasRequested();for(let B=M.overscaledZ-1;B>=x;--B){const q=M.scaledTo(B);if(_[q.key]||(_[q.key]=!0,k=this.getTile(q),!k&&O&&(k=this._addTile(q)),k&&(p[q.key]=q,O=k.wasRequested(),k.hasData())))break}}return p}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const o in this._tiles){const h=[];let p,_=this._tiles[o].tileID;for(;_.overscaledZ>0;){if(_.key in this._loadedParentTiles){p=this._loadedParentTiles[_.key];break}h.push(_.key);const x=_.scaledTo(_.overscaledZ-1);if(p=this._getLoadedTile(x),p)break;_=x}for(const x of h)this._loadedParentTiles[x]=p}}_addTile(o){let h=this._tiles[o.key];if(h)return h;h=this._cache.getAndRemove(o),h&&(this._setTileReloadTimer(o.key,h),h.tileID=o,this._state.initializeTileState(h,this.map?this.map.painter:null),this._cacheTimers[o.key]&&(clearTimeout(this._cacheTimers[o.key]),delete this._cacheTimers[o.key],this._setTileReloadTimer(o.key,h)));const p=h;return h||(h=new ci(o,this._source.tileSize*o.overscaleFactor()),this._loadTile(h,this._tileLoaded.bind(this,h,o.key,h.state))),h.uses++,this._tiles[o.key]=h,p||this._source.fire(new l.Event("dataloading",{tile:h,coord:h.tileID,dataType:"source"})),h}_setTileReloadTimer(o,h){o in this._timers&&(clearTimeout(this._timers[o]),delete this._timers[o]);const p=h.getExpiryTimeout();p&&(this._timers[o]=setTimeout(()=>{this._reloadTile(o,"expired"),delete this._timers[o]},p))}_removeTile(o){const h=this._tiles[o];h&&(h.uses--,delete this._tiles[o],this._timers[o]&&(clearTimeout(this._timers[o]),delete this._timers[o]),h.uses>0||(h.hasData()&&h.state!=="reloading"?this._cache.add(h.tileID,h,h.getExpiryTimeout()):(h.aborted=!0,this._abortTile(h),this._unloadTile(h))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const o in this._tiles)this._removeTile(o);this._cache.reset()}tilesIn(o,h,p){const _=[],x=this.transform;if(!x)return _;const E=p?x.getCameraQueryGeometry(o):o,I=o.map(te=>x.pointCoordinate(te,this.terrain)),M=E.map(te=>x.pointCoordinate(te,this.terrain)),k=this.getIds();let O=1/0,B=1/0,q=-1/0,re=-1/0;for(const te of M)O=Math.min(O,te.x),B=Math.min(B,te.y),q=Math.max(q,te.x),re=Math.max(re,te.y);for(let te=0;te<k.length;te++){const ne=this._tiles[k[te]];if(ne.holdingForFade())continue;const fe=ne.tileID,_e=Math.pow(2,x.zoom-ne.tileID.overscaledZ),xe=h*ne.queryPadding*l.EXTENT/ne.tileSize/_e,se=[fe.getTilePoint(new l.MercatorCoordinate(O,B)),fe.getTilePoint(new l.MercatorCoordinate(q,re))];if(se[0].x-xe<l.EXTENT&&se[0].y-xe<l.EXTENT&&se[1].x+xe>=0&&se[1].y+xe>=0){const Te=I.map(ke=>fe.getTilePoint(ke)),we=M.map(ke=>fe.getTilePoint(ke));_.push({tile:ne,tileID:fe,queryGeometry:Te,cameraQueryGeometry:we,scale:_e})}}return _}getVisibleCoordinates(o){const h=this.getRenderableIds(o).map(p=>this._tiles[p].tileID);for(const p of h)p.posMatrix=this.transform.calculatePosMatrix(p.toUnwrapped());return h}hasTransition(){if(this._source.hasTransition())return!0;if(us(this._source.type))for(const o in this._tiles){const h=this._tiles[o];if(h.fadeEndTime!==void 0&&h.fadeEndTime>=l.exported.now())return!0}return!1}setFeatureState(o,h,p){this._state.updateState(o=o||"_geojsonTileLayer",h,p)}removeFeatureState(o,h,p){this._state.removeFeatureState(o=o||"_geojsonTileLayer",h,p)}getFeatureState(o,h){return this._state.getState(o=o||"_geojsonTileLayer",h)}setDependencies(o,h,p){const _=this._tiles[o];_&&_.setDependencies(h,p)}reloadTilesForDependencies(o,h){for(const p in this._tiles)this._tiles[p].hasDependency(o,h)&&this._reloadTile(p,"reloading");this._cache.filter(p=>!p.hasDependency(o,h))}}function Un(m,o){const h=Math.abs(2*m.wrap)-+(m.wrap<0),p=Math.abs(2*o.wrap)-+(o.wrap<0);return m.overscaledZ-o.overscaledZ||p-h||o.canonical.y-m.canonical.y||o.canonical.x-m.canonical.x}function us(m){return m==="raster"||m==="image"||m==="video"}Kt.maxOverzooming=10,Kt.maxUnderzooming=3;const Oi="mapboxgl_preloaded_worker_pool";class ei{constructor(){this.active={}}acquire(o){if(!this.workers)for(this.workers=[];this.workers.length<ei.workerCount;)this.workers.push(new Worker(Mo.workerUrl));return this.active[o]=!0,this.workers.slice()}release(o){delete this.active[o],this.numActive()===0&&(this.workers.forEach(h=>{h.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Oi]}numActive(){return Object.keys(this.active).length}}const Br=Math.floor(l.exported.hardwareConcurrency/2);let qi;function yi(){return qi||(qi=new ei),qi}function Zi(m,o){const h={};for(const p in m)p!=="ref"&&(h[p]=m[p]);return l.refProperties.forEach(p=>{p in o&&(h[p]=o[p])}),h}function Xs(m){m=m.slice();const o=Object.create(null);for(let h=0;h<m.length;h++)o[m[h].id]=m[h];for(let h=0;h<m.length;h++)"ref"in m[h]&&(m[h]=Zi(m[h],o[m[h].ref]));return m}ei.workerCount=Math.max(Math.min(Br,6),1);const $t={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Fi(m,o,h){h.push({command:$t.addSource,args:[m,o[m]]})}function Vn(m,o,h){o.push({command:$t.removeSource,args:[m]}),h[m]=!0}function hs(m,o,h,p){Vn(m,h,p),Fi(m,o,h)}function To(m,o,h){let p;for(p in m[h])if(Object.prototype.hasOwnProperty.call(m[h],p)&&p!=="data"&&!C(m[h][p],o[h][p]))return!1;for(p in o[h])if(Object.prototype.hasOwnProperty.call(o[h],p)&&p!=="data"&&!C(m[h][p],o[h][p]))return!1;return!0}function Ur(m,o,h,p,_,x){let E;for(E in o=o||{},m=m||{})Object.prototype.hasOwnProperty.call(m,E)&&(C(m[E],o[E])||h.push({command:x,args:[p,E,o[E],_]}));for(E in o)Object.prototype.hasOwnProperty.call(o,E)&&!Object.prototype.hasOwnProperty.call(m,E)&&(C(m[E],o[E])||h.push({command:x,args:[p,E,o[E],_]}))}function Vr(m){return m.id}function Ys(m,o){return m[o.id]=o,m}class Sr{constructor(o,h){this.reset(o,h)}reset(o,h){this.points=o||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(o){if(this.points.length===1)return this.points[0];o=l.clamp(o,0,1);let h=1,p=this._distances[h];const _=o*this.paddedLength+this.padding;for(;p<_&&h<this._distances.length;)p=this._distances[++h];const x=h-1,E=this._distances[x],I=p-E,M=I>0?(_-E)/I:0;return this.points[x].mult(1-M).add(this.points[h].mult(M))}}function Le(m,o){let h=!0;return m==="always"||m!=="never"&&o!=="never"||(h=!1),h}class qe{constructor(o,h,p){const _=this.boxCells=[],x=this.circleCells=[];this.xCellCount=Math.ceil(o/p),this.yCellCount=Math.ceil(h/p);for(let E=0;E<this.xCellCount*this.yCellCount;E++)_.push([]),x.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=o,this.height=h,this.xScale=this.xCellCount/o,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(o,h,p,_,x){this._forEachCell(h,p,_,x,this._insertBoxCell,this.boxUid++),this.boxKeys.push(o),this.bboxes.push(h),this.bboxes.push(p),this.bboxes.push(_),this.bboxes.push(x)}insertCircle(o,h,p,_){this._forEachCell(h-_,p-_,h+_,p+_,this._insertCircleCell,this.circleUid++),this.circleKeys.push(o),this.circles.push(h),this.circles.push(p),this.circles.push(_)}_insertBoxCell(o,h,p,_,x,E){this.boxCells[x].push(E)}_insertCircleCell(o,h,p,_,x,E){this.circleCells[x].push(E)}_query(o,h,p,_,x,E,I){if(p<0||o>this.width||_<0||h>this.height)return[];const M=[];if(o<=0&&h<=0&&this.width<=p&&this.height<=_){if(x)return[{key:null,x1:o,y1:h,x2:p,y2:_}];for(let k=0;k<this.boxKeys.length;k++)M.push({key:this.boxKeys[k],x1:this.bboxes[4*k],y1:this.bboxes[4*k+1],x2:this.bboxes[4*k+2],y2:this.bboxes[4*k+3]});for(let k=0;k<this.circleKeys.length;k++){const O=this.circles[3*k],B=this.circles[3*k+1],q=this.circles[3*k+2];M.push({key:this.circleKeys[k],x1:O-q,y1:B-q,x2:O+q,y2:B+q})}}else this._forEachCell(o,h,p,_,this._queryCell,M,{hitTest:x,overlapMode:E,seenUids:{box:{},circle:{}}},I);return M}query(o,h,p,_){return this._query(o,h,p,_,!1,null)}hitTest(o,h,p,_,x,E){return this._query(o,h,p,_,!0,x,E).length>0}hitTestCircle(o,h,p,_,x){const E=o-p,I=o+p,M=h-p,k=h+p;if(I<0||E>this.width||k<0||M>this.height)return!1;const O=[];return this._forEachCell(E,M,I,k,this._queryCellCircle,O,{hitTest:!0,overlapMode:_,circle:{x:o,y:h,radius:p},seenUids:{box:{},circle:{}}},x),O.length>0}_queryCell(o,h,p,_,x,E,I,M){const{seenUids:k,hitTest:O,overlapMode:B}=I,q=this.boxCells[x];if(q!==null){const te=this.bboxes;for(const ne of q)if(!k.box[ne]){k.box[ne]=!0;const fe=4*ne,_e=this.boxKeys[ne];if(o<=te[fe+2]&&h<=te[fe+3]&&p>=te[fe+0]&&_>=te[fe+1]&&(!M||M(_e))&&(!O||!Le(B,_e.overlapMode))&&(E.push({key:_e,x1:te[fe],y1:te[fe+1],x2:te[fe+2],y2:te[fe+3]}),O))return!0}}const re=this.circleCells[x];if(re!==null){const te=this.circles;for(const ne of re)if(!k.circle[ne]){k.circle[ne]=!0;const fe=3*ne,_e=this.circleKeys[ne];if(this._circleAndRectCollide(te[fe],te[fe+1],te[fe+2],o,h,p,_)&&(!M||M(_e))&&(!O||!Le(B,_e.overlapMode))){const xe=te[fe],se=te[fe+1],Te=te[fe+2];if(E.push({key:_e,x1:xe-Te,y1:se-Te,x2:xe+Te,y2:se+Te}),O)return!0}}}return!1}_queryCellCircle(o,h,p,_,x,E,I,M){const{circle:k,seenUids:O,overlapMode:B}=I,q=this.boxCells[x];if(q!==null){const te=this.bboxes;for(const ne of q)if(!O.box[ne]){O.box[ne]=!0;const fe=4*ne,_e=this.boxKeys[ne];if(this._circleAndRectCollide(k.x,k.y,k.radius,te[fe+0],te[fe+1],te[fe+2],te[fe+3])&&(!M||M(_e))&&!Le(B,_e.overlapMode))return E.push(!0),!0}}const re=this.circleCells[x];if(re!==null){const te=this.circles;for(const ne of re)if(!O.circle[ne]){O.circle[ne]=!0;const fe=3*ne,_e=this.circleKeys[ne];if(this._circlesCollide(te[fe],te[fe+1],te[fe+2],k.x,k.y,k.radius)&&(!M||M(_e))&&!Le(B,_e.overlapMode))return E.push(!0),!0}}}_forEachCell(o,h,p,_,x,E,I,M){const k=this._convertToXCellCoord(o),O=this._convertToYCellCoord(h),B=this._convertToXCellCoord(p),q=this._convertToYCellCoord(_);for(let re=k;re<=B;re++)for(let te=O;te<=q;te++)if(x.call(this,o,h,p,_,this.xCellCount*te+re,E,I,M))return}_convertToXCellCoord(o){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(o*this.xScale)))}_convertToYCellCoord(o){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(o*this.yScale)))}_circlesCollide(o,h,p,_,x,E){const I=_-o,M=x-h,k=p+E;return k*k>I*I+M*M}_circleAndRectCollide(o,h,p,_,x,E,I){const M=(E-_)/2,k=Math.abs(o-(_+M));if(k>M+p)return!1;const O=(I-x)/2,B=Math.abs(h-(x+O));if(B>O+p)return!1;if(k<=M||B<=O)return!0;const q=k-M,re=B-O;return q*q+re*re<=p*p}}function ds(m,o,h,p,_){const x=l.create();return o?(l.scale(x,x,[1/_,1/_,1]),h||l.rotateZ(x,x,p.angle)):l.multiply(x,p.labelPlaneMatrix,m),x}function Ii(m,o,h,p,_){if(o){const x=l.clone(m);return l.scale(x,x,[_,_,1]),h||l.rotateZ(x,x,-p.angle),x}return p.glCoordMatrix}function Gt(m,o,h){let p;h?(p=[m.x,m.y,h(m.x,m.y),1],l.transformMat4(p,p,o)):(p=[m.x,m.y,0,1],ur(p,p,o));const _=p[3];return{point:new l.pointGeometry(p[0]/_,p[1]/_),signedDistanceFromCamera:_}}function Xi(m,o){return .5+m/o*.5}function Ni(m,o){const h=m[0]/m[3],p=m[1]/m[3];return h>=-o[0]&&h<=o[0]&&p>=-o[1]&&p<=o[1]}function Bi(m,o,h,p,_,x,E,I,M,k){const O=p?m.textSizeData:m.iconSizeData,B=l.evaluateSizeForZoom(O,h.transform.zoom),q=[256/h.width*2+1,256/h.height*2+1],re=p?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;re.clear();const te=m.lineVertexArray,ne=p?m.text.placedSymbolArray:m.icon.placedSymbolArray,fe=h.transform.width/h.transform.height;let _e=!1;for(let xe=0;xe<ne.length;xe++){const se=ne.get(xe);if(se.hidden||se.writingMode===l.WritingMode.vertical&&!_e){Mt(se.numGlyphs,re);continue}let Te;if(_e=!1,k?(Te=[se.anchorX,se.anchorY,k(se.anchorX,se.anchorY),1],l.transformMat4(Te,Te,o)):(Te=[se.anchorX,se.anchorY,0,1],ur(Te,Te,o)),!Ni(Te,q)){Mt(se.numGlyphs,re);continue}const we=Xi(h.transform.cameraToCenterDistance,Te[3]),ke=l.evaluateSizeForFeature(O,B,se),Re=E?ke/we:ke*we,Be=new l.pointGeometry(se.anchorX,se.anchorY),Me=Gt(Be,_,k).point,nt={},Ze=kt(se,Re,!1,I,o,_,x,m.glyphOffsetArray,te,re,Me,Be,nt,fe,M,k);_e=Ze.useVertical,(Ze.notEnoughRoom||_e||Ze.needsFlipping&&kt(se,Re,!0,I,o,_,x,m.glyphOffsetArray,te,re,Me,Be,nt,fe,M,k).notEnoughRoom)&&Mt(se.numGlyphs,re)}p?m.text.dynamicLayoutVertexBuffer.updateData(re):m.icon.dynamicLayoutVertexBuffer.updateData(re)}function fs(m,o,h,p,_,x,E,I,M,k,O,B,q){const re=I.glyphStartIndex+I.numGlyphs,te=I.lineStartIndex,ne=I.lineStartIndex+I.lineLength,fe=o.getoffsetX(I.glyphStartIndex),_e=o.getoffsetX(re-1),xe=ti(m*fe,h,p,_,x,E,I.segment,te,ne,M,k,O,B,q);if(!xe)return null;const se=ti(m*_e,h,p,_,x,E,I.segment,te,ne,M,k,O,B,q);return se?{first:xe,last:se}:null}function $e(m,o,h,p){return m===l.WritingMode.horizontal&&Math.abs(h.y-o.y)>Math.abs(h.x-o.x)*p?{useVertical:!0}:(m===l.WritingMode.vertical?o.y<h.y:o.x>h.x)?{needsFlipping:!0}:null}function kt(m,o,h,p,_,x,E,I,M,k,O,B,q,re,te,ne){const fe=o/24,_e=m.lineOffsetX*fe,xe=m.lineOffsetY*fe;let se;if(m.numGlyphs>1){const Te=m.glyphStartIndex+m.numGlyphs,we=m.lineStartIndex,ke=m.lineStartIndex+m.lineLength,Re=fs(fe,I,_e,xe,h,O,B,m,M,x,q,te,ne);if(!Re)return{notEnoughRoom:!0};const Be=Gt(Re.first.point,E,ne).point,Me=Gt(Re.last.point,E,ne).point;if(p&&!h){const nt=$e(m.writingMode,Be,Me,re);if(nt)return nt}se=[Re.first];for(let nt=m.glyphStartIndex+1;nt<Te-1;nt++)se.push(ti(fe*I.getoffsetX(nt),_e,xe,h,O,B,m.segment,we,ke,M,x,q,te,ne));se.push(Re.last)}else{if(p&&!h){const we=Gt(B,_,ne).point,ke=m.lineStartIndex+m.segment+1,Re=new l.pointGeometry(M.getx(ke),M.gety(ke)),Be=Gt(Re,_,ne),Me=Be.signedDistanceFromCamera>0?Be.point:Lt(B,Re,we,1,_,ne),nt=$e(m.writingMode,we,Me,re);if(nt)return nt}const Te=ti(fe*I.getoffsetX(m.glyphStartIndex),_e,xe,h,O,B,m.segment,m.lineStartIndex,m.lineStartIndex+m.lineLength,M,x,q,te,ne);if(!Te)return{notEnoughRoom:!0};se=[Te]}for(const Te of se)l.addDynamicAttributes(k,Te.point,Te.angle);return{}}function Lt(m,o,h,p,_,x){const E=Gt(m.add(m.sub(o)._unit()),_,x).point,I=h.sub(E);return h.add(I._mult(p/I.mag()))}function ti(m,o,h,p,_,x,E,I,M,k,O,B,q,re){const te=p?m-o:m+o;let ne=te>0?1:-1,fe=0;p&&(ne*=-1,fe=Math.PI),ne<0&&(fe+=Math.PI);let _e=ne>0?I+E:I+E+1,xe=_,se=_,Te=0,we=0;const ke=Math.abs(te),Re=[];for(;Te+we<=ke;){if(_e+=ne,_e<I||_e>=M)return null;if(se=xe,Re.push(xe),xe=B[_e],xe===void 0){const st=new l.pointGeometry(k.getx(_e),k.gety(_e)),Rt=Gt(st,O,re);if(Rt.signedDistanceFromCamera>0)xe=B[_e]=Rt.point;else{const Ot=_e-ne;xe=Lt(Te===0?x:new l.pointGeometry(k.getx(Ot),k.gety(Ot)),st,se,ke-Te+1,O,re)}}Te+=we,we=se.dist(xe)}const Be=(ke-Te)/we,Me=xe.sub(se),nt=Me.mult(Be)._add(se);nt._add(Me._unit()._perp()._mult(h*ne));const Ze=fe+Math.atan2(xe.y-se.y,xe.x-se.x);return Re.push(nt),{point:nt,angle:q?Ze:0,path:Re}}const jr=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Mt(m,o){for(let h=0;h<m;h++){const p=o.length;o.resize(p+4),o.float32.set(jr,3*p)}}function ur(m,o,h){const p=o[0],_=o[1];return m[0]=h[0]*p+h[4]*_+h[12],m[1]=h[1]*p+h[5]*_+h[13],m[3]=h[3]*p+h[7]*_+h[15],m}const Zn=100;class Ks{constructor(o,h=new qe(o.width+200,o.height+200,25),p=new qe(o.width+200,o.height+200,25)){this.transform=o,this.grid=h,this.ignoredGrid=p,this.pitchfactor=Math.cos(o._pitch)*o.cameraToCenterDistance,this.screenRightBoundary=o.width+Zn,this.screenBottomBoundary=o.height+Zn,this.gridRightBoundary=o.width+200,this.gridBottomBoundary=o.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(o,h,p,_,x,E){const I=this.projectAndGetPerspectiveRatio(_,o.anchorPointX,o.anchorPointY,E),M=p*I.perspectiveRatio,k=o.x1*M+I.point.x,O=o.y1*M+I.point.y,B=o.x2*M+I.point.x,q=o.y2*M+I.point.y;return!this.isInsideGrid(k,O,B,q)||h!=="always"&&this.grid.hitTest(k,O,B,q,h,x)||I.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[k,O,B,q],offscreen:this.isOffscreen(k,O,B,q)}}placeCollisionCircles(o,h,p,_,x,E,I,M,k,O,B,q,re,te){const ne=[],fe=new l.pointGeometry(h.anchorX,h.anchorY),_e=Gt(fe,E,te),xe=Xi(this.transform.cameraToCenterDistance,_e.signedDistanceFromCamera),se=(O?x/xe:x*xe)/l.ONE_EM,Te=Gt(fe,I,te).point,we=fs(se,_,h.lineOffsetX*se,h.lineOffsetY*se,!1,Te,fe,h,p,I,{},!1,te);let ke=!1,Re=!1,Be=!0;if(we){const Me=.5*q*xe+re,nt=new l.pointGeometry(-100,-100),Ze=new l.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),st=new Sr,Rt=we.first,Ot=we.last;let bt=[];for(let Zt=Rt.path.length-1;Zt>=1;Zt--)bt.push(Rt.path[Zt]);for(let Zt=1;Zt<Ot.path.length;Zt++)bt.push(Ot.path[Zt]);const cn=2.5*Me;if(M){const Zt=bt.map(Xt=>Gt(Xt,M,te));bt=Zt.some(Xt=>Xt.signedDistanceFromCamera<=0)?[]:Zt.map(Xt=>Xt.point)}let un=[];if(bt.length>0){const Zt=bt[0].clone(),Xt=bt[0].clone();for(let dn=1;dn<bt.length;dn++)Zt.x=Math.min(Zt.x,bt[dn].x),Zt.y=Math.min(Zt.y,bt[dn].y),Xt.x=Math.max(Xt.x,bt[dn].x),Xt.y=Math.max(Xt.y,bt[dn].y);un=Zt.x>=nt.x&&Xt.x<=Ze.x&&Zt.y>=nt.y&&Xt.y<=Ze.y?[bt]:Xt.x<nt.x||Zt.x>Ze.x||Xt.y<nt.y||Zt.y>Ze.y?[]:l.clipLine([bt],nt.x,nt.y,Ze.x,Ze.y)}for(const Zt of un){st.reset(Zt,.25*Me);let Xt=0;Xt=st.length<=.5*Me?1:Math.ceil(st.paddedLength/cn)+1;for(let dn=0;dn<Xt;dn++){const hi=dn/Math.max(Xt-1,1),_s=st.lerp(hi),$r=_s.x+Zn,ys=_s.y+Zn;ne.push($r,ys,Me,0);const ao=$r-Me,Cr=ys-Me,Ki=$r+Me,Os=ys+Me;if(Be=Be&&this.isOffscreen(ao,Cr,Ki,Os),Re=Re||this.isInsideGrid(ao,Cr,Ki,Os),o!=="always"&&this.grid.hitTestCircle($r,ys,Me,o,B)&&(ke=!0,!k))return{circles:[],offscreen:!1,collisionDetected:ke}}}}return{circles:!k&&ke||!Re||xe<this.perspectiveRatioCutoff?[]:ne,offscreen:Be,collisionDetected:ke}}queryRenderedSymbols(o){if(o.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const h=[];let p=1/0,_=1/0,x=-1/0,E=-1/0;for(const O of o){const B=new l.pointGeometry(O.x+Zn,O.y+Zn);p=Math.min(p,B.x),_=Math.min(_,B.y),x=Math.max(x,B.x),E=Math.max(E,B.y),h.push(B)}const I=this.grid.query(p,_,x,E).concat(this.ignoredGrid.query(p,_,x,E)),M={},k={};for(const O of I){const B=O.key;if(M[B.bucketInstanceId]===void 0&&(M[B.bucketInstanceId]={}),M[B.bucketInstanceId][B.featureIndex])continue;const q=[new l.pointGeometry(O.x1,O.y1),new l.pointGeometry(O.x2,O.y1),new l.pointGeometry(O.x2,O.y2),new l.pointGeometry(O.x1,O.y2)];l.polygonIntersectsPolygon(h,q)&&(M[B.bucketInstanceId][B.featureIndex]=!0,k[B.bucketInstanceId]===void 0&&(k[B.bucketInstanceId]=[]),k[B.bucketInstanceId].push(B.featureIndex))}return k}insertCollisionBox(o,h,p,_,x,E){(p?this.ignoredGrid:this.grid).insert({bucketInstanceId:_,featureIndex:x,collisionGroupID:E,overlapMode:h},o[0],o[1],o[2],o[3])}insertCollisionCircles(o,h,p,_,x,E){const I=p?this.ignoredGrid:this.grid,M={bucketInstanceId:_,featureIndex:x,collisionGroupID:E,overlapMode:h};for(let k=0;k<o.length;k+=4)I.insertCircle(M,o[k],o[k+1],o[k+2])}projectAndGetPerspectiveRatio(o,h,p,_){let x;return _?(x=[h,p,_(h,p),1],l.transformMat4(x,x,o)):(x=[h,p,0,1],ur(x,x,o)),{point:new l.pointGeometry((x[0]/x[3]+1)/2*this.transform.width+Zn,(-x[1]/x[3]+1)/2*this.transform.height+Zn),perspectiveRatio:.5+this.transform.cameraToCenterDistance/x[3]*.5}}isOffscreen(o,h,p,_){return p<Zn||o>=this.screenRightBoundary||_<Zn||h>this.screenBottomBoundary}isInsideGrid(o,h,p,_){return p>=0&&o<this.gridRightBoundary&&_>=0&&h<this.gridBottomBoundary}getViewportMatrix(){const o=l.identity([]);return l.translate(o,o,[-100,-100,0]),o}}function On(m,o,h){return o*(l.EXTENT/(m.tileSize*Math.pow(2,h-m.tileID.overscaledZ)))}class ui{constructor(o,h,p,_){this.opacity=o?Math.max(0,Math.min(1,o.opacity+(o.placed?h:-h))):_&&p?1:0,this.placed=p}isHidden(){return this.opacity===0&&!this.placed}}class sn{constructor(o,h,p,_,x){this.text=new ui(o?o.text:null,h,p,x),this.icon=new ui(o?o.icon:null,h,_,x)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Js{constructor(o,h,p){this.text=o,this.icon=h,this.skipFade=p}}class Ar{constructor(){this.invProjMatrix=l.create(),this.viewportMatrix=l.create(),this.circles=[]}}class Pr{constructor(o,h,p,_,x){this.bucketInstanceId=o,this.featureIndex=h,this.sourceLayerIndex=p,this.bucketIndex=_,this.tileID=x}}class ks{constructor(o){this.crossSourceCollisions=o,this.maxGroupID=0,this.collisionGroups={}}get(o){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[o]){const h=++this.maxGroupID;this.collisionGroups[o]={ID:h,predicate:p=>p.collisionGroupID===h}}return this.collisionGroups[o]}}function Qs(m,o,h,p,_){const{horizontalAlign:x,verticalAlign:E}=l.getAnchorAlignment(m),I=-(x-.5)*o,M=-(E-.5)*h,k=l.evaluateVariableOffset(m,p);return new l.pointGeometry(I+k[0]*_,M+k[1]*_)}function ps(m,o,h,p,_,x){const{x1:E,x2:I,y1:M,y2:k,anchorPointX:O,anchorPointY:B}=m,q=new l.pointGeometry(o,h);return p&&q._rotate(_?x:-x),{x1:E+q.x,y1:M+q.y,x2:I+q.x,y2:k+q.y,anchorPointX:O,anchorPointY:B}}class ee{constructor(o,h,p,_,x){this.transform=o.clone(),this.terrain=h,this.collisionIndex=new Ks(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=p,this.retainedQueryData={},this.collisionGroups=new ks(_),this.collisionCircleArrays={},this.prevPlacement=x,x&&(x.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(o,h,p,_){const x=p.getBucket(h),E=p.latestFeatureIndex;if(!x||!E||h.id!==x.layerIds[0])return;const I=p.collisionBoxArray,M=x.layers[0].layout,k=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),O=p.tileSize/l.EXTENT,B=this.transform.calculatePosMatrix(p.tileID.toUnwrapped()),q=M.get("text-pitch-alignment")==="map",re=M.get("text-rotation-alignment")==="map",te=On(p,1,this.transform.zoom),ne=ds(B,q,re,this.transform,te);let fe=null;if(q){const xe=Ii(B,q,re,this.transform,te);fe=l.multiply([],this.transform.labelPlaneMatrix,xe)}this.retainedQueryData[x.bucketInstanceId]=new Pr(x.bucketInstanceId,E,x.sourceLayerIndex,x.index,p.tileID);const _e={bucket:x,layout:M,posMatrix:B,textLabelPlaneMatrix:ne,labelToScreenMatrix:fe,scale:k,textPixelRatio:O,holdingForFade:p.holdingForFade(),collisionBoxArray:I,partiallyEvaluatedTextSize:l.evaluateSizeForZoom(x.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(x.sourceID)};if(_)for(const xe of x.sortKeyRanges){const{sortKey:se,symbolInstanceStart:Te,symbolInstanceEnd:we}=xe;o.push({sortKey:se,symbolInstanceStart:Te,symbolInstanceEnd:we,parameters:_e})}else o.push({symbolInstanceStart:0,symbolInstanceEnd:x.symbolInstances.length,parameters:_e})}attemptAnchorPlacement(o,h,p,_,x,E,I,M,k,O,B,q,re,te,ne,fe){const _e=[q.textOffset0,q.textOffset1],xe=Qs(o,p,_,_e,x),se=this.collisionIndex.placeCollisionBox(ps(h,xe.x,xe.y,E,I,this.transform.angle),B,M,k,O.predicate,fe);if((!ne||this.collisionIndex.placeCollisionBox(ps(ne,xe.x,xe.y,E,I,this.transform.angle),B,M,k,O.predicate,fe).box.length!==0)&&se.box.length>0){let Te;if(this.prevPlacement&&this.prevPlacement.variableOffsets[q.crossTileID]&&this.prevPlacement.placements[q.crossTileID]&&this.prevPlacement.placements[q.crossTileID].text&&(Te=this.prevPlacement.variableOffsets[q.crossTileID].anchor),q.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[q.crossTileID]={textOffset:_e,width:p,height:_,anchor:o,textBoxScale:x,prevAnchor:Te},this.markUsedJustification(re,o,q,te),re.allowVerticalPlacement&&(this.markUsedOrientation(re,te,q),this.placedOrientations[q.crossTileID]=te),{shift:xe,placedGlyphBoxes:se}}}placeLayerBucketPart(o,h,p){const{bucket:_,layout:x,posMatrix:E,textLabelPlaneMatrix:I,labelToScreenMatrix:M,textPixelRatio:k,holdingForFade:O,collisionBoxArray:B,partiallyEvaluatedTextSize:q,collisionGroup:re}=o.parameters,te=x.get("text-optional"),ne=x.get("icon-optional"),fe=l.getOverlapMode(x,"text-overlap","text-allow-overlap"),_e=fe==="always",xe=l.getOverlapMode(x,"icon-overlap","icon-allow-overlap"),se=xe==="always",Te=x.get("text-rotation-alignment")==="map",we=x.get("text-pitch-alignment")==="map",ke=x.get("icon-text-fit")!=="none",Re=x.get("symbol-z-order")==="viewport-y",Be=_e&&(se||!_.hasIconData()||ne),Me=se&&(_e||!_.hasTextData()||te);!_.collisionArrays&&B&&_.deserializeCollisionBoxes(B);const nt=(Ze,st)=>{if(h[Ze.crossTileID])return;if(O)return void(this.placements[Ze.crossTileID]=new Js(!1,!1,!1));let Rt=!1,Ot=!1,bt=!0,cn=null,un={box:null,offscreen:null},Zt={box:null,offscreen:null},Xt=null,dn=null,hi=null,_s=0,$r=0,ys=0;st.textFeatureIndex?_s=st.textFeatureIndex:Ze.useRuntimeCollisionCircles&&(_s=Ze.featureIndex),st.verticalTextFeatureIndex&&($r=st.verticalTextFeatureIndex);const ao=this.retainedQueryData[_.bucketInstanceId].tileID,Cr=this.terrain?(ii,jt)=>this.terrain.getElevation(ao,ii,jt):null;for(const ii of["textBox","verticalTextBox","iconBox","verticalIconBox"]){const jt=st[ii];jt&&(jt.elevation=Cr?Cr(jt.anchorPointX,jt.anchorPointY):0)}const Ki=st.textBox;if(Ki){const ii=on=>{let di=l.WritingMode.horizontal;if(_.allowVerticalPlacement&&!on&&this.prevPlacement){const fi=this.prevPlacement.placedOrientations[Ze.crossTileID];fi&&(this.placedOrientations[Ze.crossTileID]=fi,di=fi,this.markUsedOrientation(_,di,Ze))}return di},jt=(on,di)=>{if(_.allowVerticalPlacement&&Ze.numVerticalGlyphVertices>0&&st.verticalTextBox){for(const fi of _.writingModes)if(fi===l.WritingMode.vertical?(un=di(),Zt=un):un=on(),un&&un.box&&un.box.length)break}else un=on()};if(x.get("text-variable-anchor")){let on=x.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Ze.crossTileID]){const Pn=this.prevPlacement.variableOffsets[Ze.crossTileID];on.indexOf(Pn.anchor)>0&&(on=on.filter(Mr=>Mr!==Pn.anchor),on.unshift(Pn.anchor))}const di=(Pn,Mr,Lo)=>{const yh=Pn.x2-Pn.x1,ya=Pn.y2-Pn.y1,Vf=Ze.textBoxScale,vh=ke&&xe==="never"?Mr:null;let lo={box:[],offscreen:!1};const ko=fe!=="never"?2*on.length:on.length;for(let Ro=0;Ro<ko;++Ro){const bc=this.attemptAnchorPlacement(on[Ro%on.length],Pn,yh,ya,Vf,Te,we,k,E,re,Ro>=on.length?fe:"never",Ze,_,Lo,vh,Cr);if(bc&&(lo=bc.placedGlyphBoxes,lo&&lo.box&&lo.box.length)){Rt=!0,cn=bc.shift;break}}return lo};jt(()=>di(Ki,st.iconBox,l.WritingMode.horizontal),()=>{const Pn=st.verticalTextBox;return _.allowVerticalPlacement&&!(un&&un.box&&un.box.length)&&Ze.numVerticalGlyphVertices>0&&Pn?di(Pn,st.verticalIconBox,l.WritingMode.vertical):{box:null,offscreen:null}}),un&&(Rt=un.box,bt=un.offscreen);const fi=ii(un&&un.box);if(!Rt&&this.prevPlacement){const Pn=this.prevPlacement.variableOffsets[Ze.crossTileID];Pn&&(this.variableOffsets[Ze.crossTileID]=Pn,this.markUsedJustification(_,Pn.anchor,Ze,fi))}}else{const on=(di,fi)=>{const Pn=this.collisionIndex.placeCollisionBox(di,fe,k,E,re.predicate,Cr);return Pn&&Pn.box&&Pn.box.length&&(this.markUsedOrientation(_,fi,Ze),this.placedOrientations[Ze.crossTileID]=fi),Pn};jt(()=>on(Ki,l.WritingMode.horizontal),()=>{const di=st.verticalTextBox;return _.allowVerticalPlacement&&Ze.numVerticalGlyphVertices>0&&di?on(di,l.WritingMode.vertical):{box:null,offscreen:null}}),ii(un&&un.box&&un.box.length)}}if(Xt=un,Rt=Xt&&Xt.box&&Xt.box.length>0,bt=Xt&&Xt.offscreen,Ze.useRuntimeCollisionCircles){const ii=_.text.placedSymbolArray.get(Ze.centerJustifiedTextSymbolIndex),jt=l.evaluateSizeForFeature(_.textSizeData,q,ii),on=x.get("text-padding");dn=this.collisionIndex.placeCollisionCircles(fe,ii,_.lineVertexArray,_.glyphOffsetArray,jt,E,I,M,p,we,re.predicate,Ze.collisionCircleDiameter,on,Cr),dn.circles.length&&dn.collisionDetected&&!p&&l.warnOnce("Collisions detected, but collision boxes are not shown"),Rt=_e||dn.circles.length>0&&!dn.collisionDetected,bt=bt&&dn.offscreen}if(st.iconFeatureIndex&&(ys=st.iconFeatureIndex),st.iconBox){const ii=jt=>{const on=ke&&cn?ps(jt,cn.x,cn.y,Te,we,this.transform.angle):jt;return this.collisionIndex.placeCollisionBox(on,xe,k,E,re.predicate,Cr)};Zt&&Zt.box&&Zt.box.length&&st.verticalIconBox?(hi=ii(st.verticalIconBox),Ot=hi.box.length>0):(hi=ii(st.iconBox),Ot=hi.box.length>0),bt=bt&&hi.offscreen}const Os=te||Ze.numHorizontalGlyphVertices===0&&Ze.numVerticalGlyphVertices===0,xc=ne||Ze.numIconVertices===0;if(Os||xc?xc?Os||(Ot=Ot&&Rt):Rt=Ot&&Rt:Ot=Rt=Ot&&Rt,Rt&&Xt&&Xt.box&&this.collisionIndex.insertCollisionBox(Xt.box,fe,x.get("text-ignore-placement"),_.bucketInstanceId,Zt&&Zt.box&&$r?$r:_s,re.ID),Ot&&hi&&this.collisionIndex.insertCollisionBox(hi.box,xe,x.get("icon-ignore-placement"),_.bucketInstanceId,ys,re.ID),dn&&(Rt&&this.collisionIndex.insertCollisionCircles(dn.circles,fe,x.get("text-ignore-placement"),_.bucketInstanceId,_s,re.ID),p)){const ii=_.bucketInstanceId;let jt=this.collisionCircleArrays[ii];jt===void 0&&(jt=this.collisionCircleArrays[ii]=new Ar);for(let on=0;on<dn.circles.length;on+=4)jt.circles.push(dn.circles[on+0]),jt.circles.push(dn.circles[on+1]),jt.circles.push(dn.circles[on+2]),jt.circles.push(dn.collisionDetected?1:0)}if(Ze.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(_.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Ze.crossTileID]=new Js(Rt||Be,Ot||Me,bt||_.justReloaded),h[Ze.crossTileID]=!0};if(Re){if(o.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Ze=_.getSortedSymbolIndexes(this.transform.angle);for(let st=Ze.length-1;st>=0;--st){const Rt=Ze[st];nt(_.symbolInstances.get(Rt),_.collisionArrays[Rt])}}else for(let Ze=o.symbolInstanceStart;Ze<o.symbolInstanceEnd;Ze++)nt(_.symbolInstances.get(Ze),_.collisionArrays[Ze]);if(p&&_.bucketInstanceId in this.collisionCircleArrays){const Ze=this.collisionCircleArrays[_.bucketInstanceId];l.invert(Ze.invProjMatrix,E),Ze.viewportMatrix=this.collisionIndex.getViewportMatrix()}_.justReloaded=!1}markUsedJustification(o,h,p,_){let x;x=_===l.WritingMode.vertical?p.verticalPlacedTextSymbolIndex:{left:p.leftJustifiedTextSymbolIndex,center:p.centerJustifiedTextSymbolIndex,right:p.rightJustifiedTextSymbolIndex}[l.getAnchorJustification(h)];const E=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex,p.verticalPlacedTextSymbolIndex];for(const I of E)I>=0&&(o.text.placedSymbolArray.get(I).crossTileID=x>=0&&I!==x?0:p.crossTileID)}markUsedOrientation(o,h,p){const _=h===l.WritingMode.horizontal||h===l.WritingMode.horizontalOnly?h:0,x=h===l.WritingMode.vertical?h:0,E=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex];for(const I of E)o.text.placedSymbolArray.get(I).placedOrientation=_;p.verticalPlacedTextSymbolIndex&&(o.text.placedSymbolArray.get(p.verticalPlacedTextSymbolIndex).placedOrientation=x)}commit(o){this.commitTime=o,this.zoomAtLastRecencyCheck=this.transform.zoom;const h=this.prevPlacement;let p=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;const _=h?h.symbolFadeChange(o):1,x=h?h.opacities:{},E=h?h.variableOffsets:{},I=h?h.placedOrientations:{};for(const M in this.placements){const k=this.placements[M],O=x[M];O?(this.opacities[M]=new sn(O,_,k.text,k.icon),p=p||k.text!==O.text.placed||k.icon!==O.icon.placed):(this.opacities[M]=new sn(null,_,k.text,k.icon,k.skipFade),p=p||k.text||k.icon)}for(const M in x){const k=x[M];if(!this.opacities[M]){const O=new sn(k,_,!1,!1);O.isHidden()||(this.opacities[M]=O,p=p||k.text.placed||k.icon.placed)}}for(const M in E)this.variableOffsets[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.variableOffsets[M]=E[M]);for(const M in I)this.placedOrientations[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.placedOrientations[M]=I[M]);if(h&&h.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");p?this.lastPlacementChangeTime=o:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:o)}updateLayerOpacities(o,h){const p={};for(const _ of h){const x=_.getBucket(o);x&&_.latestFeatureIndex&&o.id===x.layerIds[0]&&this.updateBucketOpacities(x,p,_.collisionBoxArray)}}updateBucketOpacities(o,h,p){o.hasTextData()&&o.text.opacityVertexArray.clear(),o.hasIconData()&&o.icon.opacityVertexArray.clear(),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexArray.clear(),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexArray.clear();const _=o.layers[0].layout,x=new sn(null,0,!1,!1,!0),E=_.get("text-allow-overlap"),I=_.get("icon-allow-overlap"),M=_.get("text-variable-anchor"),k=_.get("text-rotation-alignment")==="map",O=_.get("text-pitch-alignment")==="map",B=_.get("icon-text-fit")!=="none",q=new sn(null,0,E&&(I||!o.hasIconData()||_.get("icon-optional")),I&&(E||!o.hasTextData()||_.get("text-optional")),!0);!o.collisionArrays&&p&&(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData())&&o.deserializeCollisionBoxes(p);const re=(te,ne,fe)=>{for(let _e=0;_e<ne/4;_e++)te.opacityVertexArray.emplaceBack(fe)};for(let te=0;te<o.symbolInstances.length;te++){const ne=o.symbolInstances.get(te),{numHorizontalGlyphVertices:fe,numVerticalGlyphVertices:_e,crossTileID:xe}=ne;let se=this.opacities[xe];h[xe]?se=x:se||(se=q,this.opacities[xe]=se),h[xe]=!0;const Te=ne.numIconVertices>0,we=this.placedOrientations[ne.crossTileID],ke=we===l.WritingMode.vertical,Re=we===l.WritingMode.horizontal||we===l.WritingMode.horizontalOnly;if(fe>0||_e>0){const Be=me(se.text);re(o.text,fe,ke?Ce:Be),re(o.text,_e,Re?Ce:Be);const Me=se.text.isHidden();[ne.rightJustifiedTextSymbolIndex,ne.centerJustifiedTextSymbolIndex,ne.leftJustifiedTextSymbolIndex].forEach(st=>{st>=0&&(o.text.placedSymbolArray.get(st).hidden=Me||ke?1:0)}),ne.verticalPlacedTextSymbolIndex>=0&&(o.text.placedSymbolArray.get(ne.verticalPlacedTextSymbolIndex).hidden=Me||Re?1:0);const nt=this.variableOffsets[ne.crossTileID];nt&&this.markUsedJustification(o,nt.anchor,ne,we);const Ze=this.placedOrientations[ne.crossTileID];Ze&&(this.markUsedJustification(o,"left",ne,Ze),this.markUsedOrientation(o,Ze,ne))}if(Te){const Be=me(se.icon),Me=!(B&&ne.verticalPlacedIconSymbolIndex&&ke);ne.placedIconSymbolIndex>=0&&(re(o.icon,ne.numIconVertices,Me?Be:Ce),o.icon.placedSymbolArray.get(ne.placedIconSymbolIndex).hidden=se.icon.isHidden()),ne.verticalPlacedIconSymbolIndex>=0&&(re(o.icon,ne.numVerticalIconVertices,Me?Ce:Be),o.icon.placedSymbolArray.get(ne.verticalPlacedIconSymbolIndex).hidden=se.icon.isHidden())}if(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData()){const Be=o.collisionArrays[te];if(Be){let Me=new l.pointGeometry(0,0);if(Be.textBox||Be.verticalTextBox){let Ze=!0;if(M){const st=this.variableOffsets[xe];st?(Me=Qs(st.anchor,st.width,st.height,st.textOffset,st.textBoxScale),k&&Me._rotate(O?this.transform.angle:-this.transform.angle)):Ze=!1}Be.textBox&&R(o.textCollisionBox.collisionVertexArray,se.text.placed,!Ze||ke,Me.x,Me.y),Be.verticalTextBox&&R(o.textCollisionBox.collisionVertexArray,se.text.placed,!Ze||Re,Me.x,Me.y)}const nt=!!(!Re&&Be.verticalIconBox);Be.iconBox&&R(o.iconCollisionBox.collisionVertexArray,se.icon.placed,nt,B?Me.x:0,B?Me.y:0),Be.verticalIconBox&&R(o.iconCollisionBox.collisionVertexArray,se.icon.placed,!nt,B?Me.x:0,B?Me.y:0)}}}if(o.sortFeatures(this.transform.angle),this.retainedQueryData[o.bucketInstanceId]&&(this.retainedQueryData[o.bucketInstanceId].featureSortOrder=o.featureSortOrder),o.hasTextData()&&o.text.opacityVertexBuffer&&o.text.opacityVertexBuffer.updateData(o.text.opacityVertexArray),o.hasIconData()&&o.icon.opacityVertexBuffer&&o.icon.opacityVertexBuffer.updateData(o.icon.opacityVertexArray),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexBuffer&&o.iconCollisionBox.collisionVertexBuffer.updateData(o.iconCollisionBox.collisionVertexArray),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexBuffer&&o.textCollisionBox.collisionVertexBuffer.updateData(o.textCollisionBox.collisionVertexArray),o.text.opacityVertexArray.length!==o.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${o.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${o.text.layoutVertexArray.length}) / 4`);if(o.icon.opacityVertexArray.length!==o.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${o.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${o.icon.layoutVertexArray.length}) / 4`);if(o.bucketInstanceId in this.collisionCircleArrays){const te=this.collisionCircleArrays[o.bucketInstanceId];o.placementInvProjMatrix=te.invProjMatrix,o.placementViewportMatrix=te.viewportMatrix,o.collisionCircleArray=te.circles,delete this.collisionCircleArrays[o.bucketInstanceId]}}symbolFadeChange(o){return this.fadeDuration===0?1:(o-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(o){return Math.max(0,(this.transform.zoom-o)/1.5)}hasTransitions(o){return this.stale||o-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(o,h){const p=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*p>o}setStale(){this.stale=!0}}function R(m,o,h,p,_){m.emplaceBack(o?1:0,h?1:0,p||0,_||0),m.emplaceBack(o?1:0,h?1:0,p||0,_||0),m.emplaceBack(o?1:0,h?1:0,p||0,_||0),m.emplaceBack(o?1:0,h?1:0,p||0,_||0)}const N=Math.pow(2,25),K=Math.pow(2,24),J=Math.pow(2,17),ue=Math.pow(2,16),pe=Math.pow(2,9),de=Math.pow(2,8),ce=Math.pow(2,1);function me(m){if(m.opacity===0&&!m.placed)return 0;if(m.opacity===1&&m.placed)return 4294967295;const o=m.placed?1:0,h=Math.floor(127*m.opacity);return h*N+o*K+h*J+o*ue+h*pe+o*de+h*ce+o}const Ce=0;class Fe{constructor(o){this._sortAcrossTiles=o.layout.get("symbol-z-order")!=="viewport-y"&&!o.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(o,h,p,_,x){const E=this._bucketParts;for(;this._currentTileIndex<o.length;)if(h.getBucketParts(E,_,o[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,x())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,E.sort((I,M)=>I.sortKey-M.sortKey));this._currentPartIndex<E.length;)if(h.placeLayerBucketPart(E[this._currentPartIndex],this._seenCrossTileIDs,p),this._currentPartIndex++,x())return!0;return!1}}class Ie{constructor(o,h,p,_,x,E,I,M){this.placement=new ee(o,h,E,I,M),this._currentPlacementIndex=p.length-1,this._forceFullPlacement=_,this._showCollisionBoxes=x,this._done=!1}isDone(){return this._done}continuePlacement(o,h,p){const _=l.exported.now(),x=()=>{const E=l.exported.now()-_;return!this._forceFullPlacement&&E>2};for(;this._currentPlacementIndex>=0;){const E=h[o[this._currentPlacementIndex]],I=this.placement.collisionIndex.transform.zoom;if(E.type==="symbol"&&(!E.minzoom||E.minzoom<=I)&&(!E.maxzoom||E.maxzoom>I)){if(this._inProgressLayer||(this._inProgressLayer=new Fe(E)),this._inProgressLayer.continuePlacement(p[E.source],this.placement,this._showCollisionBoxes,E,x))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(o){return this.placement.commit(o),this.placement}}const lt=512/l.EXTENT/2;class ht{constructor(o,h,p){this.tileID=o,this.indexedSymbolInstances={},this.bucketInstanceId=p;for(let _=0;_<h.length;_++){const x=h.get(_),E=x.key;this.indexedSymbolInstances[E]||(this.indexedSymbolInstances[E]=[]),this.indexedSymbolInstances[E].push({crossTileID:x.crossTileID,coord:this.getScaledCoordinates(x,o)})}}getScaledCoordinates(o,h){const p=lt/Math.pow(2,h.canonical.z-this.tileID.canonical.z);return{x:Math.floor((h.canonical.x*l.EXTENT+o.anchorX)*p),y:Math.floor((h.canonical.y*l.EXTENT+o.anchorY)*p)}}findMatches(o,h,p){const _=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z);for(let x=0;x<o.length;x++){const E=o.get(x);if(E.crossTileID)continue;const I=this.indexedSymbolInstances[E.key];if(!I)continue;const M=this.getScaledCoordinates(E,h);for(const k of I)if(Math.abs(k.coord.x-M.x)<=_&&Math.abs(k.coord.y-M.y)<=_&&!p[k.crossTileID]){p[k.crossTileID]=!0,E.crossTileID=k.crossTileID;break}}}}class Ke{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class xt{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(o){const h=Math.round((o-this.lng)/360);if(h!==0)for(const p in this.indexes){const _=this.indexes[p],x={};for(const E in _){const I=_[E];I.tileID=I.tileID.unwrapTo(I.tileID.wrap+h),x[I.tileID.key]=I}this.indexes[p]=x}this.lng=o}addBucket(o,h,p){if(this.indexes[o.overscaledZ]&&this.indexes[o.overscaledZ][o.key]){if(this.indexes[o.overscaledZ][o.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(o.overscaledZ,this.indexes[o.overscaledZ][o.key])}for(let x=0;x<h.symbolInstances.length;x++)h.symbolInstances.get(x).crossTileID=0;this.usedCrossTileIDs[o.overscaledZ]||(this.usedCrossTileIDs[o.overscaledZ]={});const _=this.usedCrossTileIDs[o.overscaledZ];for(const x in this.indexes){const E=this.indexes[x];if(Number(x)>o.overscaledZ)for(const I in E){const M=E[I];M.tileID.isChildOf(o)&&M.findMatches(h.symbolInstances,o,_)}else{const I=E[o.scaledTo(Number(x)).key];I&&I.findMatches(h.symbolInstances,o,_)}}for(let x=0;x<h.symbolInstances.length;x++){const E=h.symbolInstances.get(x);E.crossTileID||(E.crossTileID=p.generate(),_[E.crossTileID]=!0)}return this.indexes[o.overscaledZ]===void 0&&(this.indexes[o.overscaledZ]={}),this.indexes[o.overscaledZ][o.key]=new ht(o,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(o,h){for(const p in h.indexedSymbolInstances)for(const _ of h.indexedSymbolInstances[p])delete this.usedCrossTileIDs[o][_.crossTileID]}removeStaleBuckets(o){let h=!1;for(const p in this.indexes){const _=this.indexes[p];for(const x in _)o[_[x].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,_[x]),delete _[x],h=!0)}return h}}class gt{constructor(){this.layerIndexes={},this.crossTileIDs=new Ke,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(o,h,p){let _=this.layerIndexes[o.id];_===void 0&&(_=this.layerIndexes[o.id]=new xt);let x=!1;const E={};_.handleWrapJump(p);for(const I of h){const M=I.getBucket(o);M&&o.id===M.layerIds[0]&&(M.bucketInstanceId||(M.bucketInstanceId=++this.maxBucketInstanceId),_.addBucket(I.tileID,M,this.crossTileIDs)&&(x=!0),E[M.bucketInstanceId]=!0)}return _.removeStaleBuckets(E)&&(x=!0),x}pruneUnusedLayers(o){const h={};o.forEach(p=>{h[p]=!0});for(const p in this.layerIndexes)h[p]||delete this.layerIndexes[p]}}var Dt=l.createLayout([{name:"a_pos",type:"Int16",components:2}]);class Et extends l.Evented{constructor(o){super(),this.sourceCache=o,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.renderHistory=[],this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,this.renderHistorySize=o._cache.max,o.usedForTerrain=!0,o.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null;for(const o in this._tiles){const h=this._tiles[o];h.textures.forEach(p=>p.destroy()),h.textures=[]}}update(o,h){this.sourceCache.update(o,h),this._renderableTilesKeys=[];for(const p of o.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:h}))this._renderableTilesKeys.push(p.key),this._tiles[p.key]||(p.posMatrix=new Float64Array(16),l.ortho(p.posMatrix,0,l.EXTENT,0,l.EXTENT,0,1),this._tiles[p.key]=new ci(p,this.tileSize))}removeOutdated(o){const h={};this.renderHistory=this.renderHistory.filter((p,_)=>this.renderHistory.indexOf(p)===_).slice(0,this.renderHistorySize);for(const p of this._renderableTilesKeys)h[p]=!0;for(const p of this.renderHistory)h[p]=!0;for(const p in this._tiles)h[p]||(this._tiles[p].clearTextures(o),delete this._tiles[p])}getRenderableTiles(){return this._renderableTilesKeys.map(o=>this.getTileByID(o))}getTileByID(o){return this._tiles[o]}getTerrainCoords(o){const h={};for(const p of this._renderableTilesKeys){const _=this._tiles[p].tileID;if(_.canonical.equals(o.canonical)){const x=o.clone();x.posMatrix=new Float64Array(16),l.ortho(x.posMatrix,0,l.EXTENT,0,l.EXTENT,0,1),h[p]=x}else if(_.canonical.isChildOf(o.canonical)){const x=o.clone();x.posMatrix=new Float64Array(16);const E=_.canonical.z-o.canonical.z,I=_.canonical.x-(_.canonical.x>>E<<E),M=_.canonical.y-(_.canonical.y>>E<<E),k=l.EXTENT>>E;l.ortho(x.posMatrix,0,k,0,k,0,1),l.translate(x.posMatrix,x.posMatrix,[-I*k,-M*k,0]),h[p]=x}else if(o.canonical.isChildOf(_.canonical)){const x=o.clone();x.posMatrix=new Float64Array(16);const E=o.canonical.z-_.canonical.z,I=o.canonical.x-(o.canonical.x>>E<<E),M=o.canonical.y-(o.canonical.y>>E<<E),k=l.EXTENT>>E;l.ortho(x.posMatrix,0,l.EXTENT,0,l.EXTENT,0,1),l.translate(x.posMatrix,x.posMatrix,[I*k,M*k,0]),l.scale(x.posMatrix,x.posMatrix,[1/2**E,1/2**E,0]),h[p]=x}}return h}getSourceTile(o,h){const p=this.sourceCache._source;let _=o.overscaledZ-this.deltaZoom;if(_>p.maxzoom&&(_=p.maxzoom),_<p.minzoom)return null;this._sourceTileCache[o.key]||(this._sourceTileCache[o.key]=o.scaledTo(_).key);let x=this.sourceCache.getTileByID(this._sourceTileCache[o.key]);if((!x||!x.dem)&&h)for(;_>=p.minzoom&&(!x||!x.dem);)x=this.sourceCache.getTileByID(o.scaledTo(_--).key);return x}tilesAfterTime(o=Date.now()){return Object.values(this._tiles).filter(h=>h.timeLoaded>=o)}}class It{constructor(o,h,p){this.style=o,this.sourceCache=new Et(h),this.options=p,this.exaggeration=typeof p.exaggeration=="number"?p.exaggeration:1,this.elevationOffset=typeof p.elevationOffset=="number"?p.elevationOffset:450,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024,this.clearRerenderCache()}getDEMElevation(o,h,p,_=l.EXTENT){if(!(h>=0&&h<_&&p>=0&&p<_))return this.elevationOffset;let x=0;const E=this.getTerrainData(o);if(E.tile&&E.tile.dem){const I=l.transformMat4$1([],[h/_*l.EXTENT,p/_*l.EXTENT],E.u_terrain_matrix),M=[I[0]*E.tile.dem.dim,I[1]*E.tile.dem.dim],k=[Math.floor(M[0]),Math.floor(M[1])],O=E.tile.dem.get(k[0],k[1]),B=E.tile.dem.get(k[0],k[1]+1),q=E.tile.dem.get(k[0]+1,k[1]),re=E.tile.dem.get(k[0]+1,k[1]+1);x=l.number(l.number(O,B,M[0]-k[0]),l.number(q,re,M[0]-k[0]),M[1]-k[1])}return x}rememberForRerender(o,h){for(const p in this.sourceCache._tiles){const _=this.sourceCache._tiles[p];(_.tileID.equals(h)||_.tileID.isChildOf(h))&&(o===this.sourceCache.sourceCache.id&&(_.timeLoaded=Date.now()),this._rerender[o]=this._rerender[o]||{},this._rerender[o][_.tileID.key]=!0)}}needsRerender(o,h){return this._rerender[o]&&this._rerender[o][h.key]}clearRerenderCache(){this._rerender={}}getElevation(o,h,p,_=l.EXTENT){return(this.getDEMElevation(o,h,p,_)+this.elevationOffset)*this.exaggeration}getTerrainData(o){if(!this._emptyDemTexture){const _=this.style.map.painter.context,x=new l.RGBAImage({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new H(_,x,_.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new H(_,new l.RGBAImage({width:1,height:1}),_.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(_.gl.NEAREST,_.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=l.identity([])}const h=this.sourceCache.getSourceTile(o,!0);if(h&&h.dem&&(!h.demTexture||h.needsTerrainPrepare)){const _=this.style.map.painter.context;h.demTexture=this.style.map.painter.getTileTexture(h.dem.stride),h.demTexture?h.demTexture.update(h.dem.getPixels(),{premultiply:!1}):h.demTexture=new H(_,h.dem.getPixels(),_.gl.RGBA,{premultiply:!1}),h.demTexture.bind(_.gl.NEAREST,_.gl.CLAMP_TO_EDGE),h.needsTerrainPrepare=!1}const p=h&&h+h.tileID.key+o.key;if(p&&!this._demMatrixCache[p]){const _=this.sourceCache.sourceCache._source.maxzoom;let x=o.canonical.z-h.tileID.canonical.z;o.overscaledZ>o.canonical.z&&(o.canonical.z>=_?x=o.canonical.z-_:l.warnOnce("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const E=o.canonical.x-(o.canonical.x>>x<<x),I=o.canonical.y-(o.canonical.y>>x<<x),M=l.fromScaling(new Float64Array(16),[1/(l.EXTENT<<x),1/(l.EXTENT<<x),0]);l.translate(M,M,[E*l.EXTENT,I*l.EXTENT,0]),this._demMatrixCache[o.key]={matrix:M,coord:o}}return{u_depth:2,u_terrain:3,u_terrain_dim:h&&h.dem&&h.dem.dim||1,u_terrain_matrix:p?this._demMatrixCache[o.key].matrix:this._emptyDemMatrix,u_terrain_unpack:h&&h.dem&&h.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_offset:this.elevationOffset,u_terrain_exaggeration:this.exaggeration,texture:(h&&h.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:h}}getRTTFramebuffer(){const o=this.style.map.painter;if(!this._rttFramebuffer){const h=this.sourceCache.tileSize*this.qualityFactor;this._rttFramebuffer=o.context.createFramebuffer(h,h,!0),this._rttFramebuffer.depthAttachment.set(o.context.createRenderbuffer(o.context.gl.DEPTH_COMPONENT16,h,h))}return this._rttFramebuffer}getFramebuffer(o){const h=this.style.map.painter,p=h.width/devicePixelRatio,_=h.height/devicePixelRatio;return!this._fbo||this._fbo.width===p&&this._fbo.height===_||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new H(h.context,{width:p,height:_,data:null},h.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(h.context.gl.NEAREST,h.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new H(h.context,{width:p,height:_,data:null},h.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(h.context.gl.NEAREST,h.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=h.context.createFramebuffer(p,_,!0),this._fbo.depthAttachment.set(h.context.createRenderbuffer(h.context.gl.DEPTH_COMPONENT16,p,_))),this._fbo.colorAttachment.set(o==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const o=this.style.map.painter.context;if(this._coordsTexture)return this._coordsTexture;const h=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let x=0,E=0;x<this._coordsTextureSize;x++)for(let I=0;I<this._coordsTextureSize;I++,E+=4)h[E+0]=255&I,h[E+1]=255&x,h[E+2]=I>>8<<4|x>>8,h[E+3]=0;const p=new l.RGBAImage({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(h.buffer)),_=new H(o,p,o.gl.RGBA,{premultiply:!1});return _.bind(o.gl.NEAREST,o.gl.CLAMP_TO_EDGE),this._coordsTexture=_,_}pointCoordinate(o){const h=new Uint8Array(4),p=this.style.map.painter,_=p.context,x=_.gl;_.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),x.readPixels(o.x,p.height/devicePixelRatio-o.y-1,1,1,x.RGBA,x.UNSIGNED_BYTE,h),_.bindFramebuffer.set(null);const E=h[0]+(h[2]>>4<<8),I=h[1]+((15&h[2])<<8),M=this.coordsIndex[255-h[3]],k=M&&this.sourceCache.getTileByID(M);if(!k)return null;const O=this._coordsTextureSize,B=(1<<k.tileID.canonical.z)*O;return new l.MercatorCoordinate((k.tileID.canonical.x*O+E)/B,(k.tileID.canonical.y*O+I)/B,this.getElevation(k.tileID,E,I,O))}getTerrainMesh(){if(this._mesh)return this._mesh;const o=this.style.map.painter.context,h=new l.PosArray,p=new l.TriangleIndexArray,_=this.meshSize,x=l.EXTENT/_,E=_*_;for(let I=0;I<=_;I++)for(let M=0;M<=_;M++)h.emplaceBack(M*x,I*x);for(let I=0;I<E;I+=_+1)for(let M=0;M<_;M++)p.emplaceBack(M+I,_+M+I+1,_+M+I+2),p.emplaceBack(M+I,_+M+I+2,M+I+1);return this._mesh={indexBuffer:o.createIndexBuffer(p),vertexBuffer:o.createVertexBuffer(h,Dt.members),segments:l.SegmentVector.simpleSegment(0,0,h.length,p.length)},this._mesh}getMinMaxElevation(o){const h=this.getTerrainData(o).tile,p={minElevation:null,maxElevation:null};return h&&h.dem&&(p.minElevation=(h.dem.min+this.elevationOffset)*this.exaggeration,p.maxElevation=(h.dem.max+this.elevationOffset)*this.exaggeration),p}}const Ut=(m,o)=>l.emitValidationErrors(m,o&&o.filter(h=>h.identifier!=="source.canvas")),Wt=l.pick($t,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),_n=l.pick($t,["setCenter","setZoom","setBearing","setPitch"]),yn=function(){const m={},o=l.spec.$version;for(const h in l.spec.$root){const p=l.spec.$root[h];if(p.required){let _=null;_=h==="version"?o:p.type==="array"?[]:{},_!=null&&(m[h]=_)}}return m}();class ni extends l.Evented{constructor(o,h={}){super(),this.map=o,this.dispatcher=new je(yi(),this),this.imageManager=new G,this.imageManager.setEventedParent(this),this.glyphManager=new ge(o._requestManager,h.localIdeographFontFamily),this.lineAtlas=new He(256,512),this.crossTileSymbolIndex=new gt,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new l.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",l.getReferrer());const p=this;this._rtlTextPluginCallback=ni.registerForPluginStateChange(_=>{p.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:_.pluginStatus,pluginURL:_.pluginURL},(x,E)=>{if(l.triggerPluginCompletionEvent(x),E&&E.every(I=>I))for(const I in p.sourceCaches)p.sourceCaches[I].reload()})}),this.on("data",_=>{if(_.dataType!=="source"||_.sourceDataType!=="metadata")return;const x=this.sourceCaches[_.sourceId];if(!x)return;const E=x.getSource();if(E&&E.vectorLayerIds)for(const I in this._layers){const M=this._layers[I];M.source===E.id&&this._validateLayer(M)}})}loadURL(o,h={}){this.fire(new l.Event("dataloading",{dataType:"style"}));const p=typeof h.validate!="boolean"||h.validate,_=this.map._requestManager.transformRequest(o,l.ResourceType.Style);this._request=l.getJSON(_,(x,E)=>{this._request=null,x?this.fire(new l.ErrorEvent(x)):E&&this._load(E,p)})}loadJSON(o,h={}){this.fire(new l.Event("dataloading",{dataType:"style"})),this._request=l.exported.frame(()=>{this._request=null,this._load(o,h.validate!==!1)})}loadEmpty(){this.fire(new l.Event("dataloading",{dataType:"style"})),this._load(yn,!1)}_load(o,h){if(h&&Ut(this,l.validateStyle(o)))return;this._loaded=!0,this.stylesheet=o;for(const _ in o.sources)this.addSource(_,o.sources[_],{validate:!1});o.sprite?this._loadSprite(o.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(o.glyphs);const p=Xs(this.stylesheet.layers);this._order=p.map(_=>_.id),this._layers={},this._serializedLayers={};for(let _ of p)_=l.createStyleLayer(_),_.setEventedParent(this,{layer:{id:_.id}}),this._layers[_.id]=_,this._serializedLayers[_.id]=_.serialize();this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Ne(this.stylesheet.light),this.setTerrain(this.stylesheet.terrain),this.fire(new l.Event("data",{dataType:"style"})),this.fire(new l.Event("style.load"))}_loadSprite(o){this._spriteRequest=function(h,p,_,x){let E,I,M;const k=_>1?"@2x":"";let O=l.getJSON(p.transformRequest(p.normalizeSpriteURL(h,k,".json"),l.ResourceType.SpriteJSON),(re,te)=>{O=null,M||(M=re,E=te,q())}),B=l.getImage(p.transformRequest(p.normalizeSpriteURL(h,k,".png"),l.ResourceType.SpriteImage),(re,te)=>{B=null,M||(M=re,I=te,q())});function q(){if(M)x(M);else if(E&&I){const re=l.exported.getImageData(I),te={};for(const ne in E){const{width:fe,height:_e,x:xe,y:se,sdf:Te,pixelRatio:we,stretchX:ke,stretchY:Re,content:Be}=E[ne],Me=new l.RGBAImage({width:fe,height:_e});l.RGBAImage.copy(re,Me,{x:xe,y:se},{x:0,y:0},{width:fe,height:_e}),te[ne]={data:Me,pixelRatio:we,sdf:Te,stretchX:ke,stretchY:Re,content:Be}}x(null,te)}}return{cancel(){O&&(O.cancel(),O=null),B&&(B.cancel(),B=null)}}}(o,this.map._requestManager,this.map.getPixelRatio(),(h,p)=>{if(this._spriteRequest=null,h)this.fire(new l.ErrorEvent(h));else if(p)for(const _ in p)this.imageManager.addImage(_,p[_]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.Event("data",{dataType:"style"}))})}_validateLayer(o){const h=this.sourceCaches[o.source];if(!h)return;const p=o.sourceLayer;if(!p)return;const _=h.getSource();(_.type==="geojson"||_.vectorLayerIds&&_.vectorLayerIds.indexOf(p)===-1)&&this.fire(new l.ErrorEvent(new Error(`Source layer "${p}" does not exist on source "${_.id}" as specified by style layer "${o.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const o in this.sourceCaches)if(!this.sourceCaches[o].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(o){const h=[];for(const p of o){const _=this._layers[p];_.type!=="custom"&&h.push(_.serialize())}return h}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const o in this.sourceCaches)if(this.sourceCaches[o].hasTransition())return!0;for(const o in this._layers)if(this._layers[o].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(o){if(!this._loaded)return;const h=this._changed;if(this._changed){const _=Object.keys(this._updatedLayers),x=Object.keys(this._removedLayers);(_.length||x.length)&&this._updateWorkerLayers(_,x);for(const E in this._updatedSources){const I=this._updatedSources[E];if(I==="reload")this._reloadSource(E);else{if(I!=="clear")throw new Error(`Invalid action ${I}`);this._clearSource(E)}}this._updateTilesForChangedImages();for(const E in this._updatedPaintProps)this._layers[E].updateTransitions(o);this.light.updateTransitions(o),this._resetUpdates()}const p={};for(const _ in this.sourceCaches){const x=this.sourceCaches[_];p[_]=x.used,x.used=!1}for(const _ of this._order){const x=this._layers[_];x.recalculate(o,this._availableImages),!x.isHidden(o.zoom)&&x.source&&(this.sourceCaches[x.source].used=!0)}for(const _ in p){const x=this.sourceCaches[_];p[_]!==x.used&&x.fire(new l.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:_}))}this.light.recalculate(o),this.z=o.zoom,h&&this.fire(new l.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const o=Object.keys(this._changedImages);if(o.length){for(const h in this.sourceCaches)this.sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],o);this._changedImages={}}}_updateWorkerLayers(o,h){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(o),removedIds:h})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setTerrain(o){if(this._checkLoaded(),this._terrainDataCallback&&this.off("data",this._terrainDataCallback),this._terrainfreezeElevationCallback&&this.map.off("freezeElevation",this._terrainfreezeElevationCallback),o){const h=this.sourceCaches[o.source];if(!h)throw new Error(`cannot load terrain, because there exists no source with ID: ${o.source}`);this.terrain=new It(this,h,o),this.map.transform.updateElevation(this.terrain),this._terrainfreezeElevationCallback=p=>{p.freeze?this.map.transform.freezeElevation=!0:(this.map.transform.freezeElevation=!1,this.map.transform.recalculateZoom(this.terrain))},this._terrainDataCallback=p=>{p.tile&&(p.sourceId===o.source?(this.map.transform.updateElevation(this.terrain),this.terrain.rememberForRerender(p.sourceId,p.tile.tileID)):p.source.type==="geojson"&&this.terrain.rememberForRerender(p.sourceId,p.tile.tileID))},this.on("data",this._terrainDataCallback),this.map.on("freezeElevation",this._terrainfreezeElevationCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.map.transform.updateElevation(this.terrain);this.map.fire(new l.Event("terrain",{terrain:o}))}setState(o){if(this._checkLoaded(),Ut(this,l.validateStyle(o)))return!1;(o=l.clone$1(o)).layers=Xs(o.layers);const h=function(_,x){if(!_)return[{command:$t.setStyle,args:[x]}];let E=[];try{if(!C(_.version,x.version))return[{command:$t.setStyle,args:[x]}];C(_.center,x.center)||E.push({command:$t.setCenter,args:[x.center]}),C(_.zoom,x.zoom)||E.push({command:$t.setZoom,args:[x.zoom]}),C(_.bearing,x.bearing)||E.push({command:$t.setBearing,args:[x.bearing]}),C(_.pitch,x.pitch)||E.push({command:$t.setPitch,args:[x.pitch]}),C(_.sprite,x.sprite)||E.push({command:$t.setSprite,args:[x.sprite]}),C(_.glyphs,x.glyphs)||E.push({command:$t.setGlyphs,args:[x.glyphs]}),C(_.transition,x.transition)||E.push({command:$t.setTransition,args:[x.transition]}),C(_.light,x.light)||E.push({command:$t.setLight,args:[x.light]});const I={},M=[];(function(O,B,q,re){let te;for(te in B=B||{},O=O||{})Object.prototype.hasOwnProperty.call(O,te)&&(Object.prototype.hasOwnProperty.call(B,te)||Vn(te,q,re));for(te in B)Object.prototype.hasOwnProperty.call(B,te)&&(Object.prototype.hasOwnProperty.call(O,te)?C(O[te],B[te])||(O[te].type==="geojson"&&B[te].type==="geojson"&&To(O,B,te)?q.push({command:$t.setGeoJSONSourceData,args:[te,B[te].data]}):hs(te,B,q,re)):Fi(te,B,q))})(_.sources,x.sources,M,I);const k=[];_.layers&&_.layers.forEach(O=>{I[O.source]?E.push({command:$t.removeLayer,args:[O.id]}):k.push(O)}),E=E.concat(M),function(O,B,q){B=B||[];const re=(O=O||[]).map(Vr),te=B.map(Vr),ne=O.reduce(Ys,{}),fe=B.reduce(Ys,{}),_e=re.slice(),xe=Object.create(null);let se,Te,we,ke,Re,Be,Me;for(se=0,Te=0;se<re.length;se++)we=re[se],Object.prototype.hasOwnProperty.call(fe,we)?Te++:(q.push({command:$t.removeLayer,args:[we]}),_e.splice(_e.indexOf(we,Te),1));for(se=0,Te=0;se<te.length;se++)we=te[te.length-1-se],_e[_e.length-1-se]!==we&&(Object.prototype.hasOwnProperty.call(ne,we)?(q.push({command:$t.removeLayer,args:[we]}),_e.splice(_e.lastIndexOf(we,_e.length-Te),1)):Te++,Be=_e[_e.length-se],q.push({command:$t.addLayer,args:[fe[we],Be]}),_e.splice(_e.length-se,0,we),xe[we]=!0);for(se=0;se<te.length;se++)if(we=te[se],ke=ne[we],Re=fe[we],!xe[we]&&!C(ke,Re))if(C(ke.source,Re.source)&&C(ke["source-layer"],Re["source-layer"])&&C(ke.type,Re.type)){for(Me in Ur(ke.layout,Re.layout,q,we,null,$t.setLayoutProperty),Ur(ke.paint,Re.paint,q,we,null,$t.setPaintProperty),C(ke.filter,Re.filter)||q.push({command:$t.setFilter,args:[we,Re.filter]}),C(ke.minzoom,Re.minzoom)&&C(ke.maxzoom,Re.maxzoom)||q.push({command:$t.setLayerZoomRange,args:[we,Re.minzoom,Re.maxzoom]}),ke)Object.prototype.hasOwnProperty.call(ke,Me)&&Me!=="layout"&&Me!=="paint"&&Me!=="filter"&&Me!=="metadata"&&Me!=="minzoom"&&Me!=="maxzoom"&&(Me.indexOf("paint.")===0?Ur(ke[Me],Re[Me],q,we,Me.slice(6),$t.setPaintProperty):C(ke[Me],Re[Me])||q.push({command:$t.setLayerProperty,args:[we,Me,Re[Me]]}));for(Me in Re)Object.prototype.hasOwnProperty.call(Re,Me)&&!Object.prototype.hasOwnProperty.call(ke,Me)&&Me!=="layout"&&Me!=="paint"&&Me!=="filter"&&Me!=="metadata"&&Me!=="minzoom"&&Me!=="maxzoom"&&(Me.indexOf("paint.")===0?Ur(ke[Me],Re[Me],q,we,Me.slice(6),$t.setPaintProperty):C(ke[Me],Re[Me])||q.push({command:$t.setLayerProperty,args:[we,Me,Re[Me]]}))}else q.push({command:$t.removeLayer,args:[we]}),Be=_e[_e.lastIndexOf(we)+1],q.push({command:$t.addLayer,args:[Re,Be]})}(k,x.layers,E)}catch(I){console.warn("Unable to compute style diff:",I),E=[{command:$t.setStyle,args:[x]}]}return E}(this.serialize(),o).filter(_=>!(_.command in _n));if(h.length===0)return!1;const p=h.filter(_=>!(_.command in Wt));if(p.length>0)throw new Error(`Unimplemented: ${p.map(_=>_.command).join(", ")}.`);return h.forEach(_=>{_.command!=="setTransition"&&this[_.command].apply(this,_.args)}),this.stylesheet=o,!0}addImage(o,h){if(this.getImage(o))return this.fire(new l.ErrorEvent(new Error(`An image named "${o}" already exists.`)));this.imageManager.addImage(o,h),this._afterImageUpdated(o)}updateImage(o,h){this.imageManager.updateImage(o,h)}getImage(o){return this.imageManager.getImage(o)}removeImage(o){if(!this.getImage(o))return this.fire(new l.ErrorEvent(new Error(`An image named "${o}" does not exist.`)));this.imageManager.removeImage(o),this._afterImageUpdated(o)}_afterImageUpdated(o){this._availableImages=this.imageManager.listImages(),this._changedImages[o]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(o,h,p={}){if(this._checkLoaded(),this.sourceCaches[o]!==void 0)throw new Error(`Source "${o}" already exists.`);if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(l.validateStyle.source,`sources.${o}`,h,null,p))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);const _=this.sourceCaches[o]=new Kt(o,h,this.dispatcher);_.style=this,_.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:_.serialize(),sourceId:o})),_.onAdd(this.map),this._changed=!0}removeSource(o){if(this._checkLoaded(),this.sourceCaches[o]===void 0)throw new Error("There is no source with this ID");for(const p in this._layers)if(this._layers[p].source===o)return this.fire(new l.ErrorEvent(new Error(`Source "${o}" cannot be removed while layer "${p}" is using it.`)));const h=this.sourceCaches[o];delete this.sourceCaches[o],delete this._updatedSources[o],h.fire(new l.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:o})),h.setEventedParent(null),h.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(o,h){if(this._checkLoaded(),this.sourceCaches[o]===void 0)throw new Error(`There is no source with this ID=${o}`);const p=this.sourceCaches[o].getSource();if(p.type!=="geojson")throw new Error(`geojsonSource.type is ${p.type}, which is !== 'geojson`);p.setData(h),this._changed=!0}getSource(o){return this.sourceCaches[o]&&this.sourceCaches[o].getSource()}addLayer(o,h,p={}){this._checkLoaded();const _=o.id;if(this.getLayer(_))return void this.fire(new l.ErrorEvent(new Error(`Layer "${_}" already exists on this map.`)));let x;if(o.type==="custom"){if(Ut(this,l.validateCustomStyleLayer(o)))return;x=l.createStyleLayer(o)}else{if(typeof o.source=="object"&&(this.addSource(_,o.source),o=l.clone$1(o),o=l.extend(o,{source:_})),this._validate(l.validateStyle.layer,`layers.${_}`,o,{arrayIndex:-1},p))return;x=l.createStyleLayer(o),this._validateLayer(x),x.setEventedParent(this,{layer:{id:_}}),this._serializedLayers[x.id]=x.serialize()}const E=h?this._order.indexOf(h):this._order.length;if(h&&E===-1)this.fire(new l.ErrorEvent(new Error(`Cannot add layer "${_}" before non-existing layer "${h}".`)));else{if(this._order.splice(E,0,_),this._layerOrderChanged=!0,this._layers[_]=x,this._removedLayers[_]&&x.source&&x.type!=="custom"){const I=this._removedLayers[_];delete this._removedLayers[_],I.type!==x.type?this._updatedSources[x.source]="clear":(this._updatedSources[x.source]="reload",this.sourceCaches[x.source].pause())}this._updateLayer(x),x.onAdd&&x.onAdd(this.map)}}moveLayer(o,h){if(this._checkLoaded(),this._changed=!0,!this._layers[o])return void this.fire(new l.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be moved.`)));if(o===h)return;const p=this._order.indexOf(o);this._order.splice(p,1);const _=h?this._order.indexOf(h):this._order.length;h&&_===-1?this.fire(new l.ErrorEvent(new Error(`Cannot move layer "${o}" before non-existing layer "${h}".`))):(this._order.splice(_,0,o),this._layerOrderChanged=!0)}removeLayer(o){this._checkLoaded();const h=this._layers[o];if(!h)return void this.fire(new l.ErrorEvent(new Error(`Cannot remove non-existing layer "${o}".`)));h.setEventedParent(null);const p=this._order.indexOf(o);this._order.splice(p,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[o]=h,delete this._layers[o],delete this._serializedLayers[o],delete this._updatedLayers[o],delete this._updatedPaintProps[o],h.onRemove&&h.onRemove(this.map)}getLayer(o){return this._layers[o]}hasLayer(o){return o in this._layers}setLayerZoomRange(o,h,p){this._checkLoaded();const _=this.getLayer(o);_?_.minzoom===h&&_.maxzoom===p||(h!=null&&(_.minzoom=h),p!=null&&(_.maxzoom=p),this._updateLayer(_)):this.fire(new l.ErrorEvent(new Error(`Cannot set the zoom range of non-existing layer "${o}".`)))}setFilter(o,h,p={}){this._checkLoaded();const _=this.getLayer(o);if(_){if(!C(_.filter,h))return h==null?(_.filter=void 0,void this._updateLayer(_)):void(this._validate(l.validateStyle.filter,`layers.${_.id}.filter`,h,null,p)||(_.filter=l.clone$1(h),this._updateLayer(_)))}else this.fire(new l.ErrorEvent(new Error(`Cannot filter non-existing layer "${o}".`)))}getFilter(o){return l.clone$1(this.getLayer(o).filter)}setLayoutProperty(o,h,p,_={}){this._checkLoaded();const x=this.getLayer(o);x?C(x.getLayoutProperty(h),p)||(x.setLayoutProperty(h,p,_),this._updateLayer(x)):this.fire(new l.ErrorEvent(new Error(`Cannot style non-existing layer "${o}".`)))}getLayoutProperty(o,h){const p=this.getLayer(o);if(p)return p.getLayoutProperty(h);this.fire(new l.ErrorEvent(new Error(`Cannot get style of non-existing layer "${o}".`)))}setPaintProperty(o,h,p,_={}){this._checkLoaded();const x=this.getLayer(o);x?C(x.getPaintProperty(h),p)||(x.setPaintProperty(h,p,_)&&this._updateLayer(x),this._changed=!0,this._updatedPaintProps[o]=!0):this.fire(new l.ErrorEvent(new Error(`Cannot style non-existing layer "${o}".`)))}getPaintProperty(o,h){return this.getLayer(o).getPaintProperty(h)}setFeatureState(o,h){this._checkLoaded();const p=o.source,_=o.sourceLayer,x=this.sourceCaches[p];if(x===void 0)return void this.fire(new l.ErrorEvent(new Error(`The source '${p}' does not exist in the map's style.`)));const E=x.getSource().type;E==="geojson"&&_?this.fire(new l.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):E!=="vector"||_?(o.id===void 0&&this.fire(new l.ErrorEvent(new Error("The feature id parameter must be provided."))),x.setFeatureState(_,o.id,h)):this.fire(new l.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(o,h){this._checkLoaded();const p=o.source,_=this.sourceCaches[p];if(_===void 0)return void this.fire(new l.ErrorEvent(new Error(`The source '${p}' does not exist in the map's style.`)));const x=_.getSource().type,E=x==="vector"?o.sourceLayer:void 0;x!=="vector"||E?h&&typeof o.id!="string"&&typeof o.id!="number"?this.fire(new l.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):_.removeFeatureState(E,o.id,h):this.fire(new l.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(o){this._checkLoaded();const h=o.source,p=o.sourceLayer,_=this.sourceCaches[h];if(_!==void 0)return _.getSource().type!=="vector"||p?(o.id===void 0&&this.fire(new l.ErrorEvent(new Error("The feature id parameter must be provided."))),_.getFeatureState(p,o.id)):void this.fire(new l.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new l.ErrorEvent(new Error(`The source '${h}' does not exist in the map's style.`)))}getTransition(){return l.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){return l.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:l.mapObject(this.sourceCaches,o=>o.serialize()),layers:this._serializeLayers(this._order)},o=>o!==void 0)}_updateLayer(o){this._updatedLayers[o.id]=!0,o.source&&!this._updatedSources[o.source]&&this.sourceCaches[o.source].getSource().type!=="raster"&&(this._updatedSources[o.source]="reload",this.sourceCaches[o.source].pause()),this._changed=!0}_flattenAndSortRenderedFeatures(o){const h=E=>this._layers[E].type==="fill-extrusion",p={},_=[];for(let E=this._order.length-1;E>=0;E--){const I=this._order[E];if(h(I)){p[I]=E;for(const M of o){const k=M[I];if(k)for(const O of k)_.push(O)}}}_.sort((E,I)=>I.intersectionZ-E.intersectionZ);const x=[];for(let E=this._order.length-1;E>=0;E--){const I=this._order[E];if(h(I))for(let M=_.length-1;M>=0;M--){const k=_[M].feature;if(p[k.layer.id]<E)break;x.push(k),_.pop()}else for(const M of o){const k=M[I];if(k)for(const O of k)x.push(O.feature)}}return x}queryRenderedFeatures(o,h,p){h&&h.filter&&this._validate(l.validateStyle.filter,"queryRenderedFeatures.filter",h.filter,null,h);const _={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new l.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const E of h.layers){const I=this._layers[E];if(!I)return this.fire(new l.ErrorEvent(new Error(`The layer '${E}' does not exist in the map's style and cannot be queried for features.`))),[];_[I.source]=!0}}const x=[];h.availableImages=this._availableImages;for(const E in this.sourceCaches)h.layers&&!_[E]||x.push(li(this.sourceCaches[E],this._layers,this._serializedLayers,o,h,p));return this.placement&&x.push(function(E,I,M,k,O,B,q){const re={},te=B.queryRenderedSymbols(k),ne=[];for(const fe of Object.keys(te).map(Number))ne.push(q[fe]);ne.sort(Ai);for(const fe of ne){const _e=fe.featureIndex.lookupSymbolFeatures(te[fe.bucketInstanceId],I,fe.bucketIndex,fe.sourceLayerIndex,O.filter,O.layers,O.availableImages,E);for(const xe in _e){const se=re[xe]=re[xe]||[],Te=_e[xe];Te.sort((we,ke)=>{const Re=fe.featureSortOrder;if(Re){const Be=Re.indexOf(we.featureIndex);return Re.indexOf(ke.featureIndex)-Be}return ke.featureIndex-we.featureIndex});for(const we of Te)se.push(we)}}for(const fe in re)re[fe].forEach(_e=>{const xe=_e.feature,se=M[E[fe].source].getFeatureState(xe.layer["source-layer"],xe.id);xe.source=xe.layer.source,xe.layer["source-layer"]&&(xe.sourceLayer=xe.layer["source-layer"]),xe.state=se});return re}(this._layers,this._serializedLayers,this.sourceCaches,o,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(x)}querySourceFeatures(o,h){h&&h.filter&&this._validate(l.validateStyle.filter,"querySourceFeatures.filter",h.filter,null,h);const p=this.sourceCaches[o];return p?function(_,x){const E=_.getRenderableIds().map(k=>_.getTileByID(k)),I=[],M={};for(let k=0;k<E.length;k++){const O=E[k],B=O.tileID.canonical.key;M[B]||(M[B]=!0,O.querySourceFeatures(I,x))}return I}(p,h):[]}addSourceType(o,h,p){return ni.getSourceType(o)?p(new Error(`A source type called "${o}" already exists.`)):(ni.setSourceType(o,h),h.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:o,url:h.workerSourceURL},p):p(null,null))}getLight(){return this.light.getLight()}setLight(o,h={}){this._checkLoaded();const p=this.light.getLight();let _=!1;for(const E in o)if(!C(o[E],p[E])){_=!0;break}if(!_)return;const x={now:l.exported.now(),transition:l.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(o,h),this.light.updateTransitions(x)}_validate(o,h,p,_,x={}){return(!x||x.validate!==!1)&&Ut(this,o.call(l.validateStyle,l.extend({key:h,style:this.serialize(),value:p,styleSpec:l.spec},_)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),l.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const o in this._layers)this._layers[o].setEventedParent(null);for(const o in this.sourceCaches){const h=this.sourceCaches[o];h.setEventedParent(null),h.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(o){this.sourceCaches[o].clearTiles()}_reloadSource(o){this.sourceCaches[o].resume(),this.sourceCaches[o].reload()}_updateSources(o){for(const h in this.sourceCaches)this.sourceCaches[h].update(o,this.terrain)}_generateCollisionBoxes(){for(const o in this.sourceCaches)this._reloadSource(o)}_updatePlacement(o,h,p,_,x=!1){let E=!1,I=!1;const M={};for(const k of this._order){const O=this._layers[k];if(O.type!=="symbol")continue;if(!M[O.source]){const q=this.sourceCaches[O.source];M[O.source]=q.getRenderableIds(!0).map(re=>q.getTileByID(re)).sort((re,te)=>te.tileID.overscaledZ-re.tileID.overscaledZ||(re.tileID.isLessThan(te.tileID)?-1:1))}const B=this.crossTileSymbolIndex.addLayer(O,M[O.source],o.center.lng);E=E||B}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((x=x||this._layerOrderChanged||p===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(l.exported.now(),o.zoom))&&(this.pauseablePlacement=new Ie(o,this.terrain,this._order,x,h,p,_,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,M),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(l.exported.now()),I=!0),E&&this.pauseablePlacement.placement.setStale()),I||E)for(const k of this._order){const O=this._layers[k];O.type==="symbol"&&this.placement.updateLayerOpacities(O,M[O.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(l.exported.now())}_releaseSymbolFadeTiles(){for(const o in this.sourceCaches)this.sourceCaches[o].releaseSymbolFadeTiles()}getImages(o,h,p){this.imageManager.getImages(h.icons,p),this._updateTilesForChangedImages();const _=this.sourceCaches[h.source];_&&_.setDependencies(h.tileID.key,h.type,h.icons)}getGlyphs(o,h,p){this.glyphManager.getGlyphs(h.stacks,p)}getResource(o,h,p){return l.makeRequest(h,p)}}ni.getSourceType=function(m){return ln[m]},ni.setSourceType=function(m,o){ln[m]=o},ni.registerForPluginStateChange=l.registerForPluginStateChange;var Gr="attribute vec2 a_pos;uniform mat4 u_matrix;varying vec2 v_texture_pos;varying float v_depth;void main() {v_texture_pos=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);v_depth=gl_Position.z/gl_Position.w;}";const vi={prelude:en(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_offset;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return (elevation+u_terrain_offset)*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:en(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:en(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:en(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:en("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:en(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:en(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:en("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:en("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:en("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:en(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:en(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:en(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:en(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:en(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float baseDelta=10.0;float ele=get_elevation(a_centroid);
#else
float baseDelta=0.0;float ele=0.0;
#endif
base=max(0.0,ele+base-baseDelta);height=max(0.0,ele+height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:en(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float baseDelta=10.0;float ele=get_elevation(a_centroid);
#else
float baseDelta=0.0;float ele=0.0;
#endif
base=max(0.0,ele+base-baseDelta);height=max(0.0,ele+height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:en(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:en(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:en(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:en(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:en(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:en(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:en(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:en(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:en(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:en(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:en("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",Gr),terrainDepth:en("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",Gr),terrainCoords:en("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",Gr)};function en(m,o){const h=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,p=o.match(/attribute ([\w]+) ([\w]+)/g),_=m.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),x=o.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),E=x?x.concat(_):_,I={};return{fragmentSource:m=m.replace(h,(M,k,O,B,q)=>(I[q]=!0,k==="define"?`
#ifndef HAS_UNIFORM_u_${q}
varying ${O} ${B} ${q};
#else
uniform ${O} ${B} u_${q};
#endif
`:`
#ifdef HAS_UNIFORM_u_${q}
    ${O} ${B} ${q} = u_${q};
#endif
`)),vertexSource:o=o.replace(h,(M,k,O,B,q)=>{const re=B==="float"?"vec2":"vec4",te=q.match(/color/)?"color":re;return I[q]?k==="define"?`
#ifndef HAS_UNIFORM_u_${q}
uniform lowp float u_${q}_t;
attribute ${O} ${re} a_${q};
varying ${O} ${B} ${q};
#else
uniform ${O} ${B} u_${q};
#endif
`:te==="vec4"?`
#ifndef HAS_UNIFORM_u_${q}
    ${q} = a_${q};
#else
    ${O} ${B} ${q} = u_${q};
#endif
`:`
#ifndef HAS_UNIFORM_u_${q}
    ${q} = unpack_mix_${te}(a_${q}, u_${q}_t);
#else
    ${O} ${B} ${q} = u_${q};
#endif
`:k==="define"?`
#ifndef HAS_UNIFORM_u_${q}
uniform lowp float u_${q}_t;
attribute ${O} ${re} a_${q};
#else
uniform ${O} ${B} u_${q};
#endif
`:te==="vec4"?`
#ifndef HAS_UNIFORM_u_${q}
    ${O} ${B} ${q} = a_${q};
#else
    ${O} ${B} ${q} = u_${q};
#endif
`:`
#ifndef HAS_UNIFORM_u_${q}
    ${O} ${B} ${q} = unpack_mix_${te}(a_${q}, u_${q}_t);
#else
    ${O} ${B} ${q} = u_${q};
#endif
`}),staticAttributes:p,staticUniforms:E}}class So{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(o,h,p,_,x,E,I,M,k){this.context=o;let O=this.boundPaintVertexBuffers.length!==_.length;for(let B=0;!O&&B<_.length;B++)this.boundPaintVertexBuffers[B]!==_[B]&&(O=!0);o.extVertexArrayObject&&this.vao&&this.boundProgram===h&&this.boundLayoutVertexBuffer===p&&!O&&this.boundIndexBuffer===x&&this.boundVertexOffset===E&&this.boundDynamicVertexBuffer===I&&this.boundDynamicVertexBuffer2===M&&this.boundDynamicVertexBuffer3===k?(o.bindVertexArrayOES.set(this.vao),I&&I.bind(),x&&x.dynamicDraw&&x.bind(),M&&M.bind(),k&&k.bind()):this.freshBind(h,p,_,x,E,I,M,k)}freshBind(o,h,p,_,x,E,I,M){let k;const O=o.numAttributes,B=this.context,q=B.gl;if(B.extVertexArrayObject)this.vao&&this.destroy(),this.vao=B.extVertexArrayObject.createVertexArrayOES(),B.bindVertexArrayOES.set(this.vao),k=0,this.boundProgram=o,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=_,this.boundVertexOffset=x,this.boundDynamicVertexBuffer=E,this.boundDynamicVertexBuffer2=I,this.boundDynamicVertexBuffer3=M;else{k=B.currentNumAttributes||0;for(let re=O;re<k;re++)q.disableVertexAttribArray(re)}h.enableAttributes(q,o);for(const re of p)re.enableAttributes(q,o);E&&E.enableAttributes(q,o),I&&I.enableAttributes(q,o),M&&M.enableAttributes(q,o),h.bind(),h.setVertexAttribPointers(q,o,x);for(const re of p)re.bind(),re.setVertexAttribPointers(q,o,x);E&&(E.bind(),E.setVertexAttribPointers(q,o,x)),_&&_.bind(),I&&(I.bind(),I.setVertexAttribPointers(q,o,x)),M&&(M.bind(),M.setVertexAttribPointers(q,o,x)),B.currentNumAttributes=O}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Ao(m){const o=[];for(let h=0;h<m.length;h++){if(m[h]===null)continue;const p=m[h].split(" ");o.push(p.pop())}return o}class ra{constructor(o,h,p,_,x,E,I){const M=o.gl;this.program=M.createProgram();const k=Ao(p.staticAttributes),O=_?_.getBinderAttributes():[],B=k.concat(O),q=vi.prelude.staticUniforms?Ao(vi.prelude.staticUniforms):[],re=p.staticUniforms?Ao(p.staticUniforms):[],te=_?_.getBinderUniforms():[],ne=q.concat(re).concat(te),fe=[];for(const Re of ne)fe.indexOf(Re)<0&&fe.push(Re);const _e=_?_.defines():[];E&&_e.push("#define OVERDRAW_INSPECTOR;"),I&&_e.push("#define TERRAIN3D;");const xe=_e.concat(vi.prelude.fragmentSource,p.fragmentSource).join(`
`),se=_e.concat(vi.prelude.vertexSource,p.vertexSource).join(`
`),Te=M.createShader(M.FRAGMENT_SHADER);if(M.isContextLost())return void(this.failedToCreate=!0);M.shaderSource(Te,xe),M.compileShader(Te),M.attachShader(this.program,Te);const we=M.createShader(M.VERTEX_SHADER);if(M.isContextLost())return void(this.failedToCreate=!0);M.shaderSource(we,se),M.compileShader(we),M.attachShader(this.program,we),this.attributes={};const ke={};this.numAttributes=B.length;for(let Re=0;Re<this.numAttributes;Re++)B[Re]&&(M.bindAttribLocation(this.program,Re,B[Re]),this.attributes[B[Re]]=Re);M.linkProgram(this.program),M.deleteShader(we),M.deleteShader(Te);for(let Re=0;Re<fe.length;Re++){const Be=fe[Re];if(Be&&!ke[Be]){const Me=M.getUniformLocation(this.program,Be);Me&&(ke[Be]=Me)}}this.fixedUniforms=x(o,ke),this.terrainUniforms=((Re,Be)=>({u_depth:new l.Uniform1i(Re,Be.u_depth),u_terrain:new l.Uniform1i(Re,Be.u_terrain),u_terrain_dim:new l.Uniform1f(Re,Be.u_terrain_dim),u_terrain_matrix:new l.UniformMatrix4f(Re,Be.u_terrain_matrix),u_terrain_unpack:new l.Uniform4f(Re,Be.u_terrain_unpack),u_terrain_offset:new l.Uniform1f(Re,Be.u_terrain_offset),u_terrain_exaggeration:new l.Uniform1f(Re,Be.u_terrain_exaggeration)}))(o,ke),this.binderUniforms=_?_.getUniforms(o,ke):[]}draw(o,h,p,_,x,E,I,M,k,O,B,q,re,te,ne,fe,_e,xe){const se=o.gl;if(this.failedToCreate)return;if(o.program.set(this.program),o.setDepthMode(p),o.setStencilMode(_),o.setColorMode(x),o.setCullFace(E),M){o.activeTexture.set(se.TEXTURE2),se.bindTexture(se.TEXTURE_2D,M.depthTexture),o.activeTexture.set(se.TEXTURE3),se.bindTexture(se.TEXTURE_2D,M.texture);for(const we in this.terrainUniforms)this.terrainUniforms[we].set(M[we])}for(const we in this.fixedUniforms)this.fixedUniforms[we].set(I[we]);ne&&ne.setUniforms(o,this.binderUniforms,re,{zoom:te});let Te=0;switch(h){case se.LINES:Te=2;break;case se.TRIANGLES:Te=3;break;case se.LINE_STRIP:Te=1}for(const we of q.get()){const ke=we.vaos||(we.vaos={});(ke[k]||(ke[k]=new So)).bind(o,this,O,ne?ne.getPaintVertexBuffers():[],B,we.vertexOffset,fe,_e,xe),se.drawElements(h,we.primitiveLength*Te,se.UNSIGNED_SHORT,we.primitiveOffset*Te*2)}}}function sa(m,o,h){const p=1/On(h,1,o.transform.tileZoom),_=Math.pow(2,h.tileID.overscaledZ),x=h.tileSize*Math.pow(2,o.transform.tileZoom)/_,E=x*(h.tileID.canonical.x+h.tileID.wrap*_),I=x*h.tileID.canonical.y;return{u_image:0,u_texsize:h.imageAtlasTexture.size,u_scale:[p,m.fromScale,m.toScale],u_fade:m.t,u_pixel_coord_upper:[E>>16,I>>16],u_pixel_coord_lower:[65535&E,65535&I]}}const eo=(m,o,h,p)=>{const _=o.style.light,x=_.properties.get("position"),E=[x.x,x.y,x.z],I=l.create$1();_.properties.get("anchor")==="viewport"&&l.fromRotation(I,-o.transform.angle),l.transformMat3(E,E,I);const M=_.properties.get("color");return{u_matrix:m,u_lightpos:E,u_lightintensity:_.properties.get("intensity"),u_lightcolor:[M.r,M.g,M.b],u_vertical_gradient:+h,u_opacity:p}},Wr=(m,o,h,p,_,x,E)=>l.extend(eo(m,o,h,p),sa(x,o,E),{u_height_factor:-Math.pow(2,_.overscaledZ)/E.tileSize/8}),oa=m=>({u_matrix:m}),aa=(m,o,h,p)=>l.extend(oa(m),sa(h,o,p)),la=(m,o)=>({u_matrix:m,u_world:o}),tl=(m,o,h,p,_)=>l.extend(aa(m,o,h,p),{u_world:_}),rc=(m,o,h,p)=>{const _=m.transform;let x,E;if(p.paint.get("circle-pitch-alignment")==="map"){const I=On(h,1,_.zoom);x=!0,E=[I,I]}else x=!1,E=_.pixelsToGLUnits;return{u_camera_to_center_distance:_.cameraToCenterDistance,u_scale_with_map:+(p.paint.get("circle-pitch-scale")==="map"),u_matrix:m.translatePosMatrix(o.posMatrix,h,p.paint.get("circle-translate"),p.paint.get("circle-translate-anchor")),u_pitch_with_map:+x,u_device_pixel_ratio:m.pixelRatio,u_extrude_scale:E}},Rs=(m,o,h)=>{const p=On(h,1,o.zoom),_=Math.pow(2,o.zoom-h.tileID.overscaledZ),x=h.tileID.overscaleFactor();return{u_matrix:m,u_camera_to_center_distance:o.cameraToCenterDistance,u_pixels_to_tile_units:p,u_extrude_scale:[o.pixelsToGLUnits[0]/(p*_),o.pixelsToGLUnits[1]/(p*_)],u_overscale_factor:x}},Z=(m,o,h=1)=>({u_matrix:m,u_color:o,u_overlay:0,u_overlay_scale:h}),Q=m=>({u_matrix:m}),he=(m,o,h,p)=>({u_matrix:m,u_extrude_scale:On(o,1,h),u_intensity:p});function Pe(m,o){const h=Math.pow(2,o.canonical.z),p=o.canonical.y;return[new l.MercatorCoordinate(0,p/h).toLngLat().lat,new l.MercatorCoordinate(0,(p+1)/h).toLngLat().lat]}const Ue=(m,o,h,p)=>{const _=m.transform;return{u_matrix:jn(m,o,h,p),u_ratio:1/On(o,1,_.zoom),u_device_pixel_ratio:m.pixelRatio,u_units_to_pixels:[1/_.pixelsToGLUnits[0],1/_.pixelsToGLUnits[1]]}},ut=(m,o,h,p,_)=>l.extend(Ue(m,o,h,_),{u_image:0,u_image_height:p}),Vt=(m,o,h,p,_)=>{const x=m.transform,E=zt(o,x);return{u_matrix:jn(m,o,h,_),u_texsize:o.imageAtlasTexture.size,u_ratio:1/On(o,1,x.zoom),u_device_pixel_ratio:m.pixelRatio,u_image:0,u_scale:[E,p.fromScale,p.toScale],u_fade:p.t,u_units_to_pixels:[1/x.pixelsToGLUnits[0],1/x.pixelsToGLUnits[1]]}},Cn=(m,o,h,p,_,x)=>{const E=m.lineAtlas,I=zt(o,m.transform),M=h.layout.get("line-cap")==="round",k=E.getDash(p.from,M),O=E.getDash(p.to,M),B=k.width*_.fromScale,q=O.width*_.toScale;return l.extend(Ue(m,o,h,x),{u_patternscale_a:[I/B,-k.height/2],u_patternscale_b:[I/q,-O.height/2],u_sdfgamma:E.width/(256*Math.min(B,q)*m.pixelRatio)/2,u_image:0,u_tex_y_a:k.y,u_tex_y_b:O.y,u_mix:_.t})};function zt(m,o){return 1/On(m,1,o.tileZoom)}function jn(m,o,h,p){return m.translatePosMatrix(p?p.posMatrix:o.tileID.posMatrix,o,h.paint.get("line-translate"),h.paint.get("line-translate-anchor"))}const hr=(m,o,h,p,_)=>{return{u_matrix:m,u_tl_parent:o,u_scale_parent:h,u_buffer_scale:1,u_fade_t:p.mix,u_opacity:p.opacity*_.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:_.paint.get("raster-brightness-min"),u_brightness_high:_.paint.get("raster-brightness-max"),u_saturation_factor:(E=_.paint.get("raster-saturation"),E>0?1-1/(1.001-E):-E),u_contrast_factor:(x=_.paint.get("raster-contrast"),x>0?1/(1-x):1+x),u_spin_weights:cf(_.paint.get("raster-hue-rotate"))};var x,E};function cf(m){m*=Math.PI/180;const o=Math.sin(m),h=Math.cos(m);return[(2*h+1)/3,(-Math.sqrt(3)*o-h+1)/3,(Math.sqrt(3)*o-h+1)/3]}const Hu=(m,o,h,p,_,x,E,I,M,k)=>{const O=_.transform;return{u_is_size_zoom_constant:+(m==="constant"||m==="source"),u_is_size_feature_constant:+(m==="constant"||m==="camera"),u_size_t:o?o.uSizeT:0,u_size:o?o.uSize:0,u_camera_to_center_distance:O.cameraToCenterDistance,u_pitch:O.pitch/360*2*Math.PI,u_rotate_symbol:+h,u_aspect_ratio:O.width/O.height,u_fade_change:_.options.fadeDuration?_.symbolFadeChange:1,u_matrix:x,u_label_plane_matrix:E,u_coord_matrix:I,u_is_text:+M,u_pitch_with_map:+p,u_texsize:k,u_texture:0}},sc=(m,o,h,p,_,x,E,I,M,k,O)=>{const B=_.transform;return l.extend(Hu(m,o,h,p,_,x,E,I,M,k),{u_gamma_scale:p?Math.cos(B._pitch)*B.cameraToCenterDistance:1,u_device_pixel_ratio:_.pixelRatio,u_is_halo:+O})},uf=(m,o,h,p,_,x,E,I,M,k)=>l.extend(sc(m,o,h,p,_,x,E,I,!0,M,!0),{u_texsize_icon:k,u_texture_icon:1}),kg=(m,o,h)=>({u_matrix:m,u_opacity:o,u_color:h}),Rg=(m,o,h,p,_,x)=>l.extend(function(E,I,M,k){const O=M.imageManager.getPattern(E.from.toString()),B=M.imageManager.getPattern(E.to.toString()),{width:q,height:re}=M.imageManager.getPixelSize(),te=Math.pow(2,k.tileID.overscaledZ),ne=k.tileSize*Math.pow(2,M.transform.tileZoom)/te,fe=ne*(k.tileID.canonical.x+k.tileID.wrap*te),_e=ne*k.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:O.tl,u_pattern_br_a:O.br,u_pattern_tl_b:B.tl,u_pattern_br_b:B.br,u_texsize:[q,re],u_mix:I.t,u_pattern_size_a:O.displaySize,u_pattern_size_b:B.displaySize,u_scale_a:I.fromScale,u_scale_b:I.toScale,u_tile_units_to_pixels:1/On(k,1,M.transform.tileZoom),u_pixel_coord_upper:[fe>>16,_e>>16],u_pixel_coord_lower:[65535&fe,65535&_e]}}(p,x,h,_),{u_matrix:m,u_opacity:o}),$u={fillExtrusion:(m,o)=>({u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_lightpos:new l.Uniform3f(m,o.u_lightpos),u_lightintensity:new l.Uniform1f(m,o.u_lightintensity),u_lightcolor:new l.Uniform3f(m,o.u_lightcolor),u_vertical_gradient:new l.Uniform1f(m,o.u_vertical_gradient),u_opacity:new l.Uniform1f(m,o.u_opacity)}),fillExtrusionPattern:(m,o)=>({u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_lightpos:new l.Uniform3f(m,o.u_lightpos),u_lightintensity:new l.Uniform1f(m,o.u_lightintensity),u_lightcolor:new l.Uniform3f(m,o.u_lightcolor),u_vertical_gradient:new l.Uniform1f(m,o.u_vertical_gradient),u_height_factor:new l.Uniform1f(m,o.u_height_factor),u_image:new l.Uniform1i(m,o.u_image),u_texsize:new l.Uniform2f(m,o.u_texsize),u_pixel_coord_upper:new l.Uniform2f(m,o.u_pixel_coord_upper),u_pixel_coord_lower:new l.Uniform2f(m,o.u_pixel_coord_lower),u_scale:new l.Uniform3f(m,o.u_scale),u_fade:new l.Uniform1f(m,o.u_fade),u_opacity:new l.Uniform1f(m,o.u_opacity)}),fill:(m,o)=>({u_matrix:new l.UniformMatrix4f(m,o.u_matrix)}),fillPattern:(m,o)=>({u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_image:new l.Uniform1i(m,o.u_image),u_texsize:new l.Uniform2f(m,o.u_texsize),u_pixel_coord_upper:new l.Uniform2f(m,o.u_pixel_coord_upper),u_pixel_coord_lower:new l.Uniform2f(m,o.u_pixel_coord_lower),u_scale:new l.Uniform3f(m,o.u_scale),u_fade:new l.Uniform1f(m,o.u_fade)}),fillOutline:(m,o)=>({u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_world:new l.Uniform2f(m,o.u_world)}),fillOutlinePattern:(m,o)=>({u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_world:new l.Uniform2f(m,o.u_world),u_image:new l.Uniform1i(m,o.u_image),u_texsize:new l.Uniform2f(m,o.u_texsize),u_pixel_coord_upper:new l.Uniform2f(m,o.u_pixel_coord_upper),u_pixel_coord_lower:new l.Uniform2f(m,o.u_pixel_coord_lower),u_scale:new l.Uniform3f(m,o.u_scale),u_fade:new l.Uniform1f(m,o.u_fade)}),circle:(m,o)=>({u_camera_to_center_distance:new l.Uniform1f(m,o.u_camera_to_center_distance),u_scale_with_map:new l.Uniform1i(m,o.u_scale_with_map),u_pitch_with_map:new l.Uniform1i(m,o.u_pitch_with_map),u_extrude_scale:new l.Uniform2f(m,o.u_extrude_scale),u_device_pixel_ratio:new l.Uniform1f(m,o.u_device_pixel_ratio),u_matrix:new l.UniformMatrix4f(m,o.u_matrix)}),collisionBox:(m,o)=>({u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_camera_to_center_distance:new l.Uniform1f(m,o.u_camera_to_center_distance),u_pixels_to_tile_units:new l.Uniform1f(m,o.u_pixels_to_tile_units),u_extrude_scale:new l.Uniform2f(m,o.u_extrude_scale),u_overscale_factor:new l.Uniform1f(m,o.u_overscale_factor)}),collisionCircle:(m,o)=>({u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_inv_matrix:new l.UniformMatrix4f(m,o.u_inv_matrix),u_camera_to_center_distance:new l.Uniform1f(m,o.u_camera_to_center_distance),u_viewport_size:new l.Uniform2f(m,o.u_viewport_size)}),debug:(m,o)=>({u_color:new l.UniformColor(m,o.u_color),u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_overlay:new l.Uniform1i(m,o.u_overlay),u_overlay_scale:new l.Uniform1f(m,o.u_overlay_scale)}),clippingMask:(m,o)=>({u_matrix:new l.UniformMatrix4f(m,o.u_matrix)}),heatmap:(m,o)=>({u_extrude_scale:new l.Uniform1f(m,o.u_extrude_scale),u_intensity:new l.Uniform1f(m,o.u_intensity),u_matrix:new l.UniformMatrix4f(m,o.u_matrix)}),heatmapTexture:(m,o)=>({u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_world:new l.Uniform2f(m,o.u_world),u_image:new l.Uniform1i(m,o.u_image),u_color_ramp:new l.Uniform1i(m,o.u_color_ramp),u_opacity:new l.Uniform1f(m,o.u_opacity)}),hillshade:(m,o)=>({u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_image:new l.Uniform1i(m,o.u_image),u_latrange:new l.Uniform2f(m,o.u_latrange),u_light:new l.Uniform2f(m,o.u_light),u_shadow:new l.UniformColor(m,o.u_shadow),u_highlight:new l.UniformColor(m,o.u_highlight),u_accent:new l.UniformColor(m,o.u_accent)}),hillshadePrepare:(m,o)=>({u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_image:new l.Uniform1i(m,o.u_image),u_dimension:new l.Uniform2f(m,o.u_dimension),u_zoom:new l.Uniform1f(m,o.u_zoom),u_unpack:new l.Uniform4f(m,o.u_unpack)}),line:(m,o)=>({u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_ratio:new l.Uniform1f(m,o.u_ratio),u_device_pixel_ratio:new l.Uniform1f(m,o.u_device_pixel_ratio),u_units_to_pixels:new l.Uniform2f(m,o.u_units_to_pixels)}),lineGradient:(m,o)=>({u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_ratio:new l.Uniform1f(m,o.u_ratio),u_device_pixel_ratio:new l.Uniform1f(m,o.u_device_pixel_ratio),u_units_to_pixels:new l.Uniform2f(m,o.u_units_to_pixels),u_image:new l.Uniform1i(m,o.u_image),u_image_height:new l.Uniform1f(m,o.u_image_height)}),linePattern:(m,o)=>({u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_texsize:new l.Uniform2f(m,o.u_texsize),u_ratio:new l.Uniform1f(m,o.u_ratio),u_device_pixel_ratio:new l.Uniform1f(m,o.u_device_pixel_ratio),u_image:new l.Uniform1i(m,o.u_image),u_units_to_pixels:new l.Uniform2f(m,o.u_units_to_pixels),u_scale:new l.Uniform3f(m,o.u_scale),u_fade:new l.Uniform1f(m,o.u_fade)}),lineSDF:(m,o)=>({u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_ratio:new l.Uniform1f(m,o.u_ratio),u_device_pixel_ratio:new l.Uniform1f(m,o.u_device_pixel_ratio),u_units_to_pixels:new l.Uniform2f(m,o.u_units_to_pixels),u_patternscale_a:new l.Uniform2f(m,o.u_patternscale_a),u_patternscale_b:new l.Uniform2f(m,o.u_patternscale_b),u_sdfgamma:new l.Uniform1f(m,o.u_sdfgamma),u_image:new l.Uniform1i(m,o.u_image),u_tex_y_a:new l.Uniform1f(m,o.u_tex_y_a),u_tex_y_b:new l.Uniform1f(m,o.u_tex_y_b),u_mix:new l.Uniform1f(m,o.u_mix)}),raster:(m,o)=>({u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_tl_parent:new l.Uniform2f(m,o.u_tl_parent),u_scale_parent:new l.Uniform1f(m,o.u_scale_parent),u_buffer_scale:new l.Uniform1f(m,o.u_buffer_scale),u_fade_t:new l.Uniform1f(m,o.u_fade_t),u_opacity:new l.Uniform1f(m,o.u_opacity),u_image0:new l.Uniform1i(m,o.u_image0),u_image1:new l.Uniform1i(m,o.u_image1),u_brightness_low:new l.Uniform1f(m,o.u_brightness_low),u_brightness_high:new l.Uniform1f(m,o.u_brightness_high),u_saturation_factor:new l.Uniform1f(m,o.u_saturation_factor),u_contrast_factor:new l.Uniform1f(m,o.u_contrast_factor),u_spin_weights:new l.Uniform3f(m,o.u_spin_weights)}),symbolIcon:(m,o)=>({u_is_size_zoom_constant:new l.Uniform1i(m,o.u_is_size_zoom_constant),u_is_size_feature_constant:new l.Uniform1i(m,o.u_is_size_feature_constant),u_size_t:new l.Uniform1f(m,o.u_size_t),u_size:new l.Uniform1f(m,o.u_size),u_camera_to_center_distance:new l.Uniform1f(m,o.u_camera_to_center_distance),u_pitch:new l.Uniform1f(m,o.u_pitch),u_rotate_symbol:new l.Uniform1i(m,o.u_rotate_symbol),u_aspect_ratio:new l.Uniform1f(m,o.u_aspect_ratio),u_fade_change:new l.Uniform1f(m,o.u_fade_change),u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_label_plane_matrix:new l.UniformMatrix4f(m,o.u_label_plane_matrix),u_coord_matrix:new l.UniformMatrix4f(m,o.u_coord_matrix),u_is_text:new l.Uniform1i(m,o.u_is_text),u_pitch_with_map:new l.Uniform1i(m,o.u_pitch_with_map),u_texsize:new l.Uniform2f(m,o.u_texsize),u_texture:new l.Uniform1i(m,o.u_texture)}),symbolSDF:(m,o)=>({u_is_size_zoom_constant:new l.Uniform1i(m,o.u_is_size_zoom_constant),u_is_size_feature_constant:new l.Uniform1i(m,o.u_is_size_feature_constant),u_size_t:new l.Uniform1f(m,o.u_size_t),u_size:new l.Uniform1f(m,o.u_size),u_camera_to_center_distance:new l.Uniform1f(m,o.u_camera_to_center_distance),u_pitch:new l.Uniform1f(m,o.u_pitch),u_rotate_symbol:new l.Uniform1i(m,o.u_rotate_symbol),u_aspect_ratio:new l.Uniform1f(m,o.u_aspect_ratio),u_fade_change:new l.Uniform1f(m,o.u_fade_change),u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_label_plane_matrix:new l.UniformMatrix4f(m,o.u_label_plane_matrix),u_coord_matrix:new l.UniformMatrix4f(m,o.u_coord_matrix),u_is_text:new l.Uniform1i(m,o.u_is_text),u_pitch_with_map:new l.Uniform1i(m,o.u_pitch_with_map),u_texsize:new l.Uniform2f(m,o.u_texsize),u_texture:new l.Uniform1i(m,o.u_texture),u_gamma_scale:new l.Uniform1f(m,o.u_gamma_scale),u_device_pixel_ratio:new l.Uniform1f(m,o.u_device_pixel_ratio),u_is_halo:new l.Uniform1i(m,o.u_is_halo)}),symbolTextAndIcon:(m,o)=>({u_is_size_zoom_constant:new l.Uniform1i(m,o.u_is_size_zoom_constant),u_is_size_feature_constant:new l.Uniform1i(m,o.u_is_size_feature_constant),u_size_t:new l.Uniform1f(m,o.u_size_t),u_size:new l.Uniform1f(m,o.u_size),u_camera_to_center_distance:new l.Uniform1f(m,o.u_camera_to_center_distance),u_pitch:new l.Uniform1f(m,o.u_pitch),u_rotate_symbol:new l.Uniform1i(m,o.u_rotate_symbol),u_aspect_ratio:new l.Uniform1f(m,o.u_aspect_ratio),u_fade_change:new l.Uniform1f(m,o.u_fade_change),u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_label_plane_matrix:new l.UniformMatrix4f(m,o.u_label_plane_matrix),u_coord_matrix:new l.UniformMatrix4f(m,o.u_coord_matrix),u_is_text:new l.Uniform1i(m,o.u_is_text),u_pitch_with_map:new l.Uniform1i(m,o.u_pitch_with_map),u_texsize:new l.Uniform2f(m,o.u_texsize),u_texsize_icon:new l.Uniform2f(m,o.u_texsize_icon),u_texture:new l.Uniform1i(m,o.u_texture),u_texture_icon:new l.Uniform1i(m,o.u_texture_icon),u_gamma_scale:new l.Uniform1f(m,o.u_gamma_scale),u_device_pixel_ratio:new l.Uniform1f(m,o.u_device_pixel_ratio),u_is_halo:new l.Uniform1i(m,o.u_is_halo)}),background:(m,o)=>({u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_opacity:new l.Uniform1f(m,o.u_opacity),u_color:new l.UniformColor(m,o.u_color)}),backgroundPattern:(m,o)=>({u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_opacity:new l.Uniform1f(m,o.u_opacity),u_image:new l.Uniform1i(m,o.u_image),u_pattern_tl_a:new l.Uniform2f(m,o.u_pattern_tl_a),u_pattern_br_a:new l.Uniform2f(m,o.u_pattern_br_a),u_pattern_tl_b:new l.Uniform2f(m,o.u_pattern_tl_b),u_pattern_br_b:new l.Uniform2f(m,o.u_pattern_br_b),u_texsize:new l.Uniform2f(m,o.u_texsize),u_mix:new l.Uniform1f(m,o.u_mix),u_pattern_size_a:new l.Uniform2f(m,o.u_pattern_size_a),u_pattern_size_b:new l.Uniform2f(m,o.u_pattern_size_b),u_scale_a:new l.Uniform1f(m,o.u_scale_a),u_scale_b:new l.Uniform1f(m,o.u_scale_b),u_pixel_coord_upper:new l.Uniform2f(m,o.u_pixel_coord_upper),u_pixel_coord_lower:new l.Uniform2f(m,o.u_pixel_coord_lower),u_tile_units_to_pixels:new l.Uniform1f(m,o.u_tile_units_to_pixels)}),terrain:(m,o)=>({u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_texture:new l.Uniform1i(m,o.u_texture)}),terrainDepth:(m,o)=>({u_matrix:new l.UniformMatrix4f(m,o.u_matrix)}),terrainCoords:(m,o)=>({u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_texture:new l.Uniform1i(m,o.u_texture),u_terrain_coords_id:new l.Uniform1f(m,o.u_terrain_coords_id)})};class qu{constructor(o,h,p){this.context=o;const _=o.gl;this.buffer=_.createBuffer(),this.dynamicDraw=!!p,this.context.unbindVAO(),o.bindElementBuffer.set(this.buffer),_.bufferData(_.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(o){const h=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,o.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Zu={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Xu{constructor(o,h,p,_){this.length=h.length,this.attributes=p,this.itemSize=h.bytesPerElement,this.dynamicDraw=_,this.context=o;const x=o.gl;this.buffer=x.createBuffer(),o.bindVertexBuffer.set(this.buffer),x.bufferData(x.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(o){if(o.length!==this.length)throw new Error(`Length of new data is ${o.length}, which doesn't match current length of ${this.length}`);const h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,o.arrayBuffer)}enableAttributes(o,h){for(let p=0;p<this.attributes.length;p++){const _=h.attributes[this.attributes[p].name];_!==void 0&&o.enableVertexAttribArray(_)}}setVertexAttribPointers(o,h,p){for(let _=0;_<this.attributes.length;_++){const x=this.attributes[_],E=h.attributes[x.name];E!==void 0&&o.vertexAttribPointer(E,x.components,o[Zu[x.type]],!1,this.itemSize,x.offset+this.itemSize*(p||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class nn{constructor(o){this.gl=o.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(o){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class hf extends nn{getDefault(){return l.Color.transparent}set(o){const h=this.current;(o.r!==h.r||o.g!==h.g||o.b!==h.b||o.a!==h.a||this.dirty)&&(this.gl.clearColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class Dg extends nn{getDefault(){return 1}set(o){(o!==this.current||this.dirty)&&(this.gl.clearDepth(o),this.current=o,this.dirty=!1)}}class nl extends nn{getDefault(){return 0}set(o){(o!==this.current||this.dirty)&&(this.gl.clearStencil(o),this.current=o,this.dirty=!1)}}class il extends nn{getDefault(){return[!0,!0,!0,!0]}set(o){const h=this.current;(o[0]!==h[0]||o[1]!==h[1]||o[2]!==h[2]||o[3]!==h[3]||this.dirty)&&(this.gl.colorMask(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class df extends nn{getDefault(){return!0}set(o){(o!==this.current||this.dirty)&&(this.gl.depthMask(o),this.current=o,this.dirty=!1)}}class dr extends nn{getDefault(){return 255}set(o){(o!==this.current||this.dirty)&&(this.gl.stencilMask(o),this.current=o,this.dirty=!1)}}class Yu extends nn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(o){const h=this.current;(o.func!==h.func||o.ref!==h.ref||o.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(o.func,o.ref,o.mask),this.current=o,this.dirty=!1)}}class oc extends nn{getDefault(){const o=this.gl;return[o.KEEP,o.KEEP,o.KEEP]}set(o){const h=this.current;(o[0]!==h[0]||o[1]!==h[1]||o[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(o[0],o[1],o[2]),this.current=o,this.dirty=!1)}}class ac extends nn{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;o?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=o,this.dirty=!1}}class Ku extends nn{getDefault(){return[0,1]}set(o){const h=this.current;(o[0]!==h[0]||o[1]!==h[1]||this.dirty)&&(this.gl.depthRange(o[0],o[1]),this.current=o,this.dirty=!1)}}class Ju extends nn{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;o?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=o,this.dirty=!1}}class lc extends nn{getDefault(){return this.gl.LESS}set(o){(o!==this.current||this.dirty)&&(this.gl.depthFunc(o),this.current=o,this.dirty=!1)}}class Qu extends nn{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;o?h.enable(h.BLEND):h.disable(h.BLEND),this.current=o,this.dirty=!1}}class eh extends nn{getDefault(){const o=this.gl;return[o.ONE,o.ZERO]}set(o){const h=this.current;(o[0]!==h[0]||o[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(o[0],o[1]),this.current=o,this.dirty=!1)}}class cc extends nn{getDefault(){return l.Color.transparent}set(o){const h=this.current;(o.r!==h.r||o.g!==h.g||o.b!==h.b||o.a!==h.a||this.dirty)&&(this.gl.blendColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class ff extends nn{getDefault(){return this.gl.FUNC_ADD}set(o){(o!==this.current||this.dirty)&&(this.gl.blendEquation(o),this.current=o,this.dirty=!1)}}class pf extends nn{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;o?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=o,this.dirty=!1}}class ca extends nn{getDefault(){return this.gl.BACK}set(o){(o!==this.current||this.dirty)&&(this.gl.cullFace(o),this.current=o,this.dirty=!1)}}class zg extends nn{getDefault(){return this.gl.CCW}set(o){(o!==this.current||this.dirty)&&(this.gl.frontFace(o),this.current=o,this.dirty=!1)}}class Og extends nn{getDefault(){return null}set(o){(o!==this.current||this.dirty)&&(this.gl.useProgram(o),this.current=o,this.dirty=!1)}}class Fg extends nn{getDefault(){return this.gl.TEXTURE0}set(o){(o!==this.current||this.dirty)&&(this.gl.activeTexture(o),this.current=o,this.dirty=!1)}}class Ng extends nn{getDefault(){const o=this.gl;return[0,0,o.drawingBufferWidth,o.drawingBufferHeight]}set(o){const h=this.current;(o[0]!==h[0]||o[1]!==h[1]||o[2]!==h[2]||o[3]!==h[3]||this.dirty)&&(this.gl.viewport(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class Bg extends nn{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,o),this.current=o,this.dirty=!1}}class Ug extends nn{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class th extends nn{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.bindTexture(h.TEXTURE_2D,o),this.current=o,this.dirty=!1}}class uc extends nn{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class nh extends nn{getDefault(){return null}set(o){const h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class ih extends nn{constructor(o){super(o),this.vao=o.extVertexArrayObject}getDefault(){return null}set(o){this.vao&&(o!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(o),this.current=o,this.dirty=!1)}}class ua extends nn{getDefault(){return 4}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,o),this.current=o,this.dirty=!1}}class mf extends nn{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o),this.current=o,this.dirty=!1}}class gf extends nn{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,o),this.current=o,this.dirty=!1}}class hc extends nn{constructor(o,h){super(o),this.context=o,this.parent=h}getDefault(){return null}}class Po extends hc{setDirty(){this.dirty=!0}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class _f extends hc{set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_ATTACHMENT,h.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class ha{constructor(o,h,p,_){this.context=o,this.width=h,this.height=p;const x=o.gl,E=this.framebuffer=x.createFramebuffer();if(this.colorAttachment=new Po(o,E),_&&(this.depthAttachment=new _f(o,E)),x.checkFramebufferStatus(x.FRAMEBUFFER)!==x.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const o=this.context.gl,h=this.colorAttachment.get();if(h&&o.deleteTexture(h),this.depthAttachment){const p=this.depthAttachment.get();p&&o.deleteRenderbuffer(p)}o.deleteFramebuffer(this.framebuffer)}}class wn{constructor(o,h,p){this.blendFunction=o,this.blendColor=h,this.mask=p}}wn.Replace=[1,0],wn.disabled=new wn(wn.Replace,l.Color.transparent,[!1,!1,!1,!1]),wn.unblended=new wn(wn.Replace,l.Color.transparent,[!0,!0,!0,!0]),wn.alphaBlended=new wn([1,771],l.Color.transparent,[!0,!0,!0,!0]);class yf{constructor(o){this.gl=o,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new hf(this),this.clearDepth=new Dg(this),this.clearStencil=new nl(this),this.colorMask=new il(this),this.depthMask=new df(this),this.stencilMask=new dr(this),this.stencilFunc=new Yu(this),this.stencilOp=new oc(this),this.stencilTest=new ac(this),this.depthRange=new Ku(this),this.depthTest=new Ju(this),this.depthFunc=new lc(this),this.blend=new Qu(this),this.blendFunc=new eh(this),this.blendColor=new cc(this),this.blendEquation=new ff(this),this.cullFace=new pf(this),this.cullFaceSide=new ca(this),this.frontFace=new zg(this),this.program=new Og(this),this.activeTexture=new Fg(this),this.viewport=new Ng(this),this.bindFramebuffer=new Bg(this),this.bindRenderbuffer=new Ug(this),this.bindTexture=new th(this),this.bindVertexBuffer=new uc(this),this.bindElementBuffer=new nh(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new ih(this),this.pixelStoreUnpack=new ua(this),this.pixelStoreUnpackPremultiplyAlpha=new mf(this),this.pixelStoreUnpackFlipY=new gf(this),this.extTextureFilterAnisotropic=o.getExtension("EXT_texture_filter_anisotropic")||o.getExtension("MOZ_EXT_texture_filter_anisotropic")||o.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=o.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=o.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(o.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=o.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=o.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=o.getParameter(o.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(o,h){return new qu(this,o,h)}createVertexBuffer(o,h,p){return new Xu(this,o,h,p)}createRenderbuffer(o,h,p){const _=this.gl,x=_.createRenderbuffer();return this.bindRenderbuffer.set(x),_.renderbufferStorage(_.RENDERBUFFER,o,h,p),this.bindRenderbuffer.set(null),x}createFramebuffer(o,h,p){return new ha(this,o,h,p)}clear({color:o,depth:h}){const p=this.gl;let _=0;o&&(_|=p.COLOR_BUFFER_BIT,this.clearColor.set(o),this.colorMask.set([!0,!0,!0,!0])),h!==void 0&&(_|=p.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),p.clear(_)}setCullFace(o){o.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(o.mode),this.frontFace.set(o.frontFace))}setDepthMode(o){o.func!==this.gl.ALWAYS||o.mask?(this.depthTest.set(!0),this.depthFunc.set(o.func),this.depthMask.set(o.mask),this.depthRange.set(o.range)):this.depthTest.set(!1)}setStencilMode(o){o.test.func!==this.gl.ALWAYS||o.mask?(this.stencilTest.set(!0),this.stencilMask.set(o.mask),this.stencilOp.set([o.fail,o.depthFail,o.pass]),this.stencilFunc.set({func:o.test.func,ref:o.ref,mask:o.test.mask})):this.stencilTest.set(!1)}setColorMode(o){C(o.blendFunction,wn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(o.blendFunction),this.blendColor.set(o.blendColor)),this.colorMask.set(o.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class qt{constructor(o,h,p){this.func=o,this.mask=h,this.range=p}}qt.ReadOnly=!1,qt.ReadWrite=!0,qt.disabled=new qt(519,qt.ReadOnly,[0,1]);const rn=7680;class xn{constructor(o,h,p,_,x,E){this.test=o,this.ref=h,this.mask=p,this.fail=_,this.depthFail=x,this.pass=E}}xn.disabled=new xn({func:519,mask:0},0,0,rn,rn,rn);class Sn{constructor(o,h,p){this.enable=o,this.mode=h,this.frontFace=p}}let rl;function da(m,o,h,p,_,x,E){const I=m.context,M=I.gl,k=m.useProgram("collisionBox"),O=[];let B=0,q=0;for(let se=0;se<p.length;se++){const Te=p[se],we=o.getTile(Te),ke=we.getBucket(h);if(!ke)continue;let Re=Te.posMatrix;_[0]===0&&_[1]===0||(Re=m.translatePosMatrix(Te.posMatrix,we,_,x));const Be=E?ke.textCollisionBox:ke.iconCollisionBox,Me=ke.collisionCircleArray;if(Me.length>0){const nt=l.create(),Ze=Re;l.mul(nt,ke.placementInvProjMatrix,m.transform.glCoordMatrix),l.mul(nt,nt,ke.placementViewportMatrix),O.push({circleArray:Me,circleOffset:q,transform:Ze,invTransform:nt,coord:Te}),B+=Me.length/4,q=B}Be&&k.draw(I,M.LINES,qt.disabled,xn.disabled,m.colorModeForRenderPass(),Sn.disabled,Rs(Re,m.transform,we),m.style.terrain&&m.style.terrain.getTerrainData(Te),h.id,Be.layoutVertexBuffer,Be.indexBuffer,Be.segments,null,m.transform.zoom,null,null,Be.collisionVertexBuffer)}if(!E||!O.length)return;const re=m.useProgram("collisionCircle"),te=new l.CollisionCircleLayoutArray;te.resize(4*B),te._trim();let ne=0;for(const se of O)for(let Te=0;Te<se.circleArray.length/4;Te++){const we=4*Te,ke=se.circleArray[we+0],Re=se.circleArray[we+1],Be=se.circleArray[we+2],Me=se.circleArray[we+3];te.emplace(ne++,ke,Re,Be,Me,0),te.emplace(ne++,ke,Re,Be,Me,1),te.emplace(ne++,ke,Re,Be,Me,2),te.emplace(ne++,ke,Re,Be,Me,3)}(!rl||rl.length<2*B)&&(rl=function(se){const Te=2*se,we=new l.QuadTriangleArray;we.resize(Te),we._trim();for(let ke=0;ke<Te;ke++){const Re=6*ke;we.uint16[Re+0]=4*ke+0,we.uint16[Re+1]=4*ke+1,we.uint16[Re+2]=4*ke+2,we.uint16[Re+3]=4*ke+2,we.uint16[Re+4]=4*ke+3,we.uint16[Re+5]=4*ke+0}return we}(B));const fe=I.createIndexBuffer(rl,!0),_e=I.createVertexBuffer(te,l.collisionCircleLayout.members,!0);for(const se of O){const Te={u_matrix:se.transform,u_inv_matrix:se.invTransform,u_camera_to_center_distance:(xe=m.transform).cameraToCenterDistance,u_viewport_size:[xe.width,xe.height]};re.draw(I,M.TRIANGLES,qt.disabled,xn.disabled,m.colorModeForRenderPass(),Sn.disabled,Te,m.style.terrain&&m.style.terrain.getTerrainData(se.coord),h.id,_e,fe,l.SegmentVector.simpleSegment(0,2*se.circleOffset,se.circleArray.length,se.circleArray.length/2),null,m.transform.zoom,null,null,null)}var xe;_e.destroy(),fe.destroy()}Sn.disabled=new Sn(!1,1029,2305),Sn.backCCW=new Sn(!0,1029,2305);const Vg=l.identity(new Float32Array(16));function jg(m,o,h,p,_,x){const{horizontalAlign:E,verticalAlign:I}=l.getAnchorAlignment(m),M=-(E-.5)*o,k=-(I-.5)*h,O=l.evaluateVariableOffset(m,p);return new l.pointGeometry((M/_+O[0])*x,(k/_+O[1])*x)}function vf(m,o,h,p,_,x,E,I,M,k,O){const B=m.text.placedSymbolArray,q=m.text.dynamicLayoutVertexArray,re=m.icon.dynamicLayoutVertexArray,te={};q.clear();for(let ne=0;ne<B.length;ne++){const fe=B.get(ne),_e=m.allowVerticalPlacement&&!fe.placedOrientation,xe=fe.hidden||!fe.crossTileID||_e?null:p[fe.crossTileID];if(xe){const se=new l.pointGeometry(fe.anchorX,fe.anchorY),Te=Gt(se,h?E:x,O),we=Xi(_.cameraToCenterDistance,Te.signedDistanceFromCamera);let ke=l.evaluateSizeForFeature(m.textSizeData,M,fe)*we/l.ONE_EM;h&&(ke*=m.tilePixelRatio/I);const{width:Re,height:Be,anchor:Me,textOffset:nt,textBoxScale:Ze}=xe,st=jg(Me,Re,Be,nt,Ze,ke),Rt=h?Gt(se.add(st),x,O).point:Te.point.add(o?st.rotate(-_.angle):st),Ot=m.allowVerticalPlacement&&fe.placedOrientation===l.WritingMode.vertical?Math.PI/2:0;for(let bt=0;bt<fe.numGlyphs;bt++)l.addDynamicAttributes(q,Rt,Ot);k&&fe.associatedIconIndex>=0&&(te[fe.associatedIconIndex]={shiftedAnchor:Rt,angle:Ot})}else Mt(fe.numGlyphs,q)}if(k){re.clear();const ne=m.icon.placedSymbolArray;for(let fe=0;fe<ne.length;fe++){const _e=ne.get(fe);if(_e.hidden)Mt(_e.numGlyphs,re);else{const xe=te[fe];if(xe)for(let se=0;se<_e.numGlyphs;se++)l.addDynamicAttributes(re,xe.shiftedAnchor,xe.angle);else Mt(_e.numGlyphs,re)}}m.icon.dynamicLayoutVertexBuffer.updateData(re)}m.text.dynamicLayoutVertexBuffer.updateData(q)}function Gg(m,o,h){return h.iconsInText&&o?"symbolTextAndIcon":m?"symbolSDF":"symbolIcon"}function dc(m,o,h,p,_,x,E,I,M,k,O,B){const q=m.context,re=q.gl,te=m.transform,ne=I==="map",fe=M==="map",_e=I!=="viewport"&&h.layout.get("symbol-placement")!=="point",xe=ne&&!fe&&!_e,se=!h.layout.get("symbol-sort-key").isConstant();let Te=!1;const we=m.depthModeForSublayer(0,qt.ReadOnly),ke=h.layout.get("text-variable-anchor"),Re=[];for(const Be of p){const Me=o.getTile(Be),nt=Me.getBucket(h);if(!nt)continue;const Ze=_?nt.text:nt.icon;if(!Ze||!Ze.segments.get().length)continue;const st=Ze.programConfigurations.get(h.id),Rt=_||nt.sdfIcons,Ot=_?nt.textSizeData:nt.iconSizeData,bt=fe||te.pitch!==0,cn=m.useProgram(Gg(Rt,_,nt),st),un=l.evaluateSizeForZoom(Ot,te.zoom),Zt=m.style.terrain&&m.style.terrain.getTerrainData(Be);let Xt,dn,hi,_s,$r=[0,0],ys=null;if(_){if(dn=Me.glyphAtlasTexture,hi=re.LINEAR,Xt=Me.glyphAtlasTexture.size,nt.iconsInText){$r=Me.imageAtlasTexture.size,ys=Me.imageAtlasTexture;const Mr=Ot.kind==="composite"||Ot.kind==="camera";_s=bt||m.options.rotating||m.options.zooming||Mr?re.LINEAR:re.NEAREST}}else{const Mr=h.layout.get("icon-size").constantOr(0)!==1||nt.iconsNeedLinear;dn=Me.imageAtlasTexture,hi=Rt||m.options.rotating||m.options.zooming||Mr||bt?re.LINEAR:re.NEAREST,Xt=Me.imageAtlasTexture.size}const ao=On(Me,1,m.transform.zoom),Cr=ds(Be.posMatrix,fe,ne,m.transform,ao),Ki=Ii(Be.posMatrix,fe,ne,m.transform,ao),Os=ke&&nt.hasTextData(),xc=h.layout.get("icon-text-fit")!=="none"&&Os&&nt.hasIconData();if(_e){const Mr=m.style.terrain?(yh,ya)=>m.style.terrain.getElevation(Be,yh,ya):null,Lo=h.layout.get("text-rotation-alignment")==="map";Bi(nt,Be.posMatrix,m,_,Cr,Ki,fe,k,Lo,Mr)}const ii=m.translatePosMatrix(Be.posMatrix,Me,x,E),jt=_e||_&&ke||xc?Vg:Cr,on=m.translatePosMatrix(Ki,Me,x,E,!0),di=Rt&&h.paint.get(_?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let fi;fi=Rt?nt.iconsInText?uf(Ot.kind,un,xe,fe,m,ii,jt,on,Xt,$r):sc(Ot.kind,un,xe,fe,m,ii,jt,on,_,Xt,!0):Hu(Ot.kind,un,xe,fe,m,ii,jt,on,_,Xt);const Pn={program:cn,buffers:Ze,uniformValues:fi,atlasTexture:dn,atlasTextureIcon:ys,atlasInterpolation:hi,atlasInterpolationIcon:_s,isSDF:Rt,hasHalo:di};if(se&&nt.canOverlap){Te=!0;const Mr=Ze.segments.get();for(const Lo of Mr)Re.push({segments:new l.SegmentVector([Lo]),sortKey:Lo.sortKey,state:Pn,terrainData:Zt})}else Re.push({segments:Ze.segments,sortKey:0,state:Pn,terrainData:Zt})}Te&&Re.sort((Be,Me)=>Be.sortKey-Me.sortKey);for(const Be of Re){const Me=Be.state;if(q.activeTexture.set(re.TEXTURE0),Me.atlasTexture.bind(Me.atlasInterpolation,re.CLAMP_TO_EDGE),Me.atlasTextureIcon&&(q.activeTexture.set(re.TEXTURE1),Me.atlasTextureIcon&&Me.atlasTextureIcon.bind(Me.atlasInterpolationIcon,re.CLAMP_TO_EDGE)),Me.isSDF){const nt=Me.uniformValues;Me.hasHalo&&(nt.u_is_halo=1,sl(Me.buffers,Be.segments,h,m,Me.program,we,O,B,nt,Be.terrainData)),nt.u_is_halo=0}sl(Me.buffers,Be.segments,h,m,Me.program,we,O,B,Me.uniformValues,Be.terrainData)}}function sl(m,o,h,p,_,x,E,I,M,k){const O=p.context;_.draw(O,O.gl.TRIANGLES,x,E,I,Sn.disabled,M,k,h.id,m.layoutVertexBuffer,m.indexBuffer,o,h.paint,p.transform.zoom,m.programConfigurations.get(h.id),m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer)}function ol(m,o,h,p,_,x,E){const I=m.context.gl,M=h.paint.get("fill-pattern"),k=M&&M.constantOr(1),O=h.getCrossfadeParameters();let B,q,re,te,ne;E?(q=k&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",B=I.LINES):(q=k?"fillPattern":"fill",B=I.TRIANGLES);for(const fe of p){const _e=o.getTile(fe);if(k&&!_e.patternsLoaded())continue;const xe=_e.getBucket(h);if(!xe)continue;const se=xe.programConfigurations.get(h.id),Te=m.useProgram(q,se),we=m.style.terrain&&m.style.terrain.getTerrainData(fe);k&&(m.context.activeTexture.set(I.TEXTURE0),_e.imageAtlasTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),se.updatePaintBuffers(O));const ke=M.constantOr(null);if(ke&&_e.imageAtlas){const Me=_e.imageAtlas,nt=Me.patternPositions[ke.to.toString()],Ze=Me.patternPositions[ke.from.toString()];nt&&Ze&&se.setConstantPatternPositions(nt,Ze)}const Re=we?fe:null,Be=m.translatePosMatrix(Re?Re.posMatrix:fe.posMatrix,_e,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor"));if(E){te=xe.indexBuffer2,ne=xe.segments2;const Me=[I.drawingBufferWidth,I.drawingBufferHeight];re=q==="fillOutlinePattern"&&k?tl(Be,m,O,_e,Me):la(Be,Me)}else te=xe.indexBuffer,ne=xe.segments,re=k?aa(Be,m,O,_e):oa(Be);Te.draw(m.context,B,_,m.stencilModeForClipping(fe),x,Sn.disabled,re,we,h.id,xe.layoutVertexBuffer,te,ne,h.paint,m.transform.zoom,se)}}function al(m,o,h,p,_,x,E){const I=m.context,M=I.gl,k=h.paint.get("fill-extrusion-pattern"),O=k.constantOr(1),B=h.getCrossfadeParameters(),q=h.paint.get("fill-extrusion-opacity");for(const re of p){const te=o.getTile(re),ne=te.getBucket(h);if(!ne)continue;const fe=m.style.terrain&&m.style.terrain.getTerrainData(re),_e=ne.programConfigurations.get(h.id),xe=m.useProgram(O?"fillExtrusionPattern":"fillExtrusion",_e);O&&(m.context.activeTexture.set(M.TEXTURE0),te.imageAtlasTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),_e.updatePaintBuffers(B));const se=k.constantOr(null);if(se&&te.imageAtlas){const Re=te.imageAtlas,Be=Re.patternPositions[se.to.toString()],Me=Re.patternPositions[se.from.toString()];Be&&Me&&_e.setConstantPatternPositions(Be,Me)}const Te=m.translatePosMatrix(re.posMatrix,te,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),we=h.paint.get("fill-extrusion-vertical-gradient"),ke=O?Wr(Te,m,we,q,re,B,te):eo(Te,m,we,q);xe.draw(I,I.gl.TRIANGLES,_,x,E,Sn.backCCW,ke,fe,h.id,ne.layoutVertexBuffer,ne.indexBuffer,ne.segments,h.paint,m.transform.zoom,_e,m.style.terrain&&ne.centroidVertexBuffer)}}function rh(m,o,h,p,_,x,E){const I=m.context,M=I.gl,k=h.fbo;if(!k)return;const O=m.useProgram("hillshade"),B=m.style.terrain&&m.style.terrain.getTerrainData(o);I.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,k.colorAttachment.get()),O.draw(I,M.TRIANGLES,_,x,E,Sn.disabled,((q,re,te,ne)=>{const fe=te.paint.get("hillshade-shadow-color"),_e=te.paint.get("hillshade-highlight-color"),xe=te.paint.get("hillshade-accent-color");let se=te.paint.get("hillshade-illumination-direction")*(Math.PI/180);te.paint.get("hillshade-illumination-anchor")==="viewport"&&(se-=q.transform.angle);const Te=!q.options.moving;return{u_matrix:ne?ne.posMatrix:q.transform.calculatePosMatrix(re.tileID.toUnwrapped(),Te),u_image:0,u_latrange:Pe(0,re.tileID),u_light:[te.paint.get("hillshade-exaggeration"),se],u_shadow:fe,u_highlight:_e,u_accent:xe}})(m,h,p,B?o:null),B,p.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments)}function xf(m,o,h,p,_,x){const E=m.context,I=E.gl,M=o.dem;if(M&&M.data){const k=M.dim,O=M.stride,B=M.getPixels();if(E.activeTexture.set(I.TEXTURE1),E.pixelStoreUnpackPremultiplyAlpha.set(!1),o.demTexture=o.demTexture||m.getTileTexture(O),o.demTexture){const re=o.demTexture;re.update(B,{premultiply:!1}),re.bind(I.NEAREST,I.CLAMP_TO_EDGE)}else o.demTexture=new H(E,B,I.RGBA,{premultiply:!1}),o.demTexture.bind(I.NEAREST,I.CLAMP_TO_EDGE);E.activeTexture.set(I.TEXTURE0);let q=o.fbo;if(!q){const re=new H(E,{width:k,height:k,data:null},I.RGBA);re.bind(I.LINEAR,I.CLAMP_TO_EDGE),q=o.fbo=E.createFramebuffer(k,k,!0),q.colorAttachment.set(re.texture)}E.bindFramebuffer.set(q.framebuffer),E.viewport.set([0,0,k,k]),m.useProgram("hillshadePrepare").draw(E,I.TRIANGLES,p,_,x,Sn.disabled,((re,te)=>{const ne=te.stride,fe=l.create();return l.ortho(fe,0,l.EXTENT,-l.EXTENT,0,0,1),l.translate(fe,fe,[0,-l.EXTENT,0]),{u_matrix:fe,u_image:1,u_dimension:[ne,ne],u_zoom:re.overscaledZ,u_unpack:te.getUnpackVector()}})(o.tileID,M),null,h.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments),o.needsHillshadePrepare=!1}}function fc(m,o,h,p,_,x){const E=p.paint.get("raster-fade-duration");if(!x&&E>0){const I=l.exported.now(),M=(I-m.timeAdded)/E,k=o?(I-o.timeAdded)/E:-1,O=h.getSource(),B=_.coveringZoomLevel({tileSize:O.tileSize,roundZoom:O.roundZoom}),q=!o||Math.abs(o.tileID.overscaledZ-B)>Math.abs(m.tileID.overscaledZ-B),re=q&&m.refreshedUponExpiration?1:l.clamp(q?M:1-k,0,1);return m.refreshedUponExpiration&&M>=1&&(m.refreshedUponExpiration=!1),o?{opacity:1,mix:1-re}:{opacity:re,mix:0}}return{opacity:1,mix:0}}const pc=new l.Color(1,0,0,1),Hr=new l.Color(0,1,0,1),bf=new l.Color(0,0,1,1),sh=new l.Color(1,0,1,1),wf=new l.Color(0,1,1,1);function Io(m,o,h,p){fa(m,0,o+h/2,m.transform.width,h,p)}function ll(m,o,h,p){fa(m,o-h/2,0,h,m.transform.height,p)}function fa(m,o,h,p,_,x){const E=m.context,I=E.gl;I.enable(I.SCISSOR_TEST),I.scissor(o*m.pixelRatio,h*m.pixelRatio,p*m.pixelRatio,_*m.pixelRatio),E.clear({color:x}),I.disable(I.SCISSOR_TEST)}function Wg(m,o,h){const p=m.context,_=p.gl,x=h.posMatrix,E=m.useProgram("debug"),I=qt.disabled,M=xn.disabled,k=m.colorModeForRenderPass(),O="$debug",B=m.style.terrain&&m.style.terrain.getTerrainData(h);p.activeTexture.set(_.TEXTURE0),m.emptyTexture.bind(_.LINEAR,_.CLAMP_TO_EDGE);const q=o.getTileByID(h.key).latestRawTileData,re=Math.floor((q&&q.byteLength||0)/1024),te=o.getTile(h).tileSize,ne=512/Math.min(te,512)*(h.overscaledZ/m.transform.zoom)*.5;let fe=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(fe+=` => ${h.overscaledZ}`),function(_e,xe){_e.initDebugOverlayCanvas();const se=_e.debugOverlayCanvas,Te=_e.context.gl,we=_e.debugOverlayCanvas.getContext("2d");we.clearRect(0,0,se.width,se.height),we.shadowColor="white",we.shadowBlur=2,we.lineWidth=1.5,we.strokeStyle="white",we.textBaseline="top",we.font="bold 36px Open Sans, sans-serif",we.fillText(xe,5,5),we.strokeText(xe,5,5),_e.debugOverlayTexture.update(se),_e.debugOverlayTexture.bind(Te.LINEAR,Te.CLAMP_TO_EDGE)}(m,`${fe} ${re}kB`),E.draw(p,_.TRIANGLES,I,M,wn.alphaBlended,Sn.disabled,Z(x,l.Color.transparent,ne),null,O,m.debugBuffer,m.quadTriangleIndexBuffer,m.debugSegments),E.draw(p,_.LINE_STRIP,I,M,k,Sn.disabled,Z(x,l.Color.red),B,O,m.debugBuffer,m.tileBorderIndexBuffer,m.debugSegments)}function mc(m,o,h){const p=m.context,_=p.gl,x=m.colorModeForRenderPass(),E=new qt(_.LEQUAL,qt.ReadWrite,m.depthRangeFor3D),I=m.useProgram("terrain"),M=o.getTerrainMesh(),k=o.getTerrainData(h.tileID);p.bindFramebuffer.set(null),p.viewport.set([0,0,m.width,m.height]),p.activeTexture.set(_.TEXTURE0),_.bindTexture(_.TEXTURE_2D,o.getRTTFramebuffer().colorAttachment.get());const O=m.transform.calculatePosMatrix(h.tileID.toUnwrapped());I.draw(p,_.TRIANGLES,E,xn.disabled,x,Sn.backCCW,{u_matrix:O,u_texture:0},k,"terrain",M.vertexBuffer,M.indexBuffer,M.segments)}function Ef(m,o,h,p){const _=m.context,x=h.tileSize*o.qualityFactor;h.textures[p]||(h.textures[p]=m.getTileTexture(x)||new H(_,{width:x,height:x,data:null},_.gl.RGBA),h.textures[p].bind(_.gl.LINEAR,_.gl.CLAMP_TO_EDGE),p===0&&o.sourceCache.renderHistory.unshift(h.tileID.key));const E=o.getRTTFramebuffer();E.colorAttachment.set(h.textures[p].texture),_.bindFramebuffer.set(E.framebuffer),_.viewport.set([0,0,x,x])}class Tf{constructor(o){this._coordsDescendingInv={},this._coordsDescendingInvStr={},this.painter=o,this._renderToTexture={background:!0,fill:!0,line:!0,raster:!0},this._coordsDescendingInv={},this._coordsDescendingInvStr={},this._stacks=[],this._prevType=null,this._rerender={},this._renderableTiles=o.style.terrain.sourceCache.getRenderableTiles(),this._init()}_init(){const o=this.painter.style,h=o.terrain;for(const p in o.sourceCaches){this._coordsDescendingInv[p]={};const _=o.sourceCaches[p].getVisibleCoordinates();for(const x of _){const E=h.sourceCache.getTerrainCoords(x);for(const I in E)this._coordsDescendingInv[p][I]||(this._coordsDescendingInv[p][I]=[]),this._coordsDescendingInv[p][I].push(E[I])}}for(const p of o._order){const _=o._layers[p],x=_.source;if(this._renderToTexture[_.type]&&!this._coordsDescendingInvStr[x]){this._coordsDescendingInvStr[x]={};for(const E in this._coordsDescendingInv[x])this._coordsDescendingInvStr[x][E]=this._coordsDescendingInv[x][E].map(I=>I.key).sort().join()}}return this._renderableTiles.forEach(p=>{for(const _ in this._coordsDescendingInvStr){const x=this._coordsDescendingInvStr[_][p.tileID.key];x&&x!==p.textureCoords[_]&&p.clearTextures(this.painter),h.needsRerender(_,p.tileID)&&p.clearTextures(this.painter)}this._rerender[p.tileID.key]=!p.textures.length}),h.clearRerenderCache(),h.sourceCache.removeOutdated(this.painter),this}renderLayer(o){const h=o.type,p=this.painter,_=p.style._order,x=p.currentLayer,E=x+1===_.length;if(this._renderToTexture[h]&&(this._prevType&&this._renderToTexture[this._prevType]||this._stacks.push([]),this._prevType=h,this._stacks[this._stacks.length-1].push(_[x]),!E))return!0;if(this._renderToTexture[this._prevType]||h==="hillshade"||this._renderToTexture[h]&&E){this._prevType=h;const I=this._stacks.length-1,M=this._stacks[I]||[];for(const k of this._renderableTiles){if(Ef(p,p.style.terrain,k,I),this._rerender[k.tileID.key]){p.context.clear({color:l.Color.transparent});for(let O=0;O<M.length;O++){const B=p.style._layers[M[O]],q=B.source?this._coordsDescendingInv[B.source][k.tileID.key]:[k.tileID];p._renderTileClippingMasks(B,q),p.renderLayer(p,p.style.sourceCaches[B.source],B,q),B.source&&(k.textureCoords[B.source]=this._coordsDescendingInvStr[B.source][k.tileID.key])}}mc(p,p.style.terrain,k)}if(h==="hillshade"){this._stacks.push([_[x]]);for(const k of this._renderableTiles){const O=this._coordsDescendingInv[o.source][k.tileID.key];Ef(p,p.style.terrain,k,this._stacks.length-1),p.context.clear({color:l.Color.transparent}),p._renderTileClippingMasks(o,O),p.renderLayer(p,p.style.sourceCaches[o.source],o,O),mc(p,p.style.terrain,k)}return!0}return this._renderToTexture[h]}return!1}}const cl={symbol:function(m,o,h,p,_){if(m.renderPass!=="translucent")return;const x=xn.disabled,E=m.colorModeForRenderPass();h.layout.get("text-variable-anchor")&&function(I,M,k,O,B,q,re){const te=M.transform,ne=B==="map",fe=q==="map";for(const _e of I){const xe=O.getTile(_e),se=xe.getBucket(k);if(!se||!se.text||!se.text.segments.get().length)continue;const Te=l.evaluateSizeForZoom(se.textSizeData,te.zoom),we=On(xe,1,M.transform.zoom),ke=ds(_e.posMatrix,fe,ne,M.transform,we),Re=k.layout.get("icon-text-fit")!=="none"&&se.hasIconData();if(Te){const Be=Math.pow(2,te.zoom-xe.tileID.overscaledZ);vf(se,ne,fe,re,te,ke,_e.posMatrix,Be,Te,Re,M.style.terrain?(Me,nt)=>M.style.terrain.getElevation(_e,Me,nt):null)}}}(p,m,h,o,h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),_),h.paint.get("icon-opacity").constantOr(1)!==0&&dc(m,o,h,p,!1,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),h.layout.get("icon-rotation-alignment"),h.layout.get("icon-pitch-alignment"),h.layout.get("icon-keep-upright"),x,E),h.paint.get("text-opacity").constantOr(1)!==0&&dc(m,o,h,p,!0,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),h.layout.get("text-keep-upright"),x,E),o.map.showCollisionBoxes&&(da(m,o,h,p,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),!0),da(m,o,h,p,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),!1))},circle:function(m,o,h,p){if(m.renderPass!=="translucent")return;const _=h.paint.get("circle-opacity"),x=h.paint.get("circle-stroke-width"),E=h.paint.get("circle-stroke-opacity"),I=!h.layout.get("circle-sort-key").isConstant();if(_.constantOr(1)===0&&(x.constantOr(1)===0||E.constantOr(1)===0))return;const M=m.context,k=M.gl,O=m.depthModeForSublayer(0,qt.ReadOnly),B=xn.disabled,q=m.colorModeForRenderPass(),re=[];for(let te=0;te<p.length;te++){const ne=p[te],fe=o.getTile(ne),_e=fe.getBucket(h);if(!_e)continue;const xe=_e.programConfigurations.get(h.id),se=m.useProgram("circle",xe),Te=_e.layoutVertexBuffer,we=_e.indexBuffer,ke=m.style.terrain&&m.style.terrain.getTerrainData(ne),Re={programConfiguration:xe,program:se,layoutVertexBuffer:Te,indexBuffer:we,uniformValues:rc(m,ne,fe,h),terrainData:ke};if(I){const Be=_e.segments.get();for(const Me of Be)re.push({segments:new l.SegmentVector([Me]),sortKey:Me.sortKey,state:Re})}else re.push({segments:_e.segments,sortKey:0,state:Re})}I&&re.sort((te,ne)=>te.sortKey-ne.sortKey);for(const te of re){const{programConfiguration:ne,program:fe,layoutVertexBuffer:_e,indexBuffer:xe,uniformValues:se,terrainData:Te}=te.state;fe.draw(M,k.TRIANGLES,O,B,q,Sn.disabled,se,Te,h.id,_e,xe,te.segments,h.paint,m.transform.zoom,ne)}},heatmap:function(m,o,h,p){if(h.paint.get("heatmap-opacity")!==0)if(m.renderPass==="offscreen"){const _=m.context,x=_.gl,E=xn.disabled,I=new wn([x.ONE,x.ONE],l.Color.transparent,[!0,!0,!0,!0]);(function(M,k,O){const B=M.gl;M.activeTexture.set(B.TEXTURE1),M.viewport.set([0,0,k.width/4,k.height/4]);let q=O.heatmapFbo;if(q)B.bindTexture(B.TEXTURE_2D,q.colorAttachment.get()),M.bindFramebuffer.set(q.framebuffer);else{const re=B.createTexture();B.bindTexture(B.TEXTURE_2D,re),B.texParameteri(B.TEXTURE_2D,B.TEXTURE_WRAP_S,B.CLAMP_TO_EDGE),B.texParameteri(B.TEXTURE_2D,B.TEXTURE_WRAP_T,B.CLAMP_TO_EDGE),B.texParameteri(B.TEXTURE_2D,B.TEXTURE_MIN_FILTER,B.LINEAR),B.texParameteri(B.TEXTURE_2D,B.TEXTURE_MAG_FILTER,B.LINEAR),q=O.heatmapFbo=M.createFramebuffer(k.width/4,k.height/4,!1),function(te,ne,fe,_e){const xe=te.gl;xe.texImage2D(xe.TEXTURE_2D,0,xe.RGBA,ne.width/4,ne.height/4,0,xe.RGBA,te.extRenderToTextureHalfFloat?te.extTextureHalfFloat.HALF_FLOAT_OES:xe.UNSIGNED_BYTE,null),_e.colorAttachment.set(fe)}(M,k,re,q)}})(_,m,h),_.clear({color:l.Color.transparent});for(let M=0;M<p.length;M++){const k=p[M];if(o.hasRenderableParent(k))continue;const O=o.getTile(k),B=O.getBucket(h);if(!B)continue;const q=B.programConfigurations.get(h.id),re=m.useProgram("heatmap",q),{zoom:te}=m.transform;re.draw(_,x.TRIANGLES,qt.disabled,E,I,Sn.disabled,he(k.posMatrix,O,te,h.paint.get("heatmap-intensity")),null,h.id,B.layoutVertexBuffer,B.indexBuffer,B.segments,h.paint,m.transform.zoom,q)}_.viewport.set([0,0,m.width,m.height])}else m.renderPass==="translucent"&&(m.context.setColorMode(m.colorModeForRenderPass()),function(_,x){const E=_.context,I=E.gl,M=x.heatmapFbo;if(!M)return;E.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,M.colorAttachment.get()),E.activeTexture.set(I.TEXTURE1);let k=x.colorRampTexture;k||(k=x.colorRampTexture=new H(E,x.colorRamp,I.RGBA)),k.bind(I.LINEAR,I.CLAMP_TO_EDGE),_.useProgram("heatmapTexture").draw(E,I.TRIANGLES,qt.disabled,xn.disabled,_.colorModeForRenderPass(),Sn.disabled,((O,B,q,re)=>{const te=l.create();l.ortho(te,0,O.width,O.height,0,0,1);const ne=O.context.gl;return{u_matrix:te,u_world:[ne.drawingBufferWidth,ne.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:B.paint.get("heatmap-opacity")}})(_,x),null,x.id,_.viewportBuffer,_.quadTriangleIndexBuffer,_.viewportSegments,x.paint,_.transform.zoom)}(m,h))},line:function(m,o,h,p){if(m.renderPass!=="translucent")return;const _=h.paint.get("line-opacity"),x=h.paint.get("line-width");if(_.constantOr(1)===0||x.constantOr(1)===0)return;const E=m.depthModeForSublayer(0,qt.ReadOnly),I=m.colorModeForRenderPass(),M=h.paint.get("line-dasharray"),k=h.paint.get("line-pattern"),O=k.constantOr(1),B=h.paint.get("line-gradient"),q=h.getCrossfadeParameters(),re=O?"linePattern":M?"lineSDF":B?"lineGradient":"line",te=m.context,ne=te.gl;let fe=!0;for(const _e of p){const xe=o.getTile(_e);if(O&&!xe.patternsLoaded())continue;const se=xe.getBucket(h);if(!se)continue;const Te=se.programConfigurations.get(h.id),we=m.context.program.get(),ke=m.useProgram(re,Te),Re=fe||ke.program!==we,Be=m.style.terrain&&m.style.terrain.getTerrainData(_e),Me=k.constantOr(null);if(Me&&xe.imageAtlas){const st=xe.imageAtlas,Rt=st.patternPositions[Me.to.toString()],Ot=st.patternPositions[Me.from.toString()];Rt&&Ot&&Te.setConstantPatternPositions(Rt,Ot)}const nt=Be?_e:null,Ze=O?Vt(m,xe,h,q,nt):M?Cn(m,xe,h,M,q,nt):B?ut(m,xe,h,se.lineClipsArray.length,nt):Ue(m,xe,h,nt);if(O)te.activeTexture.set(ne.TEXTURE0),xe.imageAtlasTexture.bind(ne.LINEAR,ne.CLAMP_TO_EDGE),Te.updatePaintBuffers(q);else if(M&&(Re||m.lineAtlas.dirty))te.activeTexture.set(ne.TEXTURE0),m.lineAtlas.bind(te);else if(B){const st=se.gradients[h.id];let Rt=st.texture;if(h.gradientVersion!==st.version){let Ot=256;if(h.stepInterpolant){const bt=o.getSource().maxzoom,cn=_e.canonical.z===bt?Math.ceil(1<<m.transform.maxZoom-_e.canonical.z):1;Ot=l.clamp(l.nextPowerOfTwo(se.maxLineLength/l.EXTENT*1024*cn),256,te.maxTextureSize)}st.gradient=l.renderColorRamp({expression:h.gradientExpression(),evaluationKey:"lineProgress",resolution:Ot,image:st.gradient||void 0,clips:se.lineClipsArray}),st.texture?st.texture.update(st.gradient):st.texture=new H(te,st.gradient,ne.RGBA),st.version=h.gradientVersion,Rt=st.texture}te.activeTexture.set(ne.TEXTURE0),Rt.bind(h.stepInterpolant?ne.NEAREST:ne.LINEAR,ne.CLAMP_TO_EDGE)}ke.draw(te,ne.TRIANGLES,E,m.stencilModeForClipping(_e),I,Sn.disabled,Ze,Be,h.id,se.layoutVertexBuffer,se.indexBuffer,se.segments,h.paint,m.transform.zoom,Te,se.layoutVertexBuffer2),fe=!1}},fill:function(m,o,h,p){const _=h.paint.get("fill-color"),x=h.paint.get("fill-opacity");if(x.constantOr(1)===0)return;const E=m.colorModeForRenderPass(),I=h.paint.get("fill-pattern"),M=m.opaquePassEnabledForLayer()&&!I.constantOr(1)&&_.constantOr(l.Color.transparent).a===1&&x.constantOr(0)===1?"opaque":"translucent";if(m.renderPass===M){const k=m.depthModeForSublayer(1,m.renderPass==="opaque"?qt.ReadWrite:qt.ReadOnly);ol(m,o,h,p,k,E,!1)}if(m.renderPass==="translucent"&&h.paint.get("fill-antialias")){const k=m.depthModeForSublayer(h.getPaintProperty("fill-outline-color")?2:0,qt.ReadOnly);ol(m,o,h,p,k,E,!0)}},"fill-extrusion":function(m,o,h,p){const _=h.paint.get("fill-extrusion-opacity");if(_!==0&&m.renderPass==="translucent"){const x=new qt(m.context.gl.LEQUAL,qt.ReadWrite,m.depthRangeFor3D);if(_!==1||h.paint.get("fill-extrusion-pattern").constantOr(1))al(m,o,h,p,x,xn.disabled,wn.disabled),al(m,o,h,p,x,m.stencilModeFor3D(),m.colorModeForRenderPass());else{const E=m.colorModeForRenderPass();al(m,o,h,p,x,xn.disabled,E)}}},hillshade:function(m,o,h,p){if(m.renderPass!=="offscreen"&&m.renderPass!=="translucent")return;const _=m.context,x=m.depthModeForSublayer(0,qt.ReadOnly),E=m.colorModeForRenderPass(),[I,M]=m.renderPass==="translucent"?m.stencilConfigForOverlap(p):[{},p];for(const k of M){const O=o.getTile(k);O.needsHillshadePrepare!==void 0&&O.needsHillshadePrepare&&m.renderPass==="offscreen"?xf(m,O,h,x,xn.disabled,E):m.renderPass==="translucent"&&rh(m,k,O,h,x,I[k.overscaledZ],E)}_.viewport.set([0,0,m.width,m.height])},raster:function(m,o,h,p){if(m.renderPass!=="translucent"||h.paint.get("raster-opacity")===0||!p.length)return;const _=m.context,x=_.gl,E=o.getSource(),I=m.useProgram("raster"),M=m.colorModeForRenderPass(),[k,O]=E instanceof At?[{},p]:m.stencilConfigForOverlap(p),B=O[O.length-1].overscaledZ,q=!m.options.moving;for(const re of O){const te=m.depthModeForSublayer(re.overscaledZ-B,h.paint.get("raster-opacity")===1?qt.ReadWrite:qt.ReadOnly,x.LESS),ne=o.getTile(re);ne.registerFadeDuration(h.paint.get("raster-fade-duration"));const fe=o.findLoadedParent(re,0),_e=fc(ne,fe,o,h,m.transform,m.style.terrain);let xe,se;const Te=h.paint.get("raster-resampling")==="nearest"?x.NEAREST:x.LINEAR;_.activeTexture.set(x.TEXTURE0),ne.texture.bind(Te,x.CLAMP_TO_EDGE,x.LINEAR_MIPMAP_NEAREST),_.activeTexture.set(x.TEXTURE1),fe?(fe.texture.bind(Te,x.CLAMP_TO_EDGE,x.LINEAR_MIPMAP_NEAREST),xe=Math.pow(2,fe.tileID.overscaledZ-ne.tileID.overscaledZ),se=[ne.tileID.canonical.x*xe%1,ne.tileID.canonical.y*xe%1]):ne.texture.bind(Te,x.CLAMP_TO_EDGE,x.LINEAR_MIPMAP_NEAREST);const we=m.style.terrain&&m.style.terrain.getTerrainData(re),ke=we?re:null,Re=ke?ke.posMatrix:m.transform.calculatePosMatrix(re.toUnwrapped(),q),Be=hr(Re,se||[0,0],xe||1,_e,h);E instanceof At?I.draw(_,x.TRIANGLES,te,xn.disabled,M,Sn.disabled,Be,we,h.id,E.boundsBuffer,m.quadTriangleIndexBuffer,E.boundsSegments):I.draw(_,x.TRIANGLES,te,k[re.overscaledZ],M,Sn.disabled,Be,we,h.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments)}},background:function(m,o,h,p){const _=h.paint.get("background-color"),x=h.paint.get("background-opacity");if(x===0)return;const E=m.context,I=E.gl,M=m.transform,k=M.tileSize,O=h.paint.get("background-pattern");if(m.isPatternMissing(O))return;const B=!O&&_.a===1&&x===1&&m.opaquePassEnabledForLayer()?"opaque":"translucent";if(m.renderPass!==B)return;const q=xn.disabled,re=m.depthModeForSublayer(0,B==="opaque"?qt.ReadWrite:qt.ReadOnly),te=m.colorModeForRenderPass(),ne=m.useProgram(O?"backgroundPattern":"background"),fe=p||M.coveringTiles({tileSize:k,terrain:m.style.terrain});O&&(E.activeTexture.set(I.TEXTURE0),m.imageManager.bind(m.context));const _e=h.getCrossfadeParameters();for(const xe of fe){const se=p?xe.posMatrix:m.transform.calculatePosMatrix(xe.toUnwrapped()),Te=O?Rg(se,x,m,O,{tileID:xe,tileSize:k},_e):kg(se,x,_),we=m.style.terrain&&m.style.terrain.getTerrainData(xe);ne.draw(E,I.TRIANGLES,re,q,te,Sn.disabled,Te,we,h.id,m.tileExtentBuffer,m.quadTriangleIndexBuffer,m.tileExtentSegments)}},debug:function(m,o,h){for(let p=0;p<h.length;p++)Wg(m,o,h[p])},custom:function(m,o,h){const p=m.context,_=h.implementation;if(m.renderPass==="offscreen"){const x=_.prerender;x&&(m.setCustomLayerDefaults(),p.setColorMode(m.colorModeForRenderPass()),x.call(_,p.gl,m.transform.customLayerMatrix()),p.setDirty(),m.setBaseState())}else if(m.renderPass==="translucent"){m.setCustomLayerDefaults(),p.setColorMode(m.colorModeForRenderPass()),p.setStencilMode(xn.disabled);const x=_.renderingMode==="3d"?new qt(m.context.gl.LEQUAL,qt.ReadWrite,m.depthRangeFor3D):m.depthModeForSublayer(0,qt.ReadOnly);p.setDepthMode(x),_.render(p.gl,m.transform.customLayerMatrix()),p.setDirty(),m.setBaseState(),p.bindFramebuffer.set(null)}}};class oh{constructor(o,h){this.context=new yf(o),this.transform=h,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:l.create(),renderTime:0},this.setup(),this.numSublayers=Kt.maxUnderzooming+Kt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new gt,this.gpuTimers={}}resize(o,h,p){if(this.width=o*p,this.height=h*p,this.pixelRatio=p,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const _ of this.style._order)this.style._layers[_].resize()}setup(){const o=this.context,h=new l.PosArray;h.emplaceBack(0,0),h.emplaceBack(l.EXTENT,0),h.emplaceBack(0,l.EXTENT),h.emplaceBack(l.EXTENT,l.EXTENT),this.tileExtentBuffer=o.createVertexBuffer(h,Dt.members),this.tileExtentSegments=l.SegmentVector.simpleSegment(0,0,4,2);const p=new l.PosArray;p.emplaceBack(0,0),p.emplaceBack(l.EXTENT,0),p.emplaceBack(0,l.EXTENT),p.emplaceBack(l.EXTENT,l.EXTENT),this.debugBuffer=o.createVertexBuffer(p,Dt.members),this.debugSegments=l.SegmentVector.simpleSegment(0,0,4,5);const _=new l.RasterBoundsArray;_.emplaceBack(0,0,0,0),_.emplaceBack(l.EXTENT,0,l.EXTENT,0),_.emplaceBack(0,l.EXTENT,0,l.EXTENT),_.emplaceBack(l.EXTENT,l.EXTENT,l.EXTENT,l.EXTENT),this.rasterBoundsBuffer=o.createVertexBuffer(_,rt.members),this.rasterBoundsSegments=l.SegmentVector.simpleSegment(0,0,4,2);const x=new l.PosArray;x.emplaceBack(0,0),x.emplaceBack(1,0),x.emplaceBack(0,1),x.emplaceBack(1,1),this.viewportBuffer=o.createVertexBuffer(x,Dt.members),this.viewportSegments=l.SegmentVector.simpleSegment(0,0,4,2);const E=new l.LineStripIndexArray;E.emplaceBack(0),E.emplaceBack(1),E.emplaceBack(3),E.emplaceBack(2),E.emplaceBack(0),this.tileBorderIndexBuffer=o.createIndexBuffer(E);const I=new l.TriangleIndexArray;I.emplaceBack(0,1,2),I.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=o.createIndexBuffer(I),this.emptyTexture=new H(o,{width:1,height:1,data:new Uint8Array([0,0,0,0])},o.gl.RGBA);const M=this.context.gl;this.stencilClearMode=new xn({func:M.ALWAYS,mask:0},0,255,M.ZERO,M.ZERO,M.ZERO)}clearStencil(){const o=this.context,h=o.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const p=l.create();l.ortho(p,0,this.width,this.height,0,0,1),l.scale(p,p,[h.drawingBufferWidth,h.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(o,h.TRIANGLES,qt.disabled,this.stencilClearMode,wn.disabled,Sn.disabled,Q(p),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(o,h){if(this.currentStencilSource===o.source||!o.isTileClipped()||!h||!h.length)return;this.currentStencilSource=o.source;const p=this.context,_=p.gl;this.nextStencilID+h.length>256&&this.clearStencil(),p.setColorMode(wn.disabled),p.setDepthMode(qt.disabled);const x=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const E of h){const I=this._tileClippingMaskIDs[E.key]=this.nextStencilID++,M=this.style.terrain&&this.style.terrain.getTerrainData(E);x.draw(p,_.TRIANGLES,qt.disabled,new xn({func:_.ALWAYS,mask:0},I,255,_.KEEP,_.KEEP,_.REPLACE),wn.disabled,Sn.disabled,Q(E.posMatrix),M,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const o=this.nextStencilID++,h=this.context.gl;return new xn({func:h.NOTEQUAL,mask:255},o,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(o){const h=this.context.gl;return new xn({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[o.key],0,h.KEEP,h.KEEP,h.REPLACE)}stencilConfigForOverlap(o){const h=this.context.gl,p=o.sort((E,I)=>I.overscaledZ-E.overscaledZ),_=p[p.length-1].overscaledZ,x=p[0].overscaledZ-_+1;if(x>1){this.currentStencilSource=void 0,this.nextStencilID+x>256&&this.clearStencil();const E={};for(let I=0;I<x;I++)E[I+_]=new xn({func:h.GEQUAL,mask:255},I+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=x,[E,p]}return[{[_]:xn.disabled},p]}colorModeForRenderPass(){const o=this.context.gl;return this._showOverdrawInspector?new wn([o.CONSTANT_COLOR,o.ONE],new l.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?wn.unblended:wn.alphaBlended}depthModeForSublayer(o,h,p){if(!this.opaquePassEnabledForLayer())return qt.disabled;const _=1-((1+this.currentLayer)*this.numSublayers+o)*this.depthEpsilon;return new qt(p||this.context.gl.LEQUAL,h,[_,_])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(o,h){this.style=o,this.options=h,this.lineAtlas=o.lineAtlas,this.imageManager=o.imageManager,this.glyphManager=o.glyphManager,this.symbolFadeChange=o.placement.symbolFadeChange(l.exported.now()),this.imageManager.beginFrame();const p=this.style._order,_=this.style.sourceCaches,x=this.style.terrain&&new Tf(this);for(const k in _){const O=_[k];O.used&&O.prepare(this.context)}const E={},I={},M={};for(const k in _){const O=_[k];E[k]=O.getVisibleCoordinates(),I[k]=E[k].slice().reverse(),M[k]=O.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let k=0;k<p.length;k++)if(this.style._layers[p[k]].is3D()){this.opaquePassCutoff=k;break}if(x){this.opaquePassCutoff=0;const k=this.style.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!l.equals(this.terrainFacilitator.matrix,this.transform.projMatrix)||k.length)&&(l.copy(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(O,B){const q=O.context,re=q.gl,te=wn.unblended,ne=new qt(re.LEQUAL,qt.ReadWrite,[0,1]),fe=B.getTerrainMesh(),_e=B.sourceCache.getRenderableTiles(),xe=O.useProgram("terrainDepth");q.bindFramebuffer.set(B.getFramebuffer("depth").framebuffer),q.viewport.set([0,0,O.width/devicePixelRatio,O.height/devicePixelRatio]),q.clear({color:l.Color.transparent,depth:1});for(const se of _e){const Te=B.getTerrainData(se.tileID),we=O.transform.calculatePosMatrix(se.tileID.toUnwrapped());xe.draw(q,re.TRIANGLES,ne,xn.disabled,te,Sn.backCCW,{u_matrix:we},Te,"terrain",fe.vertexBuffer,fe.indexBuffer,fe.segments)}q.bindFramebuffer.set(null),q.viewport.set([0,0,O.width,O.height])}(this,this.style.terrain),function(O,B){const q=O.context,re=q.gl,te=wn.unblended,ne=new qt(re.LEQUAL,qt.ReadWrite,[0,1]),fe=B.getTerrainMesh(),_e=B.getCoordsTexture(),xe=B.sourceCache.getRenderableTiles(),se=O.useProgram("terrainCoords");q.bindFramebuffer.set(B.getFramebuffer("coords").framebuffer),q.viewport.set([0,0,O.width/devicePixelRatio,O.height/devicePixelRatio]),q.clear({color:l.Color.transparent,depth:1}),B.coordsIndex=[];for(const Te of xe){const we=B.getTerrainData(Te.tileID);q.activeTexture.set(re.TEXTURE0),re.bindTexture(re.TEXTURE_2D,_e.texture);const ke=O.transform.calculatePosMatrix(Te.tileID.toUnwrapped());se.draw(q,re.TRIANGLES,ne,xn.disabled,te,Sn.backCCW,{u_matrix:ke,u_terrain_coords_id:(255-B.coordsIndex.length)/255,u_texture:0},we,"terrain",fe.vertexBuffer,fe.indexBuffer,fe.segments),B.coordsIndex.push(Te.tileID.key)}q.bindFramebuffer.set(null),q.viewport.set([0,0,O.width,O.height])}(this,this.style.terrain))}this.renderPass="offscreen";for(const k of p){const O=this.style._layers[k];if(!O.hasOffscreenPass()||O.isHidden(this.transform.zoom))continue;const B=I[O.source];(O.type==="custom"||B.length)&&this.renderLayer(this,_[O.source],O,B)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:h.showOverdrawInspector?l.Color.black:l.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=h.showOverdrawInspector,this.depthRangeFor3D=[0,1-(o._order.length+2)*this.numSublayers*this.depthEpsilon],!x)for(this.renderPass="opaque",this.currentLayer=p.length-1;this.currentLayer>=0;this.currentLayer--){const k=this.style._layers[p[this.currentLayer]],O=_[k.source],B=E[k.source];this._renderTileClippingMasks(k,B),this.renderLayer(this,O,k,B)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<p.length;this.currentLayer++){const k=this.style._layers[p[this.currentLayer]],O=_[k.source];if(x&&x.renderLayer(k))continue;const B=(k.type==="symbol"?M:I)[k.source];this._renderTileClippingMasks(k,E[k.source]),this.renderLayer(this,O,k,B)}if(this.options.showTileBoundaries){let k,O;Object.values(this.style._layers).forEach(B=>{B.source&&!B.isHidden(this.transform.zoom)&&(B.source!==(O&&O.id)&&(O=this.style.sourceCaches[B.source]),(!k||k.getSource().maxzoom<O.getSource().maxzoom)&&(k=O))}),k&&cl.debug(this,k,k.getVisibleCoordinates())}this.options.showPadding&&function(k){const O=k.transform.padding;Io(k,k.transform.height-(O.top||0),3,pc),Io(k,O.bottom||0,3,Hr),ll(k,O.left||0,3,bf),ll(k,k.transform.width-(O.right||0),3,sh);const B=k.transform.centerPoint;(function(q,re,te,ne){fa(q,re-1,te-10,2,20,ne),fa(q,re-10,te-1,20,2,ne)})(k,B.x,k.transform.height-B.y,wf)}(this),this.context.setDefault()}renderLayer(o,h,p,_){p.isHidden(this.transform.zoom)||(p.type==="background"||p.type==="custom"||(_||[]).length)&&(this.id=p.id,this.gpuTimingStart(p),cl[p.type](o,h,p,_,this.style.placement.variableOffsets),this.gpuTimingEnd())}gpuTimingStart(o){if(!this.options.gpuTiming)return;const h=this.context.extTimerQuery;let p=this.gpuTimers[o.id];p||(p=this.gpuTimers[o.id]={calls:0,cpuTime:0,query:h.createQueryEXT()}),p.calls++,h.beginQueryEXT(h.TIME_ELAPSED_EXT,p.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const o=this.context.extTimerQuery;o.endQueryEXT(o.TIME_ELAPSED_EXT)}collectGpuTimers(){const o=this.gpuTimers;return this.gpuTimers={},o}queryGpuTimers(o){const h={};for(const p in o){const _=o[p],x=this.context.extTimerQuery,E=x.getQueryObjectEXT(_.query,x.QUERY_RESULT_EXT)/1e6;x.deleteQueryEXT(_.query),h[p]=E}return h}translatePosMatrix(o,h,p,_,x){if(!p[0]&&!p[1])return o;const E=x?_==="map"?this.transform.angle:0:_==="viewport"?-this.transform.angle:0;if(E){const k=Math.sin(E),O=Math.cos(E);p=[p[0]*O-p[1]*k,p[0]*k+p[1]*O]}const I=[x?p[0]:On(h,p[0],this.transform.zoom),x?p[1]:On(h,p[1],this.transform.zoom),0],M=new Float32Array(16);return l.translate(M,o,I),M}saveTileTexture(o){const h=this._tileTextures[o.size[0]];h?h.push(o):this._tileTextures[o.size[0]]=[o]}getTileTexture(o){const h=this._tileTextures[o];return h&&h.length>0?h.pop():null}isPatternMissing(o){if(!o)return!1;if(!o.from||!o.to)return!0;const h=this.imageManager.getPattern(o.from.toString()),p=this.imageManager.getPattern(o.to.toString());return!h||!p}useProgram(o,h){this.cache=this.cache||{};const p=o+(h?h.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.terrain?"/terrain":"");return this.cache[p]||(this.cache[p]=new ra(this.context,o,vi[o],h,$u[o],this._showOverdrawInspector,this.style.terrain)),this.cache[p]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const o=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(o.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new H(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}}class gc{constructor(o,h){this.points=o,this.planes=h}static fromInvProjectionMatrix(o,h,p){const _=Math.pow(2,p),x=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(I=>{const M=1/(I=l.transformMat4([],I,o))[3]/h*_;return l.mul$1(I,I,[M,M,1/I[3],M])}),E=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(I=>{const M=l.sub([],x[I[0]],x[I[1]]),k=l.sub([],x[I[2]],x[I[1]]),O=l.normalize([],l.cross([],M,k)),B=-l.dot(O,x[I[1]]);return O.concat(B)});return new gc(x,E)}}class ul{constructor(o,h){this.min=o,this.max=h,this.center=l.scale$1([],l.add([],this.min,this.max),.5)}quadrant(o){const h=[o%2==0,o<2],p=l.clone$2(this.min),_=l.clone$2(this.max);for(let x=0;x<h.length;x++)p[x]=h[x]?this.min[x]:this.center[x],_[x]=h[x]?this.center[x]:this.max[x];return _[2]=this.max[2],new ul(p,_)}distanceX(o){return Math.max(Math.min(this.max[0],o[0]),this.min[0])-o[0]}distanceY(o){return Math.max(Math.min(this.max[1],o[1]),this.min[1])-o[1]}intersects(o){const h=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let p=!0;for(let _=0;_<o.planes.length;_++){const x=o.planes[_];let E=0;for(let I=0;I<h.length;I++)l.dot$1(x,h[I])>=0&&E++;if(E===0)return 0;E!==h.length&&(p=!1)}if(p)return 2;for(let _=0;_<3;_++){let x=Number.MAX_VALUE,E=-Number.MAX_VALUE;for(let I=0;I<o.points.length;I++){const M=o.points[I][_]-this.min[_];x=Math.min(x,M),E=Math.max(E,M)}if(E<0||x>this.max[_]-this.min[_])return 0}return 1}}class pa{constructor(o=0,h=0,p=0,_=0){if(isNaN(o)||o<0||isNaN(h)||h<0||isNaN(p)||p<0||isNaN(_)||_<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=o,this.bottom=h,this.left=p,this.right=_}interpolate(o,h,p){return h.top!=null&&o.top!=null&&(this.top=l.number(o.top,h.top,p)),h.bottom!=null&&o.bottom!=null&&(this.bottom=l.number(o.bottom,h.bottom,p)),h.left!=null&&o.left!=null&&(this.left=l.number(o.left,h.left,p)),h.right!=null&&o.right!=null&&(this.right=l.number(o.right,h.right,p)),this}getCenter(o,h){const p=l.clamp((this.left+o-this.right)/2,0,o),_=l.clamp((this.top+h-this.bottom)/2,0,h);return new l.pointGeometry(p,_)}equals(o){return this.top===o.top&&this.bottom===o.bottom&&this.left===o.left&&this.right===o.right}clone(){return new pa(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class hl{constructor(o,h,p,_,x){this.tileSize=512,this.maxValidLatitude=85.051129,this.freezeElevation=!1,this._renderWorldCopies=x===void 0||!!x,this._minZoom=o||0,this._maxZoom=h||22,this._minPitch=p??0,this._maxPitch=_??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new l.LngLat(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new pa,this._posMatrixCache={},this._alignedPosMatrixCache={}}clone(){const o=new hl(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return o.tileSize=this.tileSize,o.latRange=this.latRange,o.width=this.width,o.height=this.height,o._center=this._center,o._elevation=this._elevation,o.zoom=this.zoom,o.angle=this.angle,o._fov=this._fov,o._pitch=this._pitch,o._unmodified=this._unmodified,o._edgeInsets=this._edgeInsets.clone(),o._calcMatrices(),o}get minZoom(){return this._minZoom}set minZoom(o){this._minZoom!==o&&(this._minZoom=o,this.zoom=Math.max(this.zoom,o))}get maxZoom(){return this._maxZoom}set maxZoom(o){this._maxZoom!==o&&(this._maxZoom=o,this.zoom=Math.min(this.zoom,o))}get minPitch(){return this._minPitch}set minPitch(o){this._minPitch!==o&&(this._minPitch=o,this.pitch=Math.max(this.pitch,o))}get maxPitch(){return this._maxPitch}set maxPitch(o){this._maxPitch!==o&&(this._maxPitch=o,this.pitch=Math.min(this.pitch,o))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(o){o===void 0?o=!0:o===null&&(o=!1),this._renderWorldCopies=o}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new l.pointGeometry(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(o){const h=-l.wrap(o,-180,180)*Math.PI/180;var p;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=(p=new l.ARRAY_TYPE(4),l.ARRAY_TYPE!=Float32Array&&(p[1]=0,p[2]=0),p[0]=1,p[3]=1,p),function(_,x,E){var I=x[0],M=x[1],k=x[2],O=x[3],B=Math.sin(E),q=Math.cos(E);_[0]=I*q+k*B,_[1]=M*q+O*B,_[2]=I*-B+k*q,_[3]=M*-B+O*q}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(o){const h=l.clamp(o,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(o){o=Math.max(.01,Math.min(60,o)),this._fov!==o&&(this._unmodified=!1,this._fov=o/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(o){const h=Math.min(Math.max(o,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._zoom=h,this.scale=this.zoomScale(h),this.tileZoom=Math.floor(h),this.zoomFraction=h-this.tileZoom,this._constrain(),this._calcMatrices())}get center(){return this._center}set center(o){o.lat===this._center.lat&&o.lng===this._center.lng||(this._unmodified=!1,this._center=o,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(o){o!==this._elevation&&(this._elevation=o,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(o){this._edgeInsets.equals(o)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,o,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(o){return this._edgeInsets.equals(o)}interpolatePadding(o,h,p){this._unmodified=!1,this._edgeInsets.interpolate(o,h,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(o){const h=(o.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/o.tileSize));return Math.max(0,h)}getVisibleUnwrappedCoordinates(o){const h=[new l.UnwrappedTileID(0,o)];if(this._renderWorldCopies){const p=this.pointCoordinate(new l.pointGeometry(0,0)),_=this.pointCoordinate(new l.pointGeometry(this.width,0)),x=this.pointCoordinate(new l.pointGeometry(this.width,this.height)),E=this.pointCoordinate(new l.pointGeometry(0,this.height)),I=Math.floor(Math.min(p.x,_.x,x.x,E.x)),M=Math.floor(Math.max(p.x,_.x,x.x,E.x)),k=1;for(let O=I-k;O<=M+k;O++)O!==0&&h.push(new l.UnwrappedTileID(O,o))}return h}coveringTiles(o){var h,p;let _=this.coveringZoomLevel(o);const x=_;if(o.minzoom!==void 0&&_<o.minzoom)return[];o.maxzoom!==void 0&&_>o.maxzoom&&(_=o.maxzoom);const E=this.pointCoordinate(this.getCameraPoint()),I=l.MercatorCoordinate.fromLngLat(this.center),M=Math.pow(2,_),k=[M*E.x,M*E.y,0],O=[M*I.x,M*I.y,0],B=gc.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,_);let q=o.minzoom||0;!o.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(q=_);const re=o.terrain?2/Math.min(this.tileSize,o.tileSize)*this.tileSize:3,te=se=>({aabb:new ul([se*M,0,0],[(se+1)*M,M,0]),zoom:0,x:0,y:0,wrap:se,fullyVisible:!1}),ne=[],fe=[],_e=_,xe=o.reparseOverscaled?x:_;if(this._renderWorldCopies)for(let se=1;se<=3;se++)ne.push(te(-se)),ne.push(te(se));for(ne.push(te(0));ne.length>0;){const se=ne.pop(),Te=se.x,we=se.y;let ke=se.fullyVisible;if(!ke){const st=se.aabb.intersects(B);if(st===0)continue;ke=st===2}const Re=o.terrain?k:O,Be=se.aabb.distanceX(Re),Me=se.aabb.distanceY(Re),nt=Math.max(Math.abs(Be),Math.abs(Me)),Ze=re+(1<<_e-se.zoom)-2;if(se.zoom===_e||nt>Ze&&se.zoom>=q){const st=_e-se.zoom,Rt=k[0]-.5-(Te<<st),Ot=k[1]-.5-(we<<st);fe.push({tileID:new l.OverscaledTileID(se.zoom===_e?xe:se.zoom,se.wrap,se.zoom,Te,we),distanceSq:l.sqrLen([O[0]-.5-Te,O[1]-.5-we]),tileDistanceToCamera:Math.sqrt(Rt*Rt+Ot*Ot)})}else for(let st=0;st<4;st++){const Rt=(Te<<1)+st%2,Ot=(we<<1)+(st>>1),bt=se.zoom+1;let cn=se.aabb.quadrant(st);if(o.terrain){const un=new l.OverscaledTileID(bt,se.wrap,bt,Rt,Ot),Zt=o.terrain.getMinMaxElevation(un),Xt=(h=Zt.minElevation)!==null&&h!==void 0?h:this.elevation,dn=(p=Zt.maxElevation)!==null&&p!==void 0?p:this.elevation;cn=new ul([cn.min[0],cn.min[1],Xt],[cn.max[0],cn.max[1],dn])}ne.push({aabb:cn,zoom:bt,x:Rt,y:Ot,wrap:se.wrap,fullyVisible:ke})}}return fe.sort((se,Te)=>se.distanceSq-Te.distanceSq).map(se=>se.tileID)}resize(o,h){this.width=o,this.height=h,this.pixelsToGLUnits=[2/o,-2/h],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(o){return Math.pow(2,o)}scaleZoom(o){return Math.log(o)/Math.LN2}project(o){const h=l.clamp(o.lat,-this.maxValidLatitude,this.maxValidLatitude);return new l.pointGeometry(l.mercatorXfromLng(o.lng)*this.worldSize,l.mercatorYfromLat(h)*this.worldSize)}unproject(o){return new l.MercatorCoordinate(o.x/this.worldSize,o.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}updateElevation(o){this.freezeElevation||(this.elevation=o?this.getElevation(this._center,o):0)}getElevation(o,h){const p=l.MercatorCoordinate.fromLngLat(o),_=(1<<this.tileZoom)*l.EXTENT,x=p.x*_,E=p.y*_,I=Math.floor(x/l.EXTENT),M=Math.floor(E/l.EXTENT),k=new l.OverscaledTileID(this.tileZoom,0,this.tileZoom,I,M);return h.getElevation(k,x%l.EXTENT,E%l.EXTENT,l.EXTENT)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(o){const h=this.pointLocation(this.centerPoint,o),p=this.getElevation(h,o);if(!(this.elevation-p))return;const _=this.getCameraPosition(),x=l.MercatorCoordinate.fromLngLat(_.lngLat,_.altitude),E=l.MercatorCoordinate.fromLngLat(h,p),I=x.x-E.x,M=x.y-E.y,k=x.z-E.z,O=Math.sqrt(I*I+M*M+k*k),B=this.scaleZoom(this.cameraToCenterDistance/O/this.tileSize);this._elevation=p,this._center=h,this.zoom=B}setLocationAtPoint(o,h){const p=this.pointCoordinate(h),_=this.pointCoordinate(this.centerPoint),x=this.locationCoordinate(o),E=new l.MercatorCoordinate(x.x-(p.x-_.x),x.y-(p.y-_.y));this.center=this.coordinateLocation(E),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(o,h){return h?this.coordinatePoint(this.locationCoordinate(o),this.getElevation(o,h),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(o))}pointLocation(o,h){return this.coordinateLocation(this.pointCoordinate(o,h))}locationCoordinate(o){return l.MercatorCoordinate.fromLngLat(o)}coordinateLocation(o){return o&&o.toLngLat()}pointCoordinate(o,h){if(h){const q=h.pointCoordinate(o);if(q!=null)return q}const p=[o.x,o.y,0,1],_=[o.x,o.y,1,1];l.transformMat4(p,p,this.pixelMatrixInverse),l.transformMat4(_,_,this.pixelMatrixInverse);const x=p[3],E=_[3],I=p[1]/x,M=_[1]/E,k=p[2]/x,O=_[2]/E,B=k===O?0:(0-k)/(O-k);return new l.MercatorCoordinate(l.number(p[0]/x,_[0]/E,B)/this.worldSize,l.number(I,M,B)/this.worldSize)}coordinatePoint(o,h=0,p=this.pixelMatrix){const _=[o.x*this.worldSize,o.y*this.worldSize,h,1];return l.transformMat4(_,_,p),new l.pointGeometry(_[0]/_[3],_[1]/_[3])}getBounds(){const o=Math.max(0,this.height/2-this.getHorizon());return new l.LngLatBounds().extend(this.pointLocation(new l.pointGeometry(0,o))).extend(this.pointLocation(new l.pointGeometry(this.width,o))).extend(this.pointLocation(new l.pointGeometry(this.width,this.height))).extend(this.pointLocation(new l.pointGeometry(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new l.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(o){o?(this.lngRange=[o.getWest(),o.getEast()],this.latRange=[o.getSouth(),o.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(o,h=!1){const p=o.key,_=h?this._alignedPosMatrixCache:this._posMatrixCache;if(_[p])return _[p];const x=o.canonical,E=this.worldSize/this.zoomScale(x.z),I=x.x+Math.pow(2,x.z)*o.wrap,M=l.identity(new Float64Array(16));return l.translate(M,M,[I*E,x.y*E,0]),l.scale(M,M,[E/l.EXTENT,E/l.EXTENT,1]),l.multiply(M,h?this.alignedProjMatrix:this.projMatrix,M),_[p]=new Float32Array(M),_[p]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let o,h,p,_,x=-90,E=90,I=-180,M=180;const k=this.size,O=this._unmodified;if(this.latRange){const re=this.latRange;x=l.mercatorYfromLat(re[1])*this.worldSize,E=l.mercatorYfromLat(re[0])*this.worldSize,o=E-x<k.y?k.y/(E-x):0}if(this.lngRange){const re=this.lngRange;I=l.wrap(l.mercatorXfromLng(re[0])*this.worldSize,0,this.worldSize),M=l.wrap(l.mercatorXfromLng(re[1])*this.worldSize,0,this.worldSize),M<I&&(M+=this.worldSize),h=M-I<k.x?k.x/(M-I):0}const B=this.point,q=Math.max(h||0,o||0);if(q)return this.center=this.unproject(new l.pointGeometry(h?(M+I)/2:B.x,o?(E+x)/2:B.y)),this.zoom+=this.scaleZoom(q),this._unmodified=O,void(this._constraining=!1);if(this.latRange){const re=B.y,te=k.y/2;re-te<x&&(_=x+te),re+te>E&&(_=E-te)}if(this.lngRange){const re=(I+M)/2,te=l.wrap(B.x,re-this.worldSize/2,re+this.worldSize/2),ne=k.x/2;te-ne<I&&(p=I+ne),te+ne>M&&(p=M-ne)}p===void 0&&_===void 0||(this.center=this.unproject(new l.pointGeometry(p!==void 0?p:B.x,_!==void 0?_:B.y)).wrap()),this._unmodified=O,this._constraining=!1}_calcMatrices(){if(!this.height)return;const o=this.centerOffset,h=this.point.x,p=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=l.mercatorZfromAltitude(1,this.center.lat)*this.worldSize;let _=l.identity(new Float64Array(16));l.scale(_,_,[this.width/2,-this.height/2,1]),l.translate(_,_,[1,-1,0]),this.labelPlaneMatrix=_,_=l.identity(new Float64Array(16)),l.scale(_,_,[1,-1,1]),l.translate(_,_,[-1,-1,0]),l.scale(_,_,[2/this.width,2/this.height,1]),this.glCoordMatrix=_,this.cameraToSeaLevelDistance=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch);const x=Math.PI/2+this._pitch,E=this._fov*(.5+o.y/this.height),I=Math.sin(E)*this.cameraToSeaLevelDistance/Math.sin(l.clamp(Math.PI-x-E,.01,Math.PI-.01)),M=this.getHorizon(),k=2*Math.atan(M/this.cameraToCenterDistance)*(.5+o.y/(2*M)),O=Math.sin(k)*this.cameraToSeaLevelDistance/Math.sin(l.clamp(Math.PI-x-k,.01,Math.PI-.01)),B=Math.cos(Math.PI/2-this._pitch)*I+this.cameraToSeaLevelDistance,q=Math.cos(Math.PI/2-this._pitch)*O+this.cameraToSeaLevelDistance,re=1.01*Math.min(B,q),te=this.height/50;_=new Float64Array(16),l.perspective(_,this._fov,this.width/this.height,te,re),_[8]=2*-o.x/this.width,_[9]=2*o.y/this.height,l.scale(_,_,[1,-1,1]),l.translate(_,_,[0,0,-this.cameraToCenterDistance]),l.rotateX(_,_,this._pitch),l.rotateZ(_,_,this.angle),l.translate(_,_,[-h,-p,0]),this.mercatorMatrix=l.scale([],_,[this.worldSize,this.worldSize,this.worldSize]),l.scale(_,_,[1,1,this._pixelPerMeter]),this.pixelMatrix=l.multiply(new Float64Array(16),this.labelPlaneMatrix,_),l.translate(_,_,[0,0,-this.elevation]),this.projMatrix=_,this.invProjMatrix=l.invert([],_),this.pixelMatrix3D=l.multiply(new Float64Array(16),this.labelPlaneMatrix,_);const ne=this.width%2/2,fe=this.height%2/2,_e=Math.cos(this.angle),xe=Math.sin(this.angle),se=h-Math.round(h)+_e*ne+xe*fe,Te=p-Math.round(p)+_e*fe+xe*ne,we=new Float64Array(_);if(l.translate(we,we,[se>.5?se-1:se,Te>.5?Te-1:Te,0]),this.alignedProjMatrix=we,_=l.invert(new Float64Array(16),this.pixelMatrix),!_)throw new Error("failed to invert matrix");this.pixelMatrixInverse=_,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const o=this.pointCoordinate(new l.pointGeometry(0,0)),h=[o.x*this.worldSize,o.y*this.worldSize,0,1];return l.transformMat4(h,h,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const o=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new l.pointGeometry(0,o))}getCameraQueryGeometry(o){const h=this.getCameraPoint();if(o.length===1)return[o[0],h];{let p=h.x,_=h.y,x=h.x,E=h.y;for(const I of o)p=Math.min(p,I.x),_=Math.min(_,I.y),x=Math.max(x,I.x),E=Math.max(E,I.y);return[new l.pointGeometry(p,_),new l.pointGeometry(x,_),new l.pointGeometry(x,E),new l.pointGeometry(p,E),new l.pointGeometry(p,_)]}}}class Sf{constructor(o){this._hashName=o&&encodeURIComponent(o),l.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=function(h,p){let _=!1,x=null;const E=()=>{x=null,_&&(h(),x=setTimeout(E,300),_=!1)};return()=>(_=!0,x||E(),x)}(this._updateHashUnthrottled.bind(this))}addTo(o){return this._map=o,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(o){const h=this._map.getCenter(),p=Math.round(100*this._map.getZoom())/100,_=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),x=Math.pow(10,_),E=Math.round(h.lng*x)/x,I=Math.round(h.lat*x)/x,M=this._map.getBearing(),k=this._map.getPitch();let O="";if(O+=o?`/${E}/${I}/${p}`:`${p}/${I}/${E}`,(M||k)&&(O+="/"+Math.round(10*M)/10),k&&(O+=`/${Math.round(k)}`),this._hashName){const B=this._hashName;let q=!1;const re=window.location.hash.slice(1).split("&").map(te=>{const ne=te.split("=")[0];return ne===B?(q=!0,`${ne}=${O}`):te}).filter(te=>te);return q||re.push(`${B}=${O}`),`#${re.join("&")}`}return`#${O}`}_getCurrentHash(){const o=window.location.hash.replace("#","");if(this._hashName){let h;return o.split("&").map(p=>p.split("=")).forEach(p=>{p[0]===this._hashName&&(h=p)}),(h&&h[1]||"").split("/")}return o.split("/")}_onHashChange(){const o=this._getCurrentHash();if(o.length>=3&&!o.some(h=>isNaN(h))){const h=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(o[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+o[2],+o[1]],zoom:+o[0],bearing:h,pitch:+(o[4]||0)}),!0}return!1}_updateHashUnthrottled(){const o=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,o)}catch{}}}const dl={linearity:.3,easing:l.bezier(0,0,.3,1)},Af=l.extend({deceleration:2500,maxSpeed:1400},dl),Pf=l.extend({deceleration:20,maxSpeed:1400},dl),If=l.extend({deceleration:1e3,maxSpeed:360},dl),ma=l.extend({deceleration:1e3,maxSpeed:90},dl);class Cf{constructor(o){this._map=o,this.clear()}clear(){this._inertiaBuffer=[]}record(o){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:l.exported.now(),settings:o})}_drainInertiaBuffer(){const o=this._inertiaBuffer,h=l.exported.now();for(;o.length>0&&h-o[0].time>160;)o.shift()}_onMoveEnd(o){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const h={zoom:0,bearing:0,pitch:0,pan:new l.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:x}of this._inertiaBuffer)h.zoom+=x.zoomDelta||0,h.bearing+=x.bearingDelta||0,h.pitch+=x.pitchDelta||0,x.panDelta&&h.pan._add(x.panDelta),x.around&&(h.around=x.around),x.pinchAround&&(h.pinchAround=x.pinchAround);const p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,_={};if(h.pan.mag()){const x=pl(h.pan.mag(),p,l.extend({},Af,o||{}));_.offset=h.pan.mult(x.amount/h.pan.mag()),_.center=this._map.transform.center,fl(_,x)}if(h.zoom){const x=pl(h.zoom,p,Pf);_.zoom=this._map.transform.zoom+x.amount,fl(_,x)}if(h.bearing){const x=pl(h.bearing,p,If);_.bearing=this._map.transform.bearing+l.clamp(x.amount,-179,179),fl(_,x)}if(h.pitch){const x=pl(h.pitch,p,ma);_.pitch=this._map.transform.pitch+x.amount,fl(_,x)}if(_.zoom||_.bearing){const x=h.pinchAround===void 0?h.around:h.pinchAround;_.around=x?this._map.unproject(x):this._map.getCenter()}return this.clear(),l.extend(_,{noMoveStart:!0})}}function fl(m,o){(!m.duration||m.duration<o.duration)&&(m.duration=o.duration,m.easing=o.easing)}function pl(m,o,h){const{maxSpeed:p,linearity:_,deceleration:x}=h,E=l.clamp(m*_/(o/1e3),-p,p),I=Math.abs(E)/(x*_);return{easing:h.easing,duration:1e3*I,amount:E*(I/2)}}class fr extends l.Event{constructor(o,h,p,_={}){const x=P.mousePos(h.getCanvasContainer(),p),E=h.unproject(x);super(o,l.extend({point:x,lngLat:E,originalEvent:p},_)),this._defaultPrevented=!1,this.target=h}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class ml extends l.Event{constructor(o,h,p){const _=o==="touchend"?p.changedTouches:p.touches,x=P.touchPos(h.getCanvasContainer(),_),E=x.map(M=>h.unproject(M)),I=x.reduce((M,k,O,B)=>M.add(k.div(B.length)),new l.pointGeometry(0,0));super(o,{points:x,point:I,lngLats:E,lngLat:h.unproject(I),originalEvent:p}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class pr extends l.Event{constructor(o,h,p){super(o,{originalEvent:p}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class Hg{constructor(o,h){this._map=o,this._clickTolerance=h.clickTolerance}reset(){delete this._mousedownPos}wheel(o){return this._firePreventable(new pr(o.type,this._map,o))}mousedown(o,h){return this._mousedownPos=h,this._firePreventable(new fr(o.type,this._map,o))}mouseup(o){this._map.fire(new fr(o.type,this._map,o))}click(o,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||this._map.fire(new fr(o.type,this._map,o))}dblclick(o){return this._firePreventable(new fr(o.type,this._map,o))}mouseover(o){this._map.fire(new fr(o.type,this._map,o))}mouseout(o){this._map.fire(new fr(o.type,this._map,o))}touchstart(o){return this._firePreventable(new ml(o.type,this._map,o))}touchmove(o){this._map.fire(new ml(o.type,this._map,o))}touchend(o){this._map.fire(new ml(o.type,this._map,o))}touchcancel(o){this._map.fire(new ml(o.type,this._map,o))}_firePreventable(o){if(this._map.fire(o),o.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class to{constructor(o){this._map=o}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(o){this._map.fire(new fr(o.type,this._map,o))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new fr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(o){this._delayContextMenu?this._contextMenuEvent=o:this._ignoreContextMenu||this._map.fire(new fr(o.type,this._map,o)),this._map.listens("contextmenu")&&o.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Mf{constructor(o,h){this._map=o,this._el=o.getCanvasContainer(),this._container=o.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(o,h){this.isEnabled()&&o.shiftKey&&o.button===0&&(P.disableDrag(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(o,h){if(!this._active)return;const p=h;if(this._lastPos.equals(p)||!this._box&&p.dist(this._startPos)<this._clickTolerance)return;const _=this._startPos;this._lastPos=p,this._box||(this._box=P.create("div","maplibregl-boxzoom mapboxgl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair","mapboxgl-crosshair"),this._fireEvent("boxzoomstart",o));const x=Math.min(_.x,p.x),E=Math.max(_.x,p.x),I=Math.min(_.y,p.y),M=Math.max(_.y,p.y);P.setTransform(this._box,`translate(${x}px,${I}px)`),this._box.style.width=E-x+"px",this._box.style.height=M-I+"px"}mouseupWindow(o,h){if(!this._active||o.button!==0)return;const p=this._startPos,_=h;if(this.reset(),P.suppressClick(),p.x!==_.x||p.y!==_.y)return this._map.fire(new l.Event("boxzoomend",{originalEvent:o})),{cameraAnimation:x=>x.fitScreenCoordinates(p,_,this._map.getBearing(),{linear:!0})};this._fireEvent("boxzoomcancel",o)}keydown(o){this._active&&o.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",o))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair","mapboxgl-crosshair"),this._box&&(P.remove(this._box),this._box=null),P.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(o,h){return this._map.fire(new l.Event(o,{originalEvent:h}))}}function Ds(m,o){if(m.length!==o.length)throw new Error(`The number of touches and points are not equal - touches ${m.length}, points ${o.length}`);const h={};for(let p=0;p<m.length;p++)h[m[p].identifier]=o[p];return h}class gl{constructor(o){this.reset(),this.numTouches=o.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(o,h,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=o.timeStamp),p.length===this.numTouches&&(this.centroid=function(_){const x=new l.pointGeometry(0,0);for(const E of _)x._add(E);return x.div(_.length)}(h),this.touches=Ds(p,h)))}touchmove(o,h,p){if(this.aborted||!this.centroid)return;const _=Ds(p,h);for(const x in this.touches){const E=this.touches[x],I=_[x];(!I||I.dist(E)>30)&&(this.aborted=!0)}}touchend(o,h,p){if((!this.centroid||o.timeStamp-this.startTime>500)&&(this.aborted=!0),p.length===0){const _=!this.aborted&&this.centroid;if(this.reset(),_)return _}}}class ah{constructor(o){this.singleTap=new gl(o),this.numTaps=o.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(o,h,p){this.singleTap.touchstart(o,h,p)}touchmove(o,h,p){this.singleTap.touchmove(o,h,p)}touchend(o,h,p){const _=this.singleTap.touchend(o,h,p);if(_){const x=o.timeStamp-this.lastTime<500,E=!this.lastTap||this.lastTap.dist(_)<30;if(x&&E||this.reset(),this.count++,this.lastTime=o.timeStamp,this.lastTap=_,this.count===this.numTaps)return this.reset(),_}}}class $g{constructor(){this._zoomIn=new ah({numTouches:1,numTaps:2}),this._zoomOut=new ah({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(o,h,p){this._zoomIn.touchstart(o,h,p),this._zoomOut.touchstart(o,h,p)}touchmove(o,h,p){this._zoomIn.touchmove(o,h,p),this._zoomOut.touchmove(o,h,p)}touchend(o,h,p){const _=this._zoomIn.touchend(o,h,p),x=this._zoomOut.touchend(o,h,p);return _?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()+1,around:E.unproject(_)},{originalEvent:o})}):x?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()-1,around:E.unproject(x)},{originalEvent:o})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const qg={0:1,2:2};class _c{constructor(o){this.reset(),this._clickTolerance=o.clickTolerance||1}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(o,h){return!1}_move(o,h){return{}}mousedown(o,h){if(this._lastPoint)return;const p=P.mouseButton(o);this._correctButton(o,p)&&(this._lastPoint=h,this._eventButton=p)}mousemoveWindow(o,h){const p=this._lastPoint;if(p){if(o.preventDefault(),function(_,x){const E=qg[x];return _.buttons===void 0||(_.buttons&E)!==E}(o,this._eventButton))this.reset();else if(this._moved||!(h.dist(p)<this._clickTolerance))return this._moved=!0,this._lastPoint=h,this._move(p,h)}}mouseupWindow(o){this._lastPoint&&P.mouseButton(o)===this._eventButton&&(this._moved&&P.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class _l extends _c{mousedown(o,h){super.mousedown(o,h),this._lastPoint&&(this._active=!0)}_correctButton(o,h){return h===0&&!o.ctrlKey}_move(o,h){return{around:h,panDelta:h.sub(o)}}}class zs extends _c{_correctButton(o,h){return h===0&&o.ctrlKey||h===2}_move(o,h){const p=.8*(h.x-o.x);if(p)return this._active=!0,{bearingDelta:p}}contextmenu(o){o.preventDefault()}}class ct extends _c{_correctButton(o,h){return h===0&&o.ctrlKey||h===2}_move(o,h){const p=-.5*(h.y-o.y);if(p)return this._active=!0,{pitchDelta:p}}contextmenu(o){o.preventDefault()}}class Lf{constructor(o,h){this._minTouches=o.cooperativeGestures?2:1,this._clickTolerance=o.clickTolerance||1,this._map=h,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new l.pointGeometry(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(o,h,p){return this._calculateTransform(o,h,p)}touchmove(o,h,p){if(this._map._cooperativeGestures&&(this._minTouches===2&&p.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(o,!1,p.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(p.length<this._minTouches))return o.preventDefault(),this._calculateTransform(o,h,p)}touchend(o,h,p){this._calculateTransform(o,h,p),this._active&&p.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(o,h,p){p.length>0&&(this._active=!0);const _=Ds(p,h),x=new l.pointGeometry(0,0),E=new l.pointGeometry(0,0);let I=0;for(const k in _){const O=_[k],B=this._touches[k];B&&(x._add(O),E._add(O.sub(B)),I++,_[k]=O)}if(this._touches=_,I<this._minTouches||!E.mag())return;const M=E.div(I);return this._sum._add(M),this._sum.mag()<this._clickTolerance?void 0:{around:x.div(I),panDelta:M}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Co{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(o){}_move(o,h,p){return{}}touchstart(o,h,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([h[0],h[1]]))}touchmove(o,h,p){if(!this._firstTwoTouches)return;o.preventDefault();const[_,x]=this._firstTwoTouches,E=no(p,h,_),I=no(p,h,x);if(!E||!I)return;const M=this._aroundCenter?null:E.add(I).div(2);return this._move([E,I],M,o)}touchend(o,h,p){if(!this._firstTwoTouches)return;const[_,x]=this._firstTwoTouches,E=no(p,h,_),I=no(p,h,x);E&&I||(this._active&&P.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(o){this._enabled=!0,this._aroundCenter=!!o&&o.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function no(m,o,h){for(let p=0;p<m.length;p++)if(m[p].identifier===h)return o[p]}function lh(m,o){return Math.log(m/o)/Math.LN2}class Qe extends Co{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(o){this._startDistance=this._distance=o[0].dist(o[1])}_move(o,h){const p=this._distance;if(this._distance=o[0].dist(o[1]),this._active||!(Math.abs(lh(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:lh(this._distance,p),pinchAround:h}}}function yc(m,o){return 180*m.angleWith(o)/Math.PI}class Zg extends Co{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(o){this._startVector=this._vector=o[0].sub(o[1]),this._minDiameter=o[0].dist(o[1])}_move(o,h){const p=this._vector;if(this._vector=o[0].sub(o[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:yc(this._vector,p),pinchAround:h}}_isBelowThreshold(o){this._minDiameter=Math.min(this._minDiameter,o.mag());const h=25/(Math.PI*this._minDiameter)*360,p=yc(o,this._startVector);return Math.abs(p)<h}}function ch(m){return Math.abs(m.y)>Math.abs(m.x)}class uh extends Co{constructor(o){super(),this._map=o}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(o,h,p){super.touchstart(o,h,p),this._currentTouchCount=p.length}_start(o){this._lastPoints=o,ch(o[0].sub(o[1]))&&(this._valid=!1)}_move(o,h,p){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const _=o[0].sub(this._lastPoints[0]),x=o[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(_,x,p.timeStamp),this._valid?(this._lastPoints=o,this._active=!0,{pitchDelta:(_.y+x.y)/2*-.5}):void 0}gestureBeginsVertically(o,h,p){if(this._valid!==void 0)return this._valid;const _=o.mag()>=2,x=h.mag()>=2;if(!_&&!x)return;if(!_||!x)return this._firstMove===void 0&&(this._firstMove=p),p-this._firstMove<100&&void 0;const E=o.y>0==h.y>0;return ch(o)&&ch(h)&&E}}const kf={panStep:100,bearingStep:15,pitchStep:10};class Rf{constructor(){const o=kf;this._panStep=o.panStep,this._bearingStep=o.bearingStep,this._pitchStep=o.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(o){if(o.altKey||o.ctrlKey||o.metaKey)return;let h=0,p=0,_=0,x=0,E=0;switch(o.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:o.shiftKey?p=-1:(o.preventDefault(),x=-1);break;case 39:o.shiftKey?p=1:(o.preventDefault(),x=1);break;case 38:o.shiftKey?_=1:(o.preventDefault(),E=-1);break;case 40:o.shiftKey?_=-1:(o.preventDefault(),E=1);break;default:return}return this._rotationDisabled&&(p=0,_=0),{cameraAnimation:I=>{const M=I.getZoom();I.easeTo({duration:300,easeId:"keyboardHandler",easing:Xg,zoom:h?Math.round(M)+h*(o.shiftKey?2:1):M,bearing:I.getBearing()+p*this._bearingStep,pitch:I.getPitch()+_*this._pitchStep,offset:[-x*this._panStep,-E*this._panStep],center:I.getCenter()},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Xg(m){return m*(2-m)}const Df=4.000244140625;class hh{constructor(o,h){this._map=o,this._el=o.getCanvasContainer(),this._handler=h,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,l.bindAll(["_onTimeout"],this)}setZoomRate(o){this._defaultZoomRate=o}setWheelZoomRate(o){this._wheelZoomRate=o}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(o){this.isEnabled()||(this._enabled=!0,this._aroundCenter=o&&o.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(o){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!this._map._metaPress)return;o.preventDefault()}let h=o.deltaMode===WheelEvent.DOM_DELTA_LINE?40*o.deltaY:o.deltaY;const p=l.exported.now(),_=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,h!==0&&h%Df==0?this._type="wheel":h!==0&&Math.abs(h)<4?this._type="trackpad":_>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,o)):this._type||(this._type=Math.abs(_*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),o.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=o,this._delta-=h,this._active||this._start(o)),o.preventDefault()}_onTimeout(o){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(o)}_start(o){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const h=P.mousePos(this._el,o);this._around=l.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(h)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const o=this._map.transform;if(this._delta!==0){const I=this._type==="wheel"&&Math.abs(this._delta)>Df?this._wheelZoomRate:this._defaultZoomRate;let M=2/(1+Math.exp(-Math.abs(this._delta*I)));this._delta<0&&M!==0&&(M=1/M);const k=typeof this._targetZoom=="number"?o.zoomScale(this._targetZoom):o.scale;this._targetZoom=Math.min(o.maxZoom,Math.max(o.minZoom,o.scaleZoom(k*M))),this._type==="wheel"&&(this._startZoom=o.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const h=typeof this._targetZoom=="number"?this._targetZoom:o.zoom,p=this._startZoom,_=this._easing;let x,E=!1;if(this._type==="wheel"&&p&&_){const I=Math.min((l.exported.now()-this._lastWheelEventTime)/200,1),M=_(I);x=l.number(p,h,M),I<1?this._frameId||(this._frameId=!0):E=!0}else x=h,E=!0;return this._active=!0,E&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!E,zoomDelta:x-o.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(o){let h=l.ease;if(this._prevEase){const p=this._prevEase,_=(l.exported.now()-p.start)/p.duration,x=p.easing(_+.01)-p.easing(_),E=.27/Math.sqrt(x*x+1e-4)*.01,I=Math.sqrt(.0729-E*E);h=l.bezier(E,I,.25,1)}return this._prevEase={start:l.exported.now(),duration:o,easing:h},h}reset(){this._active=!1}}class dh{constructor(o,h){this._clickZoom=o,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class fh{constructor(){this.reset()}reset(){this._active=!1}dblclick(o,h){return o.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:p.getZoom()+(o.shiftKey?-1:1),around:p.unproject(h)},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ph{constructor(){this._tap=new ah({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(o,h,p){this._swipePoint||(this._tapTime&&o.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?p.length>0&&(this._swipePoint=h[0],this._swipeTouch=p[0].identifier):this._tap.touchstart(o,h,p))}touchmove(o,h,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;const _=h[0],x=_.y-this._swipePoint.y;return this._swipePoint=_,o.preventDefault(),this._active=!0,{zoomDelta:x/128}}}else this._tap.touchmove(o,h,p)}touchend(o,h,p){this._tapTime?this._swipePoint&&p.length===0&&this.reset():this._tap.touchend(o,h,p)&&(this._tapTime=o.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Yi{constructor(o,h,p){this._el=o,this._mousePan=h,this._touchPan=p}enable(o){this._inertiaOptions=o||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class io{constructor(o,h,p){this._pitchWithRotate=o.pitchWithRotate,this._mouseRotate=h,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class zf{constructor(o,h,p,_){this._el=o,this._touchZoom=h,this._touchRotate=p,this._tapDragZoom=_,this._rotationDisabled=!1,this._enabled=!0}enable(o){this._touchZoom.enable(o),this._rotationDisabled||this._touchRotate.enable(o),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const ga=m=>m.zoom||m.drag||m.pitch||m.rotate;class mh extends l.Event{}function yl(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta}class Of{constructor(o,h){this._map=o,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Cf(o),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(h),l.bindAll(["handleEvent","handleWindowEvent"],this);const p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[window,"blur",void 0]];for(const[_,x,E]of this._listeners)P.addEventListener(_,x,_===document?this.handleWindowEvent:this.handleEvent,E)}destroy(){for(const[o,h,p]of this._listeners)P.removeEventListener(o,h,o===document?this.handleWindowEvent:this.handleEvent,p)}_addDefaultHandlers(o){const h=this._map,p=h.getCanvasContainer();this._add("mapEvent",new Hg(h,o));const _=h.boxZoom=new Mf(h,o);this._add("boxZoom",_);const x=new $g,E=new fh;h.doubleClickZoom=new dh(E,x),this._add("tapZoom",x),this._add("clickZoom",E);const I=new ph;this._add("tapDragZoom",I);const M=h.touchPitch=new uh(h);this._add("touchPitch",M);const k=new zs(o),O=new ct(o);h.dragRotate=new io(o,k,O),this._add("mouseRotate",k,["mousePitch"]),this._add("mousePitch",O,["mouseRotate"]);const B=new _l(o),q=new Lf(o,h);h.dragPan=new Yi(p,B,q),this._add("mousePan",B),this._add("touchPan",q,["touchZoom","touchRotate"]);const re=new Zg,te=new Qe;h.touchZoomRotate=new zf(p,te,re,I),this._add("touchRotate",re,["touchPan","touchZoom"]),this._add("touchZoom",te,["touchPan","touchRotate"]);const ne=h.scrollZoom=new hh(h,this);this._add("scrollZoom",ne,["mousePan"]);const fe=h.keyboard=new Rf;this._add("keyboard",fe),this._add("blockableMapEvent",new to(h));for(const _e of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])o.interactive&&o[_e]&&h[_e].enable(o[_e])}_add(o,h,p){this._handlers.push({handlerName:o,handler:h,allowed:p}),this._handlersById[o]=h}stop(o){if(!this._updatingCamera){for(const{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},o),this._changes=[]}}isActive(){for(const{handler:o}of this._handlers)if(o.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!ga(this._eventsInProgress)||this.isZooming()}_blockedByActive(o,h,p){for(const _ in o)if(_!==p&&(!h||h.indexOf(_)<0))return!0;return!1}handleWindowEvent(o){this.handleEvent(o,`${o.type}Window`)}_getMapTouches(o){const h=[];for(const p of o)this._el.contains(p.target)&&h.push(p);return h}handleEvent(o,h){if(o.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const p=o.type==="renderFrame"?void 0:o,_={needsRenderFrame:!1},x={},E={},I=o.touches,M=I?this._getMapTouches(I):void 0,k=M?P.touchPos(this._el,M):P.mousePos(this._el,o);for(const{handlerName:q,handler:re,allowed:te}of this._handlers){if(!re.isEnabled())continue;let ne;this._blockedByActive(E,te,q)?re.reset():re[h||o.type]&&(ne=re[h||o.type](o,k,M),this.mergeHandlerResult(_,x,ne,q,p),ne&&ne.needsRenderFrame&&this._triggerRenderFrame()),(ne||re.isActive())&&(E[q]=re)}const O={};for(const q in this._previousActiveHandlers)E[q]||(O[q]=p);this._previousActiveHandlers=E,(Object.keys(O).length||yl(_))&&(this._changes.push([_,x,O]),this._triggerRenderFrame()),(Object.keys(E).length||yl(_))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:B}=_;B&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],B(this._map))}mergeHandlerResult(o,h,p,_,x){if(!p)return;l.extend(o,p);const E={handlerName:_,originalEvent:p.originalEvent||x};p.zoomDelta!==void 0&&(h.zoom=E),p.panDelta!==void 0&&(h.drag=E),p.pitchDelta!==void 0&&(h.pitch=E),p.bearingDelta!==void 0&&(h.rotate=E)}_applyChanges(){const o={},h={},p={};for(const[_,x,E]of this._changes)_.panDelta&&(o.panDelta=(o.panDelta||new l.pointGeometry(0,0))._add(_.panDelta)),_.zoomDelta&&(o.zoomDelta=(o.zoomDelta||0)+_.zoomDelta),_.bearingDelta&&(o.bearingDelta=(o.bearingDelta||0)+_.bearingDelta),_.pitchDelta&&(o.pitchDelta=(o.pitchDelta||0)+_.pitchDelta),_.around!==void 0&&(o.around=_.around),_.pinchAround!==void 0&&(o.pinchAround=_.pinchAround),_.noInertia&&(o.noInertia=_.noInertia),l.extend(h,x),l.extend(p,E);this._updateMapTransform(o,h,p),this._changes=[]}_updateMapTransform(o,h,p){const _=this._map,x=_.transform,E=_.style&&_.style.terrain;if(!(yl(o)||E&&this._drag))return this._fireEvents(h,p,!0);let{panDelta:I,zoomDelta:M,bearingDelta:k,pitchDelta:O,around:B,pinchAround:q}=o;q!==void 0&&(B=q),_._stop(!0),B=B||_.transform.centerPoint;const re=x.pointLocation(I?B.sub(I):B);k&&(x.bearing+=k),O&&(x.pitch+=O),M&&(x.zoom+=M),E?h.drag&&!this._drag?(this._drag={center:x.centerPoint,lngLat:x.pointLocation(B),point:B,handlerName:h.drag.handlerName},_.fire(new l.Event("freezeElevation",{freeze:!0}))):this._drag&&p[this._drag.handlerName]?(_.fire(new l.Event("freezeElevation",{freeze:!1})),this._drag=null):h.drag&&this._drag&&(x.center=x.pointLocation(x.centerPoint.sub(I))):x.setLocationAtPoint(re,B),this._map._update(),o.noInertia||this._inertia.record(o),this._fireEvents(h,p,!0)}_fireEvents(o,h,p){const _=ga(this._eventsInProgress),x=ga(o),E={};for(const O in o){const{originalEvent:B}=o[O];this._eventsInProgress[O]||(E[`${O}start`]=B),this._eventsInProgress[O]=o[O]}!_&&x&&this._fireEvent("movestart",x.originalEvent);for(const O in E)this._fireEvent(O,E[O]);x&&this._fireEvent("move",x.originalEvent);for(const O in o){const{originalEvent:B}=o[O];this._fireEvent(O,B)}const I={};let M;for(const O in this._eventsInProgress){const{handlerName:B,originalEvent:q}=this._eventsInProgress[O];this._handlersById[B].isActive()||(delete this._eventsInProgress[O],M=h[B]||q,I[`${O}end`]=M)}for(const O in I)this._fireEvent(O,I[O]);const k=ga(this._eventsInProgress);if(p&&(_||x)&&!k){this._updatingCamera=!0;const O=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),B=q=>q!==0&&-this._bearingSnap<q&&q<this._bearingSnap;O?(B(O.bearing||this._map.getBearing())&&(O.bearing=0),this._map.easeTo(O,{originalEvent:M})):(this._map.fire(new l.Event("moveend",{originalEvent:M})),B(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(o,h){this._map.fire(new l.Event(o,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(o=>{delete this._frameId,this.handleEvent(new mh("renderFrame",{timeStamp:o})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Ir={extend:(m,...o)=>l.extend(m,...o),run(m){m()},logToElement(m,o=!1,h="log"){const p=window.document.getElementById(h);p&&(o&&(p.innerHTML=""),p.innerHTML+=`<br>${m}`)}};class An extends l.Evented{constructor(o,h){super(),this._moving=!1,this._zooming=!1,this.transform=o,this._bearingSnap=h.bearingSnap,l.bindAll(["_renderFrameCallback"],this)}getCenter(){return new l.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(o,h){return this.jumpTo({center:o},h)}panBy(o,h,p){return o=l.pointGeometry.convert(o).mult(-1),this.panTo(this.transform.center,l.extend({offset:o},h),p)}panTo(o,h,p){return this.easeTo(l.extend({center:o},h),p)}getZoom(){return this.transform.zoom}setZoom(o,h){return this.jumpTo({zoom:o},h),this}zoomTo(o,h,p){return this.easeTo(l.extend({zoom:o},h),p)}zoomIn(o,h){return this.zoomTo(this.getZoom()+1,o,h),this}zoomOut(o,h){return this.zoomTo(this.getZoom()-1,o,h),this}getBearing(){return this.transform.bearing}setBearing(o,h){return this.jumpTo({bearing:o},h),this}getPadding(){return this.transform.padding}setPadding(o,h){return this.jumpTo({padding:o},h),this}rotateTo(o,h,p){return this.easeTo(l.extend({bearing:o},h),p)}resetNorth(o,h){return this.rotateTo(0,l.extend({duration:1e3},o),h),this}resetNorthPitch(o,h){return this.easeTo(l.extend({bearing:0,pitch:0,duration:1e3},o),h),this}snapToNorth(o,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(o,h):this}getPitch(){return this.transform.pitch}setPitch(o,h){return this.jumpTo({pitch:o},h),this}cameraForBounds(o,h){o=l.LngLatBounds.convert(o);const p=h&&h.bearing||0;return this._cameraForBoxAndBearing(o.getNorthWest(),o.getSouthEast(),p,h)}_cameraForBoxAndBearing(o,h,p,_){const x={top:0,bottom:0,right:0,left:0};if(typeof(_=l.extend({padding:x,offset:[0,0],maxZoom:this.transform.maxZoom},_)).padding=="number"){const we=_.padding;_.padding={top:we,bottom:we,right:we,left:we}}_.padding=l.extend(x,_.padding);const E=this.transform,I=E.padding,M=E.project(l.LngLat.convert(o)),k=E.project(l.LngLat.convert(h)),O=M.rotate(-p*Math.PI/180),B=k.rotate(-p*Math.PI/180),q=new l.pointGeometry(Math.max(O.x,B.x),Math.max(O.y,B.y)),re=new l.pointGeometry(Math.min(O.x,B.x),Math.min(O.y,B.y)),te=q.sub(re),ne=(E.width-(I.left+I.right+_.padding.left+_.padding.right))/te.x,fe=(E.height-(I.top+I.bottom+_.padding.top+_.padding.bottom))/te.y;if(fe<0||ne<0)return void l.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const _e=Math.min(E.scaleZoom(E.scale*Math.min(ne,fe)),_.maxZoom),xe=l.pointGeometry.convert(_.offset),se=new l.pointGeometry((_.padding.left-_.padding.right)/2,(_.padding.top-_.padding.bottom)/2).rotate(p*Math.PI/180),Te=xe.add(se).mult(E.scale/E.zoomScale(_e));return{center:E.unproject(M.add(k).div(2).sub(Te)),zoom:_e,bearing:p}}fitBounds(o,h,p){return this._fitInternal(this.cameraForBounds(o,h),h,p)}fitScreenCoordinates(o,h,p,_,x){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(l.pointGeometry.convert(o)),this.transform.pointLocation(l.pointGeometry.convert(h)),p,_),_,x)}_fitInternal(o,h,p){return o?(delete(h=l.extend(o,h)).padding,h.linear?this.easeTo(h,p):this.flyTo(h,p)):this}jumpTo(o,h){this.stop();const p=this.transform;let _=!1,x=!1,E=!1;return"zoom"in o&&p.zoom!==+o.zoom&&(_=!0,p.zoom=+o.zoom),o.center!==void 0&&(p.center=l.LngLat.convert(o.center)),"bearing"in o&&p.bearing!==+o.bearing&&(x=!0,p.bearing=+o.bearing),"pitch"in o&&p.pitch!==+o.pitch&&(E=!0,p.pitch=+o.pitch),o.padding==null||p.isPaddingEqual(o.padding)||(p.padding=o.padding),this.fire(new l.Event("movestart",h)).fire(new l.Event("move",h)),_&&this.fire(new l.Event("zoomstart",h)).fire(new l.Event("zoom",h)).fire(new l.Event("zoomend",h)),x&&this.fire(new l.Event("rotatestart",h)).fire(new l.Event("rotate",h)).fire(new l.Event("rotateend",h)),E&&this.fire(new l.Event("pitchstart",h)).fire(new l.Event("pitch",h)).fire(new l.Event("pitchend",h)),this.fire(new l.Event("moveend",h))}calculateCameraOptionsFromTo(o,h,p,_=0){const x=l.MercatorCoordinate.fromLngLat(o,h),E=l.MercatorCoordinate.fromLngLat(p,_),I=E.x-x.x,M=E.y-x.y,k=E.z-x.z,O=Math.hypot(I,M,k);if(O===0)throw new Error("Can't calculate camera options with same From and To");const B=Math.hypot(I,M),q=this.transform.scaleZoom(this.transform.cameraToCenterDistance/O/this.transform.tileSize),re=180*Math.atan2(I,-M)/Math.PI;let te=180*Math.acos(B/O)/Math.PI;return te=k<0?90-te:90+te,{center:E.toLngLat(),zoom:q,pitch:te,bearing:re}}easeTo(o,h){this._stop(!1,o.easeId),((o=l.extend({offset:[0,0],duration:500,easing:l.ease},o)).animate===!1||!o.essential&&l.exported.prefersReducedMotion)&&(o.duration=0);const p=this.transform,_=this.getZoom(),x=this.getBearing(),E=this.getPitch(),I=this.getPadding(),M="zoom"in o?+o.zoom:_,k="bearing"in o?this._normalizeBearing(o.bearing,x):x,O="pitch"in o?+o.pitch:E,B="padding"in o?o.padding:p.padding,q=l.pointGeometry.convert(o.offset);let re=p.centerPoint.add(q);const te=p.pointLocation(re),ne=l.LngLat.convert(o.center||te);this._normalizeCenter(ne);const fe=p.project(te),_e=p.project(ne).sub(fe),xe=p.zoomScale(M-_);let se,Te;o.around&&(se=l.LngLat.convert(o.around),Te=p.locationPoint(se));const we={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||M!==_,this._rotating=this._rotating||x!==k,this._pitching=this._pitching||O!==E,this._padding=!p.isPaddingEqual(B),this._easeId=o.easeId,this._prepareEase(h,o.noMoveStart,we),this._ease(ke=>{if(this._zooming&&(p.zoom=l.number(_,M,ke)),this._rotating&&(p.bearing=l.number(x,k,ke)),this._pitching&&(p.pitch=l.number(E,O,ke)),this._padding&&(p.interpolatePadding(I,B,ke),re=p.centerPoint.add(q)),se)p.setLocationAtPoint(se,Te);else{const Re=p.zoomScale(p.zoom-_),Be=M>_?Math.min(2,xe):Math.max(.5,xe),Me=Math.pow(Be,1-ke),nt=p.unproject(fe.add(_e.mult(ke*Me)).mult(Re));p.setLocationAtPoint(p.renderWorldCopies?nt.wrap():nt,re)}this._fireMoveEvents(h)},ke=>{this._afterEase(h,ke)},o),this}_prepareEase(o,h,p={}){this._moving=!0,this.fire(new l.Event("freezeElevation",{freeze:!0})),h||p.moving||this.fire(new l.Event("movestart",o)),this._zooming&&!p.zooming&&this.fire(new l.Event("zoomstart",o)),this._rotating&&!p.rotating&&this.fire(new l.Event("rotatestart",o)),this._pitching&&!p.pitching&&this.fire(new l.Event("pitchstart",o))}_fireMoveEvents(o){this.fire(new l.Event("move",o)),this._zooming&&this.fire(new l.Event("zoom",o)),this._rotating&&this.fire(new l.Event("rotate",o)),this._pitching&&this.fire(new l.Event("pitch",o))}_afterEase(o,h){if(this._easeId&&h&&this._easeId===h)return;delete this._easeId,this.fire(new l.Event("freezeElevation",{freeze:!1}));const p=this._zooming,_=this._rotating,x=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new l.Event("zoomend",o)),_&&this.fire(new l.Event("rotateend",o)),x&&this.fire(new l.Event("pitchend",o)),this.fire(new l.Event("moveend",o))}flyTo(o,h){if(!o.essential&&l.exported.prefersReducedMotion){const bt=l.pick(o,["center","zoom","bearing","pitch","around"]);return this.jumpTo(bt,h)}this.stop(),o=l.extend({offset:[0,0],speed:1.2,curve:1.42,easing:l.ease},o);const p=this.transform,_=this.getZoom(),x=this.getBearing(),E=this.getPitch(),I=this.getPadding(),M="zoom"in o?l.clamp(+o.zoom,p.minZoom,p.maxZoom):_,k="bearing"in o?this._normalizeBearing(o.bearing,x):x,O="pitch"in o?+o.pitch:E,B="padding"in o?o.padding:p.padding,q=p.zoomScale(M-_),re=l.pointGeometry.convert(o.offset);let te=p.centerPoint.add(re);const ne=p.pointLocation(te),fe=l.LngLat.convert(o.center||ne);this._normalizeCenter(fe);const _e=p.project(ne),xe=p.project(fe).sub(_e);let se=o.curve;const Te=Math.max(p.width,p.height),we=Te/q,ke=xe.mag();if("minZoom"in o){const bt=l.clamp(Math.min(o.minZoom,_,M),p.minZoom,p.maxZoom),cn=Te/p.zoomScale(bt-_);se=Math.sqrt(cn/ke*2)}const Re=se*se;function Be(bt){const cn=(we*we-Te*Te+(bt?-1:1)*Re*Re*ke*ke)/(2*(bt?we:Te)*Re*ke);return Math.log(Math.sqrt(cn*cn+1)-cn)}function Me(bt){return(Math.exp(bt)-Math.exp(-bt))/2}function nt(bt){return(Math.exp(bt)+Math.exp(-bt))/2}const Ze=Be(0);let st=function(bt){return nt(Ze)/nt(Ze+se*bt)},Rt=function(bt){return Te*((nt(Ze)*(Me(cn=Ze+se*bt)/nt(cn))-Me(Ze))/Re)/ke;var cn},Ot=(Be(1)-Ze)/se;if(Math.abs(ke)<1e-6||!isFinite(Ot)){if(Math.abs(Te-we)<1e-6)return this.easeTo(o,h);const bt=we<Te?-1:1;Ot=Math.abs(Math.log(we/Te))/se,Rt=function(){return 0},st=function(cn){return Math.exp(bt*se*cn)}}return o.duration="duration"in o?+o.duration:1e3*Ot/("screenSpeed"in o?+o.screenSpeed/se:+o.speed),o.maxDuration&&o.duration>o.maxDuration&&(o.duration=0),this._zooming=!0,this._rotating=x!==k,this._pitching=O!==E,this._padding=!p.isPaddingEqual(B),this._prepareEase(h,!1),this._ease(bt=>{const cn=bt*Ot,un=1/st(cn);p.zoom=bt===1?M:_+p.scaleZoom(un),this._rotating&&(p.bearing=l.number(x,k,bt)),this._pitching&&(p.pitch=l.number(E,O,bt)),this._padding&&(p.interpolatePadding(I,B,bt),te=p.centerPoint.add(re));const Zt=bt===1?fe:p.unproject(_e.add(xe.mult(Rt(cn))).mult(un));p.setLocationAtPoint(p.renderWorldCopies?Zt.wrap():Zt,te),this._fireMoveEvents(h)},()=>this._afterEase(h),o),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(o,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const p=this._onEaseEnd;delete this._onEaseEnd,p.call(this,h)}if(!o){const p=this.handlers;p&&p.stop(!1)}return this}_ease(o,h,p){p.animate===!1||p.duration===0?(o(1),h()):(this._easeStart=l.exported.now(),this._easeOptions=p,this._onEaseFrame=o,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const o=Math.min((l.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(o)),o<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(o,h){o=l.wrap(o,-180,180);const p=Math.abs(o-h);return Math.abs(o-360-h)<p&&(o-=360),Math.abs(o+360-h)<p&&(o+=360),o}_normalizeCenter(o){const h=this.transform;if(!h.renderWorldCopies||h.lngRange)return;const p=o.lng-h.center.lng;o.lng+=p>180?-360:p<-180?360:0}}class vl{constructor(o={}){this.options=o,l.bindAll(["_toggleAttribution","_updateData","_updateCompact","_updateCompactMinimize"],this)}getDefaultPosition(){return"bottom-right"}onAdd(o){return this._map=o,this._compact=this.options&&this.options.compact,this._container=P.create("details","maplibregl-ctrl maplibregl-ctrl-attrib mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=P.create("summary","maplibregl-ctrl-attrib-button mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=P.create("div","maplibregl-ctrl-attrib-inner mapboxgl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){P.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(o,h){const p=this._map._getUIString(`AttributionControl.${h}`);o.title=p,o.setAttribute("aria-label",p)}_toggleAttribution(){this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")):(this._container.classList.add("maplibregl-compact-show","mapboxgl-compact-show"),this._container.removeAttribute("open")))}_updateData(o){!o||o.sourceDataType!=="metadata"&&o.sourceDataType!=="visibility"&&o.dataType!=="style"&&o.type!=="terrain"||this._updateAttributions()}_updateAttributions(){if(!this._map.style)return;let o=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?o=o.concat(this.options.customAttribution.map(_=>typeof _!="string"?"":_)):typeof this.options.customAttribution=="string"&&o.push(this.options.customAttribution)),this._map.style.stylesheet){const _=this._map.style.stylesheet;this.styleOwner=_.owner,this.styleId=_.id}const h=this._map.style.sourceCaches;for(const _ in h){const x=h[_];if(x.used||x.usedForTerrain){const E=x.getSource();E.attribution&&o.indexOf(E.attribution)<0&&o.push(E.attribution)}}o=o.filter(_=>String(_).trim()),o.sort((_,x)=>_.length-x.length),o=o.filter((_,x)=>{for(let E=x+1;E<o.length;E++)if(o[E].indexOf(_)>=0)return!1;return!0});const p=o.join(" | ");p!==this._attribHTML&&(this._attribHTML=p,o.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("maplibregl-attrib-empty","mapboxgl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty","mapboxgl-attrib-empty"),this._updateCompact(),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","mapboxgl-compact","maplibregl-compact-show","mapboxgl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show","mapboxgl-compact","mapboxgl-compact-show"))}_updateCompactMinimize(){this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")}}class vc{constructor(o={}){this.options=o,l.bindAll(["_updateCompact"],this)}getDefaultPosition(){return"bottom-left"}onAdd(o){this._map=o,this._compact=this.options&&this.options.compact,this._container=P.create("div","maplibregl-ctrl mapboxgl-ctrl");const h=P.create("a","maplibregl-ctrl-logo mapboxgl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://maplibre.org/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){P.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}_updateCompact(){const o=this._container.children;if(o.length){const h=o[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&h.classList.add("maplibregl-compact","mapboxgl-compact"):h.classList.remove("maplibregl-compact","mapboxgl-compact")}}}class Ff{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(o){const h=++this._id;return this._queue.push({callback:o,id:h,cancelled:!1}),h}remove(o){const h=this._currentlyRunning,p=h?this._queue.concat(h):this._queue;for(const _ of p)if(_.id===o)return void(_.cancelled=!0)}run(o=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const h=this._currentlyRunning=this._queue;this._queue=[];for(const p of h)if(!p.cancelled&&(p.callback(o),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const Nf={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"},Bf={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,fadeDuration:300,crossSourceCollisions:!0},Yg={showCompass:!0,showZoom:!0,visualizePitch:!1};class ms{constructor(o,h,p=!1){this._clickTolerance=10,this.element=h,this.mouseRotate=new zs({clickTolerance:o.dragRotate._mouseRotate._clickTolerance}),this.map=o,p&&(this.mousePitch=new ct({clickTolerance:o.dragRotate._mousePitch._clickTolerance})),l.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),P.addEventListener(h,"mousedown",this.mousedown),P.addEventListener(h,"touchstart",this.touchstart,{passive:!1}),P.addEventListener(h,"touchmove",this.touchmove),P.addEventListener(h,"touchend",this.touchend),P.addEventListener(h,"touchcancel",this.reset)}down(o,h){this.mouseRotate.mousedown(o,h),this.mousePitch&&this.mousePitch.mousedown(o,h),P.disableDrag()}move(o,h){const p=this.map,_=this.mouseRotate.mousemoveWindow(o,h);if(_&&_.bearingDelta&&p.setBearing(p.getBearing()+_.bearingDelta),this.mousePitch){const x=this.mousePitch.mousemoveWindow(o,h);x&&x.pitchDelta&&p.setPitch(p.getPitch()+x.pitchDelta)}}off(){const o=this.element;P.removeEventListener(o,"mousedown",this.mousedown),P.removeEventListener(o,"touchstart",this.touchstart,{passive:!1}),P.removeEventListener(o,"touchmove",this.touchmove),P.removeEventListener(o,"touchend",this.touchend),P.removeEventListener(o,"touchcancel",this.reset),this.offTemp()}offTemp(){P.enableDrag(),P.removeEventListener(window,"mousemove",this.mousemove),P.removeEventListener(window,"mouseup",this.mouseup)}mousedown(o){this.down(l.extend({},o,{ctrlKey:!0,preventDefault:()=>o.preventDefault()}),P.mousePos(this.element,o)),P.addEventListener(window,"mousemove",this.mousemove),P.addEventListener(window,"mouseup",this.mouseup)}mousemove(o){this.move(o,P.mousePos(this.element,o))}mouseup(o){this.mouseRotate.mouseupWindow(o),this.mousePitch&&this.mousePitch.mouseupWindow(o),this.offTemp()}touchstart(o){o.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=P.touchPos(this.element,o.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>o.preventDefault()},this._startPos))}touchmove(o){o.targetTouches.length!==1?this.reset():(this._lastPos=P.touchPos(this.element,o.targetTouches)[0],this.move({preventDefault:()=>o.preventDefault()},this._lastPos))}touchend(o){o.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function xl(m,o,h){if(m=new l.LngLat(m.lng,m.lat),o){const p=new l.LngLat(m.lng-360,m.lat),_=new l.LngLat(m.lng+360,m.lat),x=h.locationPoint(m).distSqr(o);h.locationPoint(p).distSqr(o)<x?m=p:h.locationPoint(_).distSqr(o)<x&&(m=_)}for(;Math.abs(m.lng-h.center.lng)>180;){const p=h.locationPoint(m);if(p.x>=0&&p.y>=0&&p.x<=h.width&&p.y<=h.height)break;m.lng>h.center.lng?m.lng-=360:m.lng+=360}return m}const mt={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function St(m,o,h){const p=m.classList;for(const _ in mt)p.remove(`maplibregl-${h}-anchor-${_}`,`mapboxgl-${h}-anchor-${_}`);p.add(`maplibregl-${h}-anchor-${o}`,`mapboxgl-${h}-anchor-${o}`)}class _a extends l.Evented{constructor(o,h){if(super(),(o instanceof HTMLElement||h)&&(o=l.extend({element:o},h)),l.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=o&&o.anchor||"center",this._color=o&&o.color||"#3FB1CE",this._scale=o&&o.scale||1,this._draggable=o&&o.draggable||!1,this._clickTolerance=o&&o.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=o&&o.rotation||0,this._rotationAlignment=o&&o.rotationAlignment||"auto",this._pitchAlignment=o&&o.pitchAlignment&&o.pitchAlignment!=="auto"?o.pitchAlignment:this._rotationAlignment,o&&o.element)this._element=o.element,this._offset=l.pointGeometry.convert(o&&o.offset||[0,0]);else{this._defaultMarker=!0,this._element=P.create("div"),this._element.setAttribute("aria-label","Map marker");const p=P.createNS("http://www.w3.org/2000/svg","svg"),_=41,x=27;p.setAttributeNS(null,"display","block"),p.setAttributeNS(null,"height",`${_}px`),p.setAttributeNS(null,"width",`${x}px`),p.setAttributeNS(null,"viewBox",`0 0 ${x} ${_}`);const E=P.createNS("http://www.w3.org/2000/svg","g");E.setAttributeNS(null,"stroke","none"),E.setAttributeNS(null,"stroke-width","1"),E.setAttributeNS(null,"fill","none"),E.setAttributeNS(null,"fill-rule","evenodd");const I=P.createNS("http://www.w3.org/2000/svg","g");I.setAttributeNS(null,"fill-rule","nonzero");const M=P.createNS("http://www.w3.org/2000/svg","g");M.setAttributeNS(null,"transform","translate(3.0, 29.0)"),M.setAttributeNS(null,"fill","#000000");const k=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const xe of k){const se=P.createNS("http://www.w3.org/2000/svg","ellipse");se.setAttributeNS(null,"opacity","0.04"),se.setAttributeNS(null,"cx","10.5"),se.setAttributeNS(null,"cy","5.80029008"),se.setAttributeNS(null,"rx",xe.rx),se.setAttributeNS(null,"ry",xe.ry),M.appendChild(se)}const O=P.createNS("http://www.w3.org/2000/svg","g");O.setAttributeNS(null,"fill",this._color);const B=P.createNS("http://www.w3.org/2000/svg","path");B.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),O.appendChild(B);const q=P.createNS("http://www.w3.org/2000/svg","g");q.setAttributeNS(null,"opacity","0.25"),q.setAttributeNS(null,"fill","#000000");const re=P.createNS("http://www.w3.org/2000/svg","path");re.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),q.appendChild(re);const te=P.createNS("http://www.w3.org/2000/svg","g");te.setAttributeNS(null,"transform","translate(6.0, 7.0)"),te.setAttributeNS(null,"fill","#FFFFFF");const ne=P.createNS("http://www.w3.org/2000/svg","g");ne.setAttributeNS(null,"transform","translate(8.0, 8.0)");const fe=P.createNS("http://www.w3.org/2000/svg","circle");fe.setAttributeNS(null,"fill","#000000"),fe.setAttributeNS(null,"opacity","0.25"),fe.setAttributeNS(null,"cx","5.5"),fe.setAttributeNS(null,"cy","5.5"),fe.setAttributeNS(null,"r","5.4999962");const _e=P.createNS("http://www.w3.org/2000/svg","circle");_e.setAttributeNS(null,"fill","#FFFFFF"),_e.setAttributeNS(null,"cx","5.5"),_e.setAttributeNS(null,"cy","5.5"),_e.setAttributeNS(null,"r","5.4999962"),ne.appendChild(fe),ne.appendChild(_e),I.appendChild(M),I.appendChild(O),I.appendChild(q),I.appendChild(te),I.appendChild(ne),p.appendChild(I),p.setAttributeNS(null,"height",_*this._scale+"px"),p.setAttributeNS(null,"width",x*this._scale+"px"),this._element.appendChild(p),this._offset=l.pointGeometry.convert(o&&o.offset||[0,-14])}this._element.classList.add("maplibregl-marker","mapboxgl-marker"),this._element.addEventListener("dragstart",p=>{p.preventDefault()}),this._element.addEventListener("mousedown",p=>{p.preventDefault()}),St(this._element,this._anchor,"marker"),this._popup=null}addTo(o){return this.remove(),this._map=o,o.getCanvasContainer().appendChild(this._element),o.on("move",this._update),o.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),P.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(o){return this._lngLat=l.LngLat.convert(o),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(o){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),o){if(!("offset"in o.options)){const _=Math.sqrt(Math.pow(13.5,2)/2);o.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[_,-1*(38.1-13.5+_)],"bottom-right":[-_,-1*(38.1-13.5+_)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=o,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}_onKeyPress(o){const h=o.code,p=o.charCode||o.keyCode;h!=="Space"&&h!=="Enter"&&p!==32&&p!==13||this.togglePopup()}_onMapClick(o){const h=o.originalEvent.target,p=this._element;this._popup&&(h===p||p.contains(h))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const o=this._popup;return o?(o.isOpen()?o.remove():o.addTo(this._map),this):this}_update(o){if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=xl(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let h="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?h=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(h=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let p="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?p="rotateX(0deg)":this._pitchAlignment==="map"&&(p=`rotateX(${this._map.getPitch()}deg)`),o&&o.type!=="moveend"||(this._pos=this._pos.round()),P.setTransform(this._element,`${mt[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${p} ${h}`),this._map.style&&this._map.style.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const _=this._map.unproject(this._pos),x=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=_.distanceTo(this._lngLat)>20*x?"0.2":"1.0",this._opacityTimeout=null},100))}getOffset(){return this._offset}setOffset(o){return this._offset=l.pointGeometry.convert(o),this._update(),this}_onMove(o){if(!this._isDragging){const h=this._clickTolerance||this._map._clickTolerance;this._isDragging=o.point.dist(this._pointerdownPos)>=h}this._isDragging&&(this._pos=o.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new l.Event("dragstart"))),this.fire(new l.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new l.Event("dragend")),this._state="inactive"}_addDragHandler(o){this._element.contains(o.originalEvent.target)&&(o.preventDefault(),this._positionDelta=o.point.sub(this._pos).add(this._offset),this._pointerdownPos=o.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(o){return this._draggable=!!o,this._map&&(o?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(o){return this._rotation=o||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(o){return this._rotationAlignment=o||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(o){return this._pitchAlignment=o&&o!=="auto"?o:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const gh={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let ro,xi=0,so=!1;const gs={maxWidth:100,unit:"metric"};function Uf(m,o,h){const p=h&&h.maxWidth||100,_=m._container.clientHeight/2,x=m.unproject([0,_]),E=m.unproject([p,_]),I=x.distanceTo(E);if(h&&h.unit==="imperial"){const M=3.2808*I;M>5280?oo(o,p,M/5280,m._getUIString("ScaleControl.Miles")):oo(o,p,M,m._getUIString("ScaleControl.Feet"))}else h&&h.unit==="nautical"?oo(o,p,I/1852,m._getUIString("ScaleControl.NauticalMiles")):I>=1e3?oo(o,p,I/1e3,m._getUIString("ScaleControl.Kilometers")):oo(o,p,I,m._getUIString("ScaleControl.Meters"))}function oo(m,o,h,p){const _=function(x){const E=Math.pow(10,`${Math.floor(x)}`.length-1);let I=x/E;return I=I>=10?10:I>=5?5:I>=3?3:I>=2?2:I>=1?1:function(M){const k=Math.pow(10,Math.ceil(-Math.log(M)/Math.LN10));return Math.round(M*k)/k}(I),E*I}(h);m.style.width=o*(_/h)+"px",m.innerHTML=`${_}&nbsp;${p}`}const Fn={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Xn=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function _h(m){if(m){if(typeof m=="number"){const o=Math.round(Math.sqrt(.5*Math.pow(m,2)));return{center:new l.pointGeometry(0,0),top:new l.pointGeometry(0,m),"top-left":new l.pointGeometry(o,o),"top-right":new l.pointGeometry(-o,o),bottom:new l.pointGeometry(0,-m),"bottom-left":new l.pointGeometry(o,-o),"bottom-right":new l.pointGeometry(-o,-o),left:new l.pointGeometry(m,0),right:new l.pointGeometry(-m,0)}}if(m instanceof l.pointGeometry||Array.isArray(m)){const o=l.pointGeometry.convert(m);return{center:o,top:o,"top-left":o,"top-right":o,bottom:o,"bottom-left":o,"bottom-right":o,left:o,right:o}}return{center:l.pointGeometry.convert(m.center||[0,0]),top:l.pointGeometry.convert(m.top||[0,0]),"top-left":l.pointGeometry.convert(m["top-left"]||[0,0]),"top-right":l.pointGeometry.convert(m["top-right"]||[0,0]),bottom:l.pointGeometry.convert(m.bottom||[0,0]),"bottom-left":l.pointGeometry.convert(m["bottom-left"]||[0,0]),"bottom-right":l.pointGeometry.convert(m["bottom-right"]||[0,0]),left:l.pointGeometry.convert(m.left||[0,0]),right:l.pointGeometry.convert(m.right||[0,0])}}return _h(new l.pointGeometry(0,0))}const Mo={supported:y,setRTLTextPlugin:l.setRTLTextPlugin,getRTLTextPluginStatus:l.getRTLTextPluginStatus,Map:class extends An{constructor(m){var o;if(l.PerformanceUtils.mark(l.PerformanceMarkers.create),(m=l.extend({},Bf,m)).minZoom!=null&&m.maxZoom!=null&&m.minZoom>m.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(m.minPitch!=null&&m.maxPitch!=null&&m.minPitch>m.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(m.minPitch!=null&&m.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(m.maxPitch!=null&&m.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new hl(m.minZoom,m.maxZoom,m.minPitch,m.maxPitch,m.renderWorldCopies),{bearingSnap:m.bearingSnap}),this._interactive=m.interactive,this._cooperativeGestures=m.cooperativeGestures,this._maxTileCacheSize=m.maxTileCacheSize,this._failIfMajorPerformanceCaveat=m.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=m.preserveDrawingBuffer,this._antialias=m.antialias,this._trackResize=m.trackResize,this._bearingSnap=m.bearingSnap,this._refreshExpiredTiles=m.refreshExpiredTiles,this._fadeDuration=m.fadeDuration,this._crossSourceCollisions=m.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=m.collectResourceTiming,this._renderTaskQueue=new Ff,this._controls=[],this._mapId=l.uniqueId(),this._locale=l.extend({},Nf,m.locale),this._clickTolerance=m.clickTolerance,this._pixelRatio=(o=m.pixelRatio)!==null&&o!==void 0?o:devicePixelRatio,this._requestManager=new D(m.transformRequest),typeof m.container=="string"){if(this._container=document.getElementById(m.container),!this._container)throw new Error(`Container '${m.container}' not found.`)}else{if(!(m.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=m.container}if(m.maxBounds&&this.setMaxBounds(m.maxBounds),l.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),typeof window<"u"&&(addEventListener("online",this._onWindowOnline,!1),addEventListener("resize",this._onWindowResize,!1),addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new Of(this,m),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=m.hash&&new Sf(typeof m.hash=="string"&&m.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch}),m.bounds&&(this.resize(),this.fitBounds(m.bounds,l.extend({},m.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=m.localIdeographFontFamily,m.style&&this.setStyle(m.style,{localIdeographFontFamily:m.localIdeographFontFamily}),m.attributionControl&&this.addControl(new vl({customAttribution:m.customAttribution})),m.maplibreLogo&&this.addControl(new vc,m.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",h=>{this._update(h.dataType==="style"),this.fire(new l.Event(`${h.dataType}data`,h))}),this.on("dataloading",h=>{this.fire(new l.Event(`${h.dataType}dataloading`,h))}),this.on("dataabort",h=>{this.fire(new l.Event("sourcedataabort",h))})}_getMapId(){return this._mapId}addControl(m,o){if(o===void 0&&(o=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new l.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const h=m.onAdd(this);this._controls.push(m);const p=this._controlPositions[o];return o.indexOf("bottom")!==-1?p.insertBefore(h,p.firstChild):p.appendChild(h),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new l.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const o=this._controls.indexOf(m);return o>-1&&this._controls.splice(o,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}calculateCameraOptionsFromTo(m,o,h,p){return p==null&&this.style.terrain&&(p=this.transform.getElevation(h,this.style.terrain)),super.calculateCameraOptionsFromTo(m,o,h,p)}resize(m){const o=this._containerDimensions(),h=o[0],p=o[1];this._resizeCanvas(h,p,this.getPixelRatio()),this.transform.resize(h,p),this.painter.resize(h,p,this.getPixelRatio());const _=!this._moving;return _&&(this.stop(),this.fire(new l.Event("movestart",m)).fire(new l.Event("move",m))),this.fire(new l.Event("resize",m)),_&&this.fire(new l.Event("moveend",m)),this}getPixelRatio(){return this._pixelRatio}setPixelRatio(m){const[o,h]=this._containerDimensions();this._pixelRatio=m,this._resizeCanvas(o,h,m),this.painter.resize(o,h,m)}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(m){return this.transform.setMaxBounds(l.LngLatBounds.convert(m)),this._update()}setMinZoom(m){if((m=m??-2)>=-2&&m<=this.transform.maxZoom)return this.transform.minZoom=m,this._update(),this.getZoom()<m&&this.setZoom(m),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=m??22)>=this.transform.minZoom)return this.transform.maxZoom=m,this._update(),this.getZoom()>m&&this.setZoom(m),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=m??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.minPitch=m,this._update(),this.getPitch()<m&&this.setPitch(m),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=m??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(m>=this.transform.minPitch)return this.transform.maxPitch=m,this._update(),this.getPitch()>m&&this.setPitch(m),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.renderWorldCopies=m,this._update()}project(m){return this.transform.locationPoint(l.LngLat.convert(m),this.style&&this.style.terrain)}unproject(m){return this.transform.pointLocation(l.pointGeometry.convert(m),this.style&&this.style.terrain)}isMoving(){return this._moving||this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers.isRotating()}_createDelegatedListener(m,o,h){if(m==="mouseenter"||m==="mouseover"){let p=!1;return{layer:o,listener:h,delegates:{mousemove:x=>{const E=this.getLayer(o)?this.queryRenderedFeatures(x.point,{layers:[o]}):[];E.length?p||(p=!0,h.call(this,new fr(m,this,x.originalEvent,{features:E}))):p=!1},mouseout:()=>{p=!1}}}}if(m==="mouseleave"||m==="mouseout"){let p=!1;return{layer:o,listener:h,delegates:{mousemove:E=>{(this.getLayer(o)?this.queryRenderedFeatures(E.point,{layers:[o]}):[]).length?p=!0:p&&(p=!1,h.call(this,new fr(m,this,E.originalEvent)))},mouseout:E=>{p&&(p=!1,h.call(this,new fr(m,this,E.originalEvent)))}}}}{const p=_=>{const x=this.getLayer(o)?this.queryRenderedFeatures(_.point,{layers:[o]}):[];x.length&&(_.features=x,h.call(this,_),delete _.features)};return{layer:o,listener:h,delegates:{[m]:p}}}}on(m,o,h){if(h===void 0)return super.on(m,o);const p=this._createDelegatedListener(m,o,h);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(p);for(const _ in p.delegates)this.on(_,p.delegates[_]);return this}once(m,o,h){if(h===void 0)return super.once(m,o);const p=this._createDelegatedListener(m,o,h);for(const _ in p.delegates)this.once(_,p.delegates[_]);return this}off(m,o,h){return h===void 0?super.off(m,o):(this._delegatedListeners&&this._delegatedListeners[m]&&(p=>{const _=this._delegatedListeners[m];for(let x=0;x<_.length;x++){const E=_[x];if(E.layer===o&&E.listener===h){for(const I in E.delegates)this.off(I,E.delegates[I]);return _.splice(x,1),this}}})(),this)}queryRenderedFeatures(m,o){if(!this.style)return[];let h;if(o!==void 0||m===void 0||m instanceof l.pointGeometry||Array.isArray(m)||(o=m,m=void 0),o=o||{},(m=m||[[0,0],[this.transform.width,this.transform.height]])instanceof l.pointGeometry||typeof m[0]=="number")h=[l.pointGeometry.convert(m)];else{const p=l.pointGeometry.convert(m[0]),_=l.pointGeometry.convert(m[1]);h=[p,new l.pointGeometry(_.x,p.y),_,new l.pointGeometry(p.x,_.y),p]}return this.style.queryRenderedFeatures(h,o,this.transform)}querySourceFeatures(m,o){return this.style.querySourceFeatures(m,o)}setStyle(m,o){return(o=l.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},o)).diff!==!1&&o.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&m?(this._diffStyle(m,o),this):(this._localIdeographFontFamily=o.localIdeographFontFamily,this._updateStyle(m,o))}setTransformRequest(m){return this._requestManager.setTransformRequest(m),this}_getUIString(m){const o=this._locale[m];if(o==null)throw new Error(`Missing UI string '${m}'`);return o}_updateStyle(m,o){return this.style&&(this.style.setEventedParent(null),this.style._remove()),m?(this.style=new ni(this,o||{}),this.style.setEventedParent(this,{style:this.style}),typeof m=="string"?this.style.loadURL(m):this.style.loadJSON(m),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new ni(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(m,o){if(typeof m=="string"){const h=this._requestManager.transformRequest(m,l.ResourceType.Style);l.getJSON(h,(p,_)=>{p?this.fire(new l.ErrorEvent(p)):_&&this._updateDiff(_,o)})}else typeof m=="object"&&this._updateDiff(m,o)}_updateDiff(m,o){try{this.style.setState(m)&&this._update(!0)}catch(h){l.warnOnce(`Unable to perform style diff: ${h.message||h.error||h}.  Rebuilding the style from scratch.`),this._updateStyle(m,o)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():l.warnOnce("There is no style added to the map.")}addSource(m,o){return this._lazyInitEmptyStyle(),this.style.addSource(m,o),this._update(!0)}isSourceLoaded(m){const o=this.style&&this.style.sourceCaches[m];if(o!==void 0)return o.loaded();this.fire(new l.ErrorEvent(new Error(`There is no source with ID '${m}'`)))}setTerrain(m){return this.style.setTerrain(m),this}getTerrain(){return this.style.terrain&&this.style.terrain.options}areTilesLoaded(){const m=this.style&&this.style.sourceCaches;for(const o in m){const h=m[o]._tiles;for(const p in h){const _=h[p];if(_.state!=="loaded"&&_.state!=="errored")return!1}}return!0}addSourceType(m,o,h){return this._lazyInitEmptyStyle(),this.style.addSourceType(m,o,h)}removeSource(m){return this.style.removeSource(m),this._update(!0)}getSource(m){return this.style.getSource(m)}addImage(m,o,{pixelRatio:h=1,sdf:p=!1,stretchX:_,stretchY:x,content:E}={}){if(this._lazyInitEmptyStyle(),o instanceof HTMLImageElement||l.isImageBitmap(o)){const{width:I,height:M,data:k}=l.exported.getImageData(o);this.style.addImage(m,{data:new l.RGBAImage({width:I,height:M},k),pixelRatio:h,stretchX:_,stretchY:x,content:E,sdf:p,version:0})}else{if(o.width===void 0||o.height===void 0)return this.fire(new l.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:I,height:M,data:k}=o,O=o;this.style.addImage(m,{data:new l.RGBAImage({width:I,height:M},new Uint8Array(k)),pixelRatio:h,stretchX:_,stretchY:x,content:E,sdf:p,version:0,userImage:O}),O.onAdd&&O.onAdd(this,m)}}}updateImage(m,o){const h=this.style.getImage(m);if(!h)return this.fire(new l.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const p=o instanceof HTMLImageElement||l.isImageBitmap(o)?l.exported.getImageData(o):o,{width:_,height:x,data:E}=p;if(_===void 0||x===void 0)return this.fire(new l.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(_!==h.data.width||x!==h.data.height)return this.fire(new l.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image")));const I=!(o instanceof HTMLImageElement||l.isImageBitmap(o));h.data.replace(E,I),this.style.updateImage(m,h)}hasImage(m){return m?!!this.style.getImage(m):(this.fire(new l.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(m)}loadImage(m,o){l.getImage(this._requestManager.transformRequest(m,l.ResourceType.Image),o)}listImages(){return this.style.listImages()}addLayer(m,o){return this._lazyInitEmptyStyle(),this.style.addLayer(m,o),this._update(!0)}moveLayer(m,o){return this.style.moveLayer(m,o),this._update(!0)}removeLayer(m){return this.style.removeLayer(m),this._update(!0)}getLayer(m){return this.style.getLayer(m)}setLayerZoomRange(m,o,h){return this.style.setLayerZoomRange(m,o,h),this._update(!0)}setFilter(m,o,h={}){return this.style.setFilter(m,o,h),this._update(!0)}getFilter(m){return this.style.getFilter(m)}setPaintProperty(m,o,h,p={}){return this.style.setPaintProperty(m,o,h,p),this._update(!0)}getPaintProperty(m,o){return this.style.getPaintProperty(m,o)}setLayoutProperty(m,o,h,p={}){return this.style.setLayoutProperty(m,o,h,p),this._update(!0)}getLayoutProperty(m,o){return this.style.getLayoutProperty(m,o)}setLight(m,o={}){return this._lazyInitEmptyStyle(),this.style.setLight(m,o),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(m,o){return this.style.setFeatureState(m,o),this._update()}removeFeatureState(m,o){return this.style.removeFeatureState(m,o),this._update()}getFeatureState(m){return this.style.getFeatureState(m)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let m=0,o=0;return this._container&&(m=this._container.clientWidth||400,o=this._container.clientHeight||300),[m,o]}_setupContainer(){const m=this._container;m.classList.add("maplibregl-map","mapboxgl-map");const o=this._canvasContainer=P.create("div","maplibregl-canvas-container mapboxgl-canvas-container",m);this._interactive&&o.classList.add("maplibregl-interactive","mapboxgl-interactive"),this._canvas=P.create("canvas","maplibregl-canvas mapboxgl-canvas",o),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const h=this._containerDimensions();this._resizeCanvas(h[0],h[1],this.getPixelRatio());const p=this._controlContainer=P.create("div","maplibregl-control-container mapboxgl-control-container",m),_=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(x=>{_[x]=P.create("div",`maplibregl-ctrl-${x} mapboxgl-ctrl-${x}`,p)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){const m=this._container;this._metaPress=!1,this._cooperativeGesturesScreen=P.create("div","maplibregl-cooperative-gesture-screen",m);let o="Control",h=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(h=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use  + scroll to zoom the map",o="Meta"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${h}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,document.addEventListener("keydown",p=>{p.key===o&&(this._metaPress=!0)}),document.addEventListener("keyup",p=>{p.key===o&&(this._metaPress=!1)}),this._canvasContainer.addEventListener("wheel",p=>{this._onCooperativeGesture(p,this._metaPress,1)},!1),this._canvasContainer.classList.remove("mapboxgl-touch-drag-pan","maplibregl-touch-drag-pan")}_resizeCanvas(m,o,h){this._canvas.width=h*m,this._canvas.height=h*o,this._canvas.style.width=`${m}px`,this._canvas.style.height=`${o}px`}_setupPainter(){const m=l.extend({},y.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),o=this._canvas.getContext("webgl",m)||this._canvas.getContext("experimental-webgl",m);o?(this.painter=new oh(o,this.transform),l.exported$1.testSupport(o)):this.fire(new l.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(m){m.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new l.Event("webglcontextlost",{originalEvent:m}))}_contextRestored(m){this._setupPainter(),this.resize(),this._update(),this.fire(new l.Event("webglcontextrestored",{originalEvent:m}))}_onMapScroll(m){if(m.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}_onCooperativeGesture(m,o,h){return!o&&h<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(m){return this.style?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_render(m){let o,h=0;const p=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(o=p.createQueryEXT(),p.beginQueryEXT(p.TIME_ELAPSED_EXT,o),h=l.exported.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(m),this._removed)return;let _=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const E=this.transform.zoom,I=l.exported.now();this.style.zoomHistory.update(E,I);const M=new l.EvaluationParameters(E,{now:I,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),k=M.crossFadingFactor();k===1&&k===this._crossFadingFactor||(_=!0,this._crossFadingFactor=k),this.style.update(M)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.style.terrain&&this.style.terrain.sourceCache.update(this.transform,this.style.terrain),this.transform.updateElevation(this.style.terrain),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new l.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,l.PerformanceUtils.mark(l.PerformanceMarkers.load),this.fire(new l.Event("load"))),this.style&&(this.style.hasTransitions()||_)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const E=l.exported.now()-h;p.endQueryEXT(p.TIME_ELAPSED_EXT,o),setTimeout(()=>{const I=p.getQueryObjectEXT(o,p.QUERY_RESULT_EXT)/1e6;p.deleteQueryEXT(o),this.fire(new l.Event("gpu-timing-frame",{cpuTime:E,gpuTime:I}))},50)}if(this.listens("gpu-timing-layer")){const E=this.painter.collectGpuTimers();setTimeout(()=>{const I=this.painter.queryGpuTimers(E);this.fire(new l.Event("gpu-timing-layer",{layerTimes:I}))},50)}const x=this._sourcesDirty||this._styleDirty||this._placementDirty;return x||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new l.Event("idle")),!this._loaded||this._fullyLoaded||x||(this._fullyLoaded=!0,l.PerformanceUtils.mark(l.PerformanceMarkers.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){this._hash&&this._hash.remove();for(const o of this._controls)o.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&(removeEventListener("resize",this._onWindowResize,!1),removeEventListener("orientationchange",this._onWindowResize,!1),removeEventListener("online",this._onWindowOnline,!1));const m=this.painter.context.gl.getExtension("WEBGL_lose_context");m&&m.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),P.remove(this._canvasContainer),P.remove(this._controlContainer),this._cooperativeGestures&&P.remove(this._cooperativeGesturesScreen),this._container.classList.remove("maplibregl-map","mapboxgl-map"),l.PerformanceUtils.clearMetrics(),this._removed=!0,this.fire(new l.Event("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=l.exported.frame(m=>{l.PerformanceUtils.frame(m),this._frame=null,this._render(m)}))}_onWindowOnline(){this._update()}_onWindowResize(m){this._trackResize&&this.resize({originalEvent:m})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}_setCacheLimits(m,o){l.setCacheLimits(m,o)}get version(){return"2.4.0"}},NavigationControl:class{constructor(m){this.options=l.extend({},Yg,m),this._container=P.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",o=>o.preventDefault()),this.options.showZoom&&(l.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in mapboxgl-ctrl-zoom-in",o=>this._map.zoomIn({},{originalEvent:o})),P.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out mapboxgl-ctrl-zoom-out",o=>this._map.zoomOut({},{originalEvent:o})),P.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(l.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("maplibregl-ctrl-compass mapboxgl-ctrl-compass",o=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:o}):this._map.resetNorth({},{originalEvent:o})}),this._compassIcon=P.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const m=this._map.getZoom(),o=m===this._map.getMaxZoom(),h=m===this._map.getMinZoom();this._zoomInButton.disabled=o,this._zoomOutButton.disabled=h,this._zoomInButton.setAttribute("aria-disabled",o.toString()),this._zoomOutButton.setAttribute("aria-disabled",h.toString())}_rotateCompassArrow(){const m=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=m}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new ms(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){P.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(m,o){const h=P.create("button",m,this._container);return h.type="button",h.addEventListener("click",o),h}_setButtonTitle(m,o){const h=this._map._getUIString(`NavigationControl.${o}`);m.title=h,m.setAttribute("aria-label",h)}},GeolocateControl:class extends l.Evented{constructor(m){super(),this.options=l.extend({},gh,m),l.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}onAdd(m){var o;return this._map=m,this._container=P.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),o=this._setupUI,ro!==void 0?o(ro):window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(h=>{ro=h.state!=="denied",o(ro)}):(ro=!!window.navigator.geolocation,o(ro)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),P.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,xi=0,so=!1}_isOutOfMapMaxBounds(m){const o=this._map.getMaxBounds(),h=m.coords;return o&&(h.longitude<o.getWest()||h.longitude>o.getEast()||h.latitude<o.getSouth()||h.latitude>o.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_onSuccess(m){if(this._map){if(this._isOutOfMapMaxBounds(m))return this._setErrorState(),this.fire(new l.Event("outofmaxbounds",m)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=m,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(m),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(m),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new l.Event("geolocate",m)),this._finish()}}_updateCamera(m){const o=new l.LngLat(m.coords.longitude,m.coords.latitude),h=m.coords.accuracy,p=this._map.getBearing(),_=l.extend({bearing:p},this.options.fitBoundsOptions);this._map.fitBounds(o.toBounds(h),_,{geolocateSource:!0})}_updateMarker(m){if(m){const o=new l.LngLat(m.coords.longitude,m.coords.latitude);this._accuracyCircleMarker.setLngLat(o).addTo(this._map),this._userLocationDotMarker.setLngLat(o).addTo(this._map),this._accuracy=m.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const m=this._map._container.clientHeight/2,o=this._map.unproject([0,m]),h=this._map.unproject([1,m]),p=o.distanceTo(h),_=Math.ceil(2*this._accuracy/p);this._circleElement.style.width=`${_}px`,this._circleElement.style.height=`${_}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_onError(m){if(this._map){if(this.options.trackUserLocation)if(m.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(m.code===3&&so)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new l.Event("error",m)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(m){if(this._container.addEventListener("contextmenu",o=>o.preventDefault()),this._geolocateButton=P.create("button","maplibregl-ctrl-geolocate mapboxgl-ctrl-geolocate",this._container),P.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",m===!1){l.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o)}else{const o=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=P.create("div","maplibregl-user-location-dot mapboxgl-user-location-dot"),this._userLocationDotMarker=new _a(this._dotElement),this._circleElement=P.create("div","maplibregl-user-location-accuracy-circle mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new _a({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",o=>{o.geolocateSource||this._watchState!=="ACTIVE_LOCK"||o.originalEvent&&o.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this.fire(new l.Event("trackuserlocationend")))})}trigger(){if(!this._setup)return l.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new l.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":xi--,so=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this.fire(new l.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new l.Event("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let m;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),xi++,xi>1?(m={maximumAge:6e5,timeout:0},so=!0):(m=this.options.positionOptions,so=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,m)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:vl,LogoControl:vc,ScaleControl:class{constructor(m){this.options=l.extend({},gs,m),l.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){Uf(this._map,this._container,this.options)}onAdd(m){return this._map=m,this._container=P.create("div","maplibregl-ctrl maplibregl-ctrl-scale mapboxgl-ctrl mapboxgl-ctrl-scale",m.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){P.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}setUnit(m){this.options.unit=m,Uf(this._map,this._container,this.options)}},FullscreenControl:class{constructor(m){this._fullscreen=!1,m&&m.container&&(m.container instanceof HTMLElement?this._container=m.container:l.warnOnce("Full screen control 'container' must be a DOM element.")),l.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=P.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",l.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){P.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!!(document.fullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled||document.webkitFullscreenEnabled)}_setupUI(){const m=this._fullscreenButton=P.create("button","maplibregl-ctrl-fullscreen mapboxgl-ctrl-fullscreen",this._controlContainer);P.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",m).setAttribute("aria-hidden","true"),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.title=m}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen&&window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},TerrainControl:class{constructor(m){this.options=m,l.bindAll(["_toggleTerrain","_updateTerrainIcon"],this)}onAdd(m){return this._map=m,this._container=P.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._terrainButton=P.create("button","maplibregl-ctrl-terrain mapboxgl-ctrl-terrain",this._container),P.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){P.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}_toggleTerrain(){this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()}_updateTerrainIcon(){this._terrainButton.classList.remove("maplibregl-ctrl-terrain","mapboxgl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled","mapboxgl-ctrl-terrain-enabled"),this._map.style.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled","mapboxgl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain","mapboxgl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))}},Popup:class extends l.Evented{constructor(m){super(),this.options=l.extend(Object.create(Fn),m),l.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new l.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&P.remove(this._content),this._container&&(P.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new l.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(m){return this._lngLat=l.LngLat.convert(m),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer","mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(document.createTextNode(m))}setHTML(m){const o=document.createDocumentFragment(),h=document.createElement("body");let p;for(h.innerHTML=m;p=h.firstChild,p;)o.appendChild(p);return this.setDOMContent(o)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=P.create("div","maplibregl-popup-content mapboxgl-popup-content",this._container);return this._content.appendChild(m),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(m){this._container&&this._container.classList.add(m)}removeClassName(m){this._container&&this._container.classList.remove(m)}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){if(this._container)return this._container.classList.toggle(m)}_createCloseButton(){this.options.closeButton&&(this._closeButton=P.create("button","maplibregl-popup-close-button mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(m){this._update(m.point)}_onMouseMove(m){this._update(m.point)}_onDrag(m){this._update(m.point)}_update(m){if(!this._map||!this._lngLat&&!this._trackPointer||!this._content||(this._container||(this._container=P.create("div","maplibregl-popup mapboxgl-popup",this._map.getContainer()),this._tip=P.create("div","maplibregl-popup-tip mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(x=>this._container.classList.add(x)),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=xl(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!m))return;const o=this._pos=this._trackPointer&&m?m:this._map.project(this._lngLat);let h=this.options.anchor;const p=_h(this.options.offset);if(!h){const x=this._container.offsetWidth,E=this._container.offsetHeight;let I;I=o.y+p.bottom.y<E?["top"]:o.y>this._map.transform.height-E?["bottom"]:[],o.x<x/2?I.push("left"):o.x>this._map.transform.width-x/2&&I.push("right"),h=I.length===0?"bottom":I.join("-")}const _=o.add(p[h]).round();P.setTransform(this._container,`${mt[h]} translate(${_.x}px,${_.y}px)`),St(this._container,h,"popup")}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const m=this._container.querySelector(Xn);m&&m.focus()}_onClose(){this.remove()}},Marker:_a,Style:ni,LngLat:l.LngLat,LngLatBounds:l.LngLatBounds,Point:l.pointGeometry,MercatorCoordinate:l.MercatorCoordinate,Evented:l.Evented,AJAXError:l.AJAXError,config:l.config,CanvasSource:an,GeoJSONSource:Si,ImageSource:At,RasterDEMTileSource:Tt,RasterTileSource:Bt,VectorTileSource:Qt,VideoSource:Ct,prewarm:function(){yi().acquire(Oi)},clearPrewarmedResources:function(){const m=qi;m&&(m.isPreloaded()&&m.numActive()===1?(m.release(Oi),qi=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get version(){return"2.4.0"},get workerCount(){return ei.workerCount},set workerCount(m){ei.workerCount=m},get maxParallelImageRequests(){return l.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(m){l.config.MAX_PARALLEL_IMAGE_REQUESTS=m},clearStorage(m){l.clearTileCache(m)},workerUrl:"",addProtocol(m,o){l.config.REGISTERED_PROTOCOLS[m]=o},removeProtocol(m){delete l.config.REGISTERED_PROTOCOLS[m]}};return Ir.extend(Mo,{isSafari:l.isSafari,getPerformanceMetrics:l.PerformanceUtils.getPerformanceMetrics}),Mo});var d=s;return d})})(kA);var z3=kA.exports;const O3=sg(z3);function Od(t){"@babel/helpers - typeof";return Od=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Od(t)}function F3(t,e){if(Od(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var i=n.call(t,e||"default");if(Od(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function N3(t){var e=F3(t,"string");return Od(e)=="symbol"?e:String(e)}function $(t,e,n){return e=N3(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function jm(t,e){if(!t)throw new Error(e||"loader assertion failed.")}const px=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),Fw=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);Fw&&parseFloat(Fw[1]);const B3="3.4.14";function Jo(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}const cm=typeof process!="object"||String(process)!=="[object process]"||process.browser,U3=typeof window<"u"&&typeof window.orientation<"u",Nw=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);Nw&&parseFloat(Nw[1]);class V3{constructor(e,n){$(this,"name",void 0),$(this,"workerThread",void 0),$(this,"isRunning",!0),$(this,"result",void 0),$(this,"_resolve",()=>{}),$(this,"_reject",()=>{}),this.name=e,this.workerThread=n,this.result=new Promise((i,s)=>{this._resolve=i,this._reject=s})}postMessage(e,n){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:n})}done(e){Jo(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){Jo(this.isRunning),this.isRunning=!1,this._reject(e)}}let ly=class{terminate(){}};const cy=new Map;function j3(t){Jo(t.source&&!t.url||!t.source&&t.url);let e=cy.get(t.source||t.url);return e||(t.url&&(e=G3(t.url),cy.set(t.url,e)),t.source&&(e=DA(t.source),cy.set(t.source,e))),Jo(e),e}function G3(t){if(!t.startsWith("http"))return t;const e=W3(t);return DA(e)}function DA(t){const e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function W3(t){return`try {
  importScripts('`.concat(t,`');
} catch (error) {
  console.error(error);
  throw error;
}`)}function zA(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,n=arguments.length>2?arguments[2]:void 0;const i=n||new Set;if(t){if(Bw(t))i.add(t);else if(Bw(t.buffer))i.add(t.buffer);else if(!ArrayBuffer.isView(t)){if(e&&typeof t=="object")for(const s in t)zA(t[s],e,i)}}return n===void 0?Array.from(i):[]}function Bw(t){return t?t instanceof ArrayBuffer||typeof MessagePort<"u"&&t instanceof MessagePort||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas:!1}const uy=()=>{};class F0{static isSupported(){return typeof Worker<"u"&&cm||typeof ly<"u"&&!cm}constructor(e){$(this,"name",void 0),$(this,"source",void 0),$(this,"url",void 0),$(this,"terminated",!1),$(this,"worker",void 0),$(this,"onMessage",void 0),$(this,"onError",void 0),$(this,"_loadableURL","");const{name:n,source:i,url:s}=e;Jo(i||s),this.name=n,this.source=i,this.url=s,this.onMessage=uy,this.onError=c=>console.log(c),this.worker=cm?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=uy,this.onError=uy,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,n){n=n||zA(e),this.worker.postMessage(e,n)}_getErrorFromErrorEvent(e){let n="Failed to load ";return n+="worker ".concat(this.name," from ").concat(this.url,". "),e.message&&(n+="".concat(e.message," in ")),e.lineno&&(n+=":".concat(e.lineno,":").concat(e.colno)),new Error(n)}_createBrowserWorker(){this._loadableURL=j3({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=n=>{n.data?this.onMessage(n.data):this.onError(new Error("No data received"))},e.onerror=n=>{this.onError(this._getErrorFromErrorEvent(n)),this.terminated=!0},e.onmessageerror=n=>console.error(n),e}_createNodeWorker(){let e;if(this.url){const i=this.url.includes(":/")||this.url.startsWith("/")?this.url:"./".concat(this.url);e=new ly(i,{eval:!1})}else if(this.source)e=new ly(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",n=>{this.onMessage(n)}),e.on("error",n=>{this.onError(n)}),e.on("exit",n=>{}),e}}class H3{static isSupported(){return F0.isSupported()}constructor(e){$(this,"name","unnamed"),$(this,"source",void 0),$(this,"url",void 0),$(this,"maxConcurrency",1),$(this,"maxMobileConcurrency",1),$(this,"onDebug",()=>{}),$(this,"reuseWorkers",!0),$(this,"props",{}),$(this,"jobQueue",[]),$(this,"idleQueue",[]),$(this,"count",0),$(this,"isDestroyed",!1),this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:(c,d,l)=>c.done(l),i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:(c,d)=>c.error(d);const s=new Promise(c=>(this.jobQueue.push({name:e,onMessage:n,onError:i,onStart:c}),this));return this._startQueuedJob(),await s}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const n=this.jobQueue.shift();if(n){this.onDebug({message:"Starting job",name:n.name,workerThread:e,backlog:this.jobQueue.length});const i=new V3(n.name,e);e.onMessage=s=>n.onMessage(i,s.type,s.payload),e.onError=s=>n.onError(i,s),n.onStart(i);try{await i.result}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e="".concat(this.name.toLowerCase()," (#").concat(this.count," of ").concat(this.maxConcurrency,")");return new F0({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return U3?this.maxMobileConcurrency:this.maxConcurrency}}const $3={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class Wo{static isSupported(){return F0.isSupported()}static getWorkerFarm(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Wo._workerFarm=Wo._workerFarm||new Wo({}),Wo._workerFarm.setProps(e),Wo._workerFarm}constructor(e){$(this,"props",void 0),$(this,"workerPools",new Map),this.props={...$3},this.setProps(e),this.workerPools=new Map}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const n of this.workerPools.values())n.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:n,source:i,url:s}=e;let c=this.workerPools.get(n);return c||(c=new H3({name:n,source:i,url:s}),c.setProps(this._getWorkerPoolProps()),this.workerPools.set(n,c)),c}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}$(Wo,"_workerFarm",void 0);const q3="latest";function Z3(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=e[t.id]||{},i="".concat(t.id,"-worker.js");let s=n.workerUrl;if(!s&&t.id==="compression"&&(s=e.workerUrl),e._workerType==="test"&&(s="modules/".concat(t.module,"/dist/").concat(i)),!s){let c=t.version;c==="latest"&&(c=q3);const d=c?"@".concat(c):"";s="https://unpkg.com/@loaders.gl/".concat(t.module).concat(d,"/dist/").concat(i)}return Jo(s),s}function X3(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:B3;Jo(t,"no worker provided");const n=t.version;return!(!e||!n)}function Y3(t,e){return!Wo.isSupported()||!cm&&!(e!=null&&e._nodeWorkers)?!1:t.worker&&(e==null?void 0:e.worker)}async function K3(t,e,n,i,s){const c=t.id,d=Z3(t,n),y=Wo.getWorkerFarm(n).getWorkerPool({name:c,url:d});n=JSON.parse(JSON.stringify(n)),i=JSON.parse(JSON.stringify(i||{}));const w=await y.startJob("process-on-worker",J3.bind(null,s));return w.postMessage("process",{input:e,options:n,context:i}),await(await w.result).result}async function J3(t,e,n,i){switch(n){case"done":e.done(i);break;case"error":e.error(new Error(i.error));break;case"process":const{id:s,input:c,options:d}=i;try{const l=await t(c,d);e.postMessage("done",{id:s,result:l})}catch(l){const y=l instanceof Error?l.message:"unknown error";e.postMessage("error",{id:s,error:y})}break;default:console.warn("parse-with-worker unknown message ".concat(n))}}function Q3(t,e,n){if(n=n||t.byteLength,t.byteLength<n||e.byteLength<n)return!1;const i=new Uint8Array(t),s=new Uint8Array(e);for(let c=0;c<i.length;++c)if(i[c]!==s[c])return!1;return!0}function eR(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const i=e.map(l=>l instanceof ArrayBuffer?new Uint8Array(l):l),s=i.reduce((l,y)=>l+y.byteLength,0),c=new Uint8Array(s);let d=0;for(const l of i)c.set(l,d),d+=l.byteLength;return c.buffer}async function tR(t){const e=[];for await(const n of t)e.push(n);return eR(...e)}let nR="";const Uw={};function iR(t){for(const e in Uw)if(t.startsWith(e)){const n=Uw[e];t=t.replace(e,n)}return!t.startsWith("http://")&&!t.startsWith("https://")&&(t="".concat(nR).concat(t)),t}function rR(t){return t&&typeof t=="object"&&t.isBuffer}function OA(t){if(rR(t))return t;if(t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.byteOffset===0&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if(typeof t=="string"){const e=t;return new TextEncoder().encode(e).buffer}if(t&&typeof t=="object"&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}function FA(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(e+1):""}function sR(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(0,e):""}const oR=t=>typeof t=="boolean",gd=t=>typeof t=="function",Jd=t=>t!==null&&typeof t=="object",Vw=t=>Jd(t)&&t.constructor==={}.constructor,aR=t=>t&&typeof t[Symbol.iterator]=="function",lR=t=>t&&typeof t[Symbol.asyncIterator]=="function",tc=t=>typeof Response<"u"&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json,nc=t=>typeof Blob<"u"&&t instanceof Blob,cR=t=>t&&typeof t=="object"&&t.isBuffer,uR=t=>typeof ReadableStream<"u"&&t instanceof ReadableStream||Jd(t)&&gd(t.tee)&&gd(t.cancel)&&gd(t.getReader),hR=t=>Jd(t)&&gd(t.read)&&gd(t.pipe)&&oR(t.readable),NA=t=>uR(t)||hR(t),dR=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,fR=/^([-\w.]+\/[-\w.+]+)/;function pR(t){const e=fR.exec(t);return e?e[1]:t}function jw(t){const e=dR.exec(t);return e?e[1]:""}const BA=/\?.*/;function mR(t){const e=t.match(BA);return e&&e[0]}function mx(t){return t.replace(BA,"")}function wg(t){return tc(t)?t.url:nc(t)?t.name||"":typeof t=="string"?t:""}function gx(t){if(tc(t)){const e=t,n=e.headers.get("content-type")||"",i=mx(e.url);return pR(n)||jw(i)}return nc(t)?t.type||"":typeof t=="string"?jw(t):""}function gR(t){return tc(t)?t.headers["content-length"]||-1:nc(t)?t.size:typeof t=="string"?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}async function UA(t){if(tc(t))return t;const e={},n=gR(t);n>=0&&(e["content-length"]=String(n));const i=wg(t),s=gx(t);s&&(e["content-type"]=s);const c=await vR(t);c&&(e["x-first-bytes"]=c),typeof t=="string"&&(t=new TextEncoder().encode(t));const d=new Response(t,{headers:e});return Object.defineProperty(d,"url",{value:i}),d}async function _R(t){if(!t.ok){const e=await yR(t);throw new Error(e)}}async function yR(t){let e="Failed to fetch resource ".concat(t.url," (").concat(t.status,"): ");try{const n=t.headers.get("Content-Type");let i=t.statusText;n.includes("application/json")&&(i+=" ".concat(await t.text())),e+=i,e=e.length>60?"".concat(e.slice(0,60),"..."):e}catch{}return e}async function vR(t){if(typeof t=="string")return"data:,".concat(t.slice(0,5));if(t instanceof Blob){const n=t.slice(0,5);return await new Promise(i=>{const s=new FileReader;s.onload=c=>{var d;return i(c==null||(d=c.target)===null||d===void 0?void 0:d.result)},s.readAsDataURL(n)})}if(t instanceof ArrayBuffer){const n=t.slice(0,5),i=xR(n);return"data:base64,".concat(i)}return null}function xR(t){let e="";const n=new Uint8Array(t);for(let i=0;i<n.byteLength;i++)e+=String.fromCharCode(n[i]);return btoa(e)}async function Gw(t,e){if(typeof t=="string"){t=iR(t);let n=e;return e!=null&&e.fetch&&typeof(e==null?void 0:e.fetch)!="function"&&(n=e.fetch),await fetch(t,n)}return await UA(t)}function bR(t){if(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron)return!0;const e=typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent,n=t||e;return!!(n&&n.indexOf("Electron")>=0)}function Qd(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process.browser)||bR()}const Pp=globalThis.window||globalThis.self||globalThis.global,Hh=globalThis.process||{},VA=typeof __VERSION__<"u"?__VERSION__:"untranspiled source";Qd();function wR(t){try{const e=window[t],n="__storage_test__";return e.setItem(n,n),e.removeItem(n),e}catch{return null}}let ER=class{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";this.storage=void 0,this.id=void 0,this.config=void 0,this.storage=wR(i),this.id=e,this.config=n,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const n=JSON.stringify(this.config);this.storage.setItem(this.id,n)}}_loadConfiguration(){let e={};if(this.storage){const n=this.storage.getItem(this.id);e=n?JSON.parse(n):{}}return Object.assign(this.config,e),this}};function TR(t){let e;return t<10?e="".concat(t.toFixed(2),"ms"):t<100?e="".concat(t.toFixed(1),"ms"):t<1e3?e="".concat(t.toFixed(0),"ms"):e="".concat((t/1e3).toFixed(2),"s"),e}function SR(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8;const n=Math.max(e-t.length,0);return"".concat(" ".repeat(n)).concat(t)}function hy(t,e,n){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:600;const s=t.src.replace(/\(/g,"%28").replace(/\)/g,"%29");t.width>i&&(n=Math.min(n,i/t.width));const c=t.width*n,d=t.height*n,l=["font-size:1px;","padding:".concat(Math.floor(d/2),"px ").concat(Math.floor(c/2),"px;"),"line-height:".concat(d,"px;"),"background:url(".concat(s,");"),"background-size:".concat(c,"px ").concat(d,"px;"),"color:transparent;"].join("");return["".concat(e," %c+"),l]}let Gm;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(Gm||(Gm={}));const AR=10;function Ww(t){return typeof t!="string"?t:(t=t.toUpperCase(),Gm[t]||Gm.WHITE)}function PR(t,e,n){if(!Qd&&typeof t=="string"){if(e){const i=Ww(e);t="\x1B[".concat(i,"m").concat(t,"\x1B[39m")}if(n){const i=Ww(n);t="\x1B[".concat(i+AR,"m").concat(t,"\x1B[49m")}}return t}function IR(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"];const n=Object.getPrototypeOf(t),i=Object.getOwnPropertyNames(n),s=t;for(const c of i){const d=s[c];typeof d=="function"&&(e.find(l=>c===l)||(s[c]=d.bind(t)))}}function Wm(t,e){if(!t)throw new Error(e||"Assertion failed")}function kc(){let t;if(Qd()&&Pp.performance){var e,n;t=Pp==null||(e=Pp.performance)===null||e===void 0||(n=e.now)===null||n===void 0?void 0:n.call(e)}else if("hrtime"in Hh){var i;const s=Hh==null||(i=Hh.hrtime)===null||i===void 0?void 0:i.call(Hh);t=s[0]*1e3+s[1]/1e6}else t=Date.now();return t}const Rc={debug:Qd()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},CR={enabled:!0,level:0};function ws(){}const Hw={},$w={once:!0};let _x=class{constructor(){let{id:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:""};this.id=void 0,this.VERSION=VA,this._startTs=kc(),this._deltaTs=kc(),this._storage=void 0,this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new ER("__probe-".concat(this.id,"__"),CR),this.timeStamp("".concat(this.id," started")),IR(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((kc()-this._startTs).toPrecision(10))}getDelta(){return Number((kc()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,n){this._storage.setConfiguration({[e]:n})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,n){Wm(e,n)}warn(e){return this._getLogFunction(0,e,Rc.warn,arguments,$w)}error(e){return this._getLogFunction(0,e,Rc.error,arguments)}deprecated(e,n){return this.warn("`".concat(e,"` is deprecated and will be removed in a later version. Use `").concat(n,"` instead"))}removed(e,n){return this.error("`".concat(e,"` has been removed. Use `").concat(n,"` instead"))}probe(e,n){return this._getLogFunction(e,n,Rc.log,arguments,{time:!0,once:!0})}log(e,n){return this._getLogFunction(e,n,Rc.debug,arguments)}info(e,n){return this._getLogFunction(e,n,console.info,arguments)}once(e,n){return this._getLogFunction(e,n,Rc.debug||Rc.info,arguments,$w)}table(e,n,i){return n?this._getLogFunction(e,n,console.table||ws,i&&[i],{tag:RR(n)}):ws}image(e){let{logLevel:n,priority:i,image:s,message:c="",scale:d=1}=e;return this._shouldLog(n||i)?Qd()?kR({image:s,message:c,scale:d}):LR():ws}time(e,n){return this._getLogFunction(e,n,console.time?console.time:console.info)}timeEnd(e,n){return this._getLogFunction(e,n,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,n){return this._getLogFunction(e,n,console.timeStamp||ws)}group(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1};const s=qw({logLevel:e,message:n,opts:i}),{collapsed:c}=i;return s.method=(c?console.groupCollapsed:console.group)||console.info,this._getLogFunction(s)}groupCollapsed(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(e,n,Object.assign({},i,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||ws)}withGroup(e,n,i){this.group(e,n)();try{i()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=jA(e)}_getLogFunction(e,n,i,s,c){if(this._shouldLog(e)){c=qw({logLevel:e,message:n,args:s,opts:c}),i=i||c.method,Wm(i),c.total=this.getTotal(),c.delta=this.getDelta(),this._deltaTs=kc();const d=c.tag||c.message;if(c.once&&d)if(!Hw[d])Hw[d]=kc();else return ws;return n=MR(this.id,c.message,c),i.bind(console,n,...c.args)}return ws}};_x.VERSION=VA;function jA(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return Wm(Number.isFinite(e)&&e>=0),e}function qw(t){const{logLevel:e,message:n}=t;t.logLevel=jA(e);const i=t.args?Array.from(t.args):[];for(;i.length&&i.shift()!==n;);switch(typeof e){case"string":case"function":n!==void 0&&i.unshift(n),t.message=e;break;case"object":Object.assign(t,e);break}typeof t.message=="function"&&(t.message=t.message());const s=typeof t.message;return Wm(s==="string"||s==="object"),Object.assign(t,{args:i},t.opts)}function MR(t,e,n){if(typeof e=="string"){const i=n.time?SR(TR(n.total)):"";e=n.time?"".concat(t,": ").concat(i,"  ").concat(e):"".concat(t,": ").concat(e),e=PR(e,n.color,n.background)}return e}function LR(t){return console.warn("removed"),ws}function kR(t){let{image:e,message:n="",scale:i=1}=t;if(typeof e=="string"){const c=new Image;return c.onload=()=>{const d=hy(c,n,i);console.log(...d)},c.src=e,ws}const s=e.nodeName||"";if(s.toLowerCase()==="img")return console.log(...hy(e,n,i)),ws;if(s.toLowerCase()==="canvas"){const c=new Image;return c.onload=()=>console.log(...hy(c,n,i)),c.src=e.toDataURL(),ws}return ws}function RR(t){for(const e in t)for(const n in t[e])return n||"untitled";return"empty"}const Zw=new _x({id:"loaders.gl"});class DR{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class zR{constructor(){$(this,"console",void 0),this.console=console}log(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return this.console.log.bind(this.console,...n)}info(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return this.console.info.bind(this.console,...n)}warn(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return this.console.warn.bind(this.console,...n)}error(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return this.console.error.bind(this.console,...n)}}const GA={fetch:null,mimeType:void 0,nothrow:!1,log:new zR,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:px,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},OR={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function WA(){globalThis.loaders=globalThis.loaders||{};const{loaders:t}=globalThis;return t._state=t._state||{},t._state}const HA=()=>{const t=WA();return t.globalOptions=t.globalOptions||{...GA},t.globalOptions};function FR(t,e,n,i){return n=n||[],n=Array.isArray(n)?n:[n],NR(t,n),UR(e,t,i)}function NR(t,e){Xw(t,null,GA,OR,e);for(const n of e){const i=t&&t[n.id]||{},s=n.options&&n.options[n.id]||{},c=n.deprecatedOptions&&n.deprecatedOptions[n.id]||{};Xw(i,n.id,s,c,e)}}function Xw(t,e,n,i,s){const c=e||"Top level",d=e?"".concat(e,"."):"";for(const l in t){const y=!e&&Jd(t[l]),w=l==="baseUri"&&!e,S=l==="workerUrl"&&e;if(!(l in n)&&!w&&!S){if(l in i)Zw.warn("".concat(c," loader option '").concat(d).concat(l,"' no longer supported, use '").concat(i[l],"'"))();else if(!y){const C=BR(l,s);Zw.warn("".concat(c," loader option '").concat(d).concat(l,"' not recognized. ").concat(C))()}}}}function BR(t,e){const n=t.toLowerCase();let i="";for(const s of e)for(const c in s.options){if(t===c)return"Did you mean '".concat(s.id,".").concat(c,"'?");const d=c.toLowerCase();(n.startsWith(d)||d.startsWith(n))&&(i=i||"Did you mean '".concat(s.id,".").concat(c,"'?"))}return i}function UR(t,e,n){const s={...t.options||{}};return VR(s,n),s.log===null&&(s.log=new DR),Yw(s,HA()),Yw(s,e),s}function Yw(t,e){for(const n in e)if(n in e){const i=e[n];Vw(i)&&Vw(t[n])?t[n]={...t[n],...e[n]}:t[n]=e[n]}}function VR(t,e){e&&!("baseUri"in t)&&(t.baseUri=e)}function yx(t){var e;return t?(Array.isArray(t)&&(t=t[0]),Array.isArray((e=t)===null||e===void 0?void 0:e.extensions)):!1}function vx(t){var e,n;jm(t,"null loader"),jm(yx(t),"invalid loader");let i;return Array.isArray(t)&&(i=t[1],t=t[0],t={...t,options:{...t.options,...i}}),((e=t)!==null&&e!==void 0&&e.parseTextSync||(n=t)!==null&&n!==void 0&&n.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}const $A=()=>{const t=WA();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry};function jR(t){const e=$A();t=Array.isArray(t)?t:[t];for(const n of t){const i=vx(n);e.find(s=>i===s)||e.unshift(i)}}function GR(){return $A()}const WR=new _x({id:"loaders.gl"}),HR=/\.([^.]+)$/;async function $R(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;if(!qA(t))return null;let s=Kw(t,e,{...n,nothrow:!0},i);if(s)return s;if(nc(t)&&(t=await t.slice(0,10).arrayBuffer(),s=Kw(t,e,n,i)),!s&&!(n!=null&&n.nothrow))throw new Error(ZA(t));return s}function Kw(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;if(!qA(t))return null;if(e&&!Array.isArray(e))return vx(e);let s=[];e&&(s=s.concat(e)),n!=null&&n.ignoreRegisteredLoaders||s.push(...GR()),ZR(s);const c=qR(t,s,n,i);if(!c&&!(n!=null&&n.nothrow))throw new Error(ZA(t));return c}function qR(t,e,n,i){const s=wg(t),c=gx(t),d=mx(s)||(i==null?void 0:i.url);let l=null,y="";if(n!=null&&n.mimeType&&(l=dy(e,n==null?void 0:n.mimeType),y="match forced by supplied MIME type ".concat(n==null?void 0:n.mimeType)),l=l||XR(e,d),y=y||(l?"matched url ".concat(d):""),l=l||dy(e,c),y=y||(l?"matched MIME type ".concat(c):""),l=l||KR(e,t),y=y||(l?"matched initial data ".concat(XA(t)):""),l=l||dy(e,n==null?void 0:n.fallbackMimeType),y=y||(l?"matched fallback MIME type ".concat(c):""),y){var w;WR.log(1,"selectLoader selected ".concat((w=l)===null||w===void 0?void 0:w.name,": ").concat(y,"."))}return l}function qA(t){return!(t instanceof Response&&t.status===204)}function ZA(t){const e=wg(t),n=gx(t);let i="No valid loader found (";i+=e?"".concat(FA(e),", "):"no url provided, ",i+="MIME type: ".concat(n?'"'.concat(n,'"'):"not provided",", ");const s=t?XA(t):"";return i+=s?' first bytes: "'.concat(s,'"'):"first bytes: not available",i+=")",i}function ZR(t){for(const e of t)vx(e)}function XR(t,e){const n=e&&HR.exec(e),i=n&&n[1];return i?YR(t,i):null}function YR(t,e){e=e.toLowerCase();for(const n of t)for(const i of n.extensions)if(i.toLowerCase()===e)return n;return null}function dy(t,e){for(const n of t)if(n.mimeTypes&&n.mimeTypes.includes(e)||e==="application/x.".concat(n.id))return n;return null}function KR(t,e){if(!e)return null;for(const n of t)if(typeof e=="string"){if(JR(e,n))return n}else if(ArrayBuffer.isView(e)){if(Jw(e.buffer,e.byteOffset,n))return n}else if(e instanceof ArrayBuffer&&Jw(e,0,n))return n;return null}function JR(t,e){return e.testText?e.testText(t):(Array.isArray(e.tests)?e.tests:[e.tests]).some(i=>t.startsWith(i))}function Jw(t,e,n){return(Array.isArray(n.tests)?n.tests:[n.tests]).some(s=>QR(t,e,n,s))}function QR(t,e,n,i){if(i instanceof ArrayBuffer)return Q3(i,t,i.byteLength);switch(typeof i){case"function":return i(t,n);case"string":const s=N0(t,e,i.length);return i===s;default:return!1}}function XA(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?N0(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?N0(t,0,e):""}function N0(t,e,n){if(t.byteLength<e+n)return"";const i=new DataView(t);let s="";for(let c=0;c<n;c++)s+=String.fromCharCode(i.getUint8(e+c));return s}const eD=256*1024;function*tD(t,e){const n=(e==null?void 0:e.chunkSize)||eD;let i=0;const s=new TextEncoder;for(;i<t.length;){const c=Math.min(t.length-i,n),d=t.slice(i,i+c);i+=c,yield s.encode(d)}}const nD=256*1024;function iD(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return function*(){const{chunkSize:n=nD}=e;let i=0;for(;i<t.byteLength;){const s=Math.min(t.byteLength-i,n),c=new ArrayBuffer(s),d=new Uint8Array(t,i,s);new Uint8Array(c).set(d),i+=s,yield c}}()}const rD=1024*1024;async function*sD(t,e){const n=(e==null?void 0:e.chunkSize)||rD;let i=0;for(;i<t.size;){const s=i+n,c=await t.slice(i,s).arrayBuffer();i=s,yield c}}function Qw(t,e){return px?oD(t,e):aD(t)}async function*oD(t,e){const n=t.getReader();let i;try{for(;;){const s=i||n.read();e!=null&&e._streamReadAhead&&(i=n.read());const{done:c,value:d}=await s;if(c)return;yield OA(d)}}catch{n.releaseLock()}}async function*aD(t,e){for await(const n of t)yield OA(n)}function lD(t,e){if(typeof t=="string")return tD(t,e);if(t instanceof ArrayBuffer)return iD(t,e);if(nc(t))return sD(t,e);if(NA(t))return Qw(t,e);if(tc(t))return Qw(t.body,e);throw new Error("makeIterator")}const YA="Cannot convert supplied data type";function cD(t,e,n){if(e.text&&typeof t=="string")return t;if(cR(t)&&(t=t.buffer),t instanceof ArrayBuffer){const i=t;return e.text&&!e.binary?new TextDecoder("utf8").decode(i):i}if(ArrayBuffer.isView(t)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(t);let i=t.buffer;const s=t.byteLength||t.length;return(t.byteOffset!==0||s!==i.byteLength)&&(i=i.slice(t.byteOffset,t.byteOffset+s)),i}throw new Error(YA)}async function uD(t,e,n){const i=t instanceof ArrayBuffer||ArrayBuffer.isView(t);if(typeof t=="string"||i)return cD(t,e);if(nc(t)&&(t=await UA(t)),tc(t)){const s=t;return await _R(s),e.binary?await s.arrayBuffer():await s.text()}if(NA(t)&&(t=lD(t,n)),aR(t)||lR(t))return tR(t);throw new Error(YA)}function KA(t,e){const n=HA(),i=t||n;return typeof i.fetch=="function"?i.fetch:Jd(i.fetch)?s=>Gw(s,i):e!=null&&e.fetch?e==null?void 0:e.fetch:Gw}function hD(t,e,n){if(n)return n;const i={fetch:KA(e,t),...t};if(i.url){const s=mx(i.url);i.baseUrl=s,i.queryString=mR(i.url),i.filename=FA(s),i.baseUrl=sR(s)}return Array.isArray(i.loaders)||(i.loaders=null),i}function dD(t,e){if(!e&&t&&!Array.isArray(t))return t;let n;if(t&&(n=Array.isArray(t)?t:[t]),e&&e.loaders){const i=Array.isArray(e.loaders)?e.loaders:[e.loaders];n=n?[...n,...i]:i}return n&&n.length?n:null}async function xx(t,e,n,i){Jo(!i||typeof i=="object"),e&&!Array.isArray(e)&&!yx(e)&&(i=void 0,n=e,e=void 0),t=await t,n=n||{};const s=wg(t),d=dD(e,i),l=await $R(t,d,n);return l?(n=FR(n,l,d,s),i=hD({url:s,parse:xx,loaders:d},n,i||null),await fD(l,t,n,i)):null}async function fD(t,e,n,i){if(X3(t),tc(e)){const s=e,{ok:c,redirected:d,status:l,statusText:y,type:w,url:S}=s,C=Object.fromEntries(s.headers.entries());i.response={headers:C,ok:c,redirected:d,status:l,statusText:y,type:w,url:S}}if(e=await uD(e,t,n),t.parseTextSync&&typeof e=="string")return n.dataType="text",t.parseTextSync(e,n,i,t);if(Y3(t,n))return await K3(t,e,n,i,xx);if(t.parseText&&typeof e=="string")return await t.parseText(e,n,i,t);if(t.parse)return await t.parse(e,n,i,t);throw Jo(!t.parseSync),new Error("".concat(t.id," loader - no parser found and worker is disabled"))}async function B0(t,e,n,i){!Array.isArray(e)&&!yx(e)&&(n=e,e=void 0);const s=KA(n);let c=t;return typeof t=="string"&&(c=await s(t)),nc(t)&&(c=await s(t)),await xx(c,e,n)}const pD="3.4.14",{_parseImageNode:mD}=globalThis,U0=typeof Image<"u",V0=typeof ImageBitmap<"u",gD=!!mD,j0=px?!0:gD;function _D(t){switch(t){case"auto":return V0||U0||j0;case"imagebitmap":return V0;case"image":return U0;case"data":return j0;default:throw new Error("@loaders.gl/images: image ".concat(t," not supported in this environment"))}}function yD(){if(V0)return"imagebitmap";if(U0)return"image";if(j0)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function vD(t){const e=bD(t);if(!e)throw new Error("Not an image");return e}function xD(t){switch(vD(t)){case"data":return t;case"image":case"imagebitmap":const e=document.createElement("canvas"),n=e.getContext("2d");if(!n)throw new Error("getImageData");return e.width=t.width,e.height=t.height,n.drawImage(t,0,0),n.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}function bD(t){return typeof ImageBitmap<"u"&&t instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&t instanceof Image?"image":t&&typeof t=="object"&&t.data&&t.width&&t.height?"data":null}const wD=/^data:image\/svg\+xml/,ED=/\.svg((\?|#).*)?$/;function bx(t){return t&&(wD.test(t)||ED.test(t))}function TD(t,e){if(bx(e)){let i=new TextDecoder().decode(t);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(i=unescape(encodeURIComponent(i)))}catch(c){throw new Error(c.message)}return"data:image/svg+xml;base64,".concat(btoa(i))}return JA(t,e)}function JA(t,e){if(bx(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}async function QA(t,e,n){const i=TD(t,n),s=self.URL||self.webkitURL,c=typeof i!="string"&&s.createObjectURL(i);try{return await SD(c||i,e)}finally{c&&s.revokeObjectURL(c)}}async function SD(t,e){const n=new Image;return n.src=t,e.image&&e.image.decode&&n.decode?(await n.decode(),n):await new Promise((i,s)=>{try{n.onload=()=>i(n),n.onerror=c=>s(new Error("Could not load image ".concat(t,": ").concat(c)))}catch(c){s(c)}})}const AD={};let eE=!0;async function PD(t,e,n){let i;bx(n)?i=await QA(t,e,n):i=JA(t,n);const s=e&&e.imagebitmap;return await ID(i,s)}async function ID(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if((CD(e)||!eE)&&(e=null),e)try{return await createImageBitmap(t,e)}catch(n){console.warn(n),eE=!1}return await createImageBitmap(t)}function CD(t){for(const e in t||AD)return!1;return!0}function MD(t){return!DD(t,"ftyp",4)||!(t[8]&96)?null:LD(t)}function LD(t){switch(kD(t,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function kD(t,e,n){return String.fromCharCode(...t.slice(e,n))}function RD(t){return[...t].map(e=>e.charCodeAt(0))}function DD(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const i=RD(e);for(let s=0;s<i.length;++s)if(i[s]!==t[s+n])return!1;return!0}const _o=!1,_d=!0;function eP(t){const e=ef(t);return OD(e)||BD(e)||FD(e)||ND(e)||zD(e)}function zD(t){const e=new Uint8Array(t instanceof DataView?t.buffer:t),n=MD(e);return n?{mimeType:n.mimeType,width:0,height:0}:null}function OD(t){const e=ef(t);return e.byteLength>=24&&e.getUint32(0,_o)===2303741511?{mimeType:"image/png",width:e.getUint32(16,_o),height:e.getUint32(20,_o)}:null}function FD(t){const e=ef(t);return e.byteLength>=10&&e.getUint32(0,_o)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,_d),height:e.getUint16(8,_d)}:null}function ND(t){const e=ef(t);return e.byteLength>=14&&e.getUint16(0,_o)===16973&&e.getUint32(2,_d)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,_d),height:e.getUint32(22,_d)}:null}function BD(t){const e=ef(t);if(!(e.byteLength>=3&&e.getUint16(0,_o)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:i,sofMarkers:s}=UD();let c=2;for(;c+9<e.byteLength;){const d=e.getUint16(c,_o);if(s.has(d))return{mimeType:"image/jpeg",height:e.getUint16(c+5,_o),width:e.getUint16(c+7,_o)};if(!i.has(d))return null;c+=2,c+=e.getUint16(c,_o)}return null}function UD(){const t=new Set([65499,65476,65484,65501,65534]);for(let n=65504;n<65520;++n)t.add(n);return{tableMarkers:t,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function ef(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}async function VD(t,e){const{mimeType:n}=eP(t)||{},i=globalThis._parseImageNode;return jm(i),await i(t,n)}async function jD(t,e,n){e=e||{};const s=(e.image||{}).type||"auto",{url:c}=n||{},d=GD(s);let l;switch(d){case"imagebitmap":l=await PD(t,e,c);break;case"image":l=await QA(t,e,c);break;case"data":l=await VD(t);break;default:jm(!1)}return s==="data"&&(l=xD(l)),l}function GD(t){switch(t){case"auto":case"data":return yD();default:return _D(t),t}}const WD=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],HD=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],$D={image:{type:"auto",decode:!0}},qD={id:"image",module:"images",name:"Images",version:pD,mimeTypes:HD,extensions:WD,parse:jD,tests:[t=>!!eP(new DataView(t))],options:$D};function tP(t){if(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron)return!0;const e=typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent,n=t||e;return!!(n&&n.indexOf("Electron")>=0)}function na(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process.browser)||tP()}const um={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document,process:typeof process=="object"&&process},Ip=um.window||um.self||um.global,$h=um.process||{},nP=typeof __VERSION__<"u"?__VERSION__:"untranspiled source";na();const fy=globalThis;function iP(t){if(!t&&!na())return"Node";if(tP(t))return"Electron";const n=t||(typeof navigator<"u"?navigator:{}).userAgent||"";if(n.indexOf("Edge")>-1)return"Edge";const i=n.indexOf("MSIE ")!==-1,s=n.indexOf("Trident/")!==-1;return i||s?"IE":fy.chrome?"Chrome":fy.safari?"Safari":fy.mozInnerScreenX?"Firefox":"Unknown"}function ZD(t){try{const e=window[t],n="__storage_test__";return e.setItem(n,n),e.removeItem(n),e}catch{return null}}class XD{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";$(this,"storage",void 0),$(this,"id",void 0),$(this,"config",void 0),this.storage=ZD(i),this.id=e,this.config=n,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const n=JSON.stringify(this.config);this.storage.setItem(this.id,n)}}_loadConfiguration(){let e={};if(this.storage){const n=this.storage.getItem(this.id);e=n?JSON.parse(n):{}}return Object.assign(this.config,e),this}}function YD(t){let e;return t<10?e="".concat(t.toFixed(2),"ms"):t<100?e="".concat(t.toFixed(1),"ms"):t<1e3?e="".concat(t.toFixed(0),"ms"):e="".concat((t/1e3).toFixed(2),"s"),e}function KD(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8;const n=Math.max(e-t.length,0);return"".concat(" ".repeat(n)).concat(t)}function py(t,e,n){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:600;const s=t.src.replace(/\(/g,"%28").replace(/\)/g,"%29");t.width>i&&(n=Math.min(n,i/t.width));const c=t.width*n,d=t.height*n,l=["font-size:1px;","padding:".concat(Math.floor(d/2),"px ").concat(Math.floor(c/2),"px;"),"line-height:".concat(d,"px;"),"background:url(".concat(s,");"),"background-size:".concat(c,"px ").concat(d,"px;"),"color:transparent;"].join("");return["".concat(e," %c+"),l]}let Hm;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(Hm||(Hm={}));function tE(t){return typeof t=="string"?Hm[t.toUpperCase()]||Hm.WHITE:t}function JD(t,e,n){return!na&&typeof t=="string"&&(e&&(e=tE(e),t="\x1B[".concat(e,"m").concat(t,"\x1B[39m")),n&&(e=tE(n),t="\x1B[".concat(n+10,"m").concat(t,"\x1B[49m"))),t}function QD(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"];const n=Object.getPrototypeOf(t),i=Object.getOwnPropertyNames(n);for(const s of i)typeof t[s]=="function"&&(e.find(c=>s===c)||(t[s]=t[s].bind(t)))}function $m(t,e){if(!t)throw new Error(e||"Assertion failed")}function Dc(){let t;if(na&&"performance"in Ip){var e,n;t=Ip==null||(e=Ip.performance)===null||e===void 0||(n=e.now)===null||n===void 0?void 0:n.call(e)}else if("hrtime"in $h){var i;const s=$h==null||(i=$h.hrtime)===null||i===void 0?void 0:i.call($h);t=s[0]*1e3+s[1]/1e6}else t=Date.now();return t}const zc={debug:na&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},ez={enabled:!0,level:0};function Es(){}const nE={},iE={once:!0};class wx{constructor(){let{id:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:""};$(this,"id",void 0),$(this,"VERSION",nP),$(this,"_startTs",Dc()),$(this,"_deltaTs",Dc()),$(this,"_storage",void 0),$(this,"userData",{}),$(this,"LOG_THROTTLE_TIMEOUT",0),this.id=e,this.userData={},this._storage=new XD("__probe-".concat(this.id,"__"),ez),this.timeStamp("".concat(this.id," started")),QD(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Dc()-this._startTs).toPrecision(10))}getDelta(){return Number((Dc()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,n){this._storage.setConfiguration({[e]:n})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,n){$m(e,n)}warn(e){return this._getLogFunction(0,e,zc.warn,arguments,iE)}error(e){return this._getLogFunction(0,e,zc.error,arguments)}deprecated(e,n){return this.warn("`".concat(e,"` is deprecated and will be removed in a later version. Use `").concat(n,"` instead"))}removed(e,n){return this.error("`".concat(e,"` has been removed. Use `").concat(n,"` instead"))}probe(e,n){return this._getLogFunction(e,n,zc.log,arguments,{time:!0,once:!0})}log(e,n){return this._getLogFunction(e,n,zc.debug,arguments)}info(e,n){return this._getLogFunction(e,n,console.info,arguments)}once(e,n){for(var i=arguments.length,s=new Array(i>2?i-2:0),c=2;c<i;c++)s[c-2]=arguments[c];return this._getLogFunction(e,n,zc.debug||zc.info,arguments,iE)}table(e,n,i){return n?this._getLogFunction(e,n,console.table||Es,i&&[i],{tag:rz(n)}):Es}image(e){let{logLevel:n,priority:i,image:s,message:c="",scale:d=1}=e;return this._shouldLog(n||i)?na?iz({image:s,message:c,scale:d}):nz():Es}time(e,n){return this._getLogFunction(e,n,console.time?console.time:console.info)}timeEnd(e,n){return this._getLogFunction(e,n,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,n){return this._getLogFunction(e,n,console.timeStamp||Es)}group(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1};const s=rE({logLevel:e,message:n,opts:i}),{collapsed:c}=i;return s.method=(c?console.groupCollapsed:console.group)||console.info,this._getLogFunction(s)}groupCollapsed(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(e,n,Object.assign({},i,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||Es)}withGroup(e,n,i){this.group(e,n)();try{i()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=rP(e)}_getLogFunction(e,n,i,s,c){if(this._shouldLog(e)){c=rE({logLevel:e,message:n,args:s,opts:c}),i=i||c.method,$m(i),c.total=this.getTotal(),c.delta=this.getDelta(),this._deltaTs=Dc();const d=c.tag||c.message;if(c.once)if(!nE[d])nE[d]=Dc();else return Es;return n=tz(this.id,c.message,c),i.bind(console,n,...c.args)}return Es}}$(wx,"VERSION",nP);function rP(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return $m(Number.isFinite(e)&&e>=0),e}function rE(t){const{logLevel:e,message:n}=t;t.logLevel=rP(e);const i=t.args?Array.from(t.args):[];for(;i.length&&i.shift()!==n;);switch(typeof e){case"string":case"function":n!==void 0&&i.unshift(n),t.message=e;break;case"object":Object.assign(t,e);break}typeof t.message=="function"&&(t.message=t.message());const s=typeof t.message;return $m(s==="string"||s==="object"),Object.assign(t,{args:i},t.opts)}function tz(t,e,n){if(typeof e=="string"){const i=n.time?KD(YD(n.total)):"";e=n.time?"".concat(t,": ").concat(i,"  ").concat(e):"".concat(t,": ").concat(e),e=JD(e,n.color,n.background)}return e}function nz(t){return console.warn("removed"),Es}function iz(t){let{image:e,message:n="",scale:i=1}=t;if(typeof e=="string"){const c=new Image;return c.onload=()=>{const d=py(c,n,i);console.log(...d)},c.src=e,Es}const s=e.nodeName||"";if(s.toLowerCase()==="img")return console.log(...py(e,n,i)),Es;if(s.toLowerCase()==="canvas"){const c=new Image;return c.onload=()=>console.log(...py(c,n,i)),c.src=e.toDataURL(),Es}return Es}function rz(t){for(const e in t)for(const n in t[e])return n||"untitled";return"empty"}const fn=new wx({id:"deck"});let G0={};function sz(t){G0=t}function rr(t,e,n,i){fn.level>0&&G0[t]&&G0[t].call(null,e,n,i)}function oz(t){const e=t[0],n=t[t.length-1];return e==="{"&&n==="}"||e==="["&&n==="]"}const az={id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:oz,parseTextSync:JSON.parse};function lz(){const t="8.9.33",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==t)throw new Error("deck.gl - multiple versions detected: ".concat(e," vs ").concat(t));return e||(fn.log(1,"deck.gl ".concat(t))(),globalThis.deck={...globalThis.deck,VERSION:t,version:t,log:fn,_registerLoggers:sz},jR([az,[qD,{imagebitmap:{premultiplyAlpha:"none"}}]])),t}const cz=lz(),Jt={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(Jt,"IDENTITY",{get:()=>(fn.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const yo={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},W0={common:0,meters:1,pixels:2},sE={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}},Pt=new wx({id:"luma.gl"});function br(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}const uz="Invalid WebGLRenderingContext",hz="Requires WebGL2";function Eg(t){return typeof WebGLRenderingContext<"u"&&t instanceof WebGLRenderingContext||typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:!!(t&&Number.isFinite(t._version))}function Yt(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:!!(t&&t._version===2)}function dz(t){return Yt(t)?t:null}function Tg(t){return br(Eg(t),uz),t}function ar(t){return br(Yt(t),hz),t}const rd={};function fz(t){globalThis.console&&globalThis.console.error&&globalThis.console.error(t)}function pz(t){globalThis.console&&globalThis.console.log&&globalThis.console.log(t)}function mz(t,e){rd[t]=!0,e!==void 0&&fz(e)}function gz(t){const e=t.getError;t.getError=function(){let i;do i=e.apply(t),i!==0&&(rd[i]=!0);while(i!==0);for(i in rd)if(rd[i])return delete rd[i],parseInt(i,10);return 0}}const tf=function t(e){const n=e.gl;this.ext=e,this.isAlive=!0,this.hasBeenBound=!1,this.elementArrayBuffer=null,this.attribs=new Array(e.maxVertexAttribs);for(let i=0;i<this.attribs.length;i++){const s=new t.VertexAttrib(n);this.attribs[i]=s}this.maxAttrib=0};tf.VertexAttrib=function(e){this.enabled=!1,this.buffer=null,this.size=4,this.type=5126,this.normalized=!1,this.stride=16,this.offset=0,this.cached="",this.recache()};tf.VertexAttrib.prototype.recache=function(){this.cached=[this.size,this.type,this.normalized,this.stride,this.offset].join(":")};const ic=function(e){const n=this;this.gl=e,gz(e);const i=this.original={getParameter:e.getParameter,enableVertexAttribArray:e.enableVertexAttribArray,disableVertexAttribArray:e.disableVertexAttribArray,bindBuffer:e.bindBuffer,getVertexAttrib:e.getVertexAttrib,vertexAttribPointer:e.vertexAttribPointer};e.getParameter=function(c){return c===n.VERTEX_ARRAY_BINDING_OES?n.currentVertexArrayObject===n.defaultVertexArrayObject?null:n.currentVertexArrayObject:i.getParameter.apply(this,arguments)},e.enableVertexAttribArray=function(c){const d=n.currentVertexArrayObject;d.maxAttrib=Math.max(d.maxAttrib,c);const l=d.attribs[c];return l.enabled=!0,i.enableVertexAttribArray.apply(this,arguments)},e.disableVertexAttribArray=function(c){const d=n.currentVertexArrayObject;d.maxAttrib=Math.max(d.maxAttrib,c);const l=d.attribs[c];return l.enabled=!1,i.disableVertexAttribArray.apply(this,arguments)},e.bindBuffer=function(c,d){switch(c){case 34962:n.currentArrayBuffer=d;break;case 34963:n.currentVertexArrayObject.elementArrayBuffer=d;break}return i.bindBuffer.apply(this,arguments)},e.getVertexAttrib=function(c,d){const y=n.currentVertexArrayObject.attribs[c];switch(d){case 34975:return y.buffer;case 34338:return y.enabled;case 34339:return y.size;case 34340:return y.stride;case 34341:return y.type;case 34922:return y.normalized;default:return i.getVertexAttrib.apply(this,arguments)}},e.vertexAttribPointer=function(c,d,l,y,w,S){const C=n.currentVertexArrayObject;C.maxAttrib=Math.max(C.maxAttrib,c);const P=C.attribs[c];return P.buffer=n.currentArrayBuffer,P.size=d,P.type=l,P.normalized=y,P.stride=w,P.offset=S,P.recache(),i.vertexAttribPointer.apply(this,arguments)},e.instrumentExtension&&e.instrumentExtension(this,"OES_vertex_array_object"),e.canvas&&e.canvas.addEventListener("webglcontextrestored",()=>{pz("OESVertexArrayObject emulation library context restored"),n.reset_()},!0),this.reset_()};ic.prototype.VERTEX_ARRAY_BINDING_OES=34229;ic.prototype.reset_=function(){if(this.vertexArrayObjects!==void 0)for(let i=0;i<this.vertexArrayObjects.length;++i)this.vertexArrayObjects.isAlive=!1;const n=this.gl;this.maxVertexAttribs=n.getParameter(34921),this.defaultVertexArrayObject=new tf(this),this.currentVertexArrayObject=null,this.currentArrayBuffer=null,this.vertexArrayObjects=[this.defaultVertexArrayObject],this.bindVertexArrayOES(null)};ic.prototype.createVertexArrayOES=function(){const e=new tf(this);return this.vertexArrayObjects.push(e),e};ic.prototype.deleteVertexArrayOES=function(e){e.isAlive=!1,this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(e),1),this.currentVertexArrayObject===e&&this.bindVertexArrayOES(null)};ic.prototype.isVertexArrayOES=function(e){return!!(e&&e instanceof tf&&e.hasBeenBound&&e.ext===this)};ic.prototype.bindVertexArrayOES=function(e){const n=this.gl;if(e&&!e.isAlive){mz(1282,"bindVertexArrayOES: attempt to bind deleted arrayObject");return}const i=this.original,s=this.currentVertexArrayObject;this.currentVertexArrayObject=e||this.defaultVertexArrayObject,this.currentVertexArrayObject.hasBeenBound=!0;const c=this.currentVertexArrayObject;if(s===c)return;(!s||c.elementArrayBuffer!==s.elementArrayBuffer)&&i.bindBuffer.call(n,34963,c.elementArrayBuffer);let d=this.currentArrayBuffer;const l=Math.max(s?s.maxAttrib:0,c.maxAttrib);for(let y=0;y<=l;y++){const w=c.attribs[y],S=s?s.attribs[y]:null;if((!s||w.enabled!==S.enabled)&&(w.enabled?i.enableVertexAttribArray.call(n,y):i.disableVertexAttribArray.call(n,y)),w.enabled){let C=!1;(!s||w.buffer!==S.buffer)&&(d!==w.buffer&&(i.bindBuffer.call(n,34962,w.buffer),d=w.buffer),C=!0),(C||w.cached!==S.cached)&&i.vertexAttribPointer.call(n,y,w.size,w.type,w.normalized,w.stride,w.offset)}}this.currentArrayBuffer!==d&&i.bindBuffer.call(n,34962,this.currentArrayBuffer)};function _z(t){if(typeof t.createVertexArray=="function")return;const e=t.getSupportedExtensions;t.getSupportedExtensions=function(){const s=e.call(this)||[];return s.indexOf("OES_vertex_array_object")<0&&s.push("OES_vertex_array_object"),s};const n=t.getExtension;t.getExtension=function(s){const c=n.call(this,s);return c||(s!=="OES_vertex_array_object"?null:(t.__OESVertexArrayObject||(this.__OESVertexArrayObject=new ic(this)),this.__OESVertexArrayObject))}}const oE="OES_element_index",aE="WEBGL_draw_buffers",yz="EXT_disjoint_timer_query",vz="EXT_disjoint_timer_query_webgl2",xz="EXT_texture_filter_anisotropic",lE="WEBGL_debug_renderer_info",bz=35723,wz=4352,Ez=36795,Tz=34047,Sz=37445,Az=37446,Ln=t=>Yt(t)?void 0:0,Pz={3074:t=>Yt(t)?void 0:36064,[bz]:t=>Yt(t)?void 0:wz,35977:Ln,32937:Ln,[Ez]:(t,e)=>{const n=Yt(t)?t.getExtension(vz):t.getExtension(yz);return n&&n.GPU_DISJOINT_EXT?e(n.GPU_DISJOINT_EXT):0},[Sz]:(t,e)=>{const n=t.getExtension(lE);return e(n&&n.UNMASKED_VENDOR_WEBGL||7936)},[Az]:(t,e)=>{const n=t.getExtension(lE);return e(n&&n.UNMASKED_RENDERER_WEBGL||7937)},[Tz]:(t,e)=>{const n=t.luma.extensions[xz];return n?e(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1},32883:Ln,35071:Ln,37447:Ln,36063:(t,e)=>{if(!Yt(t)){const n=t.getExtension(aE);return n?e(n.MAX_COLOR_ATTACHMENTS_WEBGL):0}},35379:Ln,35374:Ln,35377:Ln,34852:t=>{if(!Yt(t)){const e=t.getExtension(aE);return e?e.MAX_DRAW_BUFFERS_WEBGL:0}},36203:t=>t.getExtension(oE)?2147483647:65535,33001:t=>t.getExtension(oE)?16777216:65535,33e3:t=>16777216,37157:Ln,35373:Ln,35657:Ln,36183:Ln,37137:Ln,34045:Ln,35978:Ln,35979:Ln,35968:Ln,35376:Ln,35375:Ln,35659:Ln,37154:Ln,35371:Ln,35658:Ln,35076:Ln,35077:Ln,35380:Ln};function Iz(t,e,n){const i=Pz[n],s=typeof i=="function"?i(t,e,n):i;return s!==void 0?s:e(n)}const Cz="OES_vertex_array_object",sP="ANGLE_instanced_arrays",Mz="WEBGL_draw_buffers",Lz="EXT_disjoint_timer_query",kz="EXT_texture_filter_anisotropic",Rz="VertexArray requires WebGL2 or OES_vertex_array_object extension";function Dz(t,e){return{webgl2:Yt(t),ext:t.getExtension(e)}}const oP={[Cz]:{meta:{suffix:"OES"},createVertexArray:()=>{br(!1,Rz)},deleteVertexArray:()=>{},bindVertexArray:()=>{},isVertexArray:()=>!1},[sP]:{meta:{suffix:"ANGLE"},vertexAttribDivisor(t,e){br(e===0,"WebGL instanced rendering not supported")},drawElementsInstanced:()=>{},drawArraysInstanced:()=>{}},[Mz]:{meta:{suffix:"WEBGL"},drawBuffers:()=>{br(!1)}},[Lz]:{meta:{suffix:"EXT"},createQuery:()=>{br(!1)},deleteQuery:()=>{br(!1)},beginQuery:()=>{br(!1)},endQuery:()=>{},getQuery(t,e){return this.getQueryObject(t,e)},getQueryParameter(t,e){return this.getQueryObject(t,e)},getQueryObject:()=>{}}},my={readBuffer:(t,e,n)=>{Yt(t)&&e(n)},getVertexAttrib:(t,e,n,i)=>{const{webgl2:s,ext:c}=Dz(t,sP);let d;switch(i){case 35069:d=s?void 0:!1;break;case 35070:d=!s&&!c?0:void 0;break}return d!==void 0?d:e(n,i)},getProgramParameter:(t,e,n,i)=>{if(!Yt(t))switch(i){case 35967:return 35981;case 35971:return 0;case 35382:return 0}return e(n,i)},getInternalformatParameter:(t,e,n,i,s)=>{if(!Yt(t))switch(s){case 32937:return new Int32Array([0])}return t.getInternalformatParameter(n,i,s)},getTexParameter(t,e,n,i){switch(i){case 34046:const{extensions:s}=t.luma,c=s[kz];i=c&&c.TEXTURE_MAX_ANISOTROPY_EXT||34046;break}return e(n,i)},getParameter:Iz,hint(t,e,n,i){return e(n,i)}};function zz(t){t.luma=t.luma||{};const{luma:e}=t;return e.polyfilled||(_z(t),Oz(t),Nz(t,oP),Fz(t,{target:e,target2:t}),e.polyfilled=!0),t}globalThis.polyfillContext=zz;function Oz(t){t.luma.extensions={};const e=t.getSupportedExtensions()||[];for(const n of e)t.luma[n]=t.getExtension(n)}function Fz(t,e){let{target:n,target2:i}=e;Object.keys(my).forEach(s=>{if(typeof my[s]=="function"){const c=t[s]?t[s].bind(t):()=>{},d=my[s].bind(null,t,c);n[s]=d,i[s]=d}})}function Nz(t,e){for(const n of Object.getOwnPropertyNames(e))n!=="overrides"&&Bz(t,{extension:n,target:t.luma,target2:t})}function Bz(t,e){let{extension:n,target:i,target2:s}=e;const c=oP[n];br(c);const{meta:d={}}=c,{suffix:l=""}=d,y=t.getExtension(n);for(const w of Object.keys(c)){const S="".concat(w).concat(l);let C=null;w==="meta"||typeof t[w]=="function"||(y&&typeof y[S]=="function"?C=function(){return y[S](...arguments)}:typeof c[w]=="function"&&(C=c[w].bind(i))),C&&(i[w]=C,s[w]=C)}}const Ex={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,36006:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],3333:4,3317:4,37440:!1,37441:!1,37443:37444,35723:4352,36010:null,35977:!1,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},Sa=(t,e,n)=>e?t.enable(n):t.disable(n),cE=(t,e,n)=>t.hint(n,e),Kr=(t,e,n)=>t.pixelStorei(n,e),Uz=(t,e)=>{const n=Yt(t)?36009:36160;return t.bindFramebuffer(n,e)},Vz=(t,e)=>t.bindFramebuffer(36008,e);function qh(t){return Array.isArray(t)||ArrayBuffer.isView(t)}const jz={3042:Sa,32773:(t,e)=>t.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(t,e)=>t.clearColor(...e),3107:(t,e)=>t.colorMask(...e),2884:Sa,2885:(t,e)=>t.cullFace(e),2929:Sa,2931:(t,e)=>t.clearDepth(e),2932:(t,e)=>t.depthFunc(e),2928:(t,e)=>t.depthRange(...e),2930:(t,e)=>t.depthMask(e),3024:Sa,35723:cE,36006:Uz,2886:(t,e)=>t.frontFace(e),33170:cE,2849:(t,e)=>t.lineWidth(e),32823:Sa,32824:"polygonOffset",10752:"polygonOffset",35977:Sa,32938:"sampleCoverage",32939:"sampleCoverage",3089:Sa,3088:(t,e)=>t.scissor(...e),2960:Sa,2961:(t,e)=>t.clearStencil(e),2968:(t,e)=>t.stencilMaskSeparate(1028,e),36005:(t,e)=>t.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(t,e)=>t.viewport(...e),3333:Kr,3317:Kr,37440:Kr,37441:Kr,37443:Kr,3330:Kr,3332:Kr,3331:Kr,36010:Vz,3314:Kr,32878:Kr,3316:Kr,3315:Kr,32877:Kr,framebuffer:(t,e)=>{const n=e&&"handle"in e?e.handle:e;return t.bindFramebuffer(36160,n)},blend:(t,e)=>e?t.enable(3042):t.disable(3042),blendColor:(t,e)=>t.blendColor(...e),blendEquation:(t,e)=>{e=qh(e)?e:[e,e],t.blendEquationSeparate(...e)},blendFunc:(t,e)=>{e=qh(e)&&e.length===2?[...e,...e]:e,t.blendFuncSeparate(...e)},clearColor:(t,e)=>t.clearColor(...e),clearDepth:(t,e)=>t.clearDepth(e),clearStencil:(t,e)=>t.clearStencil(e),colorMask:(t,e)=>t.colorMask(...e),cull:(t,e)=>e?t.enable(2884):t.disable(2884),cullFace:(t,e)=>t.cullFace(e),depthTest:(t,e)=>e?t.enable(2929):t.disable(2929),depthFunc:(t,e)=>t.depthFunc(e),depthMask:(t,e)=>t.depthMask(e),depthRange:(t,e)=>t.depthRange(...e),dither:(t,e)=>e?t.enable(3024):t.disable(3024),derivativeHint:(t,e)=>{t.hint(35723,e)},frontFace:(t,e)=>t.frontFace(e),mipmapHint:(t,e)=>t.hint(33170,e),lineWidth:(t,e)=>t.lineWidth(e),polygonOffsetFill:(t,e)=>e?t.enable(32823):t.disable(32823),polygonOffset:(t,e)=>t.polygonOffset(...e),sampleCoverage:(t,e)=>t.sampleCoverage(...e),scissorTest:(t,e)=>e?t.enable(3089):t.disable(3089),scissor:(t,e)=>t.scissor(...e),stencilTest:(t,e)=>e?t.enable(2960):t.disable(2960),stencilMask:(t,e)=>{e=qh(e)?e:[e,e];const[n,i]=e;t.stencilMaskSeparate(1028,n),t.stencilMaskSeparate(1029,i)},stencilFunc:(t,e)=>{e=qh(e)&&e.length===3?[...e,...e]:e;const[n,i,s,c,d,l]=e;t.stencilFuncSeparate(1028,n,i,s),t.stencilFuncSeparate(1029,c,d,l)},stencilOp:(t,e)=>{e=qh(e)&&e.length===3?[...e,...e]:e;const[n,i,s,c,d,l]=e;t.stencilOpSeparate(1028,n,i,s),t.stencilOpSeparate(1029,c,d,l)},viewport:(t,e)=>t.viewport(...e)};function Jn(t,e,n){return e[t]!==void 0?e[t]:n[t]}const Gz={blendEquation:(t,e,n)=>t.blendEquationSeparate(Jn(32777,e,n),Jn(34877,e,n)),blendFunc:(t,e,n)=>t.blendFuncSeparate(Jn(32969,e,n),Jn(32968,e,n),Jn(32971,e,n),Jn(32970,e,n)),polygonOffset:(t,e,n)=>t.polygonOffset(Jn(32824,e,n),Jn(10752,e,n)),sampleCoverage:(t,e,n)=>t.sampleCoverage(Jn(32938,e,n),Jn(32939,e,n)),stencilFuncFront:(t,e,n)=>t.stencilFuncSeparate(1028,Jn(2962,e,n),Jn(2967,e,n),Jn(2963,e,n)),stencilFuncBack:(t,e,n)=>t.stencilFuncSeparate(1029,Jn(34816,e,n),Jn(36003,e,n),Jn(36004,e,n)),stencilOpFront:(t,e,n)=>t.stencilOpSeparate(1028,Jn(2964,e,n),Jn(2965,e,n),Jn(2966,e,n)),stencilOpBack:(t,e,n)=>t.stencilOpSeparate(1029,Jn(34817,e,n),Jn(34818,e,n),Jn(34819,e,n))},uE={enable:(t,e)=>t({[e]:!0}),disable:(t,e)=>t({[e]:!1}),pixelStorei:(t,e,n)=>t({[e]:n}),hint:(t,e,n)=>t({[e]:n}),bindFramebuffer:(t,e,n)=>{switch(e){case 36160:return t({36006:n,36010:n});case 36009:return t({36006:n});case 36008:return t({36010:n});default:return null}},blendColor:(t,e,n,i,s)=>t({32773:new Float32Array([e,n,i,s])}),blendEquation:(t,e)=>t({32777:e,34877:e}),blendEquationSeparate:(t,e,n)=>t({32777:e,34877:n}),blendFunc:(t,e,n)=>t({32969:e,32968:n,32971:e,32970:n}),blendFuncSeparate:(t,e,n,i,s)=>t({32969:e,32968:n,32971:i,32970:s}),clearColor:(t,e,n,i,s)=>t({3106:new Float32Array([e,n,i,s])}),clearDepth:(t,e)=>t({2931:e}),clearStencil:(t,e)=>t({2961:e}),colorMask:(t,e,n,i,s)=>t({3107:[e,n,i,s]}),cullFace:(t,e)=>t({2885:e}),depthFunc:(t,e)=>t({2932:e}),depthRange:(t,e,n)=>t({2928:new Float32Array([e,n])}),depthMask:(t,e)=>t({2930:e}),frontFace:(t,e)=>t({2886:e}),lineWidth:(t,e)=>t({2849:e}),polygonOffset:(t,e,n)=>t({32824:e,10752:n}),sampleCoverage:(t,e,n)=>t({32938:e,32939:n}),scissor:(t,e,n,i,s)=>t({3088:new Int32Array([e,n,i,s])}),stencilMask:(t,e)=>t({2968:e,36005:e}),stencilMaskSeparate:(t,e,n)=>t({[e===1028?2968:36005]:n}),stencilFunc:(t,e,n,i)=>t({2962:e,2967:n,2963:i,34816:e,36003:n,36004:i}),stencilFuncSeparate:(t,e,n,i,s)=>t({[e===1028?2962:34816]:n,[e===1028?2967:36003]:i,[e===1028?2963:36004]:s}),stencilOp:(t,e,n,i)=>t({2964:e,2965:n,2966:i,34817:e,34818:n,34819:i}),stencilOpSeparate:(t,e,n,i,s)=>t({[e===1028?2964:34817]:n,[e===1028?2965:34818]:i,[e===1028?2966:34819]:s}),viewport:(t,e,n,i,s)=>t({2978:[e,n,i,s]})},ho=(t,e)=>t.isEnabled(e),hE={3042:ho,2884:ho,2929:ho,3024:ho,32823:ho,32926:ho,32928:ho,3089:ho,2960:ho,35977:ho};function aP(t){for(const e in t)return!1;return!0}function Wz(t,e){if(t===e)return!0;const n=Array.isArray(t)||ArrayBuffer.isView(t),i=Array.isArray(e)||ArrayBuffer.isView(e);if(n&&i&&t.length===e.length){for(let s=0;s<t.length;++s)if(t[s]!==e[s])return!1;return!0}return!1}function dE(t,e){const n=t[e].bind(t);t[e]=function(){const s=arguments.length<=0?void 0:arguments[0];return s in t.state.cache?t.state.enable?t.state.cache[s]:n(...arguments):n(...arguments)},Object.defineProperty(t[e],"name",{value:"".concat(e,"-from-cache"),configurable:!1})}function Hz(t,e,n){const i=t[e].bind(t);t[e]=function(){for(var c=arguments.length,d=new Array(c),l=0;l<c;l++)d[l]=arguments[l];const{valueChanged:y,oldValue:w}=n(t.state._updateCache,...d);return y&&i(...d),w},Object.defineProperty(t[e],"name",{value:"".concat(e,"-to-cache"),configurable:!1})}function $z(t){const e=t.useProgram.bind(t);t.useProgram=function(i){t.state.program!==i&&(e(i),t.state.program=i)}}class qz{constructor(e){let{copyState:n=!1,log:i=()=>{}}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.program=null,this.stateStack=[],this.enable=!0,this.cache=n?Xz(e):Object.assign({},Ex),this.log=i,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(){this.stateStack.push({})}pop(){br(this.stateStack.length>0);const e=this.stateStack[this.stateStack.length-1];Qo(this.gl,e),this.stateStack.pop()}_updateCache(e){let n=!1,i;const s=this.stateStack.length>0&&this.stateStack[this.stateStack.length-1];for(const c in e){br(c!==void 0);const d=e[c],l=this.cache[c];Wz(d,l)||(n=!0,i=l,s&&!(c in s)&&(s[c]=l),this.cache[c]=d)}return{valueChanged:n,oldValue:i}}}function lP(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{enable:n=!0,copyState:i}=e;if(br(i!==void 0),!t.state){const{polyfillContext:s}=globalThis;s&&s(t),t.state=new qz(t,{copyState:i}),$z(t);for(const c in uE){const d=uE[c];Hz(t,c,d)}dE(t,"getParameter"),dE(t,"isEnabled")}return t.state.enable=n,t}function Zz(t){t.state||lP(t,{copyState:!1}),t.state.push()}function fE(t){br(t.state),t.state.pop()}function Qo(t,e){if(br(Eg(t),"setParameters requires a WebGL context"),aP(e))return;const n={};for(const s in e){const c=Number(s),d=jz[s];d&&(typeof d=="string"?n[d]=!0:d(t,e[s],c))}const i=t.state&&t.state.cache;if(i)for(const s in n){const c=Gz[s];c(t,e,i)}}function Xz(t,e){if(e=e||Ex,typeof e=="number"){const s=e,c=hE[s];return c?c(t,s):t.getParameter(s)}const n=Array.isArray(e)?e:Object.keys(e),i={};for(const s of n){const c=hE[s];i[s]=c?c(t,Number(s)):t.getParameter(Number(s))}return i}function Yz(t){Qo(t,Ex)}function Nr(t,e,n){if(aP(e))return n(t);const{nocatch:i=!0}=e;Zz(t),Qo(t,e);let s;if(i)s=n(t),fE(t);else try{s=n(t)}finally{fE(t)}return s}function Zl(t){const{luma:e}=t;if(t.canvas&&e){const n=e.canvasSizeInfo,i="clientWidth"in n?n.clientWidth:t.canvas.clientWidth;return i?t.drawingBufferWidth/i:1}return 1}function gy(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;const i=Zl(t),s=t.drawingBufferWidth,c=t.drawingBufferHeight;return Jz(e,i,s,c,n)}function Kz(t){const e=typeof window>"u"?1:window.devicePixelRatio||1;return Number.isFinite(t)?t<=0?1:t:t?e:1}function Jz(t,e,n,i,s){const c=pE(t[0],e,n);let d=mE(t[1],e,i,s),l=pE(t[0]+1,e,n);const y=l===n-1?l:l-1;l=mE(t[1]+1,e,i,s);let w;return s?(l=l===0?l:l+1,w=d,d=l):w=l===i-1?l:l-1,{x:c,y:d,width:Math.max(y-c+1,1),height:Math.max(w-d+1,1)}}function pE(t,e,n){return Math.min(Math.round(t*e),n-1)}function mE(t,e,n,i){return i?Math.max(0,n-1-Math.round(t*e)):Math.min(Math.round(t*e),n-1)}const Tx=na(),Qz=Tx&&typeof document<"u",cP={webgl2:!0,webgl1:!0,throwOnError:!0,manageState:!0,canvas:null,debug:!1,width:800,height:600};function uP(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};br(Tx,`createGLContext only available in the browser.
Create your own headless context or use 'createHeadlessContext' from @luma.gl/test-utils`),t=Object.assign({},cP,t);const{width:e,height:n}=t;function i(l){if(t.throwOnError)throw new Error(l);return console.error(l),null}t.onError=i;let s;const{canvas:c}=t,d=iO({canvas:c,width:e,height:n,onError:i});return s=nO(d,t),s?(s=Sx(s,t),rO(s),s):null}function Sx(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!t||t._instrumented)return t;t._version=t._version||sO(t),t.luma=t.luma||{},t.luma.canvasSizeInfo=t.luma.canvasSizeInfo||{},e=Object.assign({},cP,e);const{manageState:n,debug:i}=e;return n&&lP(t,{copyState:!1,log:function(){for(var s=arguments.length,c=new Array(s),d=0;d<s;d++)c[d]=arguments[d];return Pt.log(1,...c)()}}),Tx&&i&&(globalThis.makeDebugContext?(t=globalThis.makeDebugContext(t,e),Pt.level=Math.max(Pt.level,1)):Pt.warn('WebGL debug mode not activated. import "@luma.gl/debug" to enable.')()),t._instrumented=!0,t}function eO(t){const e=t.getParameter(7936),n=t.getParameter(7937),i=t.getExtension("WEBGL_debug_renderer_info"),s=i&&t.getParameter(i.UNMASKED_VENDOR_WEBGL||7936),c=i&&t.getParameter(i.UNMASKED_RENDERER_WEBGL||7937);return{vendor:s||e,renderer:c||n,vendorMasked:e,rendererMasked:n,version:t.getParameter(7938),shadingLanguageVersion:t.getParameter(35724)}}function tO(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(t.canvas){const i=Kz(e.useDevicePixels);oO(t,i,e);return}const n=t.getExtension("STACKGL_resize_drawingbuffer");n&&"width"in e&&"height"in e&&n.resize(e.width,e.height)}function nO(t,e){const{onError:n}=e;let i=null;const s=y=>i=y.statusMessage||i;t.addEventListener("webglcontextcreationerror",s,!1);const{webgl1:c=!0,webgl2:d=!0}=e;let l=null;return d&&(l=l||t.getContext("webgl2",e),l=l||t.getContext("experimental-webgl2",e)),c&&(l=l||t.getContext("webgl",e),l=l||t.getContext("experimental-webgl",e)),t.removeEventListener("webglcontextcreationerror",s,!1),l?(e.onContextLost&&t.addEventListener("webglcontextlost",e.onContextLost,!1),e.onContextRestored&&t.addEventListener("webglcontextrestored",e.onContextRestored,!1),l):n("Failed to create ".concat(d&&!c?"WebGL2":"WebGL"," context: ").concat(i||"Unknown error"))}function iO(t){let{canvas:e,width:n=800,height:i=600,onError:s}=t,c;return typeof e=="string"?(Qz&&document.readyState==="complete"||s("createGLContext called on canvas '".concat(e,"' before page was loaded")),c=document.getElementById(e)):e?c=e:(c=document.createElement("canvas"),c.id="lumagl-canvas",c.style.width=Number.isFinite(n)?"".concat(n,"px"):"100%",c.style.height=Number.isFinite(i)?"".concat(i,"px"):"100%",document.body.insertBefore(c,document.body.firstChild)),c}function rO(t){const e=Yt(t)?"WebGL2":"WebGL1",n=eO(t),i=n?"(".concat(n.vendor,",").concat(n.renderer,")"):"",s=t.debug?" debug":"";Pt.info(1,"".concat(e).concat(s," context ").concat(i))()}function sO(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?2:1}function oO(t,e,n){let i="width"in n?n.width:t.canvas.clientWidth,s="height"in n?n.height:t.canvas.clientHeight;(!i||!s)&&(Pt.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,i=t.canvas.width||1,s=t.canvas.height||1),t.luma=t.luma||{},t.luma.canvasSizeInfo=t.luma.canvasSizeInfo||{};const c=t.luma.canvasSizeInfo;if(c.clientWidth!==i||c.clientHeight!==s||c.devicePixelRatio!==e){let d=e;const l=Math.floor(i*d),y=Math.floor(s*d);t.canvas.width=l,t.canvas.height=y,(t.drawingBufferWidth!==l||t.drawingBufferHeight!==y)&&(Pt.warn("Device pixel ratio clamped")(),d=Math.min(t.drawingBufferWidth/i,t.drawingBufferHeight/s),t.canvas.width=Math.floor(i*d),t.canvas.height=Math.floor(s*d)),Object.assign(t.luma.canvasSizeInfo,{clientWidth:i,clientHeight:s,devicePixelRatio:e})}}function gE(){let t;if(typeof window<"u"&&window.performance)t=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}class _E{constructor(e,n){$(this,"name",void 0),$(this,"type",void 0),$(this,"sampleSize",1),$(this,"time",void 0),$(this,"count",void 0),$(this,"samples",void 0),$(this,"lastTiming",void 0),$(this,"lastSampleTime",void 0),$(this,"lastSampleCount",void 0),$(this,"_count",0),$(this,"_time",0),$(this,"_samples",0),$(this,"_startTime",0),$(this,"_timerPending",!1),this.name=e,this.type=n,this.reset()}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=gE(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(gE()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class Ax{constructor(e){$(this,"id",void 0),$(this,"stats",{}),this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:e,type:n})}get size(){return Object.keys(this.stats).length}reset(){for(const e in this.stats)this.stats[e].reset();return this}forEach(e){for(const n in this.stats)e(this.stats[n])}getTable(){const e={};return this.forEach(n=>{e[n.name]={time:n.time||0,count:n.count||0,average:n.getAverageTime()||0,hz:n.getHz()||0}}),e}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(n=>this._getOrCreate(n))}_getOrCreate(e){if(!e||!e.name)return null;const{name:n,type:i}=e;return this.stats[n]||(e instanceof _E?this.stats[n]=e:this.stats[n]=new _E(n,i)),this.stats[n]}}const yd="8.5.21",aO="set luma.log.level=1 (or higher) to trace rendering";class lO{constructor(){this.stats=new Map}get(e){return this.stats.has(e)||this.stats.set(e,new Ax({id:e})),this.stats.get(e)}}const Nl=new lO;if(globalThis.luma&&globalThis.luma.VERSION!==yd)throw new Error("luma.gl - multiple VERSIONs detected: ".concat(globalThis.luma.VERSION," vs ").concat(yd));globalThis.luma||(na()&&Pt.log(1,"luma.gl ".concat(yd," - ").concat(aO))(),globalThis.luma=globalThis.luma||{VERSION:yd,version:yd,log:Pt,stats:Nl,globals:{modules:{},nodeIO:{}}});function cO(t){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t,1e3/60)}function uO(t){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(t):clearTimeout(t)}function ft(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}function _y(t,e){if(typeof e!="string")return e;const n=Number(e);if(!isNaN(n))return n;e=e.replace(/^.*\./,"");const i=t[e];return ft(i!==void 0,"Accessing undefined constant GL.".concat(e)),i}function qa(t,e){e=Number(e);for(const n in t)if(t[n]===e)return"GL.".concat(n);return String(e)}const yy={};function Ka(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"id";yy[t]=yy[t]||1;const e=yy[t]++;return"".concat(t,"-").concat(e)}function yE(t){return ft(typeof t=="number","Input must be a number"),t&&(t&t-1)===0}function Cu(t){let e=!0;for(const n in t){e=!1;break}return e}function hP(t,e,n,i){const s="See luma.gl ".concat(n," Upgrade Guide at https://luma.gl/docs/upgrade-guide"),c=Object.getPrototypeOf(t);i.forEach(d=>{c.methodName||(c[d]=()=>{throw Pt.removed("Calling removed method ".concat(e,".").concat(d,": "),s)(),new Error(d)})})}const Oc="Resource subclass must define virtual methods";let ia=class{get[Symbol.toStringTag](){return"Resource"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Tg(e);const{id:i,userData:s={}}=n;this.gl=e,this.gl2=e,this.id=i||Ka(this[Symbol.toStringTag]),this.userData=s,this._bound=!1,this._handle=n.handle,this._handle===void 0&&(this._handle=this._createHandle()),this.byteLength=0,this._addStats()}toString(){return"".concat(this[Symbol.toStringTag]||this.constructor.name,"(").concat(this.id,")")}get handle(){return this._handle}delete(){let{deleteChildren:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=this._handle&&this._deleteHandle(this._handle);return this._handle&&this._removeStats(),this._handle=null,n&&e&&n.filter(Boolean).forEach(i=>i.delete()),this}bind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.handle;if(typeof e!="function")return this._bindHandle(e),this;let n;return this._bound?n=e():(this._bindHandle(this.handle),this._bound=!0,n=e(),this._bound=!1,this._bindHandle(null)),n}unbind(){this.bind(null)}getParameter(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};e=_y(this.gl,e),ft(e);const s=(this.constructor.PARAMETERS||{})[e];if(s){const c=Yt(this.gl);if(!((!("webgl2"in s)||c)&&(!("extension"in s)||this.gl.getExtension(s.extension)))){const l=s.webgl1,y="webgl2"in s?s.webgl2:s.webgl1;return c?y:l}}return this._getParameter(e,n)}getParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{parameters:n,keys:i}=e,s=this.constructor.PARAMETERS||{},c=Yt(this.gl),d={},l=n||Object.keys(s);for(const y of l){const w=s[y];if(w&&(!("webgl2"in w)||c)&&(!("extension"in w)||this.gl.getExtension(w.extension))){const C=i?qa(this.gl,y):y;d[C]=this.getParameter(y,e),i&&w.type==="GLenum"&&(d[C]=qa(this.gl,d[C]))}}return d}setParameter(e,n){e=_y(this.gl,e),ft(e);const s=(this.constructor.PARAMETERS||{})[e];if(s){const c=Yt(this.gl);if(!((!("webgl2"in s)||c)&&(!("extension"in s)||this.gl.getExtension(s.extension))))throw new Error("Parameter not available on this platform");s.type==="GLenum"&&(n=_y(n))}return this._setParameter(e,n),this}setParameters(e){for(const n in e)this.setParameter(n,e[n]);return this}stubRemovedMethods(e,n,i){return hP(this,e,n,i)}initialize(e){}_createHandle(){throw new Error(Oc)}_deleteHandle(){throw new Error(Oc)}_bindHandle(e){throw new Error(Oc)}_getOptsFromHandle(){throw new Error(Oc)}_getParameter(e,n){throw new Error(Oc)}_setParameter(e,n){throw new Error(Oc)}_context(){return this.gl.luma=this.gl.luma||{},this.gl.luma}_addStats(){const e=this[Symbol.toStringTag],n=Nl.get("Resource Counts");n.get("Resources Created").incrementCount(),n.get("".concat(e,"s Created")).incrementCount(),n.get("".concat(e,"s Active")).incrementCount()}_removeStats(){const e=this[Symbol.toStringTag];Nl.get("Resource Counts").get("".concat(e,"s Active")).decrementCount()}_trackAllocatedMemory(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag];this._trackAllocatedMemoryForContext(e,n),this._trackAllocatedMemoryForContext(e,n,this.gl.canvas&&this.gl.canvas.id),this.byteLength=e}_trackAllocatedMemoryForContext(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag],i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";const s=Nl.get("Memory Usage".concat(i));s.get("GPU Memory").addCount(e),s.get("".concat(n," Memory")).addCount(e)}_trackDeallocatedMemory(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag];this._trackDeallocatedMemoryForContext(e),this._trackDeallocatedMemoryForContext(e,this.gl.canvas&&this.gl.canvas.id),this.byteLength=0}_trackDeallocatedMemoryForContext(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag],n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";const i=Nl.get("Memory Usage".concat(n));i.get("GPU Memory").subtractCount(this.byteLength),i.get("".concat(e," Memory")).subtractCount(this.byteLength)}};const hO="Failed to deduce GL constant from typed array";function H0(t){switch(ArrayBuffer.isView(t)?t.constructor:t){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(hO)}}function Fd(t){let{clamped:e=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};switch(t){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return e?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function dO(t){let{data:e,width:n,height:i,bytesPerPixel:s=4,temp:c}=t;const d=n*s;c=c||new Uint8Array(d);for(let l=0;l<i/2;++l){const y=l*d,w=(i-l-1)*d;c.set(e.subarray(y,y+d)),e.copyWithin(y,w,w+d),e.set(c,w)}}function fO(t){let{data:e,width:n,height:i}=t;const s=Math.round(n/2),c=Math.round(i/2),d=new Uint8Array(s*c*4);for(let l=0;l<c;l++)for(let y=0;y<s;y++)for(let w=0;w<4;w++)d[(l*s+y)*4+w]=e[(l*2*n+y*2)*4+w];return{data:d,width:s,height:c}}function $0(t,e,n){const{removedProps:i={},deprecatedProps:s={},replacedProps:c={}}=n;for(const l in i)if(l in e){const w=i[l]?"".concat(t,".").concat(i[l]):"N/A";Pt.removed("".concat(t,".").concat(l),w)()}for(const l in s)if(l in e){const y=s[l];Pt.deprecated("".concat(t,".").concat(l),"".concat(t,".").concat(y))()}let d=null;for(const l in c)if(l in e){const y=c[l];Pt.deprecated("".concat(t,".").concat(l),"".concat(t,".").concat(y))(),d=d||Object.assign({},e),d[y]=e[l],delete d[l]}return d||e}const pO={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},mO={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class ns{static getBytesPerElement(e){return Fd(e.type||5126).BYTES_PER_ELEMENT}static getBytesPerVertex(e){return ft(e.size),Fd(e.type||5126).BYTES_PER_ELEMENT*e.size}static resolve(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return new ns(pO,...n)}constructor(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];n.forEach(s=>this._assign(s)),Object.freeze(this)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return ns.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return ns.getBytesPerVertex(this)}_assign(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e=$0("Accessor",e,mO),e.type!==void 0&&(this.type=e.type,(e.type===5124||e.type===5125)&&(this.integer=!0)),e.size!==void 0&&(this.size=e.size),e.offset!==void 0&&(this.offset=e.offset),e.stride!==void 0&&(this.stride=e.stride),e.normalized!==void 0&&(this.normalized=e.normalized),e.integer!==void 0&&(this.integer=e.integer),e.divisor!==void 0&&(this.divisor=e.divisor),e.buffer!==void 0&&(this.buffer=e.buffer),e.index!==void 0&&(typeof e.index=="boolean"?this.index=e.index?1:0:this.index=e.index),e.instanced!==void 0&&(this.divisor=e.instanced?1:0),e.isInstanced!==void 0&&(this.divisor=e.isInstanced?1:0),this}}const vE=10,dP={offset:"accessor.offset",stride:"accessor.stride",type:"accessor.type",size:"accessor.size",divisor:"accessor.divisor",normalized:"accessor.normalized",integer:"accessor.integer",instanced:"accessor.divisor",isInstanced:"accessor.divisor"},gO={removedProps:{},replacedProps:{bytes:"byteLength"},deprecatedProps:dP},_O={removedProps:dP};class vn extends ia{get[Symbol.toStringTag](){return"Buffer"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.stubRemovedMethods("Buffer","v6.0",["layout","setLayout","getIndexedParameter"]),this.target=n.target||(this.gl.webgl2?36662:34962),this.initialize(n),Object.seal(this)}getElementCount(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/ns.getBytesPerElement(e))}getVertexCount(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/ns.getBytesPerVertex(e))}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return ArrayBuffer.isView(e)&&(e={data:e}),Number.isFinite(e)&&(e={byteLength:e}),e=$0("Buffer",e,gO),this.usage=e.usage||35044,this.debugData=null,this.setAccessor(Object.assign({},e,e.accessor)),e.data?this._setData(e.data,e.offset,e.byteLength):this._setByteLength(e.byteLength||0),this}setProps(e){return e=$0("Buffer",e,_O),"accessor"in e&&this.setAccessor(e.accessor),this}setAccessor(e){return e=Object.assign({},e),delete e.buffer,this.accessor=new ns(e),this}reallocate(e){return e>this.byteLength?(this._setByteLength(e),!0):(this.bytesUsed=e,!1)}setData(e){return this.initialize(e)}subData(e){ArrayBuffer.isView(e)&&(e={data:e});const{data:n,offset:i=0,srcOffset:s=0}=e,c=e.byteLength||e.length;ft(n);const d=this.gl.webgl2?36663:this.target;return this.gl.bindBuffer(d,this.handle),s!==0||c!==void 0?(ar(this.gl),this.gl.bufferSubData(this.target,i,n,s,c)):this.gl.bufferSubData(d,i,n),this.gl.bindBuffer(d,null),this.debugData=null,this._inferType(n),this}copyData(e){let{sourceBuffer:n,readOffset:i=0,writeOffset:s=0,size:c}=e;const{gl:d}=this;return ar(d),d.bindBuffer(36662,n.handle),d.bindBuffer(36663,this.handle),d.copyBufferSubData(36662,36663,i,s,c),d.bindBuffer(36662,null),d.bindBuffer(36663,null),this.debugData=null,this}getData(){let{dstData:e=null,srcByteOffset:n=0,dstOffset:i=0,length:s=0}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};ar(this.gl);const c=Fd(this.accessor.type||5126,{clamped:!1}),d=this._getAvailableElementCount(n),l=i;let y,w;e?(w=e.length,y=w-l):(y=Math.min(d,s||d),w=l+y);const S=Math.min(d,y);return s=s||S,ft(s<=S),e=e||new c(w),this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,n,e,i,s),this.gl.bindBuffer(36662,null),e}bind(){let{target:e=this.target,index:n=this.accessor&&this.accessor.index,offset:i=0,size:s}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e===35345||e===35982?s!==void 0?this.gl.bindBufferRange(e,n,this.handle,i,s):(ft(i===0),this.gl.bindBufferBase(e,n,this.handle)):this.gl.bindBuffer(e,this.handle),this}unbind(){let{target:e=this.target,index:n=this.accessor&&this.accessor.index}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e===35345||e===35982?this.gl.bindBufferBase(e,n,null):this.gl.bindBuffer(e,null),this}getDebugData(){return this.debugData?{data:this.debugData,changed:!1}:(this.debugData=this.getData({length:Math.min(vE,this.byteLength)}),{data:this.debugData,changed:!0})}invalidateDebugData(){this.debugData=null}_setData(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:e.byteLength+n;ft(ArrayBuffer.isView(e)),this._trackDeallocatedMemory();const s=this._getTarget();this.gl.bindBuffer(s,this.handle),this.gl.bufferData(s,i,this.usage),this.gl.bufferSubData(s,n,e),this.gl.bindBuffer(s,null),this.debugData=e.slice(0,vE),this.bytesUsed=i,this._trackAllocatedMemory(i);const c=H0(e);return ft(c),this.setAccessor(new ns(this.accessor,{type:c})),this}_setByteLength(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.usage;ft(e>=0),this._trackDeallocatedMemory();let i=e;e===0&&(i=new Float32Array(0));const s=this._getTarget();return this.gl.bindBuffer(s,this.handle),this.gl.bufferData(s,i,n),this.gl.bindBuffer(s,null),this.usage=n,this.debugData=null,this.bytesUsed=e,this._trackAllocatedMemory(e),this}_getTarget(){return this.gl.webgl2?36663:this.target}_getAvailableElementCount(e){const n=Fd(this.accessor.type||5126,{clamped:!1}),i=e/n.BYTES_PER_ELEMENT;return this.getElementCount()-i}_inferType(e){this.accessor.type||this.setAccessor(new ns(this.accessor,{type:H0(e)}))}_createHandle(){return this.gl.createBuffer()}_deleteHandle(){this.gl.deleteBuffer(this.handle),this._trackDeallocatedMemory()}_getParameter(e){this.gl.bindBuffer(this.target,this.handle);const n=this.gl.getBufferParameter(this.target,e);return this.gl.bindBuffer(this.target,null),n}get type(){return Pt.deprecated("Buffer.type","Buffer.accessor.type")(),this.accessor.type}get bytes(){return Pt.deprecated("Buffer.bytes","Buffer.byteLength")(),this.byteLength}setByteLength(e){return Pt.deprecated("setByteLength","reallocate")(),this.reallocate(e)}updateAccessor(e){return Pt.deprecated("updateAccessor(...)","setAccessor(new Accessor(buffer.accessor, ...)")(),this.accessor=new ns(this.accessor,e),this}}const Px={6407:{dataFormat:6407,types:[5121,33635]},6408:{dataFormat:6408,types:[5121,32819,32820]},6406:{dataFormat:6406,types:[5121]},6409:{dataFormat:6409,types:[5121]},6410:{dataFormat:6410,types:[5121]},33326:{dataFormat:6403,types:[5126],gl2:!0},33328:{dataFormat:33319,types:[5126],gl2:!0},34837:{dataFormat:6407,types:[5126],gl2:!0},34836:{dataFormat:6408,types:[5126],gl2:!0}},fP={6403:1,36244:1,33319:2,33320:2,6407:3,36248:3,6408:4,36249:4,6402:1,34041:1,6406:1,6409:1,6410:2},pP={5126:4,5125:4,5124:4,5123:2,5122:2,5131:2,5120:1,5121:1};function yO(t,e){const n=Px[e];if(!n)return!1;if(n.gl1===void 0&&n.gl2===void 0)return!0;const i=Yt(t)&&n.gl2||n.gl1;return typeof i=="string"?t.getExtension(i):i}function vO(t,e){const n=Px[e];switch(n&&n.types[0]){case 5126:return t.getExtension("OES_texture_float_linear");case 5131:return t.getExtension("OES_texture_half_float_linear");default:return!0}}const xO=[9729,9728],xE=globalThis.WebGLBuffer||function(){};class Mu extends ia{get[Symbol.toStringTag](){return"Texture"}static isSupported(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{format:i,linearFiltering:s}=n;let c=!0;return i&&(c=c&&yO(e,i),c=c&&(!s||vO(e,i))),c}constructor(e,n){const{id:i=Ka("texture"),handle:s,target:c}=n;super(e,{id:i,handle:s}),this.target=c,this.textureUnit=void 0,this.loaded=!1,this.width=void 0,this.height=void 0,this.depth=void 0,this.format=void 0,this.type=void 0,this.dataFormat=void 0,this.border=void 0,this.textureUnit=void 0,this.mipmaps=void 0}toString(){return"Texture(".concat(this.id,",").concat(this.width,"x").concat(this.height,")")}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=e.data;if(n instanceof Promise)return n.then(V=>this.initialize(Object.assign({},e,{pixels:V,data:V}))),this;const i=typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement;if(i&&n.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,n.addEventListener("loadeddata",()=>this.initialize(e)),this;const{pixels:s=null,format:c=6408,border:d=0,recreate:l=!1,parameters:y={},pixelStore:w={},textureUnit:S=void 0}=e;n||(n=s);let{width:C,height:P,dataFormat:D,type:U,compressed:H=!1,mipmaps:ae=!0}=e;const{depth:G=0}=e;return{width:C,height:P,compressed:H,dataFormat:D,type:U}=this._deduceParameters({format:c,type:U,dataFormat:D,compressed:H,data:n,width:C,height:P}),this.width=C,this.height=P,this.depth=G,this.format=c,this.type=U,this.dataFormat=D,this.border=d,this.textureUnit=S,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),ae&&this._isNPOT()&&(Pt.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),ae=!1,this._updateForNPOT(y)),this.mipmaps=ae,this.setImageData({data:n,width:C,height:P,depth:G,format:c,type:U,dataFormat:D,border:d,mipmaps:ae,parameters:w,compressed:H}),ae&&this.generateMipmap(),this.setParameters(y),l&&(this.data=n),i&&(this._video={video:n,parameters:y,lastTime:n.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?n.currentTime:-1}),this}update(){if(this._video){const{video:e,parameters:n,lastTime:i}=this._video;if(i===e.currentTime||e.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:e,parameters:n}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=e.currentTime}}resize(e){let{height:n,width:i,mipmaps:s=!1}=e;return i!==this.width||n!==this.height?this.initialize({width:i,height:n,format:this.format,type:this.type,dataFormat:this.dataFormat,border:this.border,mipmaps:s}):this}generateMipmap(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isNPOT()?(Pt.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),this):(this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),Nr(this.gl,e,()=>{this.gl.generateMipmap(this.target)}),this.gl.bindTexture(this.target,null),this)}setImageData(e){this._trackDeallocatedMemory("Texture");const{target:n=this.target,pixels:i=null,level:s=0,format:c=this.format,border:d=this.border,offset:l=0,parameters:y={}}=e;let{data:w=null,type:S=this.type,width:C=this.width,height:P=this.height,dataFormat:D=this.dataFormat,compressed:U=!1}=e;w||(w=i),{type:S,dataFormat:D,compressed:U,width:C,height:P}=this._deduceParameters({format:c,type:S,dataFormat:D,compressed:U,data:w,width:C,height:P});const{gl:H}=this;H.bindTexture(this.target,this.handle);let ae=null;({data:w,dataType:ae}=this._getDataType({data:w,compressed:U}));let G,V=0;if(Nr(this.gl,y,()=>{switch(ae){case"null":H.texImage2D(n,s,c,C,P,d,D,S,w);break;case"typed-array":H.texImage2D(n,s,c,C,P,d,D,S,w,l);break;case"buffer":G=ar(H),G.bindBuffer(35052,w.handle||w),G.texImage2D(n,s,c,C,P,d,D,S,l),G.bindBuffer(35052,null);break;case"browser-object":Yt(H)?H.texImage2D(n,s,c,C,P,d,D,S,w):H.texImage2D(n,s,c,D,S,w);break;case"compressed":for(const[W,ie]of w.entries())H.compressedTexImage2D(n,W,ie.format,ie.width,ie.height,d,ie.data),V+=ie.levelSize;break;default:ft(!1,"Unknown image data type")}}),ae==="compressed")this._trackAllocatedMemory(V,"Texture");else if(w&&w.byteLength)this._trackAllocatedMemory(w.byteLength,"Texture");else{const W=fP[this.dataFormat]||4,ie=pP[this.type]||1;this._trackAllocatedMemory(this.width*this.height*W*ie,"Texture")}return this.loaded=!0,this}setSubImageData(e){let{target:n=this.target,pixels:i=null,data:s=null,x:c=0,y:d=0,width:l=this.width,height:y=this.height,level:w=0,format:S=this.format,type:C=this.type,dataFormat:P=this.dataFormat,compressed:D=!1,offset:U=0,border:H=this.border,parameters:ae={}}=e;if({type:C,dataFormat:P,compressed:D,width:l,height:y}=this._deduceParameters({format:S,type:C,dataFormat:P,compressed:D,data:s,width:l,height:y}),ft(this.depth===0,"texSubImage not supported for 3D textures"),s||(s=i),s&&s.data){const G=s;s=G.data,l=G.shape[0],y=G.shape[1]}s instanceof vn&&(s=s.handle),this.gl.bindTexture(this.target,this.handle),Nr(this.gl,ae,()=>{if(D)this.gl.compressedTexSubImage2D(n,w,c,d,l,y,S,s);else if(s===null)this.gl.texSubImage2D(n,w,c,d,l,y,P,C,null);else if(ArrayBuffer.isView(s))this.gl.texSubImage2D(n,w,c,d,l,y,P,C,s,U);else if(s instanceof xE){const G=ar(this.gl);G.bindBuffer(35052,s),G.texSubImage2D(n,w,c,d,l,y,P,C,U),G.bindBuffer(35052,null)}else Yt(this.gl)?ar(this.gl).texSubImage2D(n,w,c,d,l,y,P,C,s):this.gl.texSubImage2D(n,w,c,d,P,C,s)}),this.gl.bindTexture(this.target,null)}copyFramebuffer(){return Pt.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit;const{gl:n}=this;return e!==void 0&&(this.textureUnit=e,n.activeTexture(33984+e)),n.bindTexture(this.target,this.handle),e}unbind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit;const{gl:n}=this;return e!==void 0&&(this.textureUnit=e,n.activeTexture(33984+e)),n.bindTexture(this.target,null),e}_getDataType(e){let{data:n,compressed:i=!1}=e;return i?{data:n,dataType:"compressed"}:n===null?{data:n,dataType:"null"}:ArrayBuffer.isView(n)?{data:n,dataType:"typed-array"}:n instanceof vn?{data:n.handle,dataType:"buffer"}:n instanceof xE?{data:n,dataType:"buffer"}:{data:n,dataType:"browser-object"}}_deduceParameters(e){const{format:n,data:i}=e;let{width:s,height:c,dataFormat:d,type:l,compressed:y}=e;const w=Px[n];return d=d||w&&w.dataFormat,l=l||w&&w.types[0],y=y||w&&w.compressed,{width:s,height:c}=this._deduceImageSize(i,s,c),{dataFormat:d,type:l,compressed:y,width:s,height:c,format:n,data:i}}_deduceImageSize(e,n,i){let s;return typeof ImageData<"u"&&e instanceof ImageData?s={width:e.width,height:e.height}:typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement?s={width:e.naturalWidth,height:e.naturalHeight}:typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement?s={width:e.width,height:e.height}:typeof ImageBitmap<"u"&&e instanceof ImageBitmap?s={width:e.width,height:e.height}:typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement?s={width:e.videoWidth,height:e.videoHeight}:e?s={width:n,height:i}:s={width:n>=0?n:1,height:i>=0?i:1},ft(s,"Could not deduced texture size"),ft(n===void 0||s.width===n,"Deduced texture width does not match supplied width"),ft(i===void 0||s.height===i,"Deduced texture height does not match supplied height"),s}_createHandle(){return this.gl.createTexture()}_deleteHandle(){this.gl.deleteTexture(this.handle),this._trackDeallocatedMemory("Texture")}_getParameter(e){switch(e){case 4096:return this.width;case 4097:return this.height;default:this.gl.bindTexture(this.target,this.handle);const n=this.gl.getTexParameter(this.target,e);return this.gl.bindTexture(this.target,null),n}}_setParameter(e,n){switch(this.gl.bindTexture(this.target,this.handle),n=this._getNPOTParam(e,n),e){case 33082:case 33083:this.gl.texParameterf(this.handle,e,n);break;case 4096:case 4097:ft(!1);break;default:this.gl.texParameteri(this.target,e,n);break}return this.gl.bindTexture(this.target,null),this}_isNPOT(){return Yt(this.gl)||!this.width||!this.height?!1:!yE(this.width)||!yE(this.height)}_updateForNPOT(e){e[this.gl.TEXTURE_MIN_FILTER]===void 0&&(e[this.gl.TEXTURE_MIN_FILTER]=this.gl.LINEAR),e[this.gl.TEXTURE_WRAP_S]===void 0&&(e[this.gl.TEXTURE_WRAP_S]=this.gl.CLAMP_TO_EDGE),e[this.gl.TEXTURE_WRAP_T]===void 0&&(e[this.gl.TEXTURE_WRAP_T]=this.gl.CLAMP_TO_EDGE)}_getNPOTParam(e,n){if(this._isNPOT())switch(e){case 10241:xO.indexOf(n)===-1&&(n=9729);break;case 10242:case 10243:n!==33071&&(n=33071);break}return n}}let bO="";function wO(t,e){return ft(typeof t=="string"),t=bO+t,new Promise((n,i)=>{try{const s=new Image;s.onload=()=>n(s),s.onerror=()=>i(new Error("Could not load image ".concat(t,"."))),s.crossOrigin=e&&e.crossOrigin||"anonymous",s.src=t}catch(s){i(s)}})}class Ls extends Mu{get[Symbol.toStringTag](){return"Texture2D"}static isSupported(e,n){return Mu.isSupported(e,n)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Tg(e),(n instanceof Promise||typeof n=="string")&&(n={data:n}),typeof n.data=="string"&&(n=Object.assign({},n,{data:wO(n.data)})),super(e,Object.assign({},n,{target:3553})),this.initialize(n),Object.seal(this)}}const q0=[34069,34070,34071,34072,34073,34074];class mP extends Mu{get[Symbol.toStringTag](){return"TextureCube"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Tg(e),super(e,Object.assign({},n,{target:34067})),this.initialize(n),Object.seal(this)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{mipmaps:n=!0,parameters:i={}}=e;return this.opts=e,this.setCubeMapImageData(e).then(()=>{this.loaded=!0,n&&this.generateMipmap(e),this.setParameters(i)}),this}subImage(e){let{face:n,data:i,x:s=0,y:c=0,mipmapLevel:d=0}=e;return this._subImage({target:n,data:i,x:s,y:c,mipmapLevel:d})}async setCubeMapImageData(e){let{width:n,height:i,pixels:s,data:c,border:d=0,format:l=6408,type:y=5121}=e;const{gl:w}=this,S=s||c,C=await Promise.all(q0.map(P=>{const D=S[P];return Promise.all(Array.isArray(D)?D:[D])}));this.bind(),q0.forEach((P,D)=>{C[D].length>1&&this.opts.mipmaps!==!1&&Pt.warn("".concat(this.id," has mipmap and multiple LODs."))(),C[D].forEach((U,H)=>{n&&i?w.texImage2D(P,H,l,n,i,d,l,y,U):w.texImage2D(P,H,l,l,y,U)})}),this.unbind()}setImageDataForFace(e){const{face:n,width:i,height:s,pixels:c,data:d,border:l=0,format:y=6408,type:w=5121}=e,{gl:S}=this,C=c||d;return this.bind(),C instanceof Promise?C.then(P=>this.setImageDataForFace(Object.assign({},e,{face:n,data:P,pixels:P}))):this.width||this.height?S.texImage2D(n,0,y,i,s,l,y,w,C):S.texImage2D(n,0,y,y,w,C),this}}mP.FACES=q0;class EO extends Mu{get[Symbol.toStringTag](){return"Texture3D"}static isSupported(e){return Yt(e)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};ar(e),n=Object.assign({depth:1},n,{target:32879,unpackFlipY:!1}),super(e,n),this.initialize(n),Object.seal(this)}setImageData(e){let{level:n=0,dataFormat:i=6408,width:s,height:c,depth:d=1,border:l=0,format:y,type:w=5121,offset:S=0,data:C,parameters:P={}}=e;if(this._trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle),Nr(this.gl,P,()=>{ArrayBuffer.isView(C)&&this.gl.texImage3D(this.target,n,i,s,c,d,l,y,w,C),C instanceof vn&&(this.gl.bindBuffer(35052,C.handle),this.gl.texImage3D(this.target,n,i,s,c,d,l,y,w,S))}),C&&C.byteLength)this._trackAllocatedMemory(C.byteLength,"Texture");else{const D=fP[this.dataFormat]||4,U=pP[this.type]||1;this._trackAllocatedMemory(this.width*this.height*this.depth*D*U,"Texture")}return this.loaded=!0,this}}const Pl="EXT_color_buffer_float",bE={33189:{bpp:2},33190:{gl2:!0,bpp:3},36012:{gl2:!0,bpp:4},36168:{bpp:1},34041:{bpp:4},35056:{gl2:!0,bpp:4},36013:{gl2:!0,bpp:5},32854:{bpp:2},36194:{bpp:2},32855:{bpp:2},33321:{gl2:!0,bpp:1},33330:{gl2:!0,bpp:1},33329:{gl2:!0,bpp:1},33332:{gl2:!0,bpp:2},33331:{gl2:!0,bpp:2},33334:{gl2:!0,bpp:4},33333:{gl2:!0,bpp:4},33323:{gl2:!0,bpp:2},33336:{gl2:!0,bpp:2},33335:{gl2:!0,bpp:2},33338:{gl2:!0,bpp:4},33337:{gl2:!0,bpp:4},33340:{gl2:!0,bpp:8},33339:{gl2:!0,bpp:8},32849:{gl2:!0,bpp:3},32856:{gl2:!0,bpp:4},32857:{gl2:!0,bpp:4},36220:{gl2:!0,bpp:4},36238:{gl2:!0,bpp:4},36975:{gl2:!0,bpp:4},36214:{gl2:!0,bpp:8},36232:{gl2:!0,bpp:8},36226:{gl2:!0,bpp:16},36208:{gl2:!0,bpp:16},33325:{gl2:Pl,bpp:2},33327:{gl2:Pl,bpp:4},34842:{gl2:Pl,bpp:8},33326:{gl2:Pl,bpp:4},33328:{gl2:Pl,bpp:8},34836:{gl2:Pl,bpp:16},35898:{gl2:Pl,bpp:4}};function TO(t,e,n){const i=n[e];if(!i)return!1;const s=Yt(t)&&i.gl2||i.gl1;return typeof s=="string"?t.getExtension(s):s}class cu extends ia{get[Symbol.toStringTag](){return"Renderbuffer"}static isSupported(e){let{format:n}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{format:null};return!n||TO(e,n,bE)}static getSamplesForFormat(e,n){let{format:i}=n;return e.getInternalformatParameter(36161,i,32937)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.initialize(n),Object.seal(this)}initialize(e){let{format:n,width:i=1,height:s=1,samples:c=0}=e;return ft(n,"Needs format"),this._trackDeallocatedMemory(),this.gl.bindRenderbuffer(36161,this.handle),c!==0&&Yt(this.gl)?this.gl.renderbufferStorageMultisample(36161,c,n,i,s):this.gl.renderbufferStorage(36161,n,i,s),this.format=n,this.width=i,this.height=s,this.samples=c,this._trackAllocatedMemory(this.width*this.height*(this.samples||1)*bE[this.format].bpp),this}resize(e){let{width:n,height:i}=e;return n!==this.width||i!==this.height?this.initialize({width:n,height:i,format:this.format,samples:this.samples}):this}_createHandle(){return this.gl.createRenderbuffer()}_deleteHandle(){this.gl.deleteRenderbuffer(this.handle),this._trackDeallocatedMemory()}_bindHandle(e){this.gl.bindRenderbuffer(36161,e)}_syncHandle(e){this.format=this.getParameter(36164),this.width=this.getParameter(36162),this.height=this.getParameter(36163),this.samples=this.getParameter(36011)}_getParameter(e){return this.gl.bindRenderbuffer(36161,this.handle),this.gl.getRenderbufferParameter(36161,e)}}const SO=256,AO=1024,PO=16384,wE=6144,EE=6145,TE=6146,SE=34041,gP="clear: bad arguments";function Ix(t){let{framebuffer:e=null,color:n=null,depth:i=null,stencil:s=null}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const c={};e&&(c.framebuffer=e);let d=0;n&&(d|=PO,n!==!0&&(c.clearColor=n)),i&&(d|=SO,i!==!0&&(c.clearDepth=i)),s&&(d|=AO,i!==!0&&(c.clearStencil=i)),ft(d!==0,gP),Nr(t,c,()=>{t.clear(d)})}function IO(t){let{framebuffer:e=null,buffer:n=wE,drawBuffer:i=0,value:s=[0,0,0,0]}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};ar(t),Nr(t,{framebuffer:e},()=>{switch(n){case wE:switch(s.constructor){case Int32Array:t.clearBufferiv(n,i,s);break;case Uint32Array:t.clearBufferuiv(n,i,s);break;case Float32Array:default:t.clearBufferfv(n,i,s)}break;case EE:t.clearBufferfv(EE,0,[s]);break;case TE:t.clearBufferiv(TE,0,[s]);break;case SE:const[c,d]=s;t.clearBufferfi(SE,0,c,d);break;default:ft(!1,gP)}})}function _P(t){switch(t){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return ft(!1),0}}function CO(t){switch(t){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return ft(!1),0}}function Sg(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{sourceX:n=0,sourceY:i=0,sourceFormat:s=6408}=e;let{sourceAttachment:c=36064,target:d=null,sourceWidth:l,sourceHeight:y,sourceType:w}=e;const{framebuffer:S,deleteFramebuffer:C}=yP(t);ft(S);const{gl:P,handle:D,attachments:U}=S;l=l||S.width,y=y||S.height,c===36064&&D===null&&(c=1028),ft(U[c]),w=w||U[c].type,d=MO(d,w,s,l,y),w=w||H0(d);const H=P.bindFramebuffer(36160,D);return P.readPixels(n,i,l,y,s,w,d),P.bindFramebuffer(36160,H||null),C&&S.delete(),d}function Cp(t,e){let{sourceX:n=0,sourceY:i=0,sourceFormat:s=6408,target:c=null,targetByteOffset:d=0,sourceWidth:l,sourceHeight:y,sourceType:w}=e;const{framebuffer:S,deleteFramebuffer:C}=yP(t);ft(S),l=l||S.width,y=y||S.height;const P=ar(S.gl);if(w=w||(c?c.type:5121),!c){const D=_P(s),U=CO(w),H=d+l*y*D*U;c=new vn(P,{byteLength:H,accessor:{type:w,size:D}})}return c.bind({target:35051}),Nr(P,{framebuffer:S},()=>{P.readPixels(n,i,l,y,s,w,d)}),c.unbind({target:35051}),C&&S.delete(),c}function AE(t){let{sourceAttachment:e=36064,targetMaxHeight:n=Number.MAX_SAFE_INTEGER}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=Sg(t,{sourceAttachment:e}),{width:s,height:c}=t;for(;c>n;)({data:i,width:s,height:c}=fO({data:i,width:s,height:c}));dO({data:i,width:s,height:c});const d=document.createElement("canvas");d.width=s,d.height=c;const l=d.getContext("2d"),y=l.createImageData(s,c);return y.data.set(i),l.putImageData(y,0,0),d.toDataURL()}function yP(t){return t instanceof _i?{framebuffer:t,deleteFramebuffer:!1}:{framebuffer:UO(t),deleteFramebuffer:!0}}function MO(t,e,n,i,s){if(t)return t;e=e||5121;const c=Fd(e,{clamped:!1}),d=_P(n);return new c(i*s*d)}const gn={WEBGL2:"WEBGL2",VERTEX_ARRAY_OBJECT:"VERTEX_ARRAY_OBJECT",TIMER_QUERY:"TIMER_QUERY",INSTANCED_RENDERING:"INSTANCED_RENDERING",MULTIPLE_RENDER_TARGETS:"MULTIPLE_RENDER_TARGETS",ELEMENT_INDEX_UINT32:"ELEMENT_INDEX_UINT32",BLEND_EQUATION_MINMAX:"BLEND_EQUATION_MINMAX",FLOAT_BLEND:"FLOAT_BLEND",COLOR_ENCODING_SRGB:"COLOR_ENCODING_SRGB",TEXTURE_DEPTH:"TEXTURE_DEPTH",TEXTURE_FLOAT:"TEXTURE_FLOAT",TEXTURE_HALF_FLOAT:"TEXTURE_HALF_FLOAT",TEXTURE_FILTER_LINEAR_FLOAT:"TEXTURE_FILTER_LINEAR_FLOAT",TEXTURE_FILTER_LINEAR_HALF_FLOAT:"TEXTURE_FILTER_LINEAR_HALF_FLOAT",TEXTURE_FILTER_ANISOTROPIC:"TEXTURE_FILTER_ANISOTROPIC",COLOR_ATTACHMENT_RGBA32F:"COLOR_ATTACHMENT_RGBA32F",COLOR_ATTACHMENT_FLOAT:"COLOR_ATTACHMENT_FLOAT",COLOR_ATTACHMENT_HALF_FLOAT:"COLOR_ATTACHMENT_HALF_FLOAT",GLSL_FRAG_DATA:"GLSL_FRAG_DATA",GLSL_FRAG_DEPTH:"GLSL_FRAG_DEPTH",GLSL_DERIVATIVES:"GLSL_DERIVATIVES",GLSL_TEXTURE_LOD:"GLSL_TEXTURE_LOD"};function LO(t){const e=new Ls(t,{format:6408,type:5126,dataFormat:6408}),n=new _i(t,{id:"test-framebuffer",check:!1,attachments:{36064:e}}),i=n.getStatus();return e.delete(),n.delete(),i===36053}const vP={[gn.WEBGL2]:[!1,!0],[gn.VERTEX_ARRAY_OBJECT]:["OES_vertex_array_object",!0],[gn.TIMER_QUERY]:["EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2"],[gn.INSTANCED_RENDERING]:["ANGLE_instanced_arrays",!0],[gn.MULTIPLE_RENDER_TARGETS]:["WEBGL_draw_buffers",!0],[gn.ELEMENT_INDEX_UINT32]:["OES_element_index_uint",!0],[gn.BLEND_EQUATION_MINMAX]:["EXT_blend_minmax",!0],[gn.FLOAT_BLEND]:["EXT_float_blend"],[gn.COLOR_ENCODING_SRGB]:["EXT_sRGB",!0],[gn.TEXTURE_DEPTH]:["WEBGL_depth_texture",!0],[gn.TEXTURE_FLOAT]:["OES_texture_float",!0],[gn.TEXTURE_HALF_FLOAT]:["OES_texture_half_float",!0],[gn.TEXTURE_FILTER_LINEAR_FLOAT]:["OES_texture_float_linear"],[gn.TEXTURE_FILTER_LINEAR_HALF_FLOAT]:["OES_texture_half_float_linear"],[gn.TEXTURE_FILTER_ANISOTROPIC]:["EXT_texture_filter_anisotropic"],[gn.COLOR_ATTACHMENT_RGBA32F]:[LO,"EXT_color_buffer_float"],[gn.COLOR_ATTACHMENT_FLOAT]:[!1,"EXT_color_buffer_float"],[gn.COLOR_ATTACHMENT_HALF_FLOAT]:["EXT_color_buffer_half_float"],[gn.GLSL_FRAG_DATA]:["WEBGL_draw_buffers",!0],[gn.GLSL_FRAG_DEPTH]:["EXT_frag_depth",!0],[gn.GLSL_DERIVATIVES]:["OES_standard_derivatives",!0],[gn.GLSL_TEXTURE_LOD]:["EXT_shader_texture_lod",!0]},kO=2;function RO(t,e){return Nd(t,e)}function Nd(t,e){return e=Array.isArray(e)?e:[e],e.every(n=>xP(t,n))}function DO(t){t.luma=t.luma||{},t.luma.caps=t.luma.caps||{};for(const e in vP)t.luma.caps[e]===void 0&&(t.luma.caps[e]=xP(t,e));return t.luma.caps}function xP(t,e){return t.luma=t.luma||{},t.luma.caps=t.luma.caps||{},t.luma.caps[e]===void 0&&(t.luma.caps[e]=zO(t,e)),t.luma.caps[e]||Pt.log(kO,"Feature: ".concat(e," not supported"))(),t.luma.caps[e]}function zO(t,e){const n=vP[e];ft(n,e);let i;const s=Yt(t)&&n[1]||n[0];if(typeof s=="function")i=s(t);else if(Array.isArray(s)){i=!0;for(const c of s)i=i&&!!t.getExtension(c)}else typeof s=="string"?i=!!t.getExtension(s):typeof s=="boolean"?i=s:ft(!1);return i}const PE="Multiple render targets not supported";class _i extends ia{get[Symbol.toStringTag](){return"Framebuffer"}static isSupported(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{colorBufferFloat:i,colorBufferHalfFloat:s}=n;let c=!0;return i&&(c=!!(e.getExtension("EXT_color_buffer_float")||e.getExtension("WEBGL_color_buffer_float")||e.getExtension("OES_texture_float"))),s&&(c=c&&!!(e.getExtension("EXT_color_buffer_float")||e.getExtension("EXT_color_buffer_half_float"))),c}static getDefaultFramebuffer(e){return e.luma=e.luma||{},e.luma.defaultFramebuffer=e.luma.defaultFramebuffer||new _i(e,{id:"default-framebuffer",handle:null,attachments:{}}),e.luma.defaultFramebuffer}get MAX_COLOR_ATTACHMENTS(){const e=ar(this.gl);return e.getParameter(e.MAX_COLOR_ATTACHMENTS)}get MAX_DRAW_BUFFERS(){const e=ar(this.gl);return e.getParameter(e.MAX_DRAW_BUFFERS)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.width=null,this.height=null,this.attachments={},this.readBuffer=36064,this.drawBuffers=[36064],this.ownResources=[],this.initialize(n),Object.seal(this)}get color(){return this.attachments[36064]||null}get texture(){return this.attachments[36064]||null}get depth(){return this.attachments[36096]||this.attachments[33306]||null}get stencil(){return this.attachments[36128]||this.attachments[33306]||null}initialize(e){let{width:n=1,height:i=1,attachments:s=null,color:c=!0,depth:d=!0,stencil:l=!1,check:y=!0,readBuffer:w=void 0,drawBuffers:S=void 0}=e;if(ft(n>=0&&i>=0,"Width and height need to be integers"),this.width=n,this.height=i,s)for(const C in s){const P=s[C];(Array.isArray(P)?P[0]:P).resize({width:n,height:i})}else s=this._createDefaultAttachments(c,d,l,n,i);this.update({clearAttachments:!0,attachments:s,readBuffer:w,drawBuffers:S}),s&&y&&this.checkStatus()}delete(){for(const e of this.ownResources)e.delete();return super.delete(),this}update(e){let{attachments:n={},readBuffer:i,drawBuffers:s,clearAttachments:c=!1,resizeAttachments:d=!0}=e;this.attach(n,{clearAttachments:c,resizeAttachments:d});const{gl:l}=this,y=l.bindFramebuffer(36160,this.handle);return i&&this._setReadBuffer(i),s&&this._setDrawBuffers(s),l.bindFramebuffer(36160,y||null),this}resize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{width:n,height:i}=e;if(this.handle===null)return ft(n===void 0&&i===void 0),this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;n===void 0&&(n=this.gl.drawingBufferWidth),i===void 0&&(i=this.gl.drawingBufferHeight),n!==this.width&&i!==this.height&&Pt.log(2,"Resizing framebuffer ".concat(this.id," to ").concat(n,"x").concat(i))();for(const s in this.attachments)this.attachments[s].resize({width:n,height:i});return this.width=n,this.height=i,this}attach(e){let{clearAttachments:n=!1,resizeAttachments:i=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s={};n&&Object.keys(this.attachments).forEach(d=>{s[d]=null}),Object.assign(s,e);const c=this.gl.bindFramebuffer(36160,this.handle);for(const d in s){ft(d!==void 0,"Misspelled framebuffer binding point?");const l=Number(d),y=s[l];let w=y;if(!w)this._unattach(l);else if(w instanceof cu)this._attachRenderbuffer({attachment:l,renderbuffer:w});else if(Array.isArray(y)){const[S,C=0,P=0]=y;w=S,this._attachTexture({attachment:l,texture:S,layer:C,level:P})}else this._attachTexture({attachment:l,texture:w,layer:0,level:0});i&&w&&w.resize({width:this.width,height:this.height})}this.gl.bindFramebuffer(36160,c||null),Object.assign(this.attachments,e),Object.keys(this.attachments).filter(d=>!this.attachments[d]).forEach(d=>{delete this.attachments[d]})}checkStatus(){const e=this.getStatus();if(e!==36053)throw new Error(FO(e));return this}getStatus(){const{gl:e}=this,n=e.bindFramebuffer(36160,this.handle),i=e.checkFramebufferStatus(36160);return e.bindFramebuffer(36160,n||null),i}clear(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{color:n,depth:i,stencil:s,drawBuffers:c=[]}=e,d=this.gl.bindFramebuffer(36160,this.handle);return(n||i||s)&&Ix(this.gl,{color:n,depth:i,stencil:s}),c.forEach((l,y)=>{IO(this.gl,{drawBuffer:y,value:l})}),this.gl.bindFramebuffer(36160,d||null),this}readPixels(){return Pt.error("Framebuffer.readPixels() is no logner supported, use readPixelsToArray(framebuffer)")(),null}readPixelsToBuffer(){return Pt.error("Framebuffer.readPixelsToBuffer()is no logner supported, use readPixelsToBuffer(framebuffer)")(),null}copyToDataUrl(){return Pt.error("Framebuffer.copyToDataUrl() is no logner supported, use copyToDataUrl(framebuffer)")(),null}copyToImage(){return Pt.error("Framebuffer.copyToImage() is no logner supported, use copyToImage(framebuffer)")(),null}copyToTexture(){return Pt.error("Framebuffer.copyToTexture({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}blit(){return Pt.error("Framebuffer.blit({...}) is no logner supported, use blit(source, target, opts)")(),null}invalidate(e){let{attachments:n=[],x:i=0,y:s=0,width:c,height:d}=e;const l=ar(this.gl),y=l.bindFramebuffer(36008,this.handle);return i===0&&s===0&&c===void 0&&d===void 0?l.invalidateFramebuffer(36008,n):l.invalidateFramebuffer(36008,n,i,s,c,d),l.bindFramebuffer(36008,y),this}getAttachmentParameter(e,n,i){let s=this._getAttachmentParameterFallback(n);return s===null&&(this.gl.bindFramebuffer(36160,this.handle),s=this.gl.getFramebufferAttachmentParameter(36160,e,n),this.gl.bindFramebuffer(36160,null)),i&&s>1e3&&(s=qa(this.gl,s)),s}getAttachmentParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:36064,n=arguments.length>1?arguments[1]:void 0,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.constructor.ATTACHMENT_PARAMETERS||[];const s={};for(const c of i){const d=n?qa(this.gl,c):c;s[d]=this.getAttachmentParameter(e,c,n)}return s}getParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;const n=Object.keys(this.attachments),i={};for(const s of n){const c=Number(s),d=e?qa(this.gl,c):c;i[d]=this.getAttachmentParameters(c,e)}return i}show(){return typeof window<"u"&&window.open(AE(this),"luma-debug-texture"),this}log(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if(e>Pt.level||typeof window>"u")return this;n=n||"Framebuffer ".concat(this.id);const i=AE(this,{targetMaxHeight:100});return Pt.image({logLevel:e,message:n,image:i},n)(),this}bind(){let{target:e=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(e,this.handle),this}unbind(){let{target:e=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(e,null),this}_createDefaultAttachments(e,n,i,s,c){let d=null;return e&&(d=d||{},d[36064]=new Ls(this.gl,{id:"".concat(this.id,"-color0"),pixels:null,format:6408,type:5121,width:s,height:c,mipmaps:!1,parameters:{10241:9729,10240:9729,10242:33071,10243:33071}}),this.ownResources.push(d[36064])),n&&i?(d=d||{},d[33306]=new cu(this.gl,{id:"".concat(this.id,"-depth-stencil"),format:35056,width:s,height:111}),this.ownResources.push(d[33306])):n?(d=d||{},d[36096]=new cu(this.gl,{id:"".concat(this.id,"-depth"),format:33189,width:s,height:c}),this.ownResources.push(d[36096])):i&&ft(!1),d}_unattach(e){const n=this.attachments[e];n&&(n instanceof cu?this.gl.framebufferRenderbuffer(36160,e,36161,null):this.gl.framebufferTexture2D(36160,e,3553,null,0),delete this.attachments[e])}_attachRenderbuffer(e){let{attachment:n=36064,renderbuffer:i}=e;const{gl:s}=this;s.framebufferRenderbuffer(36160,n,36161,i.handle),this.attachments[n]=i}_attachTexture(e){let{attachment:n=36064,texture:i,layer:s,level:c}=e;const{gl:d}=this;switch(d.bindTexture(i.target,i.handle),i.target){case 35866:case 32879:ar(d).framebufferTextureLayer(36160,n,i.target,c,s);break;case 34067:const y=OO(s);d.framebufferTexture2D(36160,n,y,i.handle,c);break;case 3553:d.framebufferTexture2D(36160,n,3553,i.handle,c);break;default:ft(!1,"Illegal texture type")}d.bindTexture(i.target,null),this.attachments[n]=i}_setReadBuffer(e){const n=dz(this.gl);n?n.readBuffer(e):ft(e===36064||e===1029,PE),this.readBuffer=e}_setDrawBuffers(e){const{gl:n}=this,i=ar(n);if(i)i.drawBuffers(e);else{const s=n.getExtension("WEBGL_draw_buffers");s?s.drawBuffersWEBGL(e):ft(e.length===1&&(e[0]===36064||e[0]===1029),PE)}this.drawBuffers=e}_getAttachmentParameterFallback(e){const n=DO(this.gl);switch(e){case 36052:return n.WEBGL2?null:0;case 33298:case 33299:case 33300:case 33301:case 33302:case 33303:return n.WEBGL2?null:8;case 33297:return n.WEBGL2?null:5125;case 33296:return!n.WEBGL2&&!n.EXT_sRGB?9729:null;default:return null}}_createHandle(){return this.gl.createFramebuffer()}_deleteHandle(){this.gl.deleteFramebuffer(this.handle)}_bindHandle(e){return this.gl.bindFramebuffer(36160,e)}}function OO(t){return t<34069?t+34069:t}function FO(t){return(_i.STATUS||{})[t]||"Framebuffer error ".concat(t)}const NO=[36049,36048,33296,33298,33299,33300,33301,33302,33303];_i.ATTACHMENT_PARAMETERS=NO;function BO(t,e){ft(t instanceof Ls||t instanceof mP||t instanceof EO);const n=t.constructor,{gl:i,width:s,height:c,format:d,type:l,dataFormat:y,border:w,mipmaps:S}=t,C=Object.assign({width:s,height:c,format:d,type:l,dataFormat:y,border:w,mipmaps:S},e);return new n(i,C)}function UO(t,e){const{gl:n,width:i,height:s,id:c}=t;return new _i(n,Object.assign({},e,{id:"framebuffer-for-".concat(c),width:i,height:s,attachments:{36064:t}}))}function hm(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"unnamed";const n=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/,i=t.match(n);return i?i[1]:e}const VO=35632,jO=35633;function GO(t){switch(t){case VO:return"fragment";case jO:return"vertex";default:return"unknown type"}}function WO(t,e,n,i){const s=t.split(/\r?\n/),c={},d={},l=i||hm(e)||"(unnamed)",y="".concat(GO(n)," shader ").concat(l);for(let S=0;S<s.length;S++){const C=s[S];if(C.length<=1)continue;const P=C.split(":"),D=P[0],U=parseInt(P[2],10);if(isNaN(U))throw new Error("GLSL compilation error in ".concat(y,": ").concat(t));D!=="WARNING"?c[U]=C:d[U]=C}const w=HO(e);return{shaderName:y,errors:IE(c,w),warnings:IE(d,w)}}function IE(t,e){let n="";for(let i=0;i<e.length;i++){const s=e[i];if(!(!t[i+3]&&!t[i+2]&&!t[i+1])&&(n+="".concat(s,`
`),t[i+1])){const c=t[i+1],d=c.split(":",3),l=d[0],y=parseInt(d[1],10)||0,w=c.substring(d.join(":").length+1).trim();n+=bP("^^^ ".concat(l,": ").concat(w,`

`),y)}}return n}function HO(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:": ";const i=t.split(/\r?\n/),s=String(i.length+e-1).length;return i.map((c,d)=>{const l=String(d+e),y=l.length;return bP(l,s-y)+n+c})}function bP(t,e){let n="";for(let i=0;i<e;++i)n+=" ";return"".concat(n).concat(t)}function wP(t){let e=100;const n=t.match(/[^\s]+/g);if(n.length>=2&&n[0]==="#version"){const i=parseInt(n[1],10);Number.isFinite(i)&&(e=i)}return e}const $O="Shader: GLSL source code must be a JavaScript string";class Bd extends ia{get[Symbol.toStringTag](){return"Shader"}static getTypeName(e){switch(e){case 35633:return"vertex-shader";case 35632:return"fragment-shader";default:return ft(!1),"unknown"}}constructor(e,n){Tg(e),ft(typeof n.source=="string",$O);const i=hm(n.source,null)||n.id||Ka("unnamed ".concat(Bd.getTypeName(n.shaderType)));super(e,{id:i}),this.shaderType=n.shaderType,this.source=n.source,this.initialize(n)}initialize(e){let{source:n}=e;const i=hm(n,null);i&&(this.id=Ka(i)),this._compile(n)}getParameter(e){return this.gl.getShaderParameter(this.handle,e)}toString(){return"".concat(Bd.getTypeName(this.shaderType),":").concat(this.id)}getName(){return hm(this.source)||"unnamed-shader"}getSource(){return this.gl.getShaderSource(this.handle)}getTranslatedSource(){const e=this.gl.getExtension("WEBGL_debug_shaders");return e?e.getTranslatedShaderSource(this.handle):"No translated source available. WEBGL_debug_shaders not implemented"}_compile(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.source;if(e.startsWith("#version ")||(e=`#version 100
`.concat(e)),this.source=e,this.gl.shaderSource(this.handle,this.source),this.gl.compileShader(this.handle),!this.getParameter(35713)){const i=this.gl.getShaderInfoLog(this.handle),{shaderName:s,errors:c,warnings:d}=WO(i,this.source,this.shaderType,this.id);throw Pt.error("GLSL compilation errors in ".concat(s,`
`).concat(c))(),Pt.warn("GLSL compilation warnings in ".concat(s,`
`).concat(d))(),new Error("GLSL compilation errors in ".concat(s))}}_deleteHandle(){this.gl.deleteShader(this.handle)}_getOptsFromHandle(){return{type:this.getParameter(35663),source:this.getSource()}}}class vy extends Bd{get[Symbol.toStringTag](){return"VertexShader"}constructor(e,n){typeof n=="string"&&(n={source:n}),super(e,Object.assign({},n,{shaderType:35633}))}_createHandle(){return this.gl.createShader(35633)}}class xy extends Bd{get[Symbol.toStringTag](){return"FragmentShader"}constructor(e,n){typeof n=="string"&&(n={source:n}),super(e,Object.assign({},n,{shaderType:35632}))}_createHandle(){return this.gl.createShader(35632)}}const qO={5126:Rn.bind(null,"uniform1fv",Jr,1,ir),35664:Rn.bind(null,"uniform2fv",Jr,2,ir),35665:Rn.bind(null,"uniform3fv",Jr,3,ir),35666:Rn.bind(null,"uniform4fv",Jr,4,ir),5124:Rn.bind(null,"uniform1iv",Aa,1,ir),35667:Rn.bind(null,"uniform2iv",Aa,2,ir),35668:Rn.bind(null,"uniform3iv",Aa,3,ir),35669:Rn.bind(null,"uniform4iv",Aa,4,ir),35670:Rn.bind(null,"uniform1iv",Aa,1,ir),35671:Rn.bind(null,"uniform2iv",Aa,2,ir),35672:Rn.bind(null,"uniform3iv",Aa,3,ir),35673:Rn.bind(null,"uniform4iv",Aa,4,ir),35674:Rn.bind(null,"uniformMatrix2fv",Jr,4,Uo),35675:Rn.bind(null,"uniformMatrix3fv",Jr,9,Uo),35676:Rn.bind(null,"uniformMatrix4fv",Jr,16,Uo),35678:Gi,35680:Gi,5125:Rn.bind(null,"uniform1uiv",Mp,1,ir),36294:Rn.bind(null,"uniform2uiv",Mp,2,ir),36295:Rn.bind(null,"uniform3uiv",Mp,3,ir),36296:Rn.bind(null,"uniform4uiv",Mp,4,ir),35685:Rn.bind(null,"uniformMatrix2x3fv",Jr,6,Uo),35686:Rn.bind(null,"uniformMatrix2x4fv",Jr,8,Uo),35687:Rn.bind(null,"uniformMatrix3x2fv",Jr,6,Uo),35688:Rn.bind(null,"uniformMatrix3x4fv",Jr,12,Uo),35689:Rn.bind(null,"uniformMatrix4x2fv",Jr,8,Uo),35690:Rn.bind(null,"uniformMatrix4x3fv",Jr,12,Uo),35678:Gi,35680:Gi,35679:Gi,35682:Gi,36289:Gi,36292:Gi,36293:Gi,36298:Gi,36299:Gi,36300:Gi,36303:Gi,36306:Gi,36307:Gi,36308:Gi,36311:Gi},ZO={},XO={},YO={},CE=[0];function Cx(t,e,n,i){e===1&&typeof t=="boolean"&&(t=t?1:0),Number.isFinite(t)&&(CE[0]=t,t=CE);const s=t.length;if(s%e&&Pt.warn("Uniform size should be multiples of ".concat(e),t)(),t instanceof n)return t;let c=i[s];c||(c=new n(s),i[s]=c);for(let d=0;d<s;d++)c[d]=t[d];return c}function Jr(t,e){return Cx(t,e,Float32Array,ZO)}function Aa(t,e){return Cx(t,e,Int32Array,XO)}function Mp(t,e){return Cx(t,e,Uint32Array,YO)}function ME(t,e,n){const i=qO[n.type];if(!i)throw new Error("Unknown GLSL uniform type ".concat(n.type));return i().bind(null,t,e)}function KO(t){if(t[t.length-1]!=="]")return{name:t,length:1,isArray:!1};const e=/([^[]*)(\[[0-9]+\])?/,n=t.match(e);if(!n||n.length<2)throw new Error("Failed to parse GLSL uniform name ".concat(t));return{name:n[1],length:n[2]||1,isArray:!!n[2]}}function JO(t,e,n){for(const i in t){const s=t[i];if((!n||!!n[i])&&!QO(s))throw e=e?"".concat(e," "):"",console.error("".concat(e," Bad uniform ").concat(i),s),new Error("".concat(e," Bad uniform ").concat(i))}return!0}function QO(t){return Array.isArray(t)||ArrayBuffer.isView(t)?t4(t):isFinite(t)||t===!0||t===!1||t instanceof Mu||t instanceof cu?!0:t instanceof _i?!!t.texture:!1}function e4(t,e,n){if(Array.isArray(n)||ArrayBuffer.isView(n))if(t[e]){const i=t[e];for(let s=0,c=n.length;s<c;++s)i[s]=n[s]}else t[e]=n.slice();else t[e]=n}function t4(t){if(t.length===0)return!1;const e=Math.min(t.length,16);for(let n=0;n<e;++n)if(!Number.isFinite(t[n]))return!1;return!0}function Gi(){let t=null;return(e,n,i)=>{const s=t!==i;return s&&(e.uniform1i(n,i),t=i),s}}function Rn(t,e,n,i){let s=null,c=null;return(d,l,y)=>{const w=e(y,n),S=w.length;let C=!1;if(s===null)s=new Float32Array(S),c=S,C=!0;else{ft(c===S,"Uniform length cannot change.");for(let P=0;P<S;++P)if(w[P]!==s[P]){C=!0;break}}return C&&(i(d,t,l,w),s.set(w)),C}}function ir(t,e,n,i){t[e](n,i)}function Uo(t,e,n,i){t[e](n,!1,i)}const n4=5120,i4=5121,r4=5122,s4=5123,LE=0,Lp=1,o4=2,a4=3,kp=4,l4=5,c4=6,wi=5126,u4=35664,h4=35665,d4=35666,Zh=5124,f4=35667,p4=35668,m4=35669,Xh=5125,g4=36294,_4=36295,y4=36296,v4=35670,x4=35671,b4=35672,w4=35673,E4=35674,T4=35675,S4=35676,A4=35685,P4=35686,I4=35687,C4=35688,M4=35689,L4=35690,Z0={[wi]:[wi,1,"float"],[u4]:[wi,2,"vec2"],[h4]:[wi,3,"vec3"],[d4]:[wi,4,"vec4"],[Zh]:[Zh,1,"int"],[f4]:[Zh,2,"ivec2"],[p4]:[Zh,3,"ivec3"],[m4]:[Zh,4,"ivec4"],[Xh]:[Xh,1,"uint"],[g4]:[Xh,2,"uvec2"],[_4]:[Xh,3,"uvec3"],[y4]:[Xh,4,"uvec4"],[v4]:[wi,1,"bool"],[x4]:[wi,2,"bvec2"],[b4]:[wi,3,"bvec3"],[w4]:[wi,4,"bvec4"],[E4]:[wi,8,"mat2"],[A4]:[wi,8,"mat2x3"],[P4]:[wi,8,"mat2x4"],[T4]:[wi,12,"mat3"],[I4]:[wi,12,"mat3x2"],[C4]:[wi,12,"mat3x4"],[S4]:[wi,16,"mat4"],[M4]:[wi,16,"mat4x2"],[L4]:[wi,16,"mat4x3"]};function k4(t){switch(t){case LE:return LE;case Lp:return Lp;case a4:return Lp;case o4:return Lp;case kp:return kp;case l4:return kp;case c4:return kp;default:return ft(!1),0}}function kE(t){const e=Z0[t];if(!e)return null;const[n,i]=e;return{type:n,components:i}}function EP(t,e){switch(t){case n4:case i4:case r4:case s4:t=wi;break}for(const n in Z0){const[i,s,c]=Z0[n];if(i===t&&s===e)return{glType:n,name:c}}return null}class R4{constructor(e){this.id=e.id,this.attributeInfos=[],this.attributeInfosByName={},this.attributeInfosByLocation=[],this.varyingInfos=[],this.varyingInfosByName={},Object.seal(this),this._readAttributesFromProgram(e),this._readVaryingsFromProgram(e)}getAttributeInfo(e){const n=Number(e);return Number.isFinite(n)?this.attributeInfosByLocation[n]:this.attributeInfosByName[e]||null}getAttributeLocation(e){const n=this.getAttributeInfo(e);return n?n.location:-1}getAttributeAccessor(e){const n=this.getAttributeInfo(e);return n?n.accessor:null}getVaryingInfo(e){const n=Number(e);return Number.isFinite(n)?this.varyingInfos[n]:this.varyingInfosByName[e]||null}getVaryingIndex(e){const n=this.getVaryingInfo();return n?n.location:-1}getVaryingAccessor(e){const n=this.getVaryingInfo();return n?n.accessor:null}_readAttributesFromProgram(e){const{gl:n}=e,i=n.getProgramParameter(e.handle,35721);for(let s=0;s<i;s++){const{name:c,type:d,size:l}=n.getActiveAttrib(e.handle,s),y=n.getAttribLocation(e.handle,c);y>=0&&this._addAttribute(y,c,d,l)}this.attributeInfos.sort((s,c)=>s.location-c.location)}_readVaryingsFromProgram(e){const{gl:n}=e;if(!Yt(n))return;const i=n.getProgramParameter(e.handle,35971);for(let s=0;s<i;s++){const{name:c,type:d,size:l}=n.getTransformFeedbackVarying(e.handle,s);this._addVarying(s,c,d,l)}this.varyingInfos.sort((s,c)=>s.location-c.location)}_addAttribute(e,n,i,s){const{type:c,components:d}=kE(i),l={type:c,size:s*d};this._inferProperties(e,n,l);const y={location:e,name:n,accessor:new ns(l)};this.attributeInfos.push(y),this.attributeInfosByLocation[e]=y,this.attributeInfosByName[y.name]=y}_inferProperties(e,n,i){/instance/i.test(n)&&(i.divisor=1)}_addVarying(e,n,i,s){const{type:c,components:d}=kE(i),l=new ns({type:c,size:s*d}),y={location:e,name:n,accessor:l};this.varyingInfos.push(y),this.varyingInfosByName[y.name]=y}}const RE=4,D4=35981,z4=["setVertexArray","setAttributes","setBuffers","unsetBuffers","use","getUniformCount","getUniformInfo","getUniformLocation","getUniformValue","getVarying","getFragDataLocation","getAttachedShaders","getAttributeCount","getAttributeLocation","getAttributeInfo"];class TP extends ia{get[Symbol.toStringTag](){return"Program"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.stubRemovedMethods("Program","v6.0",z4),this._isCached=!1,this.initialize(n),Object.seal(this),this._setId(n.id)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{hash:n,vs:i,fs:s,varyings:c,bufferMode:d=D4}=e;return this.hash=n||"",this.vs=typeof i=="string"?new vy(this.gl,{id:"".concat(e.id,"-vs"),source:i}):i,this.fs=typeof s=="string"?new xy(this.gl,{id:"".concat(e.id,"-fs"),source:s}):s,ft(this.vs instanceof vy),ft(this.fs instanceof xy),this.uniforms={},this._textureUniforms={},c&&c.length>0&&(ar(this.gl),this.varyings=c,this.gl2.transformFeedbackVaryings(this.handle,c,d)),this._compileAndLink(),this._readUniformLocationsFromLinkedProgram(),this.configuration=new R4(this),this.setProps(e)}delete(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isCached?this:super.delete(e)}setProps(e){return"uniforms"in e&&this.setUniforms(e.uniforms),this}draw(e){let{logPriority:n,drawMode:i=4,vertexCount:s,offset:c=0,start:d,end:l,isIndexed:y=!1,indexType:w=5123,instanceCount:S=0,isInstanced:C=S>0,vertexArray:P=null,transformFeedback:D,framebuffer:U,parameters:H={},uniforms:ae,samplers:G}=e;if((ae||G)&&(Pt.deprecated("Program.draw({uniforms})","Program.setUniforms(uniforms)")(),this.setUniforms(ae||{})),Pt.priority>=n){const V=U?U.id:"default",W="mode=".concat(qa(this.gl,i)," verts=").concat(s," ")+"instances=".concat(S," indexType=").concat(qa(this.gl,w)," ")+"isInstanced=".concat(C," isIndexed=").concat(y," ")+"Framebuffer=".concat(V);Pt.log(n,W)()}return ft(P),this.gl.useProgram(this.handle),!this._areTexturesRenderable()||s===0||C&&S===0?!1:(P.bindForDraw(s,S,()=>{if(U!==void 0&&(H=Object.assign({},H,{framebuffer:U})),D){const V=k4(i);D.begin(V)}this._bindTextures(),Nr(this.gl,H,()=>{y&&C?this.gl2.drawElementsInstanced(i,s,w,c,S):y&&Yt(this.gl)&&!isNaN(d)&&!isNaN(l)?this.gl2.drawRangeElements(i,d,l,s,w,c):y?this.gl.drawElements(i,s,w,c):C?this.gl2.drawArraysInstanced(i,c,s,S):this.gl.drawArrays(i,c,s)}),D&&D.end()}),!0)}setUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Pt.priority>=2&&JO(e,this.id,this._uniformSetters),this.gl.useProgram(this.handle);for(const n in e){const i=e[n],s=this._uniformSetters[n];if(s){let c=i,d=!1;if(c instanceof _i&&(c=c.texture),c instanceof Mu)if(d=this.uniforms[n]!==i,d){s.textureIndex===void 0&&(s.textureIndex=this._textureIndexCounter++);const l=c,{textureIndex:y}=s;l.bind(y),c=y,this._textureUniforms[n]=l}else c=s.textureIndex;else this._textureUniforms[n]&&delete this._textureUniforms[n];(s(c)||d)&&e4(this.uniforms,n,i)}}return this}_areTexturesRenderable(){let e=!0;for(const n in this._textureUniforms){const i=this._textureUniforms[n];i.update(),e=e&&i.loaded}return e}_bindTextures(){for(const e in this._textureUniforms){const n=this._uniformSetters[e].textureIndex;this._textureUniforms[e].bind(n)}}_createHandle(){return this.gl.createProgram()}_deleteHandle(){this.gl.deleteProgram(this.handle)}_getOptionsFromHandle(e){const n=this.gl.getAttachedShaders(e),i={};for(const s of n)switch(this.gl.getShaderParameter(this.handle,35663)){case 35633:i.vs=new vy({handle:s});break;case 35632:i.fs=new xy({handle:s});break}return i}_getParameter(e){return this.gl.getProgramParameter(this.handle,e)}_setId(e){if(!e){const n=this._getName();this.id=Ka(n)}}_getName(){let e=this.vs.getName()||this.fs.getName();return e=e.replace(/shader/i,""),e=e?"".concat(e,"-program"):"program",e}_compileAndLink(){const{gl:e}=this;if(e.attachShader(this.handle,this.vs.handle),e.attachShader(this.handle,this.fs.handle),Pt.time(RE,"linkProgram for ".concat(this._getName()))(),e.linkProgram(this.handle),Pt.timeEnd(RE,"linkProgram for ".concat(this._getName()))(),e.debug||Pt.level>0){if(!e.getProgramParameter(this.handle,35714))throw new Error("Error linking: ".concat(e.getProgramInfoLog(this.handle)));if(e.validateProgram(this.handle),!e.getProgramParameter(this.handle,35715))throw new Error("Error validating: ".concat(e.getProgramInfoLog(this.handle)))}}_readUniformLocationsFromLinkedProgram(){const{gl:e}=this;this._uniformSetters={},this._uniformCount=this._getParameter(35718);for(let n=0;n<this._uniformCount;n++){const i=this.gl.getActiveUniform(this.handle,n),{name:s}=KO(i.name);let c=e.getUniformLocation(this.handle,s);if(this._uniformSetters[s]=ME(e,c,i),i.size>1)for(let d=0;d<i.size;d++)c=e.getUniformLocation(this.handle,"".concat(s,"[").concat(d,"]")),this._uniformSetters["".concat(s,"[").concat(d,"]")]=ME(e,c,i)}this._textureIndexCounter=0}getActiveUniforms(e,n){return this.gl2.getActiveUniforms(this.handle,e,n)}getUniformBlockIndex(e){return this.gl2.getUniformBlockIndex(this.handle,e)}getActiveUniformBlockParameter(e,n){return this.gl2.getActiveUniformBlockParameter(this.handle,e,n)}uniformBlockBinding(e,n){this.gl2.uniformBlockBinding(this.handle,e,n)}}const O4=34918,F4=34919,N4=35007,B4=36795,U4=35976,V4=35887,j4=36202;class qm extends ia{get[Symbol.toStringTag](){return"Query"}static isSupported(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];const i=Yt(e),s=Nd(e,gn.TIMER_QUERY);let c=i||s;for(const d of n)switch(d){case"queries":c=c&&i;break;case"timers":c=c&&s;break;default:ft(!1)}return c}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.target=null,this._queryPending=!1,this._pollingPromise=null,Object.seal(this)}beginTimeElapsedQuery(){return this.begin(N4)}beginOcclusionQuery(){let{conservative:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.begin(e?j4:V4)}beginTransformFeedbackQuery(){return this.begin(U4)}begin(e){return this._queryPending?this:(this.target=e,this.gl2.beginQuery(this.target,this.handle),this)}end(){return this._queryPending?this:(this.target&&(this.gl2.endQuery(this.target),this.target=null,this._queryPending=!0),this)}isResultAvailable(){if(!this._queryPending)return!1;const e=this.gl2.getQueryParameter(this.handle,F4);return e&&(this._queryPending=!1),e}isTimerDisjoint(){return this.gl2.getParameter(B4)}getResult(){return this.gl2.getQueryParameter(this.handle,O4)}getTimerMilliseconds(){return this.getResult()/1e6}createPoll(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Number.POSITIVE_INFINITY;if(this._pollingPromise)return this._pollingPromise;let n=0;return this._pollingPromise=new Promise((i,s)=>{const c=()=>{this.isResultAvailable()?(i(this.getResult()),this._pollingPromise=null):n++>e?(s("Timed out"),this._pollingPromise=null):requestAnimationFrame(c)};requestAnimationFrame(c)}),this._pollingPromise}_createHandle(){return qm.isSupported(this.gl)?this.gl2.createQuery():null}_deleteHandle(){this.gl2.deleteQuery(this.handle)}}class SP extends ia{get[Symbol.toStringTag](){return"TransformFeedback"}static isSupported(e){return Yt(e)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};ar(e),super(e,n),this.initialize(n),this.stubRemovedMethods("TransformFeedback","v6.0",["pause","resume"]),Object.seal(this)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.buffers={},this.unused={},this.configuration=null,this.bindOnUse=!0,Cu(this.buffers)||this.bind(()=>this._unbindBuffers()),this.setProps(e),this}setProps(e){"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"bindOnUse"in e&&(e=e.bindOnUse),"buffers"in e&&this.setBuffers(e.buffers)}setBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.bind(()=>{for(const n in e)this.setBuffer(n,e[n])}),this}setBuffer(e,n){const i=this._getVaryingIndex(e),{buffer:s,byteSize:c,byteOffset:d}=this._getBufferParams(n);return i<0?(this.unused[e]=s,Pt.warn("".concat(this.id," unused varying buffer ").concat(e))(),this):(this.buffers[i]=n,this.bindOnUse||this._bindBuffer(i,s,d,c),this)}begin(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return this.gl.bindTransformFeedback(36386,this.handle),this._bindBuffers(),this.gl.beginTransformFeedback(e),this}end(){return this.gl.endTransformFeedback(),this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null),this}_getBufferParams(e){let n,i,s;return e instanceof vn?s=e:(s=e.buffer,i=e.byteSize,n=e.byteOffset),(n!==void 0||i!==void 0)&&(n=n||0,i=i||s.byteLength-n),{buffer:s,byteOffset:n,byteSize:i}}_getVaryingInfo(e){return this.configuration&&this.configuration.getVaryingInfo(e)}_getVaryingIndex(e){if(this.configuration)return this.configuration.getVaryingInfo(e).location;const n=Number(e);return Number.isFinite(n)?n:-1}_bindBuffers(){if(this.bindOnUse)for(const e in this.buffers){const{buffer:n,byteSize:i,byteOffset:s}=this._getBufferParams(this.buffers[e]);this._bindBuffer(e,n,s,i)}}_unbindBuffers(){if(this.bindOnUse)for(const e in this.buffers)this._bindBuffer(e,null)}_bindBuffer(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,s=arguments.length>3?arguments[3]:void 0;const c=n&&n.handle;return!c||s===void 0?this.gl.bindBufferBase(35982,e,c):this.gl.bindBufferRange(35982,e,c,i,s),this}_createHandle(){return this.gl.createTransformFeedback()}_deleteHandle(){this.gl.deleteTransformFeedback(this.handle)}_bindHandle(e){this.gl.bindTransformFeedback(36386,this.handle)}}let Rp=null;function G4(t){return(!Rp||Rp.byteLength<t)&&(Rp=new ArrayBuffer(t)),Rp}function W4(t,e){const n=G4(t.BYTES_PER_ELEMENT*e);return new t(n,0,e)}function H4(t){let{target:e,source:n,start:i=0,count:s=1}=t;const c=n.length,d=s*c;let l=0;for(let y=i;l<c;l++)e[y++]=n[l];for(;l<d;)l<d-l?(e.copyWithin(i+l,i,i+l),l*=2):(e.copyWithin(i+l,i,i+d-l),l=d);return e}const $4="elements must be GL.ELEMENT_ARRAY_BUFFER";class Qr extends ia{get[Symbol.toStringTag](){return"VertexArrayObject"}static isSupported(e){return(arguments.length>1&&arguments[1]!==void 0?arguments[1]:{}).constantAttributeZero?Yt(e)||iP()==="Chrome":!0}static getDefaultArray(e){return e.luma=e.luma||{},e.luma.defaultVertexArray||(e.luma.defaultVertexArray=new Qr(e,{handle:null,isDefaultArray:!0})),e.luma.defaultVertexArray}static getMaxAttributes(e){return Qr.MAX_ATTRIBUTES=Qr.MAX_ATTRIBUTES||e.getParameter(34921),Qr.MAX_ATTRIBUTES}static setConstant(e,n,i){switch(i.constructor){case Float32Array:Qr._setConstantFloatArray(e,n,i);break;case Int32Array:Qr._setConstantIntArray(e,n,i);break;case Uint32Array:Qr._setConstantUintArray(e,n,i);break;default:ft(!1)}}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=n.id||n.program&&n.program.id;super(e,Object.assign({},n,{id:i})),this.buffer=null,this.bufferValue=null,this.isDefaultArray=n.isDefaultArray||!1,this.gl2=e,this.initialize(n),Object.seal(this)}delete(){return super.delete(),this.buffer&&this.buffer.delete(),this}get MAX_ATTRIBUTES(){return Qr.getMaxAttributes(this.gl)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.setProps(e)}setProps(e){return this}setElementBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return ft(!e||e.target===34963,$4),this.bind(()=>{this.gl.bindBuffer(34963,e?e.handle:null)}),this}setBuffer(e,n,i){if(n.target===34963)return this.setElementBuffer(n,i);const{size:s,type:c,stride:d,offset:l,normalized:y,integer:w,divisor:S}=i,{gl:C,gl2:P}=this;return e=Number(e),this.bind(()=>{C.bindBuffer(34962,n.handle),w?(ft(Yt(C)),P.vertexAttribIPointer(e,s,c,d,l)):C.vertexAttribPointer(e,s,c,y,d,l),C.enableVertexAttribArray(e),P.vertexAttribDivisor(e,S||0)}),this}enable(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return!n&&e===0&&!Qr.isSupported(this.gl,{constantAttributeZero:!0})||(e=Number(e),this.bind(()=>n?this.gl.enableVertexAttribArray(e):this.gl.disableVertexAttribArray(e))),this}getConstantBuffer(e,n){const i=this._normalizeConstantArrayValue(n),s=i.byteLength*e,c=i.length*e;let d=!this.buffer;if(this.buffer=this.buffer||new vn(this.gl,s),d=d||this.buffer.reallocate(s),d=d||!this._compareConstantArrayValues(i,this.bufferValue),d){const l=W4(n.constructor,c);H4({target:l,source:i,start:0,count:c}),this.buffer.subData(l),this.bufferValue=n}return this.buffer}_normalizeConstantArrayValue(e){return Array.isArray(e)?new Float32Array(e):e}_compareConstantArrayValues(e,n){if(!e||!n||e.length!==n.length||e.constructor!==n.constructor)return!1;for(let i=0;i<e.length;++i)if(e[i]!==n[i])return!1;return!0}static _setConstantFloatArray(e,n,i){switch(i.length){case 1:e.vertexAttrib1fv(n,i);break;case 2:e.vertexAttrib2fv(n,i);break;case 3:e.vertexAttrib3fv(n,i);break;case 4:e.vertexAttrib4fv(n,i);break;default:ft(!1)}}static _setConstantIntArray(e,n,i){switch(ft(Yt(e)),i.length){case 1:e.vertexAttribI1iv(n,i);break;case 2:e.vertexAttribI2iv(n,i);break;case 3:e.vertexAttribI3iv(n,i);break;case 4:e.vertexAttribI4iv(n,i);break;default:ft(!1)}}static _setConstantUintArray(e,n,i){switch(ft(Yt(e)),i.length){case 1:e.vertexAttribI1uiv(n,i);break;case 2:e.vertexAttribI2uiv(n,i);break;case 3:e.vertexAttribI3uiv(n,i);break;case 4:e.vertexAttribI4uiv(n,i);break;default:ft(!1)}}_createHandle(){return this.gl.createVertexArray()}_deleteHandle(e){return this.gl2.deleteVertexArray(e),[this.elements]}_bindHandle(e){this.gl2.bindVertexArray(e)}_getParameter(e,n){let{location:i}=n;return ft(Number.isFinite(i)),this.bind(()=>{switch(e){case 34373:return this.gl.getVertexAttribOffset(i,e);default:return this.gl.getVertexAttrib(i,e)}})}}const q4="VertexArray: attributes must be Buffers or constants (i.e. typed array)",Z4=/^(.+)__LOCATION_([0-9]+)$/,X4=["setBuffers","setGeneric","clearBindings","setLocations","setGenericValues","setDivisor","enable","disable"];class Y4{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=n.id||n.program&&n.program.id;this.id=i,this.gl=e,this.configuration=null,this.elements=null,this.elementsAccessor=null,this.values=null,this.accessors=null,this.unused=null,this.drawParams=null,this.buffer=null,this.attributes={},this.vertexArrayObject=new Qr(e),hP(this,"VertexArray","v6.0",X4),this.initialize(n),Object.seal(this)}delete(){this.buffer&&this.buffer.delete(),this.vertexArrayObject.delete()}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.reset(),this.configuration=null,this.bindOnUse=!1,this.setProps(e)}reset(){this.elements=null,this.elementsAccessor=null;const{MAX_ATTRIBUTES:e}=this.vertexArrayObject;return this.values=new Array(e).fill(null),this.accessors=new Array(e).fill(null),this.unused={},this.drawParams=null,this}setProps(e){return"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"attributes"in e&&this.setAttributes(e.attributes),"elements"in e&&this.setElementBuffer(e.elements),"bindOnUse"in e&&(e=e.bindOnUse),this}clearDrawParams(){this.drawParams=null}getDrawParams(){return this.drawParams=this.drawParams||this._updateDrawParams(),this.drawParams}setAttributes(e){return Object.assign(this.attributes,e),this.vertexArrayObject.bind(()=>{for(const n in e){const i=e[n];this._setAttribute(n,i)}this.gl.bindBuffer(34962,null)}),this}setElementBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.elements=e,this.elementsAccessor=n,this.clearDrawParams(),this.vertexArrayObject.setElementBuffer(e,n),this}setBuffer(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(n.target===34963)return this.setElementBuffer(n,i);const{location:s,accessor:c}=this._resolveLocationAndAccessor(e,n,n.accessor,i);return s>=0&&(this.values[s]=n,this.accessors[s]=c,this.clearDrawParams(),this.vertexArrayObject.setBuffer(s,n,c)),this}setConstant(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{location:s,accessor:c}=this._resolveLocationAndAccessor(e,n,Object.assign({size:n.length},i));return s>=0&&(n=this.vertexArrayObject._normalizeConstantArrayValue(n),this.values[s]=n,this.accessors[s]=c,this.clearDrawParams(),this.vertexArrayObject.enable(s,!1)),this}unbindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.vertexArrayObject.setElementBuffer(null),this.buffer=this.buffer||new vn(this.gl,{accessor:{size:4}});for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++)this.values[e]instanceof vn&&(this.gl.disableVertexAttribArray(e),this.gl.bindBuffer(34962,this.buffer.handle),this.gl.vertexAttribPointer(e,1,5126,!1,0,0))}),this}bindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.setElementBuffer(this.elements);for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++){const n=this.values[e];n instanceof vn&&this.setBuffer(e,n)}}),this}bindForDraw(e,n,i){let s;return this.vertexArrayObject.bind(()=>{this._setConstantAttributes(e,n),s=i()}),s}_resolveLocationAndAccessor(e,n,i,s){const c={location:-1,accessor:null},{location:d,name:l}=this._getAttributeIndex(e);if(!Number.isFinite(d)||d<0)return this.unused[e]=n,Pt.once(3,()=>"unused value ".concat(e," in ").concat(this.id))(),c;const y=this._getAttributeInfo(l||d);if(!y)return c;const w=this.accessors[d]||{},S=ns.resolve(y.accessor,w,i,s),{size:C,type:P}=S;return ft(Number.isFinite(C)&&Number.isFinite(P)),{location:d,accessor:S}}_getAttributeInfo(e){return this.configuration&&this.configuration.getAttributeInfo(e)}_getAttributeIndex(e){const n=Number(e);if(Number.isFinite(n))return{location:n};const i=Z4.exec(e),s=i?i[1]:e,c=i?Number(i[2]):0;return this.configuration?{location:this.configuration.getAttributeLocation(s)+c,name:s}:{location:-1}}_setAttribute(e,n){if(n instanceof vn)this.setBuffer(e,n);else if(Array.isArray(n)&&n.length&&n[0]instanceof vn){const i=n[0],s=n[1];this.setBuffer(e,i,s)}else if(ArrayBuffer.isView(n)||Array.isArray(n)){const i=n;this.setConstant(e,i)}else if(n.buffer instanceof vn){const i=n;this.setBuffer(e,i.buffer,i)}else throw new Error(q4)}_setConstantAttributes(e,n){const i=Math.max(e|0,n|0);let s=this.values[0];ArrayBuffer.isView(s)&&this._setConstantAttributeZero(s,i);for(let c=1;c<this.vertexArrayObject.MAX_ATTRIBUTES;c++)s=this.values[c],ArrayBuffer.isView(s)&&this._setConstantAttribute(c,s)}_setConstantAttributeZero(e,n){if(Qr.isSupported(this.gl,{constantAttributeZero:!0})){this._setConstantAttribute(0,e);return}const i=this.vertexArrayObject.getConstantBuffer(n,e);this.vertexArrayObject.setBuffer(0,i,this.accessors[0])}_setConstantAttribute(e,n){Qr.setConstant(this.gl,e,n)}_updateDrawParams(){const e={isIndexed:!1,isInstanced:!1,indexCount:1/0,vertexCount:1/0,instanceCount:1/0};for(let n=0;n<this.vertexArrayObject.MAX_ATTRIBUTES;n++)this._updateDrawParamsForLocation(e,n);return this.elements&&(e.elementCount=this.elements.getElementCount(this.elements.accessor),e.isIndexed=!0,e.indexType=this.elementsAccessor.type||this.elements.accessor.type,e.indexOffset=this.elementsAccessor.offset||0),e.indexCount===1/0&&(e.indexCount=0),e.vertexCount===1/0&&(e.vertexCount=0),e.instanceCount===1/0&&(e.instanceCount=0),e}_updateDrawParamsForLocation(e,n){const i=this.values[n],s=this.accessors[n];if(!i)return;const{divisor:c}=s,d=c>0;if(e.isInstanced=e.isInstanced||d,i instanceof vn){const l=i;if(d){const y=l.getVertexCount(s);e.instanceCount=Math.min(e.instanceCount,y)}else{const y=l.getVertexCount(s);e.vertexCount=Math.min(e.vertexCount,y)}}}setElements(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Pt.deprecated("setElements","setElementBuffer")(),this.setElementBuffer(e,n)}}function K4(t,e){const{maxElts:n=16,size:i=1}=e;let s="[";for(let d=0;d<t.length&&d<n;++d)d>0&&(s+=",".concat(d%i===0?" ":"")),s+=Ud(t[d],e);const c=t.length>n?"...":"]";return"".concat(s).concat(c)}function Ud(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=1e-16,{isInteger:i=!1}=e;if(Array.isArray(t)||ArrayBuffer.isView(t))return K4(t,e);if(!Number.isFinite(t))return String(t);if(Math.abs(t)<n)return i?"0":"0.";if(i||Math.abs(t)>100&&Math.abs(t)<1e4)return t.toFixed(0);const s=t.toPrecision(2);return s.indexOf(".0")===s.length-2?s.slice(0,-1):s}function DE(t){let{header:e="Uniforms",program:n,uniforms:i,undefinedOnly:s=!1}=t;ft(n);const c=".*_.*",d=".*Matrix",l=n._uniformSetters,y={},w=Object.keys(l).sort();let S=0;for(const D of w)!D.match(c)&&!D.match(d)&&by({table:y,header:e,uniforms:i,uniformName:D,undefinedOnly:s})&&S++;for(const D of w)D.match(d)&&by({table:y,header:e,uniforms:i,uniformName:D,undefinedOnly:s})&&S++;for(const D of w)y[D]||by({table:y,header:e,uniforms:i,uniformName:D,undefinedOnly:s})&&S++;let C=0;const P={};if(!s)for(const D in i){const U=i[D];y[D]||(C++,P[D]={Type:"NOT USED: ".concat(U),[e]:Ud(U)})}return{table:y,count:S,unusedTable:P,unusedCount:C}}function by(t){let{table:e,header:n,uniforms:i,uniformName:s,undefinedOnly:c}=t;const d=i[s],l=J4(d);return!c||!l?(e[s]={[n]:l?Ud(d):"N/A","Uniform Type":l?d:"NOT PROVIDED"},!0):!1}function J4(t){return t!=null}function Q4(t){let{vertexArray:e,header:n="Attributes"}=t;if(!e.configuration)return{};const i={};e.elements&&(i.ELEMENT_ARRAY_BUFFER=zE(e,e.elements,null,n));const s=e.values;for(const c in s){const d=e._getAttributeInfo(c);if(d){let l="".concat(c,": ").concat(d.name);const y=e.accessors[d.location];y&&(l="".concat(c,": ").concat(eF(d.name,y))),i[l]=zE(e,s[c],y,n)}}return i}function zE(t,e,n,i){const{gl:s}=t;if(!e)return{[i]:"null","Format ":"N/A"};let c="NOT PROVIDED",d=1,l=0,y=0,w,S,C;if(n&&(c=n.type,d=n.size,c=String(c).replace("Array",""),w=c.indexOf("nt")!==-1),e instanceof vn){const P=e,{data:D,changed:U}=P.getDebugData();S=U?"*":"",C=D,y=P.byteLength,l=y/D.BYTES_PER_ELEMENT/d;let H;if(n){const ae=n.divisor>0;H="".concat(ae?"I ":"P "," ").concat(l," (x").concat(d,"=").concat(y," bytes ").concat(qa(s,c),")")}else w=!0,H="".concat(y," bytes");return{[i]:"".concat(S).concat(Ud(C,{size:d,isInteger:w})),"Format ":H}}return C=e,d=e.length,c=String(e.constructor.name).replace("Array",""),w=c.indexOf("nt")!==-1,{[i]:"".concat(Ud(C,{size:d,isInteger:w})," (constant)"),"Format ":"".concat(d,"x").concat(c," (constant)")}}function eF(t,e){const{type:n,size:i}=e,s=EP(n,i);return s?"".concat(t," (").concat(s.name,")"):t}function tF(t){const e={},n="Accessors for ".concat(t.id);for(const i of t.attributeInfos)if(i){const s=OE(i);e["in ".concat(s)]={[n]:JSON.stringify(i.accessor)}}for(const i of t.varyingInfos)if(i){const s=OE(i);e["out ".concat(s)]={[n]:JSON.stringify(i.accessor)}}return e}function OE(t){const{type:e,size:n}=t.accessor,i=EP(e,n);return i?"".concat(i.name," ").concat(t.name):t.name}const FE=na()&&typeof document<"u";let nF=0;class iF{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{onCreateContext:n=ae=>uP(ae),onAddHTML:i=null,onInitialize:s=()=>{},onRender:c=()=>{},onFinalize:d=()=>{},onError:l,gl:y=null,glOptions:w={},debug:S=!1,createFramebuffer:C=!1,autoResizeViewport:P=!0,autoResizeDrawingBuffer:D=!0,stats:U=Nl.get("animation-loop-".concat(nF++))}=e;let{useDevicePixels:H=!0}=e;"useDevicePixelRatio"in e&&(Pt.deprecated("useDevicePixelRatio","useDevicePixels")(),H=e.useDevicePixelRatio),this.props={onCreateContext:n,onAddHTML:i,onInitialize:s,onRender:c,onFinalize:d,onError:l,gl:y,glOptions:w,debug:S,createFramebuffer:C},this.gl=y,this.needsRedraw=null,this.timeline=null,this.stats=U,this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this._initialized=!1,this._running=!1,this._animationFrameId=null,this._nextFramePromise=null,this._resolveNextFrame=null,this._cpuStartTime=0,this.setProps({autoResizeViewport:P,autoResizeDrawingBuffer:D,useDevicePixels:H}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._pageLoadPromise=null,this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}delete(){this.stop(),this._setDisplay(null)}setNeedsRedraw(e){return ft(typeof e=="string"),this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.autoResizeViewport=e.autoResizeViewport),"autoResizeDrawingBuffer"in e&&(this.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer),"useDevicePixels"in e&&(this.useDevicePixels=e.useDevicePixels),this}start(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(this._running)return this;this._running=!0;const n=this._getPageLoadPromise().then(()=>!this._running||this._initialized?null:(this._createWebGLContext(e),this._createFramebuffer(),this._startEventHandling(),this._initializeCallbackData(),this._updateCallbackData(),this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._gpuTimeQuery=qm.isSupported(this.gl,["timers"])?new qm(this.gl):null,this._initialized=!0,this.onInitialize(this.animationProps))).then(i=>{this._running&&(this._addCallbackData(i||{}),i!==!1&&this._startLoop())});return this.props.onError&&n.catch(this.props.onError),this}redraw(){return this.isContextLost()?this:(this._beginTimers(),this._setupFrame(),this._updateCallbackData(),this._renderFrame(this.animationProps),this._clearNeedsRedraw(),this.offScreen&&this.gl.commit&&this.gl.commit(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endTimers(),this)}stop(){return this._running&&(this._finalizeCallbackData(),this._cancelAnimationFrame(this._animationFrameId),this._nextFramePromise=null,this._resolveNextFrame=null,this._animationFrameId=null,this._running=!1),this}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){return this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.gl.canvas.toDataURL()}isContextLost(){return this.gl.isContextLost()}onCreateContext(){return this.props.onCreateContext(...arguments)}onInitialize(){return this.props.onInitialize(...arguments)}onRender(){return this.props.onRender(...arguments)}onFinalize(){return this.props.onFinalize(...arguments)}getHTMLControlValue(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const i=document.getElementById(e);return i?Number(i.value):n}setViewParameters(){return Pt.removed("AnimationLoop.setViewParameters","AnimationLoop.setProps")(),this}_startLoop(){const e=()=>{this._running&&(this.redraw(),this._animationFrameId=this._requestAnimationFrame(e))};this._cancelAnimationFrame(this._animationFrameId),this._animationFrameId=this._requestAnimationFrame(e)}_getPageLoadPromise(){return this._pageLoadPromise||(this._pageLoadPromise=FE?new Promise((e,n)=>{if(FE&&document.readyState==="complete"){e(document);return}window.addEventListener("load",()=>{e(document)})}):Promise.resolve({})),this._pageLoadPromise}_setDisplay(e){this.display&&(this.display.delete(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_cancelAnimationFrame(e){return this.display&&this.display.cancelAnimationFrame?this.display.cancelAnimationFrame(e):uO(e)}_requestAnimationFrame(e){if(this._running)return this.display&&this.display.requestAnimationFrame?this.display.requestAnimationFrame(e):cO(e)}_renderFrame(){if(this.display){this.display._renderFrame(...arguments);return}this.onRender(...arguments)}_clearNeedsRedraw(){this.needsRedraw=null}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._resizeFramebuffer()}_initializeCallbackData(){this.animationProps={gl:this.gl,stop:this.stop,canvas:this.gl.canvas,framebuffer:this.framebuffer,useDevicePixels:this.useDevicePixels,needsRedraw:null,startTime:Date.now(),engineTime:0,tick:0,tock:0,time:0,_timeline:this.timeline,_loop:this,_animationLoop:this,_mousePosition:null}}_updateCallbackData(){const{width:e,height:n,aspect:i}=this._getSizeAndAspect();(e!==this.animationProps.width||n!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),i!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=n,this.animationProps.aspect=i,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime,this.animationProps._offScreen=this.offScreen}_finalizeCallbackData(){this.onFinalize(this.animationProps)}_addCallbackData(e){typeof e=="object"&&e!==null&&(this.animationProps=Object.assign({},this.animationProps,e))}_createWebGLContext(e){if(this.offScreen=e.canvas&&typeof OffscreenCanvas<"u"&&e.canvas instanceof OffscreenCanvas,e=Object.assign({},e,this.props.glOptions),this.gl=this.props.gl?Sx(this.props.gl,e):this.onCreateContext(e),!Eg(this.gl))throw new Error("AnimationLoop.onCreateContext - illegal context returned");Yz(this.gl),this._createInfoDiv()}_createInfoDiv(){if(this.gl.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const n=document.createElement("div");n.style.position="absolute",n.style.left="10px",n.style.bottom="10px",n.style.width="300px",n.style.background="white",e.appendChild(this.gl.canvas),e.appendChild(n);const i=this.props.onAddHTML(n);i&&(n.innerHTML=i)}}_getSizeAndAspect(){const e=this.gl.drawingBufferWidth,n=this.gl.drawingBufferHeight;let i=1;const{canvas:s}=this.gl;return s&&s.clientHeight?i=s.clientWidth/s.clientHeight:e>0&&n>0&&(i=e/n),{width:e,height:n,aspect:i}}_resizeViewport(){this.autoResizeViewport&&this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){this.autoResizeDrawingBuffer&&tO(this.gl,{useDevicePixels:this.useDevicePixels})}_createFramebuffer(){this.props.createFramebuffer&&(this.framebuffer=new _i(this.gl))}_resizeFramebuffer(){this.framebuffer&&this.framebuffer.resize({width:this.gl.drawingBufferWidth,height:this.gl.drawingBufferHeight})}_beginTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this._gpuTimeQuery&&this._gpuTimeQuery.isResultAvailable()&&!this._gpuTimeQuery.isTimerDisjoint()&&this.stats.get("GPU Time").addTime(this._gpuTimeQuery.getTimerMilliseconds()),this._gpuTimeQuery&&this._gpuTimeQuery.beginTimeElapsedQuery(),this.cpuTime.timeStart()}_endTimers(){this.cpuTime.timeEnd(),this._gpuTimeQuery&&this._gpuTimeQuery.end()}_startEventHandling(){const{canvas:e}=this.gl;e&&(e.addEventListener("mousemove",this._onMousemove),e.addEventListener("mouseleave",this._onMouseleave))}_onMousemove(e){this.animationProps._mousePosition=[e.offsetX,e.offsetY]}_onMouseleave(e){this.animationProps._mousePosition=null}}const nf="vs",Mx="fs";function os(t,e){if(!t)throw new Error(e||"shadertools: assertion failed.")}const wy={number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},array:{validate(t,e){return Array.isArray(t)||ArrayBuffer.isView(t)}}};function rF(t){const e={};for(const n in t){const i=t[n],s=sF(i);e[n]=s}return e}function sF(t){let e=NE(t);return e==="object"?t?"type"in t?Object.assign({},t,wy[t.type]):"value"in t?(e=NE(t.value),Object.assign({type:e},t,wy[e])):{type:"object",value:t}:{type:"object",value:null}:Object.assign({type:e,value:t},wy[e])}function NE(t){return Array.isArray(t)||ArrayBuffer.isView(t)?"array":typeof t}const oF="vs",aF="fs";class BE{constructor(e){let{name:n,vs:i,fs:s,dependencies:c=[],uniforms:d,getUniforms:l,deprecations:y=[],defines:w={},inject:S={},vertexShader:C,fragmentShader:P}=e;os(typeof n=="string"),this.name=n,this.vs=i||C,this.fs=s||P,this.getModuleUniforms=l,this.dependencies=c,this.deprecations=this._parseDeprecationDefinitions(y),this.defines=w,this.injections=lF(S),d&&(this.uniforms=rF(d))}getModuleSource(e){let n;switch(e){case oF:n=this.vs||"";break;case aF:n=this.fs||"";break;default:os(!1)}return"#define MODULE_".concat(this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_"),`
`).concat(n,"// END MODULE_").concat(this.name,`

`)}getUniforms(e,n){return this.getModuleUniforms?this.getModuleUniforms(e,n):this.uniforms?this._defaultGetUniforms(e):{}}getDefines(){return this.defines}checkDeprecations(e,n){this.deprecations.forEach(i=>{i.regex.test(e)&&(i.deprecated?n.deprecated(i.old,i.new)():n.removed(i.old,i.new)())})}_parseDeprecationDefinitions(e){return e.forEach(n=>{switch(n.type){case"function":n.regex=new RegExp("\\b".concat(n.old,"\\("));break;default:n.regex=new RegExp("".concat(n.type," ").concat(n.old,";"))}}),e}_defaultGetUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n={},i=this.uniforms;for(const s in i){const c=i[s];s in e&&!c.private?(c.validate&&os(c.validate(e[s],c),"".concat(this.name,": invalid ").concat(s)),n[s]=e[s]):n[s]=c.value}return n}}function lF(t){const e={vs:{},fs:{}};for(const n in t){let i=t[n];const s=n.slice(0,2);typeof i=="string"&&(i={order:0,injection:i}),e[s][n]=i}return e}function cF(t){return uF(PP(t))}function uF(t){const e={},n={};return AP({modules:t,level:0,moduleMap:e,moduleDepth:n}),Object.keys(n).sort((i,s)=>n[s]-n[i]).map(i=>e[i])}function AP(t){let{modules:e,level:n,moduleMap:i,moduleDepth:s}=t;if(n>=5)throw new Error("Possible loop in shader dependency graph");for(const c of e)i[c.name]=c,(s[c.name]===void 0||s[c.name]<n)&&(s[c.name]=n);for(const c of e)c.dependencies&&AP({modules:c.dependencies,level:n+1,moduleMap:i,moduleDepth:s})}function PP(t,e){return t.map(n=>(n instanceof BE||(os(typeof n!="string","Shader module use by name is deprecated. Import shader module '".concat(n,"' and use it directly.")),os(n.name,"shader module has no name"),n=new BE(n),n.dependencies=PP(n.dependencies)),n))}function hF(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=typeof window<"u"?window.navigator||{}:{},n=t.userAgent||e.userAgent||"",i=n.indexOf("MSIE ")!==-1,s=n.indexOf("Trident/")!==-1;return i||s}const dF=7936,fF=7937,pF=7938,mF=35724,Lx={GLSL_FRAG_DATA:["WEBGL_draw_buffers",!0],GLSL_FRAG_DEPTH:["EXT_frag_depth",!0],GLSL_DERIVATIVES:["OES_standard_derivatives",!0],GLSL_TEXTURE_LOD:["EXT_shader_texture_lod",!0]},Dl={};Object.keys(Lx).forEach(t=>{Dl[t]=t});function gF(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:!!(t&&t._version===2)}function _F(t){const e=t.getExtension("WEBGL_debug_renderer_info"),n=t.getParameter(e&&e.UNMASKED_VENDOR_WEBGL||dF),i=t.getParameter(e&&e.UNMASKED_RENDERER_WEBGL||fF);return{gpuVendor:yF(n,i),vendor:n,renderer:i,version:t.getParameter(pF),shadingLanguageVersion:t.getParameter(mF)}}function yF(t,e){return t.match(/NVIDIA/i)||e.match(/NVIDIA/i)?"NVIDIA":t.match(/INTEL/i)||e.match(/INTEL/i)?"INTEL":t.match(/AMD/i)||e.match(/AMD/i)||t.match(/ATI/i)||e.match(/ATI/i)?"AMD":"UNKNOWN GPU"}const Ey={};function UE(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const i=Lx[e];if(os(i,e),!hF(n))return!0;if(e in Ey)return Ey[e];const s=i[0],c=n.behavior||"enable",d="#extension GL_".concat(s," : ").concat(c,`
void main(void) {}`),l=t.createShader(35633);t.shaderSource(l,d),t.compileShader(l);const y=t.getShaderParameter(l,35713);return t.deleteShader(l),Ey[e]=y,y}function vF(t,e){const n=Lx[e];os(n,e);const i=gF(t)&&n[1]||n[0],s=typeof i=="string"?!!t.getExtension(i):i;return os(s===!1||s===!0),s}function Dp(t,e){return e=Array.isArray(e)?e:[e],e.every(n=>vF(t,n))}function xF(t){switch(_F(t).gpuVendor.toLowerCase()){case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function bF(t,e,n){let i=`#if (__VERSION__ > 120)

# define FEATURE_GLSL_DERIVATIVES
# define FEATURE_GLSL_DRAW_BUFFERS
# define FEATURE_GLSL_FRAG_DEPTH
# define FEATURE_GLSL_TEXTURE_LOD

// DEPRECATED FLAGS, remove in v9
# define FRAG_DEPTH
# define DERIVATIVES
# define DRAW_BUFFERS
# define TEXTURE_LOD

#endif // __VERSION
`;return Dp(t,Dl.GLSL_FRAG_DEPTH)&&(i+=`
// FRAG_DEPTH => gl_FragDepth is available
#ifdef GL_EXT_frag_depth
#extension GL_EXT_frag_depth : enable
# define FEATURE_GLSL_FRAG_DEPTH
# define FRAG_DEPTH
# define gl_FragDepth gl_FragDepthEXT
#endif
`),Dp(t,Dl.GLSL_DERIVATIVES)&&UE(t,Dl.GLSL_DERIVATIVES)&&(i+=`
// DERIVATIVES => dxdF, dxdY and fwidth are available
#ifdef GL_OES_standard_derivatives
#extension GL_OES_standard_derivatives : enable
# define FEATURE_GLSL_DERIVATIVES
# define DERIVATIVES
#endif
`),Dp(t,Dl.GLSL_FRAG_DATA)&&UE(t,Dl.GLSL_FRAG_DATA,{behavior:"require"})&&(i+=`
// DRAW_BUFFERS => gl_FragData[] is available
#ifdef GL_EXT_draw_buffers
#extension GL_EXT_draw_buffers : require
#define FEATURE_GLSL_DRAW_BUFFERS
#define DRAW_BUFFERS
#endif
`),Dp(t,Dl.GLSL_TEXTURE_LOD)&&(i+=`// TEXTURE_LOD => texture2DLod etc are available
#ifdef GL_EXT_shader_texture_lod
#extension GL_EXT_shader_texture_lod : enable

# define FEATURE_GLSL_TEXTURE_LOD
# define TEXTURE_LOD

#endif
`),i}const wF=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,EF=`#ifdef MODULE_MATERIAL
  gl_FragColor = material_filterColor(gl_FragColor);
#endif

#ifdef MODULE_LIGHTING
  gl_FragColor = lighting_filterColor(gl_FragColor);
#endif

#ifdef MODULE_FOG
  gl_FragColor = fog_filterColor(gl_FragColor);
#endif

#ifdef MODULE_PICKING
  gl_FragColor = picking_filterHighlightColor(gl_FragColor);
  gl_FragColor = picking_filterPickingColor(gl_FragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,TF={[nf]:wF,[Mx]:EF},dm="__LUMA_INJECT_DECLARATIONS__",VE=/void\s+main\s*\([^)]*\)\s*\{\n?/,jE=/}\n?[^{}]*$/,Ty=[];function GE(t,e,n){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const s=e===nf;for(const c in n){const d=n[c];d.sort((y,w)=>y.order-w.order),Ty.length=d.length;for(let y=0,w=d.length;y<w;++y)Ty[y]=d[y].injection;const l="".concat(Ty.join(`
`),`
`);switch(c){case"vs:#decl":s&&(t=t.replace(dm,l));break;case"vs:#main-start":s&&(t=t.replace(VE,y=>y+l));break;case"vs:#main-end":s&&(t=t.replace(jE,y=>l+y));break;case"fs:#decl":s||(t=t.replace(dm,l));break;case"fs:#main-start":s||(t=t.replace(VE,y=>y+l));break;case"fs:#main-end":s||(t=t.replace(jE,y=>l+y));break;default:t=t.replace(c,y=>y+l)}}return t=t.replace(dm,""),i&&(t=t.replace(/\}\s*$/,c=>c+TF[e])),t}function X0(t){const e={};return os(Array.isArray(t)&&t.length>1),t.forEach(n=>{for(const i in n)e[i]=e[i]?"".concat(e[i],`
`).concat(n[i]):n[i]}),e}function Lu(t){return new RegExp("\\b".concat(t,"[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)"),"g")}const IP=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],SF=[...IP,[Lu("attribute"),"in $1"],[Lu("varying"),"out $1"]],AF=[...IP,[Lu("varying"),"in $1"]],CP=[[/^#version[ \t]+300[ \t]+es/,"#version 100"],[/\btexture(2D|2DProj|Cube)Lod\(/g,"texture$1LodEXT("],[/\btexture\(/g,"texture2D("],[/\btextureLod\(/g,"texture2DLodEXT("]],PF=[...CP,[Lu("in"),"attribute $1"],[Lu("out"),"varying $1"]],IF=[...CP,[Lu("in"),"varying $1"]],Y0="gl_FragColor",K0=/\bout[ \t]+vec4[ \t]+(\w+)[ \t]*;\n?/,CF=/void\s+main\s*\([^)]*\)\s*\{\n?/;function MF(t,e,n){switch(e){case 300:return n?Zm(t,SF):LF(t);case 100:return n?Zm(t,PF):kF(t);default:throw new Error("unknown GLSL version ".concat(e))}}function Zm(t,e){for(const[n,i]of e)t=t.replace(n,i);return t}function LF(t){t=Zm(t,AF);const e=t.match(K0);if(e){const n=e[1];t=t.replace(new RegExp("\\b".concat(Y0,"\\b"),"g"),n)}else{const n="fragmentColor";t=t.replace(CF,i=>"out vec4 ".concat(n,`;
`).concat(i)).replace(new RegExp("\\b".concat(Y0,"\\b"),"g"),n)}return t}function kF(t){t=Zm(t,IF);const e=t.match(K0);if(e){const n=e[1];t=t.replace(K0,"").replace(new RegExp("\\b".concat(n,"\\b"),"g"),Y0)}return t}const RF=`

`.concat(dm,`

`),MP={[nf]:"vertex",[Mx]:"fragment"},DF=`precision highp float;

`;function zF(t,e){const{vs:n,fs:i}=e,s=cF(e.modules||[]);return{gl:t,vs:WE(t,Object.assign({},e,{source:n,type:nf,modules:s})),fs:WE(t,Object.assign({},e,{source:i,type:Mx,modules:s})),getUniforms:OF(s)}}function WE(t,e){let{id:n,source:i,type:s,modules:c,defines:d={},hookFunctions:l=[],inject:y={},transpileToGLSL100:w=!1,prologue:S=!0,log:C}=e;os(typeof i=="string","shader source must be a string");const P=s===nf,D=i.split(`
`);let U=100,H="",ae=i;D[0].indexOf("#version ")===0?(U=300,H=D[0],ae=D.slice(1).join(`
`)):H="#version ".concat(U);const G={};c.forEach(De=>{Object.assign(G,De.getDefines())}),Object.assign(G,d);let V=S?"".concat(H,`
`).concat(NF({id:n,source:i,type:s}),`
`).concat(FF({type:s}),`
`).concat(xF(t),`
`).concat(bF(t),`
`).concat(BF(G),`
`).concat(P?"":DF,`
`):"".concat(H,`
`);const W=VF(l),ie={},ge={},be={};for(const De in y){const Ne=typeof y[De]=="string"?{injection:y[De],order:0}:y[De],He=De.match(/^(v|f)s:(#)?([\w-]+)$/);if(He){const je=He[2],vt=He[3];je?vt==="decl"?ge[De]=[Ne]:be[De]=[Ne]:ie[De]=[Ne]}else be[De]=[Ne]}for(const De of c){C&&De.checkDeprecations(ae,C);const Ne=De.getModuleSource(s,U);V+=Ne;const He=De.injections[s];for(const je in He){const vt=je.match(/^(v|f)s:#([\w-]+)$/);if(vt){const Qt=vt[2]==="decl"?ge:be;Qt[je]=Qt[je]||[],Qt[je].push(He[je])}else ie[je]=ie[je]||[],ie[je].push(He[je])}}return V+=RF,V=GE(V,s,ge),V+=UF(W[s],ie),V+=ae,V=GE(V,s,be),V=MF(V,w?100:U,P),V}function OF(t){return function(n){const i={};for(const s of t){const c=s.getUniforms(n,i);Object.assign(i,c)}return i}}function FF(t){let{type:e}=t;return`
#define SHADER_TYPE_`.concat(MP[e].toUpperCase(),`
`)}function NF(t){let{id:e,source:n,type:i}=t;return e&&typeof e=="string"&&n.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME `.concat(e,"_").concat(MP[i],`

`):""}function BF(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=0,n="";for(const i in t){e===0&&(n+=`
// APPLICATION DEFINES
`),e++;const s=t[i];(s||Number.isFinite(s))&&(n+="#define ".concat(i.toUpperCase()," ").concat(t[i],`
`))}return e===0&&(n+=`
`),n}function UF(t,e){let n="";for(const i in t){const s=t[i];if(n+="void ".concat(s.signature,` {
`),s.header&&(n+="  ".concat(s.header)),e[i]){const c=e[i];c.sort((d,l)=>d.order-l.order);for(const d of c)n+="  ".concat(d.injection,`
`)}s.footer&&(n+="  ".concat(s.footer)),n+=`}
`}return n}function VF(t){const e={vs:{},fs:{}};return t.forEach(n=>{let i;typeof n!="string"?(i=n,n=i.hook):i={},n=n.trim();const[s,c]=n.split(":"),d=n.replace(/\(.+/,"");e[s][d]=Object.assign(i,{signature:c})}),e}const jF="void main() {gl_FragColor = vec4(0);}",LP=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,GF=`#version 300 es
`.concat(LP);function kP(t,e){e=Array.isArray(e)?e:[e];const n=t.replace(/^\s+/,"").split(/\s+/),[i,s,c]=n;if(!e.includes(i)||!s||!c)return null;const d=c.split(";")[0];return{qualifier:i,type:s,name:d}}function RP(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{version:e=100,input:n,inputType:i,output:s}=t;if(!n)return e===300?GF:e>300?"#version ".concat(e,`
`).concat(LP):jF;const c=$F(n,i);return e>=300?"#version ".concat(e," ").concat(e===300?"es":"",`
in `).concat(i," ").concat(n,`;
out vec4 `).concat(s,`;
void main() {
  `).concat(s," = ").concat(c,`;
}`):"varying ".concat(i," ").concat(n,`;
void main() {
  gl_FragColor = `).concat(c,`;
}`)}function WF(t){switch(t){case"float":return"x";case"vec2":return"xy";case"vec3":return"xyz";case"vec4":return"xyzw";default:return os(!1),null}}function HF(t){switch(t){case"float":return 1;case"vec2":return 2;case"vec3":return 3;case"vec4":return 4;default:return os(!1),null}}function $F(t,e){switch(e){case"float":return"vec4(".concat(t,", 0.0, 0.0, 1.0)");case"vec2":return"vec4(".concat(t,", 0.0, 1.0)");case"vec3":return"vec4(".concat(t,", 1.0)");case"vec4":return t;default:return os(!1),null}}const qF=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,ZF={name:"fp32",vs:qF,fs:null};function DP(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const i=Math.fround(t),s=t-i;return e[n]=i,e[n+1]=s,e}function XF(t){return t-Math.fround(t)}function YF(t){const e=new Float32Array(32);for(let n=0;n<4;++n)for(let i=0;i<4;++i){const s=n*4+i;DP(t[i*4+n],e,s*2)}return e}const KF=`uniform float ONE;
vec2 split(float a) {
  const float SPLIT = 4097.0;
  float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float a_hi = t * ONE - (t - a);
  float a_lo = a * ONE - a_hi;
#else
  float a_hi = t - (t - a);
  float a_lo = a - a_hi;
#endif
  return vec2(a_hi, a_lo);
}
vec2 split2(vec2 a) {
  vec2 b = split(a.x);
  b.y += a.y;
  return b;
}
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float sum = (a + b) * ONE;
  float err = b - (sum - a) * ONE;
#else
  float sum = a + b;
  float err = b - (sum - a);
#endif
  return vec2(sum, err);
}
vec2 twoSum(float a, float b) {
  float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * ONE - a) * ONE;
  float err = (a - (s - v) * ONE) * ONE * ONE * ONE + (b - v);
#else
  float v = s - a;
  float err = (a - (s - v)) + (b - v);
#endif
  return vec2(s, err);
}

vec2 twoSub(float a, float b) {
  float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * ONE - a) * ONE;
  float err = (a - (s - v) * ONE) * ONE * ONE * ONE - (b + v);
#else
  float v = s - a;
  float err = (a - (s - v)) - (b + v);
#endif
  return vec2(s, err);
}

vec2 twoSqr(float a) {
  float prod = a * a;
  vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float err = ((a_fp64.x * a_fp64.x - prod) * ONE + 2.0 * a_fp64.x *
    a_fp64.y * ONE * ONE) + a_fp64.y * a_fp64.y * ONE * ONE * ONE;
#else
  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
  return vec2(prod, err);
}

vec2 twoProd(float a, float b) {
  float prod = a * b;
  vec2 a_fp64 = split(a);
  vec2 b_fp64 = split(b);
  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
  return vec2(prod, err);
}

vec2 sum_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSum(a.x, b.x);
  t = twoSum(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 sub_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSub(a.x, b.x);
  t = twoSub(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 mul_fp64(vec2 a, vec2 b) {
  vec2 prod = twoProd(a.x, b.x);
  prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  return prod;
}

vec2 div_fp64(vec2 a, vec2 b) {
  float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
  vec2 yn = a * xn;
#endif
  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
  vec2 prod = twoProd(xn, diff);
  return sum_fp64(yn, prod);
}

vec2 sqrt_fp64(vec2 a) {
  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);

  float x = 1.0 / sqrt(a.x);
  float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  vec2 yn_sqr = twoSqr(yn) * ONE;
#else
  vec2 yn_sqr = twoSqr(yn);
#endif
  float diff = sub_fp64(a, yn_sqr).x;
  vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  return sum_fp64(split(yn), prod);
#else
  return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`,JF={ONE:1};function QF(){return JF}const zP={name:"fp64-arithmetic",vs:KF,fs:null,getUniforms:QF,fp64ify:DP,fp64LowPart:XF,fp64ifyMatrix4:YF};function HE(t,e){if(!t)throw new Error("math.gl assertion ".concat(e))}const rs={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0};function eN(t,{precision:e=rs.precision}={}){return t=tN(t),"".concat(parseFloat(t.toPrecision(e)))}function ku(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Oa(t,e,n){return iN(t,i=>Math.max(e,Math.min(n,i)))}function Vd(t,e,n){return ku(t)?t.map((i,s)=>Vd(i,e[s],n)):n*e+(1-n)*t}function jd(t,e,n){const i=rs.EPSILON;n&&(rs.EPSILON=n);try{if(t===e)return!0;if(ku(t)&&ku(e)){if(t.length!==e.length)return!1;for(let s=0;s<t.length;++s)if(!jd(t[s],e[s]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):typeof t=="number"&&typeof e=="number"?Math.abs(t-e)<=rs.EPSILON*Math.max(1,Math.abs(t),Math.abs(e)):!1}finally{rs.EPSILON=i}}function tN(t){return Math.round(t/rs.EPSILON)*rs.EPSILON}function nN(t){return t.clone?t.clone():new Array(t.length)}function iN(t,e,n){if(ku(t)){const i=t;n=n||nN(i);for(let s=0;s<n.length&&s<i.length;++s)n[s]=e(t[s],s,n);return n}return e(t)}function rN(t){function e(){var n=Reflect.construct(t,Array.from(arguments));return Object.setPrototypeOf(n,Object.getPrototypeOf(this)),n}return e.prototype=Object.create(t.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t,e}class OP extends rN(Array){clone(){return new this.constructor().copy(this)}fromArray(e,n=0){for(let i=0;i<this.ELEMENTS;++i)this[i]=e[i+n];return this.check()}toArray(e=[],n=0){for(let i=0;i<this.ELEMENTS;++i)e[n+i]=this[i];return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:ku(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(rs)}formatString(e){let n="";for(let i=0;i<this.ELEMENTS;++i)n+=(i>0?", ":"")+eN(this[i],e);return"".concat(e.printTypes?this.constructor.name:"","[").concat(n,"]")}equals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(!jd(this[n],e[n]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(this[n]!==e[n])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,n,i){if(i===void 0)return this.lerp(this,e,n);for(let s=0;s<this.ELEMENTS;++s){const c=e[s];this[s]=c+i*(n[s]-c)}return this.check()}min(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(e[n],this[n]);return this.check()}max(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.max(e[n],this[n]);return this.check()}clamp(e,n){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e[i]),n[i]);return this.check()}add(...e){for(const n of e)for(let i=0;i<this.ELEMENTS;++i)this[i]+=n[i];return this.check()}subtract(...e){for(const n of e)for(let i=0;i<this.ELEMENTS;++i)this[i]-=n[i];return this.check()}scale(e){if(typeof e=="number")for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;else for(let n=0;n<this.ELEMENTS&&n<e.length;++n)this[n]*=e[n];return this.check()}multiplyByScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}check(){if(rs.debug&&!this.validate())throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}validate(){let e=this.length===this.ELEMENTS;for(let n=0;n<this.ELEMENTS;++n)e=e&&Number.isFinite(this[n]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=e;return this.check()}addScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,n){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e),n);return this.check()}get elements(){return this}}function sN(t,e){if(t.length!==e)return!1;for(let n=0;n<t.length;++n)if(!Number.isFinite(t[n]))return!1;return!0}function ts(t){if(!Number.isFinite(t))throw new Error("Invalid number ".concat(t));return t}function Sy(t,e,n=""){if(rs.debug&&!sN(t,e))throw new Error("math.gl: ".concat(n," some fields set to invalid numbers'"));return t}class oN extends OP{get x(){return this[0]}set x(e){this[0]=ts(e)}get y(){return this[1]}set y(e){this[1]=ts(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let n=0;n<this.ELEMENTS;++n)e+=this[n]*this[n];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let n=0;for(let i=0;i<this.ELEMENTS;++i){const s=this[i]-e[i];n+=s*s}return ts(n)}dot(e){let n=0;for(let i=0;i<this.ELEMENTS;++i)n+=this[i]*e[i];return ts(n)}normalize(){const e=this.magnitude();if(e!==0)for(let n=0;n<this.ELEMENTS;++n)this[n]/=e;return this.check()}multiply(...e){for(const n of e)for(let i=0;i<this.ELEMENTS;++i)this[i]*=n[i];return this.check()}divide(...e){for(const n of e)for(let i=0;i<this.ELEMENTS;++i)this[i]/=n[i];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return HE(e>=0&&e<this.ELEMENTS,"index is out of range"),ts(this[e])}setComponent(e,n){return HE(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=n,this.check()}addVectors(e,n){return this.copy(e).add(n)}subVectors(e,n){return this.copy(e).subtract(n)}multiplyVectors(e,n){return this.copy(e).multiply(n)}addScaledVector(e,n){return this.add(new this.constructor(e).multiplyScalar(n))}}var fm=1e-6,Ru=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});function aN(){var t=new Ru(2);return Ru!=Float32Array&&(t[0]=0,t[1]=0),t}function J0(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function lN(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t}function cN(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t}function uN(t){var e=t[0],n=t[1];return Math.hypot(e,n)}function hN(t,e){return t[0]=-e[0],t[1]=-e[1],t}function FP(t,e,n,i){var s=e[0],c=e[1];return t[0]=s+i*(n[0]-s),t[1]=c+i*(n[1]-c),t}function dN(t,e,n){var i=e[0],s=e[1];return t[0]=n[0]*i+n[4]*s+n[12],t[1]=n[1]*i+n[5]*s+n[13],t}var fN=lN;(function(){var t=aN();return function(e,n,i,s,c,d){var l,y;for(n||(n=2),i||(i=0),s?y=Math.min(s*n+i,e.length):y=e.length,l=i;l<y;l+=n)t[0]=e[l],t[1]=e[l+1],c(t,t,d),e[l]=t[0],e[l+1]=t[1];return e}})();function pN(t,e,n){const i=e[0],s=e[1],c=n[3]*i+n[7]*s||1;return t[0]=(n[0]*i+n[4]*s)/c,t[1]=(n[1]*i+n[5]*s)/c,t}function NP(t,e,n){const i=e[0],s=e[1],c=e[2],d=n[3]*i+n[7]*s+n[11]*c||1;return t[0]=(n[0]*i+n[4]*s+n[8]*c)/d,t[1]=(n[1]*i+n[5]*s+n[9]*c)/d,t[2]=(n[2]*i+n[6]*s+n[10]*c)/d,t}function mN(t,e,n){const i=e[0],s=e[1];return t[0]=n[0]*i+n[2]*s,t[1]=n[1]*i+n[3]*s,t[2]=e[2],t}function gN(){var t=new Ru(3);return Ru!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function _N(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function yN(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function vN(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function xN(t,e,n){var i=e[0],s=e[1],c=e[2],d=n[0],l=n[1],y=n[2];return t[0]=s*y-c*l,t[1]=c*d-i*y,t[2]=i*l-s*d,t}function BP(t,e,n){var i=e[0],s=e[1],c=e[2],d=n[3]*i+n[7]*s+n[11]*c+n[15];return d=d||1,t[0]=(n[0]*i+n[4]*s+n[8]*c+n[12])/d,t[1]=(n[1]*i+n[5]*s+n[9]*c+n[13])/d,t[2]=(n[2]*i+n[6]*s+n[10]*c+n[14])/d,t}function bN(t,e,n){var i=e[0],s=e[1],c=e[2];return t[0]=i*n[0]+s*n[3]+c*n[6],t[1]=i*n[1]+s*n[4]+c*n[7],t[2]=i*n[2]+s*n[5]+c*n[8],t}function wN(t,e,n){var i=n[0],s=n[1],c=n[2],d=n[3],l=e[0],y=e[1],w=e[2],S=s*w-c*y,C=c*l-i*w,P=i*y-s*l,D=s*P-c*C,U=c*S-i*P,H=i*C-s*S,ae=d*2;return S*=ae,C*=ae,P*=ae,D*=2,U*=2,H*=2,t[0]=l+S+D,t[1]=y+C+U,t[2]=w+P+H,t}function EN(t,e,n,i){var s=[],c=[];return s[0]=e[0]-n[0],s[1]=e[1]-n[1],s[2]=e[2]-n[2],c[0]=s[0],c[1]=s[1]*Math.cos(i)-s[2]*Math.sin(i),c[2]=s[1]*Math.sin(i)+s[2]*Math.cos(i),t[0]=c[0]+n[0],t[1]=c[1]+n[1],t[2]=c[2]+n[2],t}function TN(t,e,n,i){var s=[],c=[];return s[0]=e[0]-n[0],s[1]=e[1]-n[1],s[2]=e[2]-n[2],c[0]=s[2]*Math.sin(i)+s[0]*Math.cos(i),c[1]=s[1],c[2]=s[2]*Math.cos(i)-s[0]*Math.sin(i),t[0]=c[0]+n[0],t[1]=c[1]+n[1],t[2]=c[2]+n[2],t}function SN(t,e,n,i){var s=[],c=[];return s[0]=e[0]-n[0],s[1]=e[1]-n[1],s[2]=e[2]-n[2],c[0]=s[0]*Math.cos(i)-s[1]*Math.sin(i),c[1]=s[0]*Math.sin(i)+s[1]*Math.cos(i),c[2]=s[2],t[0]=c[0]+n[0],t[1]=c[1]+n[1],t[2]=c[2]+n[2],t}function AN(t,e){var n=t[0],i=t[1],s=t[2],c=e[0],d=e[1],l=e[2],y=Math.sqrt(n*n+i*i+s*s),w=Math.sqrt(c*c+d*d+l*l),S=y*w,C=S&&vN(t,e)/S;return Math.acos(Math.min(Math.max(C,-1),1))}var PN=_N;(function(){var t=gN();return function(e,n,i,s,c,d){var l,y;for(n||(n=3),i||(i=0),s?y=Math.min(s*n+i,e.length):y=e.length,l=i;l<y;l+=n)t[0]=e[l],t[1]=e[l+1],t[2]=e[l+2],c(t,t,d),e[l]=t[0],e[l+1]=t[1],e[l+2]=t[2];return e}})();const Ay=[0,0,0];let zp;class wo extends oN{static get ZERO(){return zp||(zp=new wo(0,0,0),Object.freeze(zp)),zp}constructor(e=0,n=0,i=0){super(-0,-0,-0),arguments.length===1&&ku(e)?this.copy(e):(rs.debug&&(ts(e),ts(n),ts(i)),this[0]=e,this[1]=n,this[2]=i)}set(e,n,i){return this[0]=e,this[1]=n,this[2]=i,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return rs.debug&&(ts(e.x),ts(e.y),ts(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=ts(e)}angle(e){return AN(this,e)}cross(e){return xN(this,this,e),this.check()}rotateX({radians:e,origin:n=Ay}){return EN(this,this,n,e),this.check()}rotateY({radians:e,origin:n=Ay}){return TN(this,this,n,e),this.check()}rotateZ({radians:e,origin:n=Ay}){return SN(this,this,n,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return BP(this,this,e),this.check()}transformAsVector(e){return NP(this,this,e),this.check()}transformByMatrix3(e){return bN(this,this,e),this.check()}transformByMatrix2(e){return mN(this,this,e),this.check()}transformByQuaternion(e){return wN(this,this,e),this.check()}}class IN extends OP{toString(){let e="[";if(rs.printRowMajor){e+="row-major:";for(let n=0;n<this.RANK;++n)for(let i=0;i<this.RANK;++i)e+=" ".concat(this[i*this.RANK+n])}else{e+="column-major:";for(let n=0;n<this.ELEMENTS;++n)e+=" ".concat(this[n])}return e+="]",e}getElementIndex(e,n){return n*this.RANK+e}getElement(e,n){return this[n*this.RANK+e]}setElement(e,n,i){return this[n*this.RANK+e]=ts(i),this}getColumn(e,n=new Array(this.RANK).fill(-0)){const i=e*this.RANK;for(let s=0;s<this.RANK;++s)n[s]=this[i+s];return n}setColumn(e,n){const i=e*this.RANK;for(let s=0;s<this.RANK;++s)this[i+s]=n[s];return this}}function CN(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function MN(t,e){if(t===e){var n=e[1],i=e[2],s=e[3],c=e[6],d=e[7],l=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=i,t[9]=c,t[11]=e[14],t[12]=s,t[13]=d,t[14]=l}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function Q0(t,e){var n=e[0],i=e[1],s=e[2],c=e[3],d=e[4],l=e[5],y=e[6],w=e[7],S=e[8],C=e[9],P=e[10],D=e[11],U=e[12],H=e[13],ae=e[14],G=e[15],V=n*l-i*d,W=n*y-s*d,ie=n*w-c*d,ge=i*y-s*l,be=i*w-c*l,De=s*w-c*y,Ne=S*H-C*U,He=S*ae-P*U,je=S*G-D*U,vt=C*ae-P*H,Nt=C*G-D*H,Qt=P*G-D*ae,Bt=V*Qt-W*Nt+ie*vt+ge*je-be*He+De*Ne;return Bt?(Bt=1/Bt,t[0]=(l*Qt-y*Nt+w*vt)*Bt,t[1]=(s*Nt-i*Qt-c*vt)*Bt,t[2]=(H*De-ae*be+G*ge)*Bt,t[3]=(P*be-C*De-D*ge)*Bt,t[4]=(y*je-d*Qt-w*He)*Bt,t[5]=(n*Qt-s*je+c*He)*Bt,t[6]=(ae*ie-U*De-G*W)*Bt,t[7]=(S*De-P*ie+D*W)*Bt,t[8]=(d*Nt-l*je+w*Ne)*Bt,t[9]=(i*je-n*Nt-c*Ne)*Bt,t[10]=(U*be-H*ie+G*V)*Bt,t[11]=(C*ie-S*be-D*V)*Bt,t[12]=(l*He-d*vt-y*Ne)*Bt,t[13]=(n*vt-i*He+s*Ne)*Bt,t[14]=(H*W-U*ge-ae*V)*Bt,t[15]=(S*ge-C*W+P*V)*Bt,t):null}function LN(t){var e=t[0],n=t[1],i=t[2],s=t[3],c=t[4],d=t[5],l=t[6],y=t[7],w=t[8],S=t[9],C=t[10],P=t[11],D=t[12],U=t[13],H=t[14],ae=t[15],G=e*d-n*c,V=e*l-i*c,W=e*y-s*c,ie=n*l-i*d,ge=n*y-s*d,be=i*y-s*l,De=w*U-S*D,Ne=w*H-C*D,He=w*ae-P*D,je=S*H-C*U,vt=S*ae-P*U,Nt=C*ae-P*H;return G*Nt-V*vt+W*je+ie*He-ge*Ne+be*De}function jl(t,e,n){var i=e[0],s=e[1],c=e[2],d=e[3],l=e[4],y=e[5],w=e[6],S=e[7],C=e[8],P=e[9],D=e[10],U=e[11],H=e[12],ae=e[13],G=e[14],V=e[15],W=n[0],ie=n[1],ge=n[2],be=n[3];return t[0]=W*i+ie*l+ge*C+be*H,t[1]=W*s+ie*y+ge*P+be*ae,t[2]=W*c+ie*w+ge*D+be*G,t[3]=W*d+ie*S+ge*U+be*V,W=n[4],ie=n[5],ge=n[6],be=n[7],t[4]=W*i+ie*l+ge*C+be*H,t[5]=W*s+ie*y+ge*P+be*ae,t[6]=W*c+ie*w+ge*D+be*G,t[7]=W*d+ie*S+ge*U+be*V,W=n[8],ie=n[9],ge=n[10],be=n[11],t[8]=W*i+ie*l+ge*C+be*H,t[9]=W*s+ie*y+ge*P+be*ae,t[10]=W*c+ie*w+ge*D+be*G,t[11]=W*d+ie*S+ge*U+be*V,W=n[12],ie=n[13],ge=n[14],be=n[15],t[12]=W*i+ie*l+ge*C+be*H,t[13]=W*s+ie*y+ge*P+be*ae,t[14]=W*c+ie*w+ge*D+be*G,t[15]=W*d+ie*S+ge*U+be*V,t}function Xm(t,e,n){var i=n[0],s=n[1],c=n[2],d,l,y,w,S,C,P,D,U,H,ae,G;return e===t?(t[12]=e[0]*i+e[4]*s+e[8]*c+e[12],t[13]=e[1]*i+e[5]*s+e[9]*c+e[13],t[14]=e[2]*i+e[6]*s+e[10]*c+e[14],t[15]=e[3]*i+e[7]*s+e[11]*c+e[15]):(d=e[0],l=e[1],y=e[2],w=e[3],S=e[4],C=e[5],P=e[6],D=e[7],U=e[8],H=e[9],ae=e[10],G=e[11],t[0]=d,t[1]=l,t[2]=y,t[3]=w,t[4]=S,t[5]=C,t[6]=P,t[7]=D,t[8]=U,t[9]=H,t[10]=ae,t[11]=G,t[12]=d*i+S*s+U*c+e[12],t[13]=l*i+C*s+H*c+e[13],t[14]=y*i+P*s+ae*c+e[14],t[15]=w*i+D*s+G*c+e[15]),t}function kx(t,e,n){var i=n[0],s=n[1],c=n[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*s,t[5]=e[5]*s,t[6]=e[6]*s,t[7]=e[7]*s,t[8]=e[8]*c,t[9]=e[9]*c,t[10]=e[10]*c,t[11]=e[11]*c,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function kN(t,e,n,i){var s=i[0],c=i[1],d=i[2],l=Math.hypot(s,c,d),y,w,S,C,P,D,U,H,ae,G,V,W,ie,ge,be,De,Ne,He,je,vt,Nt,Qt,Bt,ai;return l<fm?null:(l=1/l,s*=l,c*=l,d*=l,y=Math.sin(n),w=Math.cos(n),S=1-w,C=e[0],P=e[1],D=e[2],U=e[3],H=e[4],ae=e[5],G=e[6],V=e[7],W=e[8],ie=e[9],ge=e[10],be=e[11],De=s*s*S+w,Ne=c*s*S+d*y,He=d*s*S-c*y,je=s*c*S-d*y,vt=c*c*S+w,Nt=d*c*S+s*y,Qt=s*d*S+c*y,Bt=c*d*S-s*y,ai=d*d*S+w,t[0]=C*De+H*Ne+W*He,t[1]=P*De+ae*Ne+ie*He,t[2]=D*De+G*Ne+ge*He,t[3]=U*De+V*Ne+be*He,t[4]=C*je+H*vt+W*Nt,t[5]=P*je+ae*vt+ie*Nt,t[6]=D*je+G*vt+ge*Nt,t[7]=U*je+V*vt+be*Nt,t[8]=C*Qt+H*Bt+W*ai,t[9]=P*Qt+ae*Bt+ie*ai,t[10]=D*Qt+G*Bt+ge*ai,t[11]=U*Qt+V*Bt+be*ai,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function UP(t,e,n){var i=Math.sin(n),s=Math.cos(n),c=e[4],d=e[5],l=e[6],y=e[7],w=e[8],S=e[9],C=e[10],P=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=c*s+w*i,t[5]=d*s+S*i,t[6]=l*s+C*i,t[7]=y*s+P*i,t[8]=w*s-c*i,t[9]=S*s-d*i,t[10]=C*s-l*i,t[11]=P*s-y*i,t}function RN(t,e,n){var i=Math.sin(n),s=Math.cos(n),c=e[0],d=e[1],l=e[2],y=e[3],w=e[8],S=e[9],C=e[10],P=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=c*s-w*i,t[1]=d*s-S*i,t[2]=l*s-C*i,t[3]=y*s-P*i,t[8]=c*i+w*s,t[9]=d*i+S*s,t[10]=l*i+C*s,t[11]=y*i+P*s,t}function VP(t,e,n){var i=Math.sin(n),s=Math.cos(n),c=e[0],d=e[1],l=e[2],y=e[3],w=e[4],S=e[5],C=e[6],P=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=c*s+w*i,t[1]=d*s+S*i,t[2]=l*s+C*i,t[3]=y*s+P*i,t[4]=w*s-c*i,t[5]=S*s-d*i,t[6]=C*s-l*i,t[7]=P*s-y*i,t}function DN(t,e){var n=e[0],i=e[1],s=e[2],c=e[3],d=n+n,l=i+i,y=s+s,w=n*d,S=i*d,C=i*l,P=s*d,D=s*l,U=s*y,H=c*d,ae=c*l,G=c*y;return t[0]=1-C-U,t[1]=S+G,t[2]=P-ae,t[3]=0,t[4]=S-G,t[5]=1-w-U,t[6]=D+H,t[7]=0,t[8]=P+ae,t[9]=D-H,t[10]=1-w-C,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function zN(t,e,n,i,s,c,d){var l=1/(n-e),y=1/(s-i),w=1/(c-d);return t[0]=c*2*l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c*2*y,t[6]=0,t[7]=0,t[8]=(n+e)*l,t[9]=(s+i)*y,t[10]=(d+c)*w,t[11]=-1,t[12]=0,t[13]=0,t[14]=d*c*2*w,t[15]=0,t}function ON(t,e,n,i,s){var c=1/Math.tan(e/2),d;return t[0]=c/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,s!=null&&s!==1/0?(d=1/(i-s),t[10]=(s+i)*d,t[14]=2*s*i*d):(t[10]=-1,t[14]=-2*i),t}var FN=ON;function NN(t,e,n,i,s,c,d){var l=1/(e-n),y=1/(i-s),w=1/(c-d);return t[0]=-2*l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*y,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*w,t[11]=0,t[12]=(e+n)*l,t[13]=(s+i)*y,t[14]=(d+c)*w,t[15]=1,t}var BN=NN;function UN(t,e,n,i){var s,c,d,l,y,w,S,C,P,D,U=e[0],H=e[1],ae=e[2],G=i[0],V=i[1],W=i[2],ie=n[0],ge=n[1],be=n[2];return Math.abs(U-ie)<fm&&Math.abs(H-ge)<fm&&Math.abs(ae-be)<fm?CN(t):(S=U-ie,C=H-ge,P=ae-be,D=1/Math.hypot(S,C,P),S*=D,C*=D,P*=D,s=V*P-W*C,c=W*S-G*P,d=G*C-V*S,D=Math.hypot(s,c,d),D?(D=1/D,s*=D,c*=D,d*=D):(s=0,c=0,d=0),l=C*d-P*c,y=P*s-S*d,w=S*c-C*s,D=Math.hypot(l,y,w),D?(D=1/D,l*=D,y*=D,w*=D):(l=0,y=0,w=0),t[0]=s,t[1]=l,t[2]=S,t[3]=0,t[4]=c,t[5]=y,t[6]=C,t[7]=0,t[8]=d,t[9]=w,t[10]=P,t[11]=0,t[12]=-(s*U+c*H+d*ae),t[13]=-(l*U+y*H+w*ae),t[14]=-(S*U+C*H+P*ae),t[15]=1,t)}function VN(){var t=new Ru(4);return Ru!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function jN(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function rf(t,e,n){var i=e[0],s=e[1],c=e[2],d=e[3];return t[0]=n[0]*i+n[4]*s+n[8]*c+n[12]*d,t[1]=n[1]*i+n[5]*s+n[9]*c+n[13]*d,t[2]=n[2]*i+n[6]*s+n[10]*c+n[14]*d,t[3]=n[3]*i+n[7]*s+n[11]*c+n[15]*d,t}(function(){var t=VN();return function(e,n,i,s,c,d){var l,y;for(n||(n=4),i||(i=0),s?y=Math.min(s*n+i,e.length):y=e.length,l=i;l<y;l+=n)t[0]=e[l],t[1]=e[l+1],t[2]=e[l+2],t[3]=e[l+3],c(t,t,d),e[l]=t[0],e[l+1]=t[1],e[l+2]=t[2],e[l+3]=t[3];return e}})();var ev;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL0ROW3=3]="COL0ROW3",t[t.COL1ROW0=4]="COL1ROW0",t[t.COL1ROW1=5]="COL1ROW1",t[t.COL1ROW2=6]="COL1ROW2",t[t.COL1ROW3=7]="COL1ROW3",t[t.COL2ROW0=8]="COL2ROW0",t[t.COL2ROW1=9]="COL2ROW1",t[t.COL2ROW2=10]="COL2ROW2",t[t.COL2ROW3=11]="COL2ROW3",t[t.COL3ROW0=12]="COL3ROW0",t[t.COL3ROW1=13]="COL3ROW1",t[t.COL3ROW2=14]="COL3ROW2",t[t.COL3ROW3=15]="COL3ROW3"})(ev||(ev={}));const GN=45*Math.PI/180,WN=1,Py=.1,Iy=500,HN=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class Eo extends IN{static get IDENTITY(){return qN()}static get ZERO(){return $N()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return ev}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,n,i,s,c,d,l,y,w,S,C,P,D,U,H,ae){return this[0]=e,this[1]=n,this[2]=i,this[3]=s,this[4]=c,this[5]=d,this[6]=l,this[7]=y,this[8]=w,this[9]=S,this[10]=C,this[11]=P,this[12]=D,this[13]=U,this[14]=H,this[15]=ae,this.check()}setRowMajor(e,n,i,s,c,d,l,y,w,S,C,P,D,U,H,ae){return this[0]=e,this[1]=c,this[2]=w,this[3]=D,this[4]=n,this[5]=d,this[6]=S,this[7]=U,this[8]=i,this[9]=l,this[10]=C,this[11]=H,this[12]=s,this[13]=y,this[14]=P,this[15]=ae,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(HN)}fromObject(e){return this.check()}fromQuaternion(e){return DN(this,e),this.check()}frustum(e){const{left:n,right:i,bottom:s,top:c,near:d=Py,far:l=Iy}=e;return l===1/0?ZN(this,n,i,s,c,d):zN(this,n,i,s,c,d,l),this.check()}lookAt(e){const{eye:n,center:i=[0,0,0],up:s=[0,1,0]}=e;return UN(this,n,i,s),this.check()}ortho(e){const{left:n,right:i,bottom:s,top:c,near:d=Py,far:l=Iy}=e;return BN(this,n,i,s,c,d,l),this.check()}orthographic(e){const{fovy:n=GN,aspect:i=WN,focalDistance:s=1,near:c=Py,far:d=Iy}=e;$E(n);const l=n/2,y=s*Math.tan(l),w=y*i;return this.ortho({left:-w,right:w,bottom:-y,top:y,near:c,far:d})}perspective(e){const{fovy:n=45*Math.PI/180,aspect:i=1,near:s=.1,far:c=500}=e;return $E(n),FN(this,n,i,s,c),this.check()}determinant(){return LN(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const i=this.getScale(n),s=1/i[0],c=1/i[1],d=1/i[2];return e[0]=this[0]*s,e[1]=this[1]*c,e[2]=this[2]*d,e[3]=0,e[4]=this[4]*s,e[5]=this[5]*c,e[6]=this[6]*d,e[7]=0,e[8]=this[8]*s,e[9]=this[9]*c,e[10]=this[10]*d,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const i=this.getScale(n),s=1/i[0],c=1/i[1],d=1/i[2];return e[0]=this[0]*s,e[1]=this[1]*c,e[2]=this[2]*d,e[3]=this[4]*s,e[4]=this[5]*c,e[5]=this[6]*d,e[6]=this[8]*s,e[7]=this[9]*c,e[8]=this[10]*d,e}transpose(){return MN(this,this),this.check()}invert(){return Q0(this,this),this.check()}multiplyLeft(e){return jl(this,e,this),this.check()}multiplyRight(e){return jl(this,this,e),this.check()}rotateX(e){return UP(this,this,e),this.check()}rotateY(e){return RN(this,this,e),this.check()}rotateZ(e){return VP(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,n){return kN(this,this,e,n),this.check()}scale(e){return kx(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return Xm(this,this,e),this.check()}transform(e,n){return e.length===4?(n=rf(n||[-0,-0,-0,-0],e,this),Sy(n,4),n):this.transformAsPoint(e,n)}transformAsPoint(e,n){const{length:i}=e;let s;switch(i){case 2:s=dN(n||[-0,-0],e,this);break;case 3:s=BP(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Sy(s,e.length),s}transformAsVector(e,n){let i;switch(e.length){case 2:i=pN(n||[-0,-0],e,this);break;case 3:i=NP(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Sy(i,e.length),i}transformPoint(e,n){return this.transformAsPoint(e,n)}transformVector(e,n){return this.transformAsPoint(e,n)}transformDirection(e,n){return this.transformAsVector(e,n)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,n,i){return this.identity().translate([e,n,i])}}let Op,Fp;function $N(){return Op||(Op=new Eo([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(Op)),Op}function qN(){return Fp||(Fp=new Eo,Object.freeze(Fp)),Fp}function $E(t){if(t>Math.PI*2)throw Error("expected radians")}function ZN(t,e,n,i,s,c){const d=2*c/(n-e),l=2*c/(s-i),y=(n+e)/(n-e),w=(s+i)/(s-i),S=-1,C=-1,P=-2*c;return t[0]=d,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=l,t[6]=0,t[7]=0,t[8]=y,t[9]=w,t[10]=S,t[11]=C,t[12]=0,t[13]=0,t[14]=P,t[15]=0,t}const qE=`#if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))

struct AmbientLight {
 vec3 color;
};

struct PointLight {
 vec3 color;
 vec3 position;
 vec3 attenuation;
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform AmbientLight lighting_uAmbientLight;
uniform PointLight lighting_uPointLight[MAX_LIGHTS];
uniform DirectionalLight lighting_uDirectionalLight[MAX_LIGHTS];
uniform int lighting_uPointLightCount;
uniform int lighting_uDirectionalLightCount;

uniform bool lighting_uEnabled;

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

#endif
`,XN={lightSources:{}};function Cy(){let{color:t=[0,0,0],intensity:e=1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return t.map(n=>n*e/255)}function YN(t){let{ambientLight:e,pointLights:n=[],directionalLights:i=[]}=t;const s={};return e?s["lighting_uAmbientLight.color"]=Cy(e):s["lighting_uAmbientLight.color"]=[0,0,0],n.forEach((c,d)=>{s["lighting_uPointLight[".concat(d,"].color")]=Cy(c),s["lighting_uPointLight[".concat(d,"].position")]=c.position,s["lighting_uPointLight[".concat(d,"].attenuation")]=c.attenuation||[1,0,0]}),s.lighting_uPointLightCount=n.length,i.forEach((c,d)=>{s["lighting_uDirectionalLight[".concat(d,"].color")]=Cy(c),s["lighting_uDirectionalLight[".concat(d,"].direction")]=c.direction}),s.lighting_uDirectionalLightCount=i.length,s}function jP(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:XN;if("lightSources"in t){const{ambientLight:e,pointLights:n,directionalLights:i}=t.lightSources||{};return e||n&&n.length>0||i&&i.length>0?Object.assign({},YN({ambientLight:e,pointLights:n,directionalLights:i}),{lighting_uEnabled:!0}):{lighting_uEnabled:!1}}if("lights"in t){const e={pointLights:[],directionalLights:[]};for(const n of t.lights||[])switch(n.type){case"ambient":e.ambientLight=n;break;case"directional":e.directionalLights.push(n);break;case"point":e.pointLights.push(n);break}return jP({lightSources:e})}return{}}const KN={name:"lights",vs:qE,fs:qE,getUniforms:jP,defines:{MAX_LIGHTS:3}},JN=new Uint8Array([0,255,255,255]),QN={pickingSelectedColor:null,pickingHighlightColor:JN,pickingActive:!1,pickingAttribute:!1};function eB(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:QN;const e={};if(t.pickingSelectedColor!==void 0)if(!t.pickingSelectedColor)e.picking_uSelectedColorValid=0;else{const n=t.pickingSelectedColor.slice(0,3);e.picking_uSelectedColorValid=1,e.picking_uSelectedColor=n}if(t.pickingHighlightColor){const n=Array.from(t.pickingHighlightColor,i=>i/255);Number.isFinite(n[3])||(n[3]=1),e.picking_uHighlightColor=n}return t.pickingActive!==void 0&&(e.picking_uActive=!!t.pickingActive,e.picking_uAttribute=!!t.pickingAttribute),e}const tB=`uniform bool picking_uActive;
uniform bool picking_uAttribute;
uniform vec3 picking_uSelectedColor;
uniform bool picking_uSelectedColorValid;

out vec4 picking_vRGBcolor_Avalid;

const float COLOR_SCALE = 1. / 255.;

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.001;
}

bool isVertexPicked(vec3 vertexColor) {
  return
    picking_uSelectedColorValid &&
    !picking_isColorValid(abs(vertexColor - picking_uSelectedColor));
}

void picking_setPickingColor(vec3 pickingColor) {
  if (picking_uActive) {
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!picking_uAttribute) {
      picking_vRGBcolor_Avalid.rgb = pickingColor * COLOR_SCALE;
    }
  } else {
    picking_vRGBcolor_Avalid.a = float(isVertexPicked(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.r = value;
  }
}
void picking_setPickingAttribute(vec2 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}
void picking_setPickingAttribute(vec3 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,nB=`uniform bool picking_uActive;
uniform vec3 picking_uSelectedColor;
uniform vec4 picking_uHighlightColor;

in vec4 picking_vRGBcolor_Avalid;
vec4 picking_filterHighlightColor(vec4 color) {
  if (picking_uActive) {
    return color;
  }
  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    float highLightAlpha = picking_uHighlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking_uHighlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}
vec4 picking_filterPickingColor(vec4 color) {
  if (picking_uActive) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}
vec4 picking_filterColor(vec4 color) {
  vec4 highightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highightColor);
}

`,iB={name:"picking",vs:tB,fs:nB,getUniforms:eB},rB=`
uniform float lighting_uAmbient;
uniform float lighting_uDiffuse;
uniform float lighting_uShininess;
uniform vec3  lighting_uSpecularColor;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
    vec3 halfway_direction = normalize(light_direction + view_direction);
    float lambertian = dot(light_direction, normal_worldspace);
    float specular = 0.0;
    if (lambertian > 0.0) {
      float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
      specular = pow(specular_angle, lighting_uShininess);
    }
    lambertian = max(lambertian, 0.0);
    return (lambertian * lighting_uDiffuse * surfaceColor + specular * lighting_uSpecularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting_uEnabled) {
    vec3 view_direction = normalize(cameraPosition - position_worldspace);
    lightColor = lighting_uAmbient * surfaceColor * lighting_uAmbientLight.color;

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uPointLightCount) {
        break;
      }
      PointLight pointLight = lighting_uPointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uDirectionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting_uDirectionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
  }
  return lightColor;
}

vec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = vec3(0, 0, 0);
  vec3 surfaceColor = vec3(0, 0, 0);

  if (lighting_uEnabled) {
    vec3 view_direction = normalize(cameraPosition - position_worldspace);

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uPointLightCount) {
        break;
      }
      PointLight pointLight = lighting_uPointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uDirectionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting_uDirectionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
  }
  return lightColor;
}
`,sB={};function oB(t){const{ambient:e=.35,diffuse:n=.6,shininess:i=32,specularColor:s=[30,30,30]}=t;return{lighting_uAmbient:e,lighting_uDiffuse:n,lighting_uShininess:i,lighting_uSpecularColor:s.map(c=>c/255)}}function aB(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:sB;if(!("material"in t))return{};const{material:e}=t;return e?oB(e):{lighting_uEnabled:!1}}const lB={name:"gouraud-lighting",dependencies:[KN],vs:rB,defines:{LIGHTING_VERTEX:1},getUniforms:aB},cB=`attribute float transform_elementID;
vec2 transform_getPixelSizeHalf(vec2 size) {
  return vec2(1.) / (2. * size);
}

vec2 transform_getPixelIndices(vec2 texSize, vec2 pixelSizeHalf) {
  float yIndex = floor((transform_elementID / texSize[0]) + pixelSizeHalf[1]);
  float xIndex = transform_elementID - (yIndex * texSize[0]);
  return vec2(xIndex, yIndex);
}
vec2 transform_getTexCoord(vec2 size) {
  vec2 pixelSizeHalf = transform_getPixelSizeHalf(size);
  vec2 indices = transform_getPixelIndices(size, pixelSizeHalf);
  vec2 coord = indices / size + pixelSizeHalf;
  return coord;
}
vec2 transform_getPos(vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec2 pos = (texCoord * (2.0, 2.0)) - (1., 1.);
  return pos;
}
vec4 transform_getInput(sampler2D texSampler, vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec4 textureColor = texture2D(texSampler, texCoord);
  return textureColor;
}
`,uB={name:"transform",vs:cB,fs:null};class sf{static getDefaultProgramManager(e){return e.luma=e.luma||{},e.luma.defaultProgramManager=e.luma.defaultProgramManager||new sf(e),e.luma.defaultProgramManager}constructor(e){this.gl=e,this._programCache={},this._getUniforms={},this._registeredModules={},this._hookFunctions=[],this._defaultModules=[],this._hashes={},this._hashCounter=0,this.stateHash=0,this._useCounts={}}addDefaultModule(e){this._defaultModules.find(n=>n.name===e.name)||this._defaultModules.push(e),this.stateHash++}removeDefaultModule(e){const n=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(i=>i.name!==n),this.stateHash++}addShaderHook(e,n){n&&(e=Object.assign(n,{hook:e})),this._hookFunctions.push(e),this.stateHash++}get(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{vs:n="",fs:i="",defines:s={},inject:c={},varyings:d=[],bufferMode:l=35981,transpileToGLSL100:y=!1}=e,w=this._getModuleList(e.modules),S=this._getHash(n),C=this._getHash(i),P=w.map(W=>this._getHash(W.name)).sort(),D=d.map(W=>this._getHash(W)),U=Object.keys(s).sort(),H=Object.keys(c).sort(),ae=[],G=[];for(const W of U)ae.push(this._getHash(W)),ae.push(this._getHash(s[W]));for(const W of H)G.push(this._getHash(W)),G.push(this._getHash(c[W]));const V="".concat(S,"/").concat(C,"D").concat(ae.join("/"),"M").concat(P.join("/"),"I").concat(G.join("/"),"V").concat(D.join("/"),"H").concat(this.stateHash,"B").concat(l).concat(y?"T":"");if(!this._programCache[V]){const W=zF(this.gl,{vs:n,fs:i,modules:w,inject:c,defines:s,hookFunctions:this._hookFunctions,transpileToGLSL100:y});this._programCache[V]=new TP(this.gl,{hash:V,vs:W.vs,fs:W.fs,varyings:d,bufferMode:l}),this._getUniforms[V]=W.getUniforms||(ie=>{}),this._useCounts[V]=0}return this._useCounts[V]++,this._programCache[V]}getUniforms(e){return this._getUniforms[e.hash]||null}release(e){const n=e.hash;this._useCounts[n]--,this._useCounts[n]===0&&(this._programCache[n].delete(),delete this._programCache[n],delete this._getUniforms[n],delete this._useCounts[n])}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}_getModuleList(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const n=new Array(this._defaultModules.length+e.length),i={};let s=0;for(let c=0,d=this._defaultModules.length;c<d;++c){const l=this._defaultModules[c],y=l.name;n[s++]=l,i[y]=!0}for(let c=0,d=e.length;c<d;++c){const l=e[c],y=l.name;i[y]||(n[s++]=l,i[y]=!0)}return n.length=s,n}}const hB={POSITION:"positions",NORMAL:"normals",COLOR_0:"colors",TEXCOORD_0:"texCoords",TEXCOORD_1:"texCoords1",TEXCOORD_2:"texCoords2"};function dB(t,e,n){const i={};let s=e.indices;for(const c in e.attributes){const d=e.attributes[c],l=fB(c,n);if(c==="indices")s=d;else if(d.constant)i[l]=d.value;else{const y=d.value,w={...d};delete w.value,i[l]=[new vn(t,y),w],pB(c,w)}}if(s){const c=s.value||s;ft(c instanceof Uint16Array||c instanceof Uint32Array,'attribute array for "indices" must be of integer type');const d={size:1,isIndexed:s.isIndexed===void 0?!0:s.isIndexed};i.indices=[new vn(t,{data:c,target:34963}),d]}return i}function fB(t,e){const{attributeMap:n=hB}=e||{};return n&&n[t]||t}function pB(t,e){let n;switch(t){case"texCoords":case"texCoord1":case"texCoord2":case"texCoord3":n="uvs";break;case"vertices":case"positions":case"normals":case"pickingColors":n="vectors";break}switch(n){case"vectors":e.size=e.size||3;break;case"uvs":e.size=e.size||2;break}ft(Number.isFinite(e.size),"attribute ".concat(t," needs size"))}const Fc=2,mB=1e4,gB="Model needs drawMode and vertexCount",ZE=()=>{},_B={};class Du{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{id:i=Ka("model")}=n;ft(Eg(e)),this.id=i,this.gl=e,this.id=n.id||Ka("Model"),this.lastLogTime=0,this.animated=!1,this.initialize(n)}initialize(e){this.props={},this.programManager=e.programManager||sf.getDefaultProgramManager(this.gl),this._programManagerState=-1,this._managedProgram=!1;const{program:n=null,vs:i,fs:s,modules:c,defines:d,inject:l,varyings:y,bufferMode:w,transpileToGLSL100:S}=e;this.programProps={program:n,vs:i,fs:s,modules:c,defines:d,inject:l,varyings:y,bufferMode:w,transpileToGLSL100:S},this.program=null,this.vertexArray=null,this._programDirty=!0,this.userData={},this.needsRedraw=!0,this._attributes={},this.attributes={},this.uniforms={},this.pickable=!0,this._checkProgram(),this.setUniforms(Object.assign({},this.getModuleUniforms(e.moduleSettings))),this.drawMode=e.drawMode!==void 0?e.drawMode:4,this.vertexCount=e.vertexCount||0,this.geometryBuffers={},this.isInstanced=e.isInstanced||e.instanced||e.instanceCount>0,this._setModelProps(e),this.geometry={},ft(this.drawMode!==void 0&&Number.isFinite(this.vertexCount),gB)}setProps(e){this._setModelProps(e)}delete(){for(const e in this._attributes)this._attributes[e]!==this.attributes[e]&&this._attributes[e].delete();this._managedProgram&&(this.programManager.release(this.program),this._managedProgram=!1),this.vertexArray.delete(),this._deleteGeometryBuffers()}getDrawMode(){return this.drawMode}getVertexCount(){return this.vertexCount}getInstanceCount(){return this.instanceCount}getAttributes(){return this.attributes}getProgram(){return this.program}setProgram(e){const{program:n,vs:i,fs:s,modules:c,defines:d,inject:l,varyings:y,bufferMode:w,transpileToGLSL100:S}=e;this.programProps={program:n,vs:i,fs:s,modules:c,defines:d,inject:l,varyings:y,bufferMode:w,transpileToGLSL100:S},this._programDirty=!0}getUniforms(){return this.uniforms}setDrawMode(e){return this.drawMode=e,this}setVertexCount(e){return ft(Number.isFinite(e)),this.vertexCount=e,this}setInstanceCount(e){return ft(Number.isFinite(e)),this.instanceCount=e,this}setGeometry(e){return this.drawMode=e.drawMode,this.vertexCount=e.getVertexCount(),this._deleteGeometryBuffers(),this.geometryBuffers=dB(this.gl,e),this.vertexArray.setAttributes(this.geometryBuffers),this}setAttributes(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(Cu(e))return this;const n={};for(const i in e){const s=e[i];n[i]=s.getValue?s.getValue():s}return this.vertexArray.setAttributes(n),this}setUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Object.assign(this.uniforms,e),this}getModuleUniforms(e){this._checkProgram();const n=this.programManager.getUniforms(this.program);return n?n(e):{}}updateModuleSettings(e){const n=this.getModuleUniforms(e||{});return this.setUniforms(n)}clear(e){return Ix(this.program.gl,e),this}draw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._checkProgram();const{moduleSettings:n=null,framebuffer:i,uniforms:s={},attributes:c={},transformFeedback:d=this.transformFeedback,parameters:l={},vertexArray:y=this.vertexArray}=e;this.setAttributes(c),this.updateModuleSettings(n),this.setUniforms(s);let w;Pt.priority>=Fc&&(w=this._logDrawCallStart(Fc));const S=this.vertexArray.getDrawParams(),{isIndexed:C=S.isIndexed,indexType:P=S.indexType,indexOffset:D=S.indexOffset,vertexArrayInstanced:U=S.isInstanced}=this.props;U&&!this.isInstanced&&Pt.warn("Found instanced attributes on non-instanced model",this.id)();const{isInstanced:H,instanceCount:ae}=this,{onBeforeRender:G=ZE,onAfterRender:V=ZE}=this.props;G(),this.program.setUniforms(this.uniforms);const W=this.program.draw(Object.assign(_B,e,{logPriority:w,uniforms:null,framebuffer:i,parameters:l,drawMode:this.getDrawMode(),vertexCount:this.getVertexCount(),vertexArray:y,transformFeedback:d,isIndexed:C,indexType:P,isInstanced:H,instanceCount:ae,offset:C?D:0}));return V(),Pt.priority>=Fc&&this._logDrawCallEnd(w,y,i),W}transform(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{discard:n=!0,feedbackBuffers:i,unbindModels:s=[]}=e;let{parameters:c}=e;i&&this._setFeedbackBuffers(i),n&&(c=Object.assign({},c,{35977:n})),s.forEach(d=>d.vertexArray.unbindBuffers());try{this.draw(Object.assign({},e,{parameters:c}))}finally{s.forEach(d=>d.vertexArray.bindBuffers())}return this}render(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Pt.warn("Model.render() is deprecated. Use Model.setUniforms() and Model.draw()")(),this.setUniforms(e).draw()}_setModelProps(e){Object.assign(this.props,e),"uniforms"in e&&this.setUniforms(e.uniforms),"pickable"in e&&(this.pickable=e.pickable),"instanceCount"in e&&(this.instanceCount=e.instanceCount),"geometry"in e&&this.setGeometry(e.geometry),"attributes"in e&&this.setAttributes(e.attributes),"_feedbackBuffers"in e&&this._setFeedbackBuffers(e._feedbackBuffers)}_checkProgram(){if(!(this._programDirty||this.programManager.stateHash!==this._programManagerState))return;let{program:n}=this.programProps;if(n)this._managedProgram=!1;else{const{vs:i,fs:s,modules:c,inject:d,defines:l,varyings:y,bufferMode:w,transpileToGLSL100:S}=this.programProps;n=this.programManager.get({vs:i,fs:s,modules:c,inject:d,defines:l,varyings:y,bufferMode:w,transpileToGLSL100:S}),this.program&&this._managedProgram&&this.programManager.release(this.program),this._programManagerState=this.programManager.stateHash,this._managedProgram=!0}ft(n instanceof TP,"Model needs a program"),this._programDirty=!1,n!==this.program&&(this.program=n,this.vertexArray?this.vertexArray.setProps({program:this.program,attributes:this.vertexArray.attributes}):this.vertexArray=new Y4(this.gl,{program:this.program}),this.setUniforms(Object.assign({},this.getModuleUniforms())))}_deleteGeometryBuffers(){for(const e in this.geometryBuffers){const n=this.geometryBuffers[e][0]||this.geometryBuffers[e];n instanceof vn&&n.delete()}}_setAnimationProps(e){this.animated&&ft(e,"Model.draw(): animated uniforms but no animationProps")}_setFeedbackBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(Cu(e))return this;const{gl:n}=this.program;return this.transformFeedback=this.transformFeedback||new SP(n,{program:this.program}),this.transformFeedback.setBuffers(e),this}_logDrawCallStart(e){const n=e>3?0:mB;if(!(Date.now()-this.lastLogTime<n))return this.lastLogTime=Date.now(),Pt.group(Fc,">>> DRAWING MODEL ".concat(this.id),{collapsed:Pt.level<=2})(),e}_logDrawCallEnd(e,n,i,s){if(e===void 0)return;const c=Q4({vertexArray:n,header:"".concat(this.id," attributes"),attributes:this._attributes}),{table:d,unusedTable:l,unusedCount:y}=DE({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,i)}),{table:w,count:S}=DE({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,i),undefinedOnly:!0});S>0&&Pt.log("MISSING UNIFORMS",Object.keys(w))(),y>0&&Pt.log("UNUSED UNIFORMS",Object.keys(l))();const C=tF(this.vertexArray.configuration);Pt.table(e,c)(),Pt.table(e,d)(),Pt.table(e+1,C)(),s&&s.log({logLevel:Fc,message:"Rendered to ".concat(s.id)}),Pt.groupEnd(Fc)()}}class yB{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.currentIndex=0,this.feedbackMap={},this.varyings=null,this.bindings=[],this.resources={},this._initialize(n),Object.seal(this)}setupResources(e){for(const n of this.bindings)this._setupTransformFeedback(n,e)}updateModelProps(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{varyings:n}=this;return n.length>0&&(e=Object.assign({},e,{varyings:n})),e}getDrawOptions(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=this.bindings[this.currentIndex],{sourceBuffers:i,transformFeedback:s}=n;return{attributes:Object.assign({},i,e.attributes),transformFeedback:s}}swap(){return this.feedbackMap?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(e)}getBuffer(e){const{feedbackBuffers:n}=this.bindings[this.currentIndex],i=e?n[e]:null;return i?i instanceof vn?i:i.buffer:null}getData(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{varyingName:n}=e,i=this.getBuffer(n);return i?i.getData():null}delete(){for(const e in this.resources)this.resources[e].delete()}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(e),this.varyings=e.varyings||Object.keys(this.bindings[this.currentIndex].feedbackBuffers),this.varyings.length>0&&ft(Yt(this.gl))}_getFeedbackBuffers(e){const{sourceBuffers:n={}}=e,i={};if(this.bindings[this.currentIndex]&&Object.assign(i,this.bindings[this.currentIndex].feedbackBuffers),this.feedbackMap)for(const s in this.feedbackMap){const c=this.feedbackMap[s];s in n&&(i[c]=s)}Object.assign(i,e.feedbackBuffers);for(const s in i){const c=i[s];if(typeof c=="string"){const d=n[c],{byteLength:l,usage:y,accessor:w}=d;i[s]=this._createNewBuffer(s,{byteLength:l,usage:y,accessor:w})}}return i}_setupBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:n=null}=e;Object.assign(this.feedbackMap,e.feedbackMap);const i=this._getFeedbackBuffers(e);this._updateBindings({sourceBuffers:n,feedbackBuffers:i})}_setupTransformFeedback(e,n){let{model:i}=n;const{program:s}=i;e.transformFeedback=new SP(this.gl,{program:s,buffers:e.feedbackBuffers})}_updateBindings(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this.feedbackMap){const{sourceBuffers:n,feedbackBuffers:i}=this._swapBuffers(this.bindings[this.currentIndex]),s=this._getNextIndex();this.bindings[s]=this._updateBinding(this.bindings[s],{sourceBuffers:n,feedbackBuffers:i})}}_updateBinding(e,n){return e?(Object.assign(e.sourceBuffers,n.sourceBuffers),Object.assign(e.feedbackBuffers,n.feedbackBuffers),e.transformFeedback&&e.transformFeedback.setBuffers(e.feedbackBuffers),e):{sourceBuffers:Object.assign({},n.sourceBuffers),feedbackBuffers:Object.assign({},n.feedbackBuffers)}}_swapBuffers(e){if(!this.feedbackMap)return null;const n=Object.assign({},e.sourceBuffers),i=Object.assign({},e.feedbackBuffers);for(const s in this.feedbackMap){const c=this.feedbackMap[s];n[s]=e.feedbackBuffers[c],i[c]=e.sourceBuffers[s],ft(i[c]instanceof vn)}return{sourceBuffers:n,feedbackBuffers:i}}_createNewBuffer(e,n){const i=new vn(this.gl,n);return this.resources[e]&&this.resources[e].delete(),this.resources[e]=i,i}_getNextIndex(){return(this.currentIndex+1)%2}}const vB="transform_uSampler_",Ym="transform_uSize_",XE="transform_position";function xB(t){let{vs:e,sourceTextureMap:n,targetTextureVarying:i,targetTexture:s}=t,d=Object.keys(n).length,l=null;const y={};let w=e,S={};if(d>0||i){const C=w.split(`
`),P=C.slice();if(C.forEach((D,U,H)=>{if(d>0){const ae=SB(D,n);if(ae){const{updatedLine:G,inject:V}=ae;P[U]=G,S=X0([S,V]),Object.assign(y,ae.samplerTextureMap),d--}}i&&!l&&(l=TB(D,i))}),i){ft(s);const D="".concat(Ym).concat(i),U="uniform vec2 ".concat(D,`;
`),H="     vec2 ".concat(XE," = transform_getPos(").concat(D,`);
     gl_Position = vec4(`).concat(XE,`, 0, 1.);
`);S=X0([S,{"vs:#decl":U,"vs:#main-start":H}])}w=P.join(`
`)}return{vs:w,targetTextureType:l,inject:S,samplerTextureMap:y}}function bB(t){let{sourceTextureMap:e,targetTextureVarying:n,targetTexture:i}=t;const s={};let c,d;n&&({width:c,height:d}=i,s["".concat(Ym).concat(n)]=[c,d]);for(const l in e)({width:c,height:d}=e[l]),s["".concat(Ym).concat(l)]=[c,d];return s}function wB(t){return kP(t,["attribute","in"])}function EB(t){const e="".concat(vB).concat(t),n="".concat(Ym).concat(t),i="  uniform sampler2D ".concat(e,`;
  uniform vec2 `).concat(n,";");return{samplerName:e,sizeName:n,uniformDeclerations:i}}function TB(t,e){const n=kP(t,["varying","out"]);return n&&n.name===e?n.type:null}function SB(t,e){const n={},i=wB(t);if(!i)return null;const{type:s,name:c}=i;if(c&&e[c]){const d="// ".concat(t," => Replaced by Transform with a sampler"),{samplerName:l,sizeName:y,uniformDeclerations:w}=EB(c),S=WF(s),C="  ".concat(s," ").concat(c," = transform_getInput(").concat(l,", ").concat(y,").").concat(S,`;
`);return n[l]=c,{updatedLine:d,inject:{"vs:#decl":w,"vs:#main-start":C},samplerTextureMap:n}}return null}const AB={10241:9728,10240:9728,10242:33071,10243:33071},PB="transform_output";class IB{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.id=this.currentIndex=0,this._swapTexture=null,this.targetTextureVarying=null,this.targetTextureType=null,this.samplerTextureMap=null,this.bindings=[],this.resources={},this._initialize(n),Object.seal(this)}updateModelProps(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=this._processVertexShader(e);return Object.assign({},e,n)}getDrawOptions(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:n,sourceTextures:i,framebuffer:s,targetTexture:c}=this.bindings[this.currentIndex],d=Object.assign({},n,e.attributes),l=Object.assign({},e.uniforms),y=Object.assign({},e.parameters);let w=e.discard;if(this.hasSourceTextures||this.hasTargetTexture){d.transform_elementID=this.elementIDBuffer;for(const C in this.samplerTextureMap){const P=this.samplerTextureMap[C];l[C]=i[P]}this._setSourceTextureParameters();const S=bB({sourceTextureMap:i,targetTextureVarying:this.targetTextureVarying,targetTexture:c});Object.assign(l,S)}return this.hasTargetTexture&&(w=!1,y.viewport=[0,0,s.width,s.height]),{attributes:d,framebuffer:s,uniforms:l,discard:w,parameters:y}}swap(){return this._swapTexture?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupTextures(e)}getTargetTexture(){const{targetTexture:e}=this.bindings[this.currentIndex];return e}getData(){let{packed:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{framebuffer:n}=this.bindings[this.currentIndex],i=Sg(n);if(!e)return i;const s=i.constructor,c=HF(this.targetTextureType),d=new s(i.length*c/4);let l=0;for(let y=0;y<i.length;y+=4)for(let w=0;w<c;w++)d[l++]=i[y+w];return d}getFramebuffer(){return this.bindings[this.currentIndex].framebuffer}delete(){this.ownTexture&&this.ownTexture.delete(),this.elementIDBuffer&&this.elementIDBuffer.delete()}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{_targetTextureVarying:n,_swapTexture:i}=e;this._swapTexture=i,this.targetTextureVarying=n,this.hasTargetTexture=n,this._setupTextures(e)}_createTargetTexture(e){const{sourceTextures:n,textureOrReference:i}=e;if(i instanceof Ls)return i;const s=n[i];return s?(this._targetRefTexName=i,this._createNewTexture(s)):null}_setupTextures(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:n,_sourceTextures:i={},_targetTexture:s}=e,c=this._createTargetTexture({sourceTextures:i,textureOrReference:s});this.hasSourceTextures=this.hasSourceTextures||i&&Object.keys(i).length>0,this._updateBindings({sourceBuffers:n,sourceTextures:i,targetTexture:c}),"elementCount"in e&&this._updateElementIDBuffer(e.elementCount)}_updateElementIDBuffer(e){if(typeof e!="number"||this.elementCount>=e)return;const n=new Float32Array(e);n.forEach((i,s,c)=>{c[s]=s}),this.elementIDBuffer?this.elementIDBuffer.setData({data:n}):this.elementIDBuffer=new vn(this.gl,{data:n,accessor:{size:1}}),this.elementCount=e}_updateBindings(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this._swapTexture){const{sourceTextures:n,targetTexture:i}=this._swapTextures(this.bindings[this.currentIndex]),s=this._getNextIndex();this.bindings[s]=this._updateBinding(this.bindings[s],{sourceTextures:n,targetTexture:i})}}_updateBinding(e,n){const{sourceBuffers:i,sourceTextures:s,targetTexture:c}=n;if(e||(e={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(e.sourceTextures,s),Object.assign(e.sourceBuffers,i),c){e.targetTexture=c;const{width:d,height:l}=c,{framebuffer:y}=e;y?(y.update({attachments:{36064:c},resizeAttachments:!1}),y.resize({width:d,height:l})):e.framebuffer=new _i(this.gl,{id:"transform-framebuffer",width:d,height:l,attachments:{36064:c}})}return e}_setSourceTextureParameters(){const e=this.currentIndex,{sourceTextures:n}=this.bindings[e];for(const i in n)n[i].setParameters(AB)}_swapTextures(e){if(!this._swapTexture)return null;const n=Object.assign({},e.sourceTextures);n[this._swapTexture]=e.targetTexture;const i=e.sourceTextures[this._swapTexture];return{sourceTextures:n,targetTexture:i}}_createNewTexture(e){const n=BO(e,{parameters:{10241:9728,10240:9728,10242:33071,10243:33071},pixelStore:{37440:!1}});return this.ownTexture&&this.ownTexture.delete(),this.ownTexture=n,n}_getNextIndex(){return(this.currentIndex+1)%2}_processVertexShader(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceTextures:n,targetTexture:i}=this.bindings[this.currentIndex],{vs:s,uniforms:c,targetTextureType:d,inject:l,samplerTextureMap:y}=xB({vs:e.vs,sourceTextureMap:n,targetTextureVarying:this.targetTextureVarying,targetTexture:i}),w=X0([e.inject||{},l]);this.targetTextureType=d,this.samplerTextureMap=y;const S=e._fs||RP({version:wP(s),input:this.targetTextureVarying,inputType:d,output:PB}),C=this.hasSourceTextures||this.targetTextureVarying?[uB].concat(e.modules||[]):e.modules;return{vs:s,fs:S,modules:C,uniforms:c,inject:w}}}class Ag{static isSupported(e){return Yt(e)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.model=null,this.elementCount=0,this.bufferTransform=null,this.textureTransform=null,this.elementIDBuffer=null,this._initialize(n),Object.seal(this)}delete(){const{model:e,bufferTransform:n,textureTransform:i}=this;e&&e.delete(),n&&n.delete(),i&&i.delete()}run(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{clearRenderTarget:n=!0}=e,i=this._updateDrawOptions(e);n&&i.framebuffer&&i.framebuffer.clear({color:!0}),this.model.transform(i)}swap(){let e=!1;const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of n)e=e||i.swap();ft(e,"Nothing to swap")}getBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return this.bufferTransform&&this.bufferTransform.getBuffer(e)}getData(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of n){const s=i.getData(e);if(s)return s}return null}getFramebuffer(){return this.textureTransform&&this.textureTransform.getFramebuffer()}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};"elementCount"in e&&this.model.setVertexCount(e.elementCount);const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of n)i.update(e)}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{gl:n}=this;this._buildResourceTransforms(n,e),e=this._updateModelProps(e),this.model=new Du(n,Object.assign({},e,{fs:e.fs||RP({version:wP(e.vs)}),id:e.id||"transform-model",drawMode:e.drawMode||0,vertexCount:e.elementCount})),this.bufferTransform&&this.bufferTransform.setupResources({model:this.model})}_updateModelProps(e){let n=Object.assign({},e);const i=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const s of i)n=s.updateModelProps(n);return n}_buildResourceTransforms(e,n){CB(n)&&(this.bufferTransform=new yB(e,n)),MB(n)&&(this.textureTransform=new IB(e,n)),ft(this.bufferTransform||this.textureTransform,"must provide source/feedback buffers or source/target textures")}_updateDrawOptions(e){let n=Object.assign({},e);const i=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const s of i)n=Object.assign(n,s.getDrawOptions(n));return n}}function CB(t){return!!(!Cu(t.feedbackBuffers)||!Cu(t.feedbackMap)||t.varyings&&t.varyings.length>0)}function MB(t){return!!(!Cu(t._sourceTextures)||t._targetTexture||t._targetTextureVarying)}const YE={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class GP{static get DRAW_MODE(){return YE}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{id:n=Ka("geometry"),drawMode:i=YE.TRIANGLES,attributes:s={},indices:c=null,vertexCount:d=null}=e;this.id=n,this.drawMode=i|0,this.attributes={},this.userData={},this._setAttributes(s,c),this.vertexCount=d||this._calculateVertexCount(this.attributes,this.indices)}get mode(){return this.drawMode}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return"Geometry ".concat(this.id," attribute ").concat(e)}_setAttributes(e,n){n&&(this.indices=ArrayBuffer.isView(n)?{value:n,size:1}:n);for(const i in e){let s=e[i];s=ArrayBuffer.isView(s)?{value:s}:s,ft(ArrayBuffer.isView(s.value),"".concat(this._print(i),": must be typed array or object with value as typed array")),(i==="POSITION"||i==="positions")&&!s.size&&(s.size=3),i==="indices"?(ft(!this.indices),this.indices=s):this.attributes[i]=s}return this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this}_calculateVertexCount(e,n){if(n)return n.value.length;let i=1/0;for(const s in e){const c=e[s],{value:d,size:l,constant:y}=c;!y&&d&&l>=1&&(i=Math.min(i,d.length/l))}return ft(Number.isFinite(i)),i}}let LB=1,kB=1;class WP{constructor(){this.time=0,this.channels=new Map,this.animations=new Map,this.playing=!1,this.lastEngineTime=-1}addChannel(e){const{delay:n=0,duration:i=Number.POSITIVE_INFINITY,rate:s=1,repeat:c=1}=e,d=LB++,l={time:0,delay:n,duration:i,rate:s,repeat:c};return this._setChannelTime(l,this.time),this.channels.set(d,l),d}removeChannel(e){this.channels.delete(e);for(const[n,i]of this.animations)i.channel===e&&this.detachAnimation(n)}isFinished(e){const n=this.channels.get(e);return n===void 0?!1:this.time>=n.delay+n.duration*n.repeat}getTime(e){if(e===void 0)return this.time;const n=this.channels.get(e);return n===void 0?-1:n.time}setTime(e){this.time=Math.max(0,e);const n=this.channels.values();for(const s of n)this._setChannelTime(s,this.time);const i=this.animations.values();for(const s of i){const{animation:c,channel:d}=s;c.setTime(this.getTime(d))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,n){const i=kB++;return this.animations.set(i,{animation:e,channel:n}),e.setTime(this.getTime(n)),i}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,n){const i=n-e.delay,s=e.duration*e.repeat;i>=s?e.time=e.duration*e.rate:(e.time=Math.max(0,i)%e.duration,e.time*=e.rate)}}const RB=[255,255,255],DB=1;let zB=0;class OB{constructor(e={}){$(this,"id",void 0),$(this,"color",void 0),$(this,"intensity",void 0),$(this,"type","ambient");const{color:n=RB}=e,{intensity:i=DB}=e;this.id=e.id||"ambient-".concat(zB++),this.color=n,this.intensity=i}}const FB=[255,255,255],NB=1,BB=[0,0,-1];let UB=0;class KE{constructor(e={}){$(this,"id",void 0),$(this,"color",void 0),$(this,"intensity",void 0),$(this,"type","directional"),$(this,"direction",void 0),$(this,"shadow",void 0);const{color:n=FB}=e,{intensity:i=NB}=e,{direction:s=BB}=e,{_shadow:c=!1}=e;this.id=e.id||"directional-".concat(UB++),this.color=n,this.intensity=i,this.type="directional",this.direction=new wo(s).normalize().toArray(),this.shadow=c}getProjectedLight(e){return this}}class VB{constructor(e,n={id:"pass"}){$(this,"id",void 0),$(this,"gl",void 0),$(this,"props",void 0);const{id:i}=n;this.id=i,this.gl=e,this.props={...n}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class Rx extends VB{constructor(...e){super(...e),$(this,"_lastRenderIndex",-1)}render(e){const n=this.gl;return Qo(n,{framebuffer:e.target}),this._drawLayers(e)}_drawLayers(e){const{target:n,moduleParameters:i,viewports:s,views:c,onViewportActive:d,clearStack:l=!0,clearCanvas:y=!0}=e;e.pass=e.pass||"unknown";const w=this.gl;y&&GB(w,n),l&&(this._lastRenderIndex=-1);const S=[];for(const C of s){const P=c&&c[C.id];d==null||d(C);const D=this._getDrawLayerParams(C,e),U=C.subViewports||[C];for(const H of U){const ae=this._drawLayersInViewport(w,{target:n,moduleParameters:i,viewport:H,view:P,pass:e.pass,layers:e.layers},D);S.push(ae)}}return S}_getDrawLayerParams(e,{layers:n,pass:i,isPicking:s=!1,layerFilter:c,cullRect:d,effects:l,moduleParameters:y},w=!1){const S=[],C=HP(this._lastRenderIndex+1),P={layer:n[0],viewport:e,isPicking:s,renderPass:i,cullRect:d},D={};for(let U=0;U<n.length;U++){const H=n[U],ae=this._shouldDrawLayer(H,P,c,D),G={shouldDrawLayer:ae};ae&&!w&&(G.layerRenderIndex=C(H,ae),G.moduleParameters=this._getModuleParameters(H,l,i,y),G.layerParameters=this.getLayerParameters(H,U,e)),S[U]=G}return S}_drawLayersInViewport(e,{layers:n,moduleParameters:i,pass:s,target:c,viewport:d,view:l},y){const w=jB(e,{moduleParameters:i,target:c,viewport:d});if(l&&l.props.clear){const C=l.props.clear===!0?{color:!0,depth:!0}:l.props.clear;Nr(e,{scissorTest:!0,scissor:w},()=>Ix(e,C))}const S={totalCount:n.length,visibleCount:0,compositeCount:0,pickableCount:0};Qo(e,{viewport:w});for(let C=0;C<n.length;C++){const P=n[C],{shouldDrawLayer:D,layerRenderIndex:U,moduleParameters:H,layerParameters:ae}=y[C];if(D&&P.props.pickable&&S.pickableCount++,P.isComposite)S.compositeCount++;else if(D){S.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,U),H.viewport=d;try{P._drawLayer({moduleParameters:H,uniforms:{layerIndex:U},parameters:ae})}catch(G){P.raiseError(G,"drawing ".concat(P," to ").concat(s))}}}return S}shouldDrawLayer(e){return!0}getModuleParameters(e,n){return null}getLayerParameters(e,n,i){return e.props.parameters}_shouldDrawLayer(e,n,i,s){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;n.layer=e;let d=e.parent;for(;d;){if(!d.props.visible||!d.filterSubLayer(n))return!1;n.layer=d,d=d.parent}if(i){const l=n.layer.id;if(l in s||(s[l]=i(n)),!s[l])return!1}return e.activateViewport(n.viewport),!0}_getModuleParameters(e,n,i,s){var c;const d=Object.assign(Object.create(((c=e.internalState)===null||c===void 0?void 0:c.propsInTransition)||e.props),{autoWrapLongitude:e.wrapLongitude,viewport:e.context.viewport,mousePosition:e.context.mousePosition,pickingActive:0,devicePixelRatio:Zl(this.gl)});if(n)for(const y of n){var l;Object.assign(d,(l=y.getModuleParameters)===null||l===void 0?void 0:l.call(y,e))}return Object.assign(d,this.getModuleParameters(e,n),s)}}function HP(t=0,e={}){const n={},i=(s,c)=>{const d=s.props._offset,l=s.id,y=s.parent&&s.parent.id;let w;if(y&&!(y in e)&&i(s.parent,!1),y in n){const S=n[y]=n[y]||HP(e[y],e);w=S(s,c),n[l]=S}else Number.isFinite(d)?(w=d+(e[y]||0),n[l]=null):w=t;return c&&w>=t&&(t=w+1),e[l]=w,w};return i}function jB(t,{moduleParameters:e,target:n,viewport:i}){const s=n&&n.id!=="default-framebuffer",c=e&&e.devicePixelRatio||Zl(t),d=s?n.height:t.drawingBufferHeight,l=i;return[l.x*c,d-(l.y+l.height)*c,l.width*c,l.height*c]}function GB(t,e){const n=e?e.width:t.drawingBufferWidth,i=e?e.height:t.drawingBufferHeight;Qo(t,{viewport:[0,0,n,i]}),t.clear(16640)}class WB extends Rx{constructor(e,n){super(e,n),$(this,"shadowMap",void 0),$(this,"depthBuffer",void 0),$(this,"fbo",void 0),this.shadowMap=new Ls(e,{width:1,height:1,parameters:{10241:9729,10240:9729,10242:33071,10243:33071}}),this.depthBuffer=new cu(e,{format:33189,width:1,height:1}),this.fbo=new _i(e,{id:"shadowmap",width:1,height:1,attachments:{36064:this.shadowMap,36096:this.depthBuffer}})}render(e){const n=this.fbo;Nr(this.gl,{depthRange:[0,1],depthTest:!0,blend:!1,clearColor:[1,1,1,1]},()=>{const i=e.viewports[0],s=Zl(this.gl),c=i.width*s,d=i.height*s;(c!==n.width||d!==n.height)&&n.resize({width:c,height:d}),super.render({...e,target:n,pass:"shadow"})})}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getModuleParameters(){return{drawToShadowMap:!0}}delete(){this.fbo&&(this.fbo.delete(),this.fbo=null),this.shadowMap&&(this.shadowMap.delete(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.delete(),this.depthBuffer=null)}}const $P="#define SMOOTH_EDGE_RADIUS 0.5",HB=`
`.concat($P,`

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`),$B=`
`.concat($P,`

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`),qB={name:"geometry",vs:HB,fs:$B},ZB=Object.keys(Jt).map(t=>"const int COORDINATE_SYSTEM_".concat(t," = ").concat(Jt[t],";")).join(""),XB=Object.keys(yo).map(t=>"const int PROJECTION_MODE_".concat(t," = ").concat(yo[t],";")).join(""),YB=Object.keys(W0).map(t=>"const int UNIT_".concat(t.toUpperCase()," = ").concat(W0[t],";")).join(""),KB="".concat(ZB,`
`).concat(XB,`
`).concat(YB,`

uniform int project_uCoordinateSystem;
uniform int project_uProjectionMode;
uniform float project_uScale;
uniform bool project_uWrapLongitude;
uniform vec3 project_uCommonUnitsPerMeter;
uniform vec3 project_uCommonUnitsPerWorldUnit;
uniform vec3 project_uCommonUnitsPerWorldUnit2;
uniform vec4 project_uCenter;
uniform mat4 project_uModelMatrix;
uniform mat4 project_uViewProjectionMatrix;
uniform vec2 project_uViewportSize;
uniform float project_uDevicePixelRatio;
uniform float project_uFocalDistance;
uniform vec3 project_uCameraPosition;
uniform vec3 project_uCoordinateOrigin;
uniform vec3 project_uCommonOrigin;
uniform bool project_uPseudoMeters;

const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
  float y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

float project_size() {
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&
    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
    project_uPseudoMeters == false) {
    
    if (geometry.position.w == 0.0) {
      return project_size_at_latitude(geometry.worldPosition.y);
    }
  
    float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    float y2 = y * y;
    float y4 = y2 * y2;
    float y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

float project_size_at_latitude(float meters, float lat) {
  return meters * project_uCommonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
  return meters * project_uCommonUnitsPerMeter.z * project_size();
}

vec2 project_size(vec2 meters) {
  return meters * project_uCommonUnitsPerMeter.xy * project_size();
}

vec3 project_size(vec3 meters) {
  return meters * project_uCommonUnitsPerMeter * project_size();
}

vec4 project_size(vec4 meters) {
  return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
  vec3 uz = normalize(up);
  vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
  vec3 uy = cross(uz, ux);
  return mat3(ux, uy, uz);
}

bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    transform = project_get_orientation_matrix(commonPosition);
    return true;
  }
  return false;
}
vec3 project_normal(vec3 vector) {
  vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);
  vec3 n = normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);
  mat3 rotation;
  if (project_needs_rotation(geometry.position.xyz, rotation)) {
    n = rotation * n;
  }
  return n;
}

vec4 project_offset_(vec4 offset) {
  float dy = offset.y;
  vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;
  return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
  float x = lnglat.x;
  if (project_uWrapLongitude) {
    x = mod(x + 180., 360.0) - 180.;
  }
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

vec3 project_globe_(vec3 lnglatz) {
  float lambda = radians(lnglatz.x);
  float phi = radians(lnglatz.y);
  float cosPhi = cos(phi);
  float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;

  return vec3(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
  vec4 position_world = project_uModelMatrix * position;
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_mercator_(position_world.xy),
        project_size_at_latitude(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world.xyz += project_uCoordinateOrigin;
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {
        return vec4(
          project_mercator_(position_world.xy) - project_uCommonOrigin.xy,
          project_size(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||
    (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
    (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
     project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world.xyz -= project_uCoordinateOrigin;
  }
  return project_offset_(position_world + project_uModelMatrix * vec4(position64Low, 0.0));
}

vec4 project_position(vec4 position) {
  return project_position(position, ZERO_64_LOW);
}

vec3 project_position(vec3 position, vec3 position64Low) {
  vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
  return projected_position.xyz;
}

vec3 project_position(vec3 position) {
  vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

vec2 project_position(vec2 position) {
  vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;
  return offset * project_uFocalDistance;
}

float project_size_to_pixel(float meters) {
  return project_size(meters) * project_uScale;
}
float project_size_to_pixel(float size, int unit) {
  if (unit == UNIT_METERS) return project_size_to_pixel(size);
  if (unit == UNIT_COMMON) return size * project_uScale;
  return size;
}
float project_pixel_size(float pixels) {
  return pixels / project_uScale;
}
vec2 project_pixel_size(vec2 pixels) {
  return pixels / project_uScale;
}
`);function JB(t,e){if(t===e)return!0;if(Array.isArray(t)){const n=t.length;if(!e||e.length!==n)return!1;for(let i=0;i<n;i++)if(t[i]!==e[i])return!1;return!0}return!1}function of(t){let e={},n;return i=>{for(const s in i)if(!JB(i[s],e[s])){n=t(i),e=i;break}return n}}const JE=[0,0,0,0],QB=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],qP=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e5=[0,0,0],ZP=[0,0,0],t5=of(r5);function XP(t,e,n=ZP){n.length<3&&(n=[n[0],n[1],0]);let i=n,s,c=!0;switch(e===Jt.LNGLAT_OFFSETS||e===Jt.METER_OFFSETS?s=n:s=t.isGeospatial?[Math.fround(t.longitude),Math.fround(t.latitude),0]:null,t.projectionMode){case yo.WEB_MERCATOR:(e===Jt.LNGLAT||e===Jt.CARTESIAN)&&(s=[0,0,0],c=!1);break;case yo.WEB_MERCATOR_AUTO_OFFSET:e===Jt.LNGLAT?i=s:e===Jt.CARTESIAN&&(i=[Math.fround(t.center[0]),Math.fround(t.center[1]),0],s=t.unprojectPosition(i),i[0]-=n[0],i[1]-=n[1],i[2]-=n[2]);break;case yo.IDENTITY:i=t.position.map(Math.fround),i[2]=i[2]||0;break;case yo.GLOBE:c=!1,s=null;break;default:c=!1}return{geospatialOrigin:s,shaderCoordinateOrigin:i,offsetMode:c}}function n5(t,e,n){const{viewMatrixUncentered:i,projectionMatrix:s}=t;let{viewMatrix:c,viewProjectionMatrix:d}=t,l=JE,y=JE,w=t.cameraPosition;const{geospatialOrigin:S,shaderCoordinateOrigin:C,offsetMode:P}=XP(t,e,n);return P&&(y=t.projectPosition(S||C),w=[w[0]-y[0],w[1]-y[1],w[2]-y[2]],y[3]=1,l=rf([],y,d),c=i||c,d=jl([],s,c),d=jl([],d,QB)),{viewMatrix:c,viewProjectionMatrix:d,projectionCenter:l,originCommon:y,cameraPosCommon:w,shaderCoordinateOrigin:C,geospatialOrigin:S}}function i5({viewport:t,devicePixelRatio:e=1,modelMatrix:n=null,coordinateSystem:i=Jt.DEFAULT,coordinateOrigin:s=ZP,autoWrapLongitude:c=!1}){i===Jt.DEFAULT&&(i=t.isGeospatial?Jt.LNGLAT:Jt.CARTESIAN);const d=t5({viewport:t,devicePixelRatio:e,coordinateSystem:i,coordinateOrigin:s});return d.project_uWrapLongitude=c,d.project_uModelMatrix=n||qP,d}function r5({viewport:t,devicePixelRatio:e,coordinateSystem:n,coordinateOrigin:i}){const{projectionCenter:s,viewProjectionMatrix:c,originCommon:d,cameraPosCommon:l,shaderCoordinateOrigin:y,geospatialOrigin:w}=n5(t,n,i),S=t.getDistanceScales(),C=[t.width*e,t.height*e],P=rf([],[0,0,-t.focalDistance,1],t.projectionMatrix)[3]||1,D={project_uCoordinateSystem:n,project_uProjectionMode:t.projectionMode,project_uCoordinateOrigin:y,project_uCommonOrigin:d.slice(0,3),project_uCenter:s,project_uPseudoMeters:!!t._pseudoMeters,project_uViewportSize:C,project_uDevicePixelRatio:e,project_uFocalDistance:P,project_uCommonUnitsPerMeter:S.unitsPerMeter,project_uCommonUnitsPerWorldUnit:S.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:e5,project_uScale:t.scale,project_uWrapLongitude:!1,project_uViewProjectionMatrix:c,project_uModelMatrix:qP,project_uCameraPosition:l};if(w){const U=t.getDistanceScales(w);switch(n){case Jt.METER_OFFSETS:D.project_uCommonUnitsPerWorldUnit=U.unitsPerMeter,D.project_uCommonUnitsPerWorldUnit2=U.unitsPerMeter2;break;case Jt.LNGLAT:case Jt.LNGLAT_OFFSETS:t._pseudoMeters||(D.project_uCommonUnitsPerMeter=U.unitsPerMeter),D.project_uCommonUnitsPerWorldUnit=U.unitsPerDegree,D.project_uCommonUnitsPerWorldUnit2=U.unitsPerDegree2;break;case Jt.CARTESIAN:D.project_uCommonUnitsPerWorldUnit=[1,1,U.unitsPerMeter[2]],D.project_uCommonUnitsPerWorldUnit2=[0,0,U.unitsPerMeter2[2]];break}}return D}const s5={};function o5(t=s5){return"viewport"in t?i5(t):{}}const Dx={name:"project",dependencies:[ZF,qB],vs:KB,getUniforms:o5};function a5(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function yu(t,e){const n=rf([],e,t);return jN(n,n,1/n[3]),n}function QE(t,e){const n=t%e;return n<0?e+n:n}function l5(t,e,n){return n*e+(1-n)*t}function tv(t,e,n){return t<e?e:t>n?n:t}function c5(t){return Math.log(t)*Math.LOG2E}const zx=Math.log2||c5;function ea(t,e){if(!t)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const Hs=Math.PI,YP=Hs/4,Is=Hs/180,nv=180/Hs,zu=512,Km=4003e4,Np=85.051129,u5=1.5;function eT(t){return Math.pow(2,t)}function KP(t){return zx(t)}function Ou(t){const[e,n]=t;ea(Number.isFinite(e)),ea(Number.isFinite(n)&&n>=-90&&n<=90,"invalid latitude");const i=e*Is,s=n*Is,c=zu*(i+Hs)/(2*Hs),d=zu*(Hs+Math.log(Math.tan(YP+s*.5)))/(2*Hs);return[c,d]}function Xl(t){const[e,n]=t,i=e/zu*(2*Hs)-Hs,s=2*(Math.atan(Math.exp(n/zu*(2*Hs)-Hs))-YP);return[i*nv,s*nv]}function h5(t){const{latitude:e}=t;ea(Number.isFinite(e));const n=Math.cos(e*Is);return KP(Km*n)-9}function My(t){const e=Math.cos(t*Is);return zu/Km/e}function iv(t){const{latitude:e,longitude:n,highPrecision:i=!1}=t;ea(Number.isFinite(e)&&Number.isFinite(n));const s=zu,c=Math.cos(e*Is),d=s/360,l=d/c,y=s/Km/c,w={unitsPerMeter:[y,y,y],metersPerUnit:[1/y,1/y,1/y],unitsPerDegree:[d,l,y],degreesPerUnit:[1/d,1/l,1/y]};if(i){const S=Is*Math.tan(e*Is)/c,C=d*S/2,P=s/Km*S,D=P/l*y;w.unitsPerDegree2=[0,C,P],w.unitsPerMeter2=[D,0,D]}return w}function JP(t,e){const[n,i,s]=t,[c,d,l]=e,{unitsPerMeter:y,unitsPerMeter2:w}=iv({longitude:n,latitude:i,highPrecision:!0}),S=Ou(t);S[0]+=c*(y[0]+w[0]*d),S[1]+=d*(y[1]+w[1]*d);const C=Xl(S),P=(s||0)+(l||0);return Number.isFinite(s)||Number.isFinite(l)?[C[0],C[1],P]:C}function d5(t){const{height:e,pitch:n,bearing:i,altitude:s,scale:c,center:d}=t,l=a5();Xm(l,l,[0,0,-s]),UP(l,l,-n*Is),VP(l,l,i*Is);const y=c/e;return kx(l,l,[y,y,y]),d&&Xm(l,l,yN([],d)),l}function f5(t){const{width:e,height:n,altitude:i,pitch:s=0,offset:c,center:d,scale:l,nearZMultiplier:y=1,farZMultiplier:w=1}=t;let{fovy:S=Jm(u5)}=t;i!==void 0&&(S=Jm(i));const C=S*Is,P=s*Is,D=QP(S);let U=D;d&&(U+=d[2]*l/Math.cos(P)/n);const H=C*(.5+(c?c[1]:0)/n),ae=Math.sin(H)*U/Math.sin(tv(Math.PI/2-P-H,.01,Math.PI-.01)),G=Math.sin(P)*ae+U,V=U*10,W=Math.min(G*w,V);return{fov:C,aspect:e/n,focalDistance:D,near:y,far:W}}function Jm(t){return 2*Math.atan(.5/t)*nv}function QP(t){return .5/Math.tan(.5*t*Is)}function eI(t,e){const[n,i,s=0]=t;return ea(Number.isFinite(n)&&Number.isFinite(i)&&Number.isFinite(s)),yu(e,[n,i,s,1])}function Ox(t,e,n=0){const[i,s,c]=t;if(ea(Number.isFinite(i)&&Number.isFinite(s),"invalid pixel coordinate"),Number.isFinite(c))return yu(e,[i,s,c,1]);const d=yu(e,[i,s,0,1]),l=yu(e,[i,s,1,1]),y=d[2],w=l[2],S=y===w?0:((n||0)-y)/(w-y);return FP([],d,l,S)}function p5(t){const{width:e,height:n,bounds:i,minExtent:s=0,maxZoom:c=24,offset:d=[0,0]}=t,[[l,y],[w,S]]=i,C=m5(t.padding),P=Ou([l,tv(S,-Np,Np)]),D=Ou([w,tv(y,-Np,Np)]),U=[Math.max(Math.abs(D[0]-P[0]),s),Math.max(Math.abs(D[1]-P[1]),s)],H=[e-C.left-C.right-Math.abs(d[0])*2,n-C.top-C.bottom-Math.abs(d[1])*2];ea(H[0]>0&&H[1]>0);const ae=H[0]/U[0],G=H[1]/U[1],V=(C.right-C.left)/2/ae,W=(C.top-C.bottom)/2/G,ie=[(D[0]+P[0])/2+V,(D[1]+P[1])/2+W],ge=Xl(ie),be=Math.min(c,zx(Math.abs(Math.min(ae,G))));return ea(Number.isFinite(be)),{longitude:ge[0],latitude:ge[1],zoom:be}}function m5(t=0){return typeof t=="number"?{top:t,bottom:t,left:t,right:t}:(ea(Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.left)&&Number.isFinite(t.right)),t)}const tT=Math.PI/180;function g5(t,e=0){const{width:n,height:i,unproject:s}=t,c={targetZ:e},d=s([0,i],c),l=s([n,i],c);let y,w;const S=t.fovy?.5*t.fovy*tT:Math.atan(.5/t.altitude),C=(90-t.pitch)*tT;return S>C-.01?(y=nT(t,0,e),w=nT(t,n,e)):(y=s([0,0],c),w=s([n,0],c)),[d,l,w,y]}function nT(t,e,n){const{pixelUnprojectionMatrix:i}=t,s=yu(i,[e,0,1,1]),c=yu(i,[e,t.height,1,1]),l=(n*t.distanceScales.unitsPerMeter[2]-s[2])/(c[2]-s[2]),y=FP([],s,c,l),w=Xl(y);return w.push(n),w}const iT=512;function _5(t){const{width:e,height:n,pitch:i=0}=t;let{longitude:s,latitude:c,zoom:d,bearing:l=0}=t;(s<-180||s>180)&&(s=QE(s+180,360)-180),(l<-180||l>180)&&(l=QE(l+180,360)-180);const y=zx(n/iT);if(d<=y)d=y,c=0;else{const w=n/2/Math.pow(2,d),S=Xl([0,w])[1];if(c<S)c=S;else{const C=Xl([0,iT-w])[1];c>C&&(c=C)}}return{width:e,height:n,longitude:s,latitude:c,zoom:d,pitch:i,bearing:l}}const tI=.01,y5=["longitude","latitude","zoom"],nI={curve:1.414,speed:1.2};function v5(t,e,n,i){const{startZoom:s,startCenterXY:c,uDelta:d,w0:l,u1:y,S:w,rho:S,rho2:C,r0:P}=iI(t,e,i);if(y<tI){const ie={};for(const ge of y5){const be=t[ge],De=e[ge];ie[ge]=l5(be,De,n)}return ie}const D=n*w,U=Math.cosh(P)/Math.cosh(P+S*D),H=l*((Math.cosh(P)*Math.tanh(P+S*D)-Math.sinh(P))/C)/y,ae=1/U,G=s+KP(ae),V=cN([],d,H);J0(V,V,c);const W=Xl(V);return{longitude:W[0],latitude:W[1],zoom:G}}function x5(t,e,n){const i={...nI,...n},{screenSpeed:s,speed:c,maxDuration:d}=i,{S:l,rho:y}=iI(t,e,i),w=1e3*l;let S;return Number.isFinite(s)?S=w/(s/y):S=w/c,Number.isFinite(d)&&S>d?0:S}function iI(t,e,n){n=Object.assign({},nI,n);const i=n.curve,s=t.zoom,c=[t.longitude,t.latitude],d=eT(s),l=e.zoom,y=[e.longitude,e.latitude],w=eT(l-s),S=Ou(c),C=Ou(y),P=fN([],C,S),D=Math.max(t.width,t.height),U=D/w,H=uN(P)*d,ae=Math.max(H,tI),G=i*i,V=(U*U-D*D+G*G*ae*ae)/(2*D*G*ae),W=(U*U-D*D-G*G*ae*ae)/(2*U*G*ae),ie=Math.log(Math.sqrt(V*V+1)-V),ge=Math.log(Math.sqrt(W*W+1)-W),be=(ge-ie)/i;return{startZoom:s,startCenterXY:S,uDelta:P,w0:D,u1:H,S:be,rho:i,rho2:G,r0:ie,r1:ge}}const b5=`
const int max_lights = 2;
uniform mat4 shadow_uViewProjectionMatrices[max_lights];
uniform vec4 shadow_uProjectCenters[max_lights];
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform int shadow_uLightId;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  if (shadow_uDrawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);
  }
  if (shadow_uUseShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow_uLightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,w5=`
const int max_lights = 2;
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;
uniform vec4 shadow_uColor;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture2D(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow_uDrawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow_uUseShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow_uLightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,E5=of(I5),T5=of(C5),S5=[0,0,0,1],A5=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function P5(t,e){const[n,i,s]=t,c=Ox([n,i,s],e);return Number.isFinite(s)?c:[c[0],c[1],0]}function I5({viewport:t,center:e}){return new Eo(t.viewProjectionMatrix).invert().transform(e)}function C5({viewport:t,shadowMatrices:e}){const n=[],i=t.pixelUnprojectionMatrix,s=t.isGeospatial?void 0:1,c=[[0,0,s],[t.width,0,s],[0,t.height,s],[t.width,t.height,s],[0,0,-1],[t.width,0,-1],[0,t.height,-1],[t.width,t.height,-1]].map(d=>P5(d,i));for(const d of e){const l=d.clone().translate(new wo(t.center).negate()),y=c.map(S=>l.transform(S)),w=new Eo().ortho({left:Math.min(...y.map(S=>S[0])),right:Math.max(...y.map(S=>S[0])),bottom:Math.min(...y.map(S=>S[1])),top:Math.max(...y.map(S=>S[1])),near:Math.min(...y.map(S=>-S[2])),far:Math.max(...y.map(S=>-S[2]))});n.push(w.multiplyRight(d))}return n}function M5(t,e){const{shadowEnabled:n=!0}=t;if(!n||!t.shadowMatrices||!t.shadowMatrices.length)return{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1};const i={shadow_uDrawShadowMap:!!t.drawToShadowMap,shadow_uUseShadowMap:t.shadowMaps?t.shadowMaps.length>0:!1,shadow_uColor:t.shadowColor||S5,shadow_uLightId:t.shadowLightId||0,shadow_uLightCount:t.shadowMatrices.length},s=E5({viewport:t.viewport,center:e.project_uCenter}),c=[],d=T5({shadowMatrices:t.shadowMatrices,viewport:t.viewport}).slice();for(let l=0;l<t.shadowMatrices.length;l++){const y=d[l],w=y.clone().translate(new wo(t.viewport.center).negate());e.project_uCoordinateSystem===Jt.LNGLAT&&e.project_uProjectionMode===yo.WEB_MERCATOR?(d[l]=w,c[l]=s):(d[l]=y.clone().multiplyRight(A5),c[l]=w.transform(s))}for(let l=0;l<d.length;l++)i["shadow_uViewProjectionMatrices[".concat(l,"]")]=d[l],i["shadow_uProjectCenters[".concat(l,"]")]=c[l],t.shadowMaps&&t.shadowMaps.length>0?i["shadow_uShadowMap".concat(l)]=t.shadowMaps[l]:i["shadow_uShadowMap".concat(l)]=t.dummyShadowMap;return i}const Ly={name:"shadow",dependencies:[Dx],vs:b5,fs:w5,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:(t={},e={})=>"viewport"in t&&(t.drawToShadowMap||t.shadowMaps&&t.shadowMaps.length>0)?M5(t,e):{}},L5={color:[255,255,255],intensity:1},rT=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],k5=[0,0,0,200/255];class rI{constructor(e={}){$(this,"id","lighting-effect"),$(this,"props",void 0),$(this,"shadowColor",k5),$(this,"shadow",void 0),$(this,"ambientLight",void 0),$(this,"directionalLights",void 0),$(this,"pointLights",void 0),$(this,"shadowPasses",[]),$(this,"shadowMaps",[]),$(this,"dummyShadowMap",null),$(this,"programManager",void 0),$(this,"shadowMatrices",void 0),this.setProps(e)}setProps(e){this.ambientLight=null,this.directionalLights=[],this.pointLights=[];for(const n in e){const i=e[n];switch(i.type){case"ambient":this.ambientLight=i;break;case"directional":this.directionalLights.push(i);break;case"point":this.pointLights.push(i);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(n=>n.shadow),this.props=e}preRender(e,{layers:n,layerFilter:i,viewports:s,onViewportActive:c,views:d}){if(this.shadow){this.shadowMatrices=this._calculateMatrices(),this.shadowPasses.length===0&&this._createShadowPasses(e),this.programManager||(this.programManager=sf.getDefaultProgramManager(e),Ly&&this.programManager.addDefaultModule(Ly)),this.dummyShadowMap||(this.dummyShadowMap=new Ls(e,{width:1,height:1}));for(let l=0;l<this.shadowPasses.length;l++)this.shadowPasses[l].render({layers:n,layerFilter:i,viewports:s,onViewportActive:c,views:d,moduleParameters:{shadowLightId:l,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}getModuleParameters(e){const n=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return n.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(i=>i.getProjectedLight({layer:e})),pointLights:this.pointLights.map(i=>i.getProjectedLight({layer:e}))},n}cleanup(){for(const e of this.shadowPasses)e.delete();this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.delete(),this.dummyShadowMap=null),this.shadow&&this.programManager&&(this.programManager.removeDefaultModule(Ly),this.programManager=null)}_calculateMatrices(){const e=[];for(const n of this.directionalLights){const i=new Eo().lookAt({eye:new wo(n.direction).negate()});e.push(i)}return e}_createShadowPasses(e){for(let n=0;n<this.directionalLights.length;n++){const i=new WB(e);this.shadowPasses[n]=i,this.shadowMaps[n]=i.shadowMap}}_applyDefaultLights(){const{ambientLight:e,pointLights:n,directionalLights:i}=this;!e&&n.length===0&&i.length===0&&(this.ambientLight=new OB(L5),this.directionalLights.push(new KE(rT[0]),new KE(rT[1])))}}class R5{constructor(e={}){$(this,"_pool",[]),$(this,"opts",{overAlloc:2,poolSize:100}),this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,n,{size:i=1,type:s,padding:c=0,copy:d=!1,initialize:l=!1,maxCount:y}){const w=s||e&&e.constructor||Float32Array,S=n*i+c;if(ArrayBuffer.isView(e)){if(S<=e.length)return e;if(S*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new w(e.buffer,0,S)}let C=1/0;y&&(C=y*i+c);const P=this._allocate(w,S,l,C);return e&&d?P.set(e):l||P.fill(0,0,4),this._release(e),P}release(e){this._release(e)}_allocate(e,n,i,s){let c=Math.max(Math.ceil(n*this.opts.overAlloc),1);c>s&&(c=s);const d=this._pool,l=e.BYTES_PER_ELEMENT*c,y=d.findIndex(w=>w.byteLength>=l);if(y>=0){const w=new e(d.splice(y,1)[0],0,c);return i&&w.fill(0),w}return new e(c)}_release(e){if(!ArrayBuffer.isView(e))return;const n=this._pool,{buffer:i}=e,{byteLength:s}=i,c=n.findIndex(d=>d.byteLength>=s);c<0?n.push(i):(c>0||n.length<this.opts.poolSize)&&n.splice(c,0,i),n.length>this.opts.poolSize&&n.shift()}}const Fu=new R5;function sd(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function D5(t){return[t[12],t[13],t[14]]}function z5(t){return{left:Nc(t[3]+t[0],t[7]+t[4],t[11]+t[8],t[15]+t[12]),right:Nc(t[3]-t[0],t[7]-t[4],t[11]-t[8],t[15]-t[12]),bottom:Nc(t[3]+t[1],t[7]+t[5],t[11]+t[9],t[15]+t[13]),top:Nc(t[3]-t[1],t[7]-t[5],t[11]-t[9],t[15]-t[13]),near:Nc(t[3]+t[2],t[7]+t[6],t[11]+t[10],t[15]+t[14]),far:Nc(t[3]-t[2],t[7]-t[6],t[11]-t[10],t[15]-t[14])}}const sT=new wo;function Nc(t,e,n,i){sT.set(t,e,n);const s=sT.len();return{distance:i/s,normal:new wo(-t/s,-e/s,-n/s)}}function O5(t){return t-Math.fround(t)}let Yh;function ky(t,e){const{size:n=1,startIndex:i=0}=e,s=e.endIndex!==void 0?e.endIndex:t.length,c=(s-i)/n;Yh=Fu.allocate(Yh,c,{type:Float32Array,size:n*2});let d=i,l=0;for(;d<s;){for(let y=0;y<n;y++){const w=t[d++];Yh[l+y]=w,Yh[l+y+n]=O5(w)}l+=n*2}return Yh.subarray(0,c*n*2)}function F5(t){let e=null,n=!1;for(const i of t)i&&(e?(n||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],n=!0),e[0][0]=Math.min(e[0][0],i[0][0]),e[0][1]=Math.min(e[0][1],i[0][1]),e[1][0]=Math.max(e[1][0],i[1][0]),e[1][1]=Math.max(e[1][1],i[1][1])):e=i);return e}const N5=Math.PI/180,B5=sd(),oT=[0,0,0],U5={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function V5({width:t,height:e,orthographic:n,fovyRadians:i,focalDistance:s,padding:c,near:d,far:l}){const y=t/e,w=n?new Eo().orthographic({fovy:i,aspect:y,focalDistance:s,near:d,far:l}):new Eo().perspective({fovy:i,aspect:y,near:d,far:l});if(c){const{left:S=0,right:C=0,top:P=0,bottom:D=0}=c,U=Oa((S+t-C)/2,0,t)-t/2,H=Oa((P+e-D)/2,0,e)-e/2;w[8]-=U*2/t,w[9]+=H*2/e}return w}class Gu{constructor(e={}){$(this,"id",void 0),$(this,"x",void 0),$(this,"y",void 0),$(this,"width",void 0),$(this,"height",void 0),$(this,"padding",void 0),$(this,"isGeospatial",void 0),$(this,"zoom",void 0),$(this,"focalDistance",void 0),$(this,"position",void 0),$(this,"modelMatrix",void 0),$(this,"distanceScales",void 0),$(this,"scale",void 0),$(this,"center",void 0),$(this,"cameraPosition",void 0),$(this,"projectionMatrix",void 0),$(this,"viewMatrix",void 0),$(this,"viewMatrixUncentered",void 0),$(this,"viewMatrixInverse",void 0),$(this,"viewProjectionMatrix",void 0),$(this,"pixelProjectionMatrix",void 0),$(this,"pixelUnprojectionMatrix",void 0),$(this,"resolution",void 0),$(this,"_frustumPlanes",{}),this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||U5,this.focalDistance=e.focalDistance||1,this.position=e.position||oT,this.modelMatrix=e.modelMatrix||null;const{longitude:n,latitude:i}=e;this.isGeospatial=Number.isFinite(i)&&Number.isFinite(n),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?yo.WEB_MERCATOR:yo.WEB_MERCATOR_AUTO_OFFSET:yo.IDENTITY}equals(e){return e instanceof Gu?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&jd(e.projectionMatrix,this.projectionMatrix)&&jd(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:n=!0}={}){const i=this.projectPosition(e),s=eI(i,this.pixelProjectionMatrix),[c,d]=s,l=n?d:this.height-d;return e.length===2?[c,l]:[c,l,s[2]]}unproject(e,{topLeft:n=!0,targetZ:i}={}){const[s,c,d]=e,l=n?c:this.height-c,y=i&&i*this.distanceScales.unitsPerMeter[2],w=Ox([s,l,d],this.pixelUnprojectionMatrix,y),[S,C,P]=this.unprojectPosition(w);return Number.isFinite(d)?[S,C,P]:Number.isFinite(i)?[S,C,i]:[S,C]}projectPosition(e){const[n,i]=this.projectFlat(e),s=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[n,i,s]}unprojectPosition(e){const[n,i]=this.unprojectFlat(e),s=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[n,i,s]}projectFlat(e){if(this.isGeospatial){const n=Ou(e);return n[1]=Oa(n[1],-318,830),n}return e}unprojectFlat(e){return this.isGeospatial?Xl(e):e}getBounds(e={}){const n={targetZ:e.z||0},i=this.unproject([0,0],n),s=this.unproject([this.width,0],n),c=this.unproject([0,this.height],n),d=this.unproject([this.width,this.height],n);return[Math.min(i[0],s[0],c[0],d[0]),Math.min(i[1],s[1],c[1],d[1]),Math.max(i[0],s[0],c[0],d[0]),Math.max(i[1],s[1],c[1],d[1])]}getDistanceScales(e){return e?iv({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:n,width:i=1,height:s=1}){return e<this.x+this.width&&this.x<e+i&&n<this.y+this.height&&this.y<n+s}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,z5(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,n){return null}_initProps(e){const n=e.longitude,i=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=h5({latitude:i})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||iv({latitude:i,longitude:n}));const s=Math.pow(2,this.zoom);this.scale=s;const{position:c,modelMatrix:d}=e;let l=oT;if(c&&(l=d?new Eo(d).transformAsVector(c,[]):c),this.isGeospatial){const y=this.projectPosition([n,i,0]);this.center=new wo(l).scale(this.distanceScales.unitsPerMeter).add(y)}else this.center=this.projectPosition(l)}_initMatrices(e){const{viewMatrix:n=B5,projectionMatrix:i=null,orthographic:s=!1,fovyRadians:c,fovy:d=75,near:l=.1,far:y=1e3,padding:w=null,focalDistance:S=1}=e;this.viewMatrixUncentered=n,this.viewMatrix=new Eo().multiplyRight(n).translate(new wo(this.center).negate()),this.projectionMatrix=i||V5({width:this.width,height:this.height,orthographic:s,fovyRadians:c||d*N5,focalDistance:S,padding:w,near:l,far:y});const C=sd();jl(C,C,this.projectionMatrix),jl(C,C,this.viewMatrix),this.viewProjectionMatrix=C,this.viewMatrixInverse=Q0([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=D5(this.viewMatrixInverse);const P=sd(),D=sd();kx(P,P,[this.width/2,-this.height/2,1]),Xm(P,P,[1,-1,0]),jl(D,P,this.viewProjectionMatrix),this.pixelProjectionMatrix=D,this.pixelUnprojectionMatrix=Q0(sd(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||fn.warn("Pixel project matrix not invertible")()}}$(Gu,"displayName","Viewport");class Nu extends Gu{constructor(e={}){const{latitude:n=0,longitude:i=0,zoom:s=0,pitch:c=0,bearing:d=0,nearZMultiplier:l=.1,farZMultiplier:y=1.01,nearZ:w,farZ:S,orthographic:C=!1,projectionMatrix:P,repeat:D=!1,worldOffset:U=0,position:H,padding:ae,legacyMeterSizes:G=!1}=e;let{width:V,height:W,altitude:ie=1.5}=e;const ge=Math.pow(2,s);V=V||1,W=W||1;let be,De=null;if(P)ie=P[5]/2,be=Jm(ie);else{e.fovy?(be=e.fovy,ie=QP(be)):be=Jm(ie);let He;if(ae){const{top:je=0,bottom:vt=0}=ae;He=[0,Oa((je+W-vt)/2,0,W)-W/2]}De=f5({width:V,height:W,scale:ge,center:H&&[0,0,H[2]*My(n)],offset:He,pitch:c,fovy:be,nearZMultiplier:l,farZMultiplier:y}),Number.isFinite(w)&&(De.near=w),Number.isFinite(S)&&(De.far=S)}let Ne=d5({height:W,pitch:c,bearing:d,scale:ge,altitude:ie});U&&(Ne=new Eo().translate([512*U,0,0]).multiplyLeft(Ne)),super({...e,width:V,height:W,viewMatrix:Ne,longitude:i,latitude:n,zoom:s,...De,fovy:be,focalDistance:ie}),$(this,"longitude",void 0),$(this,"latitude",void 0),$(this,"pitch",void 0),$(this,"bearing",void 0),$(this,"altitude",void 0),$(this,"fovy",void 0),$(this,"orthographic",void 0),$(this,"_subViewports",void 0),$(this,"_pseudoMeters",void 0),this.latitude=n,this.longitude=i,this.zoom=s,this.pitch=c,this.bearing=d,this.altitude=ie,this.fovy=be,this.orthographic=C,this._subViewports=D?[]:null,this._pseudoMeters=G,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),n=Math.floor((e[0]+180)/360),i=Math.ceil((e[2]-180)/360);for(let s=n;s<=i;s++){const c=s?new Nu({...this,worldOffset:s}):this;this._subViewports.push(c)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[n,i]=this.projectFlat(e),s=(e[2]||0)*My(e[1]);return[n,i,s]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[n,i]=this.unprojectFlat(e),s=(e[2]||0)/My(i);return[n,i,s]}addMetersToLngLat(e,n){return JP(e,n)}panByPosition(e,n){const i=Ox(n,this.pixelUnprojectionMatrix),s=this.projectFlat(e),c=J0([],s,hN([],i)),d=J0([],this.center,c),[l,y]=this.unprojectFlat(d);return{longitude:l,latitude:y}}getBounds(e={}){const n=g5(this,e.z||0);return[Math.min(n[0][0],n[1][0],n[2][0],n[3][0]),Math.min(n[0][1],n[1][1],n[2][1],n[3][1]),Math.max(n[0][0],n[1][0],n[2][0],n[3][0]),Math.max(n[0][1],n[1][1],n[2][1],n[3][1])]}fitBounds(e,n={}){const{width:i,height:s}=this,{longitude:c,latitude:d,zoom:l}=p5({width:i,height:s,bounds:e,...n});return new Nu({width:i,height:s,longitude:c,latitude:d,zoom:l})}}$(Nu,"displayName","WebMercatorViewport");const aT=[0,0,0];function Ry(t,e,n=!1){const i=e.projectPosition(t);if(n&&e instanceof Nu){const[s,c,d=0]=t,l=e.getDistanceScales([s,c]);i[2]=d*l.unitsPerMeter[2]}return i}function j5(t){const{viewport:e,modelMatrix:n,coordinateOrigin:i}=t;let{coordinateSystem:s,fromCoordinateSystem:c,fromCoordinateOrigin:d}=t;return s===Jt.DEFAULT&&(s=e.isGeospatial?Jt.LNGLAT:Jt.CARTESIAN),c===void 0&&(c=s),d===void 0&&(d=i),{viewport:e,coordinateSystem:s,coordinateOrigin:i,modelMatrix:n,fromCoordinateSystem:c,fromCoordinateOrigin:d}}function sI(t,{viewport:e,modelMatrix:n,coordinateSystem:i,coordinateOrigin:s,offsetMode:c}){let[d,l,y=0]=t;switch(n&&([d,l,y]=rf([],[d,l,y,1],n)),i){case Jt.LNGLAT:return Ry([d,l,y],e,c);case Jt.LNGLAT_OFFSETS:return Ry([d+s[0],l+s[1],y+(s[2]||0)],e,c);case Jt.METER_OFFSETS:return Ry(JP(s,[d,l,y]),e,c);case Jt.CARTESIAN:default:return e.isGeospatial?[d+s[0],l+s[1],y+s[2]]:e.projectPosition([d,l,y])}}function G5(t,e){const{viewport:n,coordinateSystem:i,coordinateOrigin:s,modelMatrix:c,fromCoordinateSystem:d,fromCoordinateOrigin:l}=j5(e),{autoOffset:y=!0}=e,{geospatialOrigin:w=aT,shaderCoordinateOrigin:S=aT,offsetMode:C=!1}=y?XP(n,i,s):{},P=sI(t,{viewport:n,modelMatrix:c,coordinateSystem:d,coordinateOrigin:l,offsetMode:C});if(C){const D=n.projectPosition(w||S);PN(P,P,D)}return P}const lT={blendFunc:[1,0,32771,0],blendEquation:32774};class oI extends Rx{constructor(...e){super(...e),$(this,"pickZ",void 0),$(this,"_colorEncoderState",null)}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:n,views:i,viewports:s,onViewportActive:c,pickingFBO:d,deviceRect:{x:l,y,width:w,height:S},cullRect:C,effects:P,pass:D="picking",pickZ:U,moduleParameters:H}){const ae=this.gl;this.pickZ=U;const G=this._resetColorEncoder(U),V=Nr(ae,{scissorTest:!0,scissor:[l,y,w,S],clearColor:[0,0,0,0],depthMask:!0,depthTest:!0,depthRange:[0,1],colorMask:[!0,!0,!0,!0],...lT,blend:!U},()=>super.render({target:d,layers:e,layerFilter:n,views:i,viewports:s,onViewportActive:c,cullRect:C,effects:P==null?void 0:P.filter(ie=>ie.useInPicking),pass:D,isPicking:!0,moduleParameters:H}));return this._colorEncoderState=null,{decodePickingColor:G&&H5.bind(null,G),stats:V}}shouldDrawLayer(e){const{pickable:n,operation:i}=e.props;return n&&i.includes("draw")||i.includes("terrain")||i.includes("mask")}getModuleParameters(){return{pickingActive:1,pickingAttribute:this.pickZ,lightSources:{}}}getLayerParameters(e,n,i){const s={...e.props.parameters},{pickable:c,operation:d}=e.props;return this._colorEncoderState?c&&d.includes("draw")&&(Object.assign(s,lT),s.blend=!0,s.blendColor=W5(this._colorEncoderState,e,i)):s.blend=!1,d.includes("terrain")&&(s.blend=!1),s}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function W5(t,e,n){const{byLayer:i,byAlpha:s}=t;let c,d=i.get(e);return d?(d.viewports.push(n),c=d.a):(c=i.size+1,c<=255?(d={a:c,layer:e,viewports:[n]},i.set(e,d),s[c]=d):(fn.warn("Too many pickable layers, only picking the first 255")(),c=0)),[0,0,0,c/255]}function H5(t,e){const n=t.byAlpha[e[3]];return n&&{pickedLayer:n.layer,pickedViewports:n.viewports,pickedObjectIndex:n.layer.decodePickingColor(e)}}const Yc={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},Qm=Symbol.for("component"),Za=Symbol.for("propTypes"),Dy=Symbol.for("deprecatedProps"),vu=Symbol.for("asyncPropDefaults"),Yl=Symbol.for("asyncPropOriginal"),Fa=Symbol.for("asyncPropResolved");function Fx(t,e=()=>!0){return Array.isArray(t)?aI(t,e,[]):e(t)?[t]:[]}function aI(t,e,n){let i=-1;for(;++i<t.length;){const s=t[i];Array.isArray(s)?aI(s,e,n):e(s)&&n.push(s)}return n}function $5({target:t,source:e,start:n=0,count:i=1}){const s=e.length,c=i*s;let d=0;for(let l=n;d<s;d++)t[l++]=e[d];for(;d<c;)d<c-d?(t.copyWithin(n+d,n,n+d),d*=2):(t.copyWithin(n+d,n,n+c-d),d=c);return t}class q5{constructor(e,n,i){$(this,"id",void 0),$(this,"context",void 0),$(this,"isLoaded",void 0),$(this,"persistent",void 0),$(this,"_loadCount",0),$(this,"_subscribers",new Set),$(this,"_data",void 0),$(this,"_loader",void 0),$(this,"_error",void 0),$(this,"_content",void 0),this.id=e,this.context=i,this.setData(n)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,n){if(e===this._data&&!n)return;this._data=e;const i=++this._loadCount;let s=e;typeof e=="string"&&(s=B0(e)),s instanceof Promise?(this.isLoaded=!1,this._loader=s.then(c=>{this._loadCount===i&&(this.isLoaded=!0,this._error=void 0,this._content=c)}).catch(c=>{this._loadCount===i&&(this.isLoaded=!0,this._error=c||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const c of this._subscribers)c.onChange(this.getData())}}class Z5{constructor({gl:e,protocol:n}){$(this,"protocol",void 0),$(this,"_context",void 0),$(this,"_resources",void 0),$(this,"_consumers",void 0),$(this,"_pruneRequest",void 0),this.protocol=n||"resource://",this._context={gl:e,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:n,forceUpdate:i=!1,persistent:s=!0}){let c=this._resources[e];c?c.setData(n,i):(c=new q5(e,n,this._context),this._resources[e]=c),c.persistent=s}remove(e){const n=this._resources[e];n&&(n.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const n=this._consumers[e];if(n){for(const i in n){const s=n[i],c=this._resources[s.resourceId];c&&c.unsubscribe(s)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:n,consumerId:i,requestId:s="default"}){const{_resources:c,protocol:d}=this;e.startsWith(d)&&(e=e.replace(d,""),c[e]||this.add({resourceId:e,data:null,persistent:!1}));const l=c[e];if(this._track(i,s,l,n),l)return l.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,n,i,s){const c=this._consumers,d=c[e]=c[e]||{},l=d[n]||{},y=l.resourceId&&this._resources[l.resourceId];y&&(y.unsubscribe(l),this.prune()),i&&(d[n]=l,l.onChange=s,l.resourceId=i.id,i.subscribe(l))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const n=this._resources[e];!n.persistent&&!n.inUse()&&(n.delete(),delete this._resources[e])}}}const X5=`
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,Nx={name:"project32",dependencies:[Dx],vs:X5},lI={inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:#decl":`
uniform bool picking_uAttribute;
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}},...iB},Y5=[Dx],K5=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function J5(t){const e=sf.getDefaultProgramManager(t);for(const n of Y5)e.addDefaultModule(n);for(const n of K5)e.addShaderHook(n);return e}const Q5="layerManager.setLayers",e6="layerManager.activateViewport";class t6{constructor(e,{deck:n,stats:i,viewport:s,timeline:c}={}){$(this,"layers",void 0),$(this,"context",void 0),$(this,"resourceManager",void 0),$(this,"_lastRenderedLayers",[]),$(this,"_needsRedraw",!1),$(this,"_needsUpdate",!1),$(this,"_nextLayers",null),$(this,"_debug",!1),$(this,"activateViewport",d=>{rr(e6,this,d),d&&(this.context.viewport=d)}),this.layers=[],this.resourceManager=new Z5({gl:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,gl:e,deck:n,programManager:e&&J5(e),stats:i||new Ax({id:"deck.gl"}),viewport:s||new Gu({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:c||new WP,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const i of this.layers){const s=i.getNeedsRedraw(e);n=n||s}return n}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(n=>e.find(i=>n.id.indexOf(i)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,n){rr(Q5,this,n,e),this._lastRenderedLayers=e;const i=Fx(e,Boolean);for(const s of i)s.context=this.context;this._updateLayers(this.layers,i)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw("updating layers: ".concat(e)),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}_handleError(e,n,i){i.raiseError(n,"".concat(e," of ").concat(i))}_updateLayers(e,n){const i={};for(const d of e)i[d.id]?fn.warn("Multiple old layers with same id ".concat(d.id))():i[d.id]=d;const s=[];this._updateSublayersRecursively(n,i,s),this._finalizeOldLayers(i);let c=!1;for(const d of s)if(d.hasUniformTransition()){c="Uniform transition in ".concat(d);break}this._needsUpdate=c,this.layers=s}_updateSublayersRecursively(e,n,i){for(const s of e){s.context=this.context;const c=n[s.id];c===null&&fn.warn("Multiple new layers with same id ".concat(s.id))(),n[s.id]=null;let d=null;try{this._debug&&c!==s&&s.validateProps(),c?(this._transferLayerState(c,s),this._updateLayer(s)):this._initializeLayer(s),i.push(s),d=s.isComposite?s.getSubLayers():null}catch(l){this._handleError("matching",l,s)}d&&this._updateSublayersRecursively(d,n,i)}}_finalizeOldLayers(e){for(const n in e){const i=e[n];i&&this._finalizeLayer(i)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=Yc.INITIALIZED}catch(n){this._handleError("initialization",n,e)}}_transferLayerState(e,n){n._transferState(e),n.lifecycle=Yc.MATCHED,n!==e&&(e.lifecycle=Yc.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(n){this._handleError("update",n,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||"finalized ".concat(e),e.lifecycle=Yc.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=Yc.FINALIZED}catch(n){this._handleError("finalization",n,e)}}}function vo(t,e,n){if(t===e)return!0;if(!n||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(!vo(t[i],e[i],n-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const i=Object.keys(t),s=Object.keys(e);if(i.length!==s.length)return!1;for(const c of i)if(!e.hasOwnProperty(c)||!vo(t[c],e[c],n-1))return!1;return!0}return!1}class n6{constructor(e){$(this,"width",void 0),$(this,"height",void 0),$(this,"views",void 0),$(this,"viewState",void 0),$(this,"controllers",void 0),$(this,"timeline",void 0),$(this,"_viewports",void 0),$(this,"_viewportMap",void 0),$(this,"_isUpdating",void 0),$(this,"_needsRedraw",void 0),$(this,"_needsUpdate",void 0),$(this,"_eventManager",void 0),$(this,"_eventCallbacks",void 0),this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const n=this.controllers[e];n&&n.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const n=this.controllers[e];n&&n.updateTransition()}}getViewports(e){return e?this._viewports.filter(n=>n.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(n=>{e[n.id]=n}),e}getView(e){return this.views.find(n=>n.id===e)}getViewState(e){const n=typeof e=="string"?this.getView(e):e,i=n&&this.viewState[n.getViewStateId()]||this.viewState;return n?n.filterViewState(i):i}getViewport(e){return this._viewportMap[e]}unproject(e,n){const i=this.getViewports(),s={x:e[0],y:e[1]};for(let c=i.length-1;c>=0;--c){const d=i[c];if(d.containsPixel(s)){const l=e.slice();return l[0]-=d.x,l[1]-=d.y,d.unproject(l,n)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,n){(e!==this.width||n!==this.height)&&(this.width=e,this.height=n,this.setNeedsUpdate("Size changed"))}_setViews(e){e=Fx(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!vo(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):fn.warn("missing `viewState` or `initialViewState`")()}_onViewStateChange(e,n){this._eventCallbacks.onViewStateChange&&this._eventCallbacks.onViewStateChange({...n,viewId:e})}_createController(e,n){const i=n.type;return new i({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._onViewStateChange.bind(this,n.id),onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:c=>{var d;return(d=this.getView(e.id))===null||d===void 0?void 0:d.makeViewport({viewState:c,width:this.width,height:this.height})}})}_updateController(e,n,i,s){const c=e.controller;if(c&&i){const d={...n,...c,id:e.id,x:i.x,y:i.y,width:i.width,height:i.height};return(!s||s.constructor!==c.type)&&(s=this._createController(e,d)),s&&s.setProps(d),s}return null}_rebuildViewports(){const{views:e}=this,n=this.controllers;this._viewports=[],this.controllers={};let i=!1;for(let s=e.length;s--;){const c=e[s],d=this.getViewState(c),l=c.makeViewport({viewState:d,width:this.width,height:this.height});let y=n[c.id];const w=!!c.controller;w&&!y&&(i=!0),(i||!w)&&y&&(y.finalize(),y=null),this.controllers[c.id]=this._updateController(c,d,l,y),l&&this._viewports.unshift(l)}for(const s in n){const c=n[s];c&&!this.controllers[s]&&c.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,n){return e.length!==n.length?!0:e.some((i,s)=>!e[s].equals(n[s]))}}const i6=/([0-9]+\.?[0-9]*)(%|px)/;function Pa(t){switch(typeof t){case"number":return{position:t,relative:!1};case"string":const e=i6.exec(t);if(e&&e.length>=3){const n=e[2]==="%",i=parseFloat(e[1]);return{position:n?i/100:i,relative:n}}default:throw new Error("Could not parse position string ".concat(t))}}function Ia(t,e){return t.relative?Math.round(t.position*e):t.position}function Di(t,e){if(!t)throw new Error(e||"deck.gl: assertion failed.")}class Bu{constructor(e){$(this,"id",void 0),$(this,"viewportInstance",void 0),$(this,"_x",void 0),$(this,"_y",void 0),$(this,"_width",void 0),$(this,"_height",void 0),$(this,"_padding",void 0),$(this,"props",void 0);const{id:n,x:i=0,y:s=0,width:c="100%",height:d="100%",padding:l=null,viewportInstance:y}=e||{};Di(!y||y instanceof Gu),this.viewportInstance=y,this.id=n||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=Pa(i),this._y=Pa(s),this._width=Pa(c),this._height=Pa(d),this._padding=l&&{left:Pa(l.left||0),right:Pa(l.right||0),top:Pa(l.top||0),bottom:Pa(l.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.viewportInstance?e.viewportInstance?this.viewportInstance.equals(e.viewportInstance):!1:this.ViewportType===e.ViewportType&&vo(this.props,e.props,2)}makeViewport({width:e,height:n,viewState:i}){if(this.viewportInstance)return this.viewportInstance;i=this.filterViewState(i);const s=this.getDimensions({width:e,height:n});return!s.height||!s.width?null:new this.ViewportType({...i,...this.props,...s})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:(e==null?void 0:e.id)||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const n={...e};for(const i in this.props.viewState)i!=="id"&&(n[i]=this.props.viewState[i]);return n}return e}getDimensions({width:e,height:n}){const i={x:Ia(this._x,e),y:Ia(this._y,n),width:Ia(this._width,e),height:Ia(this._height,n)};return this._padding&&(i.padding={left:Ia(this._padding.left,e),top:Ia(this._padding.top,n),right:Ia(this._padding.right,e),bottom:Ia(this._padding.bottom,n)}),i}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class af{constructor(e){$(this,"_inProgress",void 0),$(this,"_handle",void 0),$(this,"_timeline",void 0),$(this,"time",void 0),$(this,"settings",void 0),this._inProgress=!1,this._handle=null,this._timeline=e,this.time=0,this.settings={duration:0}}get inProgress(){return this._inProgress}start(e){var n,i;this.cancel(),this.settings=e,this._inProgress=!0,(n=(i=this.settings).onStart)===null||n===void 0||n.call(i,this)}end(){if(this._inProgress){var e,n;this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(e=(n=this.settings).onEnd)===null||e===void 0||e.call(n,this)}}cancel(){if(this._inProgress){var e,n;(e=(n=this.settings).onInterrupt)===null||e===void 0||e.call(n,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1}}update(){var e,n;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:i,settings:s}=this;this._handle=i.addChannel({delay:i.getTime(),duration:s.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(e=(n=this.settings).onUpdate)===null||e===void 0||e.call(n,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const cT=()=>{},rv={BREAK:1,SNAP_TO_END:2,IGNORE:3},r6=t=>t,s6=rv.BREAK;class o6{constructor(e){$(this,"getControllerState",void 0),$(this,"props",void 0),$(this,"propsInTransition",void 0),$(this,"transition",void 0),$(this,"onViewStateChange",void 0),$(this,"onStateChange",void 0),$(this,"_onTransitionUpdate",n=>{const{time:i,settings:{interpolator:s,startProps:c,endProps:d,duration:l,easing:y}}=n,w=y(i/l),S=s.interpolateProps(c,d,w);this.propsInTransition=this.getControllerState({...this.props,...S}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})}),this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new af(e.timeline),this.onViewStateChange=e.onViewStateChange||cT,this.onStateChange=e.onStateChange||cT}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let n=!1;const i=this.props;if(this.props=e,!i||this._shouldIgnoreViewportChange(i,e))return!1;if(this._isTransitionEnabled(e)){let s=i;if(this.transition.inProgress){const{interruption:c,endProps:d}=this.transition.settings;s={...i,...c===rv.SNAP_TO_END?d:this.propsInTransition||i}}this._triggerTransition(s,e),n=!0}else this.transition.cancel();return n}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:n,transitionInterpolator:i}=e;return(n>0||n==="auto")&&!!i}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,n){return this.transition.inProgress?this.transition.settings.interruption===rv.IGNORE||this._isUpdateDueToCurrentTransition(n):this._isTransitionEnabled(n)?n.transitionInterpolator.arePropsEqual(e,n):!0}_triggerTransition(e,n){const i=this.getControllerState(e),s=this.getControllerState(n).shortestPathFrom(i),c=n.transitionInterpolator,d=c.getDuration?c.getDuration(e,n):n.transitionDuration;if(d===0)return;const l=c.initializeProps(e,s);this.propsInTransition={};const y={duration:d,easing:n.transitionEasing||r6,interpolator:c,interruption:n.transitionInterruption||s6,startProps:l.start,endProps:l.end,onStart:n.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(n.onTransitionInterrupt),onEnd:this._onTransitionEnd(n.onTransitionEnd)};this.transition.start(y),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return n=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e==null||e(n)}}}class cI{constructor(e){$(this,"_propsToCompare",void 0),$(this,"_propsToExtract",void 0),$(this,"_requiredProps",void 0);const{compare:n,extract:i,required:s}=e;this._propsToCompare=n,this._propsToExtract=i||n,this._requiredProps=s}arePropsEqual(e,n){for(const i of this._propsToCompare)if(!(i in e)||!(i in n)||!jd(e[i],n[i]))return!1;return!0}initializeProps(e,n){const i={},s={};for(const c of this._propsToExtract)(c in e||c in n)&&(i[c]=e[c],s[c]=n[c]);return this._checkRequiredProps(i),this._checkRequiredProps(s),{start:i,end:s}}getDuration(e,n){return n.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(n=>{const i=e[n];Di(Number.isFinite(i)||Array.isArray(i),"".concat(n," is required for transition"))})}}const a6=["longitude","latitude","zoom","bearing","pitch"],l6=["longitude","latitude","zoom"];class uI extends cI{constructor(e={}){const n=Array.isArray(e)?e:e.transitionProps,i=Array.isArray(e)?{}:e;i.transitionProps=Array.isArray(n)?{compare:n,required:n}:n||{compare:a6,required:l6},super(i.transitionProps),$(this,"opts",void 0),this.opts=i}initializeProps(e,n){const i=super.initializeProps(e,n),{makeViewport:s,around:c}=this.opts;if(s&&c){const d=s(e),l=s(n),y=d.unproject(c);i.start.around=c,Object.assign(i.end,{around:l.project(y),aroundPosition:y,width:n.width,height:n.height})}return i}interpolateProps(e,n,i){const s={};for(const c of this._propsToExtract)s[c]=Vd(e[c]||0,n[c]||0,i);if(n.aroundPosition&&this.opts.makeViewport){const c=this.opts.makeViewport({...n,...s});Object.assign(s,c.panByPosition(n.aroundPosition,Vd(e.around,n.around,i)))}return s}}const Ca={transitionDuration:0},c6=300,Bp=t=>1-(1-t)*(1-t),Bc={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},Il={};class u6{constructor(e){$(this,"props",void 0),$(this,"state",{}),$(this,"transitionManager",void 0),$(this,"eventManager",void 0),$(this,"onViewStateChange",void 0),$(this,"onStateChange",void 0),$(this,"makeViewport",void 0),$(this,"_controllerState",void 0),$(this,"_events",{}),$(this,"_interactionState",{isDragging:!1}),$(this,"_customEvents",[]),$(this,"_eventStartBlocked",null),$(this,"_panMove",!1),$(this,"invertPan",!1),$(this,"dragMode","rotate"),$(this,"inertia",0),$(this,"scrollZoom",!0),$(this,"dragPan",!0),$(this,"dragRotate",!0),$(this,"doubleClickZoom",!0),$(this,"touchZoom",!0),$(this,"touchRotate",!1),$(this,"keyboard",!0),this.transitionManager=new o6({...e,getControllerState:n=>new this.ControllerState(n),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){for(const n in this._events)if(this._events[n]){var e;(e=this.eventManager)===null||e===void 0||e.off(n,this.handleEvent)}this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const n=this._eventStartBlocked;switch(e.type){case"panstart":return n?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return n?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"tripanstart":return n?!1:this._onTriplePanStart(e);case"tripanmove":return this._onTriplePan(e);case"tripanend":return this._onTriplePanEnd(e);case"doubletap":return this._onDoubleTap(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:n,y:i}=this.props,{offsetCenter:s}=e;return[s.x-n,s.y-i]}isPointInBounds(e,n){const{width:i,height:s}=this.props;if(n&&n.handled)return!1;const c=e[0]>=0&&e[0]<=i&&e[1]>=0&&e[1]<=s;return c&&n&&n.stopPropagation(),c}isFunctionKeyPressed(e){const{srcEvent:n}=e;return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const n=setTimeout(()=>{this._eventStartBlocked===n&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=n}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:n}=e;this.inertia=Number.isFinite(n)?n:n===!0?c6:0;const{scrollZoom:i=!0,dragPan:s=!0,dragRotate:c=!0,doubleClickZoom:d=!0,touchZoom:l=!0,touchRotate:y=!1,keyboard:w=!0}=e,S=!!this.onViewStateChange;this.toggleEvents(Bc.WHEEL,S&&i),this.toggleEvents(Bc.PAN,S),this.toggleEvents(Bc.PINCH,S&&(l||y)),this.toggleEvents(Bc.TRIPLE_PAN,S&&y),this.toggleEvents(Bc.DOUBLE_TAP,S&&d),this.toggleEvents(Bc.KEYBOARD,S&&w),this.scrollZoom=i,this.dragPan=s,this.dragRotate=c,this.doubleClickZoom=d,this.touchZoom=l,this.touchRotate=y,this.keyboard=w}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,n){this.eventManager&&e.forEach(i=>{this._events[i]!==n&&(this._events[i]=n,n?this.eventManager.on(i,this.handleEvent):this.eventManager.off(i,this.handleEvent))})}updateViewport(e,n=null,i={}){const s={...e.getViewportProps(),...n},c=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(i),c){const d=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:s,interactionState:this._interactionState,oldViewState:d})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;let i=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(i=!i);const s=this.controllerState[i?"panStart":"rotateStart"]({pos:n});return this._panMove=i,this.updateViewport(s,Ca,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const n=this.getCenter(e),i=this.controllerState.pan({pos:n});return this.updateViewport(i,Ca,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:n}=this;if(this.dragPan&&n&&e.velocity){const i=this.getCenter(e),s=[i[0]+e.velocityX*n/2,i[1]+e.velocityY*n/2],c=this.controllerState.pan({pos:s}).panEnd();this.updateViewport(c,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:Bp},{isDragging:!1,isPanning:!0})}else{const i=this.controllerState.panEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const n=this.getCenter(e),i=this.controllerState.rotate({pos:n});return this.updateViewport(i,Ca,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:n}=this;if(this.dragRotate&&n&&e.velocity){const i=this.getCenter(e),s=[i[0]+e.velocityX*n/2,i[1]+e.velocityY*n/2],c=this.controllerState.rotate({pos:s}).rotateEnd();this.updateViewport(c,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:Bp},{isDragging:!1,isRotating:!0})}else{const i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;e.srcEvent.preventDefault();const{speed:i=.01,smooth:s=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:c}=e;let d=2/(1+Math.exp(-Math.abs(c*i)));c<0&&d!==0&&(d=1/d);const l=this.controllerState.zoom({pos:n,scale:d});return this.updateViewport(l,{...this._getTransitionProps({around:n}),transitionDuration:s?250:1},{isZooming:!0,isPanning:!0}),!0}_onTriplePanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const i=this.controllerState.rotateStart({pos:n});return this.updateViewport(i,Ca,{isDragging:!0}),!0}_onTriplePan(e){if(!this.touchRotate||!this.isDragging())return!1;const n=this.getCenter(e);n[0]-=e.deltaX;const i=this.controllerState.rotate({pos:n});return this.updateViewport(i,Ca,{isDragging:!0,isRotating:!0}),!0}_onTriplePanEnd(e){if(!this.isDragging())return!1;const{inertia:n}=this;if(this.touchRotate&&n&&e.velocityY){const i=this.getCenter(e),s=[i[0],i[1]+=e.velocityY*n/2],c=this.controllerState.rotate({pos:s});this.updateViewport(c,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:Bp},{isDragging:!1,isRotating:!0}),this.blockEvents(n)}else{const i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const i=this.controllerState.zoomStart({pos:n}).rotateStart({pos:n});return Il._startPinchRotation=e.rotation,Il._lastPinchEvent=e,this.updateViewport(i,Ca,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let n=this.controllerState;if(this.touchZoom){const{scale:i}=e,s=this.getCenter(e);n=n.zoom({pos:s,scale:i})}if(this.touchRotate){const{rotation:i}=e;n=n.rotate({deltaAngleX:Il._startPinchRotation-i})}return this.updateViewport(n,Ca,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),Il._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:n}=this,{_lastPinchEvent:i}=Il;if(this.touchZoom&&n&&i&&e.scale!==i.scale){const s=this.getCenter(e);let c=this.controllerState.rotateEnd();const d=Math.log2(e.scale),l=(d-Math.log2(i.scale))/(e.deltaTime-i.deltaTime),y=Math.pow(2,d+l*n/2);c=c.zoom({pos:s,scale:y}).zoomEnd(),this.updateViewport(c,{...this._getTransitionProps({around:s}),transitionDuration:n,transitionEasing:Bp},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(n)}else{const s=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(s,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return Il._startPinchRotation=null,Il._lastPinchEvent=null,!0}_onDoubleTap(e){if(!this.doubleClickZoom)return!1;const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const i=this.isFunctionKeyPressed(e),s=this.controllerState.zoom({pos:n,scale:i?.5:2});return this.updateViewport(s,this._getTransitionProps({around:n}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const n=this.isFunctionKeyPressed(e),{zoomSpeed:i,moveSpeed:s,rotateSpeedX:c,rotateSpeedY:d}=this.keyboard===!0?{}:this.keyboard,{controllerState:l}=this;let y;const w={};switch(e.srcEvent.code){case"Minus":y=n?l.zoomOut(i).zoomOut(i):l.zoomOut(i),w.isZooming=!0;break;case"Equal":y=n?l.zoomIn(i).zoomIn(i):l.zoomIn(i),w.isZooming=!0;break;case"ArrowLeft":n?(y=l.rotateLeft(c),w.isRotating=!0):(y=l.moveLeft(s),w.isPanning=!0);break;case"ArrowRight":n?(y=l.rotateRight(c),w.isRotating=!0):(y=l.moveRight(s),w.isPanning=!0);break;case"ArrowUp":n?(y=l.rotateUp(d),w.isRotating=!0):(y=l.moveUp(s),w.isPanning=!0);break;case"ArrowDown":n?(y=l.rotateDown(d),w.isRotating=!0):(y=l.moveDown(s),w.isPanning=!0);break;default:return!1}return this.updateViewport(y,this._getTransitionProps(),w),!0}_getTransitionProps(e){const{transition:n}=this;return!n||!n.transitionInterpolator?Ca:e?{...n,transitionInterpolator:new uI({...e,...n.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:n}}class h6{constructor(e,n){$(this,"_viewportProps",void 0),$(this,"_state",void 0),this._viewportProps=this.applyConstraints(e),this._state=n}getViewportProps(){return this._viewportProps}getState(){return this._state}}const uT=5,d6=1.2;class f6 extends h6{constructor(e){const{width:n,height:i,latitude:s,longitude:c,zoom:d,bearing:l=0,pitch:y=0,altitude:w=1.5,position:S=[0,0,0],maxZoom:C=20,minZoom:P=0,maxPitch:D=60,minPitch:U=0,startPanLngLat:H,startZoomLngLat:ae,startRotatePos:G,startBearing:V,startPitch:W,startZoom:ie,normalize:ge=!0}=e;Di(Number.isFinite(c)),Di(Number.isFinite(s)),Di(Number.isFinite(d)),super({width:n,height:i,latitude:s,longitude:c,zoom:d,bearing:l,pitch:y,altitude:w,maxZoom:C,minZoom:P,maxPitch:D,minPitch:U,normalize:ge,position:S},{startPanLngLat:H,startZoomLngLat:ae,startRotatePos:G,startBearing:V,startPitch:W,startZoom:ie}),$(this,"makeViewport",void 0),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:n}){const i=this.getState().startPanLngLat||this._unproject(n);if(!i)return this;const c=this.makeViewport(this.getViewportProps()).panByPosition(i,e);return this._getUpdatedState(c)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:n=0,deltaAngleY:i=0}){const{startRotatePos:s,startBearing:c,startPitch:d}=this.getState();if(!s||c===void 0||d===void 0)return this;let l;return e?l=this._getNewRotation(e,s,d,c):l={bearing:c+n,pitch:d+i},this._getUpdatedState(l)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:n,scale:i}){let{startZoom:s,startZoomLngLat:c}=this.getState();if(c||(s=this.getViewportProps().zoom,c=this._unproject(n)||this._unproject(e)),!c)return this;const{maxZoom:d,minZoom:l}=this.getViewportProps();let y=s+Math.log2(i);y=Oa(y,l,d);const w=this.makeViewport({...this.getViewportProps(),zoom:y});return this._getUpdatedState({zoom:y,...w.panByPosition(c,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const n=e.getViewportProps(),i={...this.getViewportProps()},{bearing:s,longitude:c}=i;return Math.abs(s-n.bearing)>180&&(i.bearing=s<0?s+360:s-360),Math.abs(c-n.longitude)>180&&(i.longitude=c<0?c+360:c-360),i}applyConstraints(e){const{maxZoom:n,minZoom:i,zoom:s}=e;e.zoom=Oa(s,i,n);const{maxPitch:c,minPitch:d,pitch:l}=e;e.pitch=Oa(l,d,c);const{normalize:y=!0}=e;return y&&Object.assign(e,_5(e)),e}_zoomFromCenter(e){const{width:n,height:i}=this.getViewportProps();return this.zoom({pos:[n/2,i/2],scale:e})}_panFromCenter(e){const{width:n,height:i}=this.getViewportProps();return this.pan({startPos:[n/2,i/2],pos:[n/2+e[0],i/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const n=this.makeViewport(this.getViewportProps());return e&&n.unproject(e)}_getNewRotation(e,n,i,s){const c=e[0]-n[0],d=e[1]-n[1],l=e[1],y=n[1],{width:w,height:S}=this.getViewportProps(),C=c/w;let P=0;d>0?Math.abs(S-y)>uT&&(P=d/(y-S)*d6):d<0&&y>uT&&(P=1-l/y),P=Oa(P,-1,1);const{minPitch:D,maxPitch:U}=this.getViewportProps(),H=s+180*C;let ae=i;return P>0?ae=i+P*(U-i):P<0&&(ae=i-P*(D-i)),{pitch:ae,bearing:H}}}class p6 extends u6{constructor(...e){super(...e),$(this,"ControllerState",f6),$(this,"transition",{transitionDuration:300,transitionInterpolator:new uI({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})}),$(this,"dragMode","pan")}setProps(e){e.position=e.position||[0,0,0];const n=this.props;super.setProps(e),(!n||n.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class hI extends Bu{get ViewportType(){return Nu}get ControllerType(){return p6}}$(hI,"displayName","MapView");const m6=new rI;function g6(t,e){var n,i;const s=(n=t.order)!==null&&n!==void 0?n:1/0,c=(i=e.order)!==null&&i!==void 0?i:1/0;return s-c}class _6{constructor(){$(this,"effects",void 0),$(this,"_resolvedEffects",[]),$(this,"_defaultEffects",[]),$(this,"_needsRedraw",void 0),this.effects=[],this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const n=this._defaultEffects;if(!n.find(i=>i.id===e.id)){const i=n.findIndex(s=>g6(s,e)>0);i<0?n.push(e):n.splice(i,0,e),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(vo(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}getEffects(){return this._resolvedEffects}_setEffects(e){const n={};for(const s of this.effects)n[s.id]=s;const i=[];for(const s of e){const c=n[s.id];c&&c!==s?c.setProps?(c.setProps(s.props),i.push(c)):(c.cleanup(),i.push(s)):i.push(s),delete n[s.id]}for(const s in n)n[s].cleanup();this.effects=i,this._resolvedEffects=i.concat(this._defaultEffects),e.some(s=>s instanceof rI)||this._resolvedEffects.push(m6),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup();this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class y6 extends Rx{shouldDrawLayer(e){const{operation:n}=e.props;return n.includes("draw")||n.includes("terrain")}}const v6="deckRenderer.renderLayers";class x6{constructor(e){$(this,"gl",void 0),$(this,"layerFilter",void 0),$(this,"drawPickingColors",void 0),$(this,"drawLayersPass",void 0),$(this,"pickLayersPass",void 0),$(this,"renderCount",void 0),$(this,"_needsRedraw",void 0),$(this,"renderBuffers",void 0),$(this,"lastPostProcessEffect",void 0),this.gl=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new y6(e),this.pickLayersPass=new oI(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const n=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,i={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e,target:e.target||_i.getDefaultFramebuffer(this.gl)};i.effects&&this._preRender(i.effects,i);const s=this.lastPostProcessEffect?this.renderBuffers[0]:i.target,c=n.render({...i,target:s});i.effects&&this._postRender(i.effects,i),this.renderCount++,rr(v6,this,c,e)}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}finalize(){const{renderBuffers:e}=this;for(const n of e)n.delete();e.length=0}_preRender(e,n){this.lastPostProcessEffect=null,n.preRenderStats=n.preRenderStats||{};for(const i of e)n.preRenderStats[i.id]=i.preRender(this.gl,n),i.postRender&&(this.lastPostProcessEffect=i.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this;e.length===0&&e.push(new _i(this.gl),new _i(this.gl));for(const n of e)n.resize()}_postRender(e,n){const{renderBuffers:i}=this,s={...n,inputBuffer:i[0],swapBuffer:i[1],target:null};for(const c of e)if(c.postRender){if(c.id===this.lastPostProcessEffect){s.target=n.target,c.postRender(this.gl,s);break}const d=c.postRender(this.gl,s);s.inputBuffer=d,s.swapBuffer=d===i[0]?i[1]:i[0]}}}const b6={pickedColor:null,pickedObjectIndex:-1};function w6({pickedColors:t,decodePickingColor:e,deviceX:n,deviceY:i,deviceRadius:s,deviceRect:c}){const{x:d,y:l,width:y,height:w}=c;let S=s*s,C=-1,P=0;for(let D=0;D<w;D++){const U=D+l-i,H=U*U;if(H>S)P+=4*y;else for(let ae=0;ae<y;ae++){if(t[P+3]-1>=0){const V=ae+d-n,W=V*V+H;W<=S&&(S=W,C=P)}P+=4}}if(C>=0){const D=t.slice(C,C+4),U=e(D);if(U){const H=Math.floor(C/4/y),ae=C/4-H*y;return{...U,pickedColor:D,pickedX:d+ae,pickedY:l+H}}fn.error("Picked non-existent layer. Is picking buffer corrupt?")()}return b6}function E6({pickedColors:t,decodePickingColor:e}){const n=new Map;if(t){for(let i=0;i<t.length;i+=4)if(t[i+3]-1>=0){const c=t.slice(i,i+4),d=c.join(",");if(!n.has(d)){const l=e(c);l?n.set(d,{...l,color:c}):fn.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(n.values())}function dI({pickInfo:t,viewports:e,pixelRatio:n,x:i,y:s,z:c}){let d=e[0];e.length>1&&(d=S6((t==null?void 0:t.pickedViewports)||e,{x:i,y:s}));let l;if(d){const y=[i-d.x,s-d.y];c!==void 0&&(y[2]=c),l=d.unproject(y)}return{color:null,layer:null,viewport:d,index:-1,picked:!1,x:i,y:s,pixel:[i,s],coordinate:l,devicePixel:t&&"pickedX"in t?[t.pickedX,t.pickedY]:void 0,pixelRatio:n}}function T6(t){const{pickInfo:e,lastPickedInfo:n,mode:i,layers:s}=t,{pickedColor:c,pickedLayer:d,pickedObjectIndex:l}=e,y=d?[d]:[];if(i==="hover"){const C=n.index,P=n.layerId,D=d?d.props.id:null;if(D!==P||l!==C){if(D!==P){const U=s.find(H=>H.props.id===P);U&&y.unshift(U)}n.layerId=D,n.index=l,n.info=null}}const w=dI(t),S=new Map;return S.set(null,w),y.forEach(C=>{let P={...w};C===d&&(P.color=c,P.index=l,P.picked=!0),P=fI({layer:C,info:P,mode:i});const D=P.layer;C===d&&i==="hover"&&(n.info=P),S.set(D.id,P),i==="hover"&&D.updateAutoHighlight(P)}),S}function fI({layer:t,info:e,mode:n}){for(;t&&e;){const i=e.layer||null;e.sourceLayer=i,e.layer=t,e=t.getPickingInfo({info:e,mode:n,sourceLayer:i}),t=t.parent}return e}function S6(t,e){for(let n=t.length-1;n>=0;n--){const i=t[n];if(i.containsPixel(e))return i}return t[0]}class A6{constructor(e){$(this,"gl",void 0),$(this,"pickingFBO",void 0),$(this,"depthFBO",void 0),$(this,"pickLayersPass",void 0),$(this,"layerFilter",void 0),$(this,"lastPickedInfo",void 0),$(this,"_pickable",!0),this.gl=e,this.pickLayersPass=new oI(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.delete(),this.depthFBO&&(this.depthFBO.color.delete(),this.depthFBO.delete())}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:n,layers:i,viewports:s},c=this.lastPickedInfo.info){const d=c&&c.layer&&c.layer.id,l=c&&c.viewport&&c.viewport.id,y=d?i.find(P=>P.id===d):null,w=l&&s.find(P=>P.id===l)||s[0],S=w&&w.unproject([e-w.x,n-w.y]);return{...c,...{x:e,y:n,viewport:w,coordinate:S,layer:y}}}_resizeBuffer(){var e,n;const{gl:i}=this;if(!this.pickingFBO&&(this.pickingFBO=new _i(i),_i.isSupported(i,{colorBufferFloat:!0}))){const s=new _i(i);s.attach({36064:new Ls(i,{format:Yt(i)?34836:6408,type:5126})}),this.depthFBO=s}(e=this.pickingFBO)===null||e===void 0||e.resize({width:i.canvas.width,height:i.canvas.height}),(n=this.depthFBO)===null||n===void 0||n.resize({width:i.canvas.width,height:i.canvas.height})}_getPickable(e){if(this._pickable===!1)return null;const n=e.filter(i=>this.pickLayersPass.shouldDrawLayer(i)&&!i.isComposite);return n.length?n:null}_pickClosestObject({layers:e,views:n,viewports:i,x:s,y:c,radius:d=0,depth:l=1,mode:y="query",unproject3D:w,onViewportActive:S,effects:C}){const P=this._getPickable(e),D=Zl(this.gl);if(!P)return{result:[],emptyInfo:dI({viewports:i,x:s,y:c,pixelRatio:D})};this._resizeBuffer();const U=gy(this.gl,[s,c],!0),H=[U.x+Math.floor(U.width/2),U.y+Math.floor(U.height/2)],ae=Math.round(d*D),{width:G,height:V}=this.pickingFBO,W=this._getPickingRect({deviceX:H[0],deviceY:H[1],deviceRadius:ae,deviceWidth:G,deviceHeight:V}),ie={x:s-d,y:c-d,width:d*2+1,height:d*2+1};let ge;const be=[],De=new Set;for(let Ne=0;Ne<l;Ne++){let He;if(W){const vt=this._drawAndSample({layers:P,views:n,viewports:i,onViewportActive:S,deviceRect:W,cullRect:ie,effects:C,pass:"picking:".concat(y)});He=w6({...vt,deviceX:H[0],deviceY:H[1],deviceRadius:ae,deviceRect:W})}else He={pickedColor:null,pickedObjectIndex:-1};let je;if(He.pickedLayer&&w&&this.depthFBO){const{pickedColors:vt}=this._drawAndSample({layers:[He.pickedLayer],views:n,viewports:i,onViewportActive:S,deviceRect:{x:He.pickedX,y:He.pickedY,width:1,height:1},cullRect:ie,effects:C,pass:"picking:".concat(y,":z")},!0);vt[3]&&(je=vt[0])}He.pickedLayer&&Ne+1<l&&(De.add(He.pickedLayer),He.pickedLayer.disablePickingIndex(He.pickedObjectIndex)),ge=T6({pickInfo:He,lastPickedInfo:this.lastPickedInfo,mode:y,layers:P,viewports:i,x:s,y:c,z:je,pixelRatio:D});for(const vt of ge.values())vt.layer&&be.push(vt);if(!He.pickedColor)break}for(const Ne of De)Ne.restorePickingColors();return{result:be,emptyInfo:ge.get(null)}}_pickVisibleObjects({layers:e,views:n,viewports:i,x:s,y:c,width:d=1,height:l=1,mode:y="query",maxObjects:w=null,onViewportActive:S,effects:C}){const P=this._getPickable(e);if(!P)return[];this._resizeBuffer();const D=Zl(this.gl),U=gy(this.gl,[s,c],!0),H=U.x,ae=U.y+U.height,G=gy(this.gl,[s+d,c+l],!0),V=G.x+G.width,W=G.y,ie={x:H,y:W,width:V-H,height:ae-W},ge=this._drawAndSample({layers:P,views:n,viewports:i,onViewportActive:S,deviceRect:ie,cullRect:{x:s,y:c,width:d,height:l},effects:C,pass:"picking:".concat(y)}),be=E6(ge),De=new Map,Ne=Number.isFinite(w);for(let je=0;je<be.length;je++){var He;if(Ne&&w&&De.size>=w)break;const vt=be[je];let Nt={color:vt.pickedColor,layer:null,index:vt.pickedObjectIndex,picked:!0,x:s,y:c,pixelRatio:D};Nt=fI({layer:vt.pickedLayer,info:Nt,mode:y});const Qt=(He=Nt.object)!==null&&He!==void 0?He:"".concat(Nt.layer.id,"[").concat(Nt.index,"]");De.has(Qt)||De.set(Qt,Nt)}return Array.from(De.values())}_drawAndSample({layers:e,views:n,viewports:i,onViewportActive:s,deviceRect:c,cullRect:d,effects:l,pass:y},w=!1){const S=w?this.depthFBO:this.pickingFBO,C={layers:e,layerFilter:this.layerFilter,views:n,viewports:i,onViewportActive:s,pickingFBO:S,deviceRect:c,cullRect:d,effects:l,pass:y,pickZ:w,preRenderStats:{}};for(const V of l)V.useInPicking&&(C.preRenderStats[V.id]=V.preRender(this.gl,C));const{decodePickingColor:P}=this.pickLayersPass.render(C),{x:D,y:U,width:H,height:ae}=c,G=new(w?Float32Array:Uint8Array)(H*ae*4);return Sg(S,{sourceX:D,sourceY:U,sourceWidth:H,sourceHeight:ae,target:G}),{pickedColors:G,decodePickingColor:P}}_getPickingRect({deviceX:e,deviceY:n,deviceRadius:i,deviceWidth:s,deviceHeight:c}){const d=Math.max(0,e-i),l=Math.max(0,n-i),y=Math.min(s,e+i+1)-d,w=Math.min(c,n+i+1)-l;return y<=0||w<=0?null:{x:d,y:l,width:y,height:w}}}const P6={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class I6{constructor(e){$(this,"el",null),$(this,"isVisible",!1);const n=e.parentElement;n&&(this.el=document.createElement("div"),this.el.className="deck-tooltip",Object.assign(this.el.style,P6),n.appendChild(this.el))}setTooltip(e,n,i){const s=this.el;if(s){if(typeof e=="string")s.innerText=e;else if(e)e.text&&(s.innerText=e.text),e.html&&(s.innerHTML=e.html),e.className&&(s.className=e.className);else{this.isVisible=!1,s.style.display="none";return}this.isVisible=!0,s.style.display="block",s.style.transform="translate(".concat(n,"px, ").concat(i,"px)"),e&&typeof e=="object"&&"style"in e&&Object.assign(s.style,e.style)}}remove(){this.el&&(this.el.remove(),this.el=null)}}var pI={exports:{}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */(function(t){(function(e,n,i,s){var c=["","webkit","Moz","MS","ms","o"],d=n.createElement("div"),l="function",y=Math.round,w=Math.abs,S=Date.now;function C(Z,Q,he){return setTimeout(W(Z,he),Q)}function P(Z,Q,he){return Array.isArray(Z)?(D(Z,he[Q],he),!0):!1}function D(Z,Q,he){var Pe;if(Z)if(Z.forEach)Z.forEach(Q,he);else if(Z.length!==s)for(Pe=0;Pe<Z.length;)Q.call(he,Z[Pe],Pe,Z),Pe++;else for(Pe in Z)Z.hasOwnProperty(Pe)&&Q.call(he,Z[Pe],Pe,Z)}function U(Z,Q,he){var Pe="DEPRECATED METHOD: "+Q+`
`+he+` AT 
`;return function(){var Ue=new Error("get-stack-trace"),ut=Ue&&Ue.stack?Ue.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Vt=e.console&&(e.console.warn||e.console.log);return Vt&&Vt.call(e.console,Pe,ut),Z.apply(this,arguments)}}var H;typeof Object.assign!="function"?H=function(Q){if(Q===s||Q===null)throw new TypeError("Cannot convert undefined or null to object");for(var he=Object(Q),Pe=1;Pe<arguments.length;Pe++){var Ue=arguments[Pe];if(Ue!==s&&Ue!==null)for(var ut in Ue)Ue.hasOwnProperty(ut)&&(he[ut]=Ue[ut])}return he}:H=Object.assign;var ae=U(function(Q,he,Pe){for(var Ue=Object.keys(he),ut=0;ut<Ue.length;)(!Pe||Pe&&Q[Ue[ut]]===s)&&(Q[Ue[ut]]=he[Ue[ut]]),ut++;return Q},"extend","Use `assign`."),G=U(function(Q,he){return ae(Q,he,!0)},"merge","Use `assign`.");function V(Z,Q,he){var Pe=Q.prototype,Ue;Ue=Z.prototype=Object.create(Pe),Ue.constructor=Z,Ue._super=Pe,he&&H(Ue,he)}function W(Z,Q){return function(){return Z.apply(Q,arguments)}}function ie(Z,Q){return typeof Z==l?Z.apply(Q&&Q[0]||s,Q):Z}function ge(Z,Q){return Z===s?Q:Z}function be(Z,Q,he){D(je(Q),function(Pe){Z.addEventListener(Pe,he,!1)})}function De(Z,Q,he){D(je(Q),function(Pe){Z.removeEventListener(Pe,he,!1)})}function Ne(Z,Q){for(;Z;){if(Z==Q)return!0;Z=Z.parentNode}return!1}function He(Z,Q){return Z.indexOf(Q)>-1}function je(Z){return Z.trim().split(/\s+/g)}function vt(Z,Q,he){if(Z.indexOf&&!he)return Z.indexOf(Q);for(var Pe=0;Pe<Z.length;){if(he&&Z[Pe][he]==Q||!he&&Z[Pe]===Q)return Pe;Pe++}return-1}function Nt(Z){return Array.prototype.slice.call(Z,0)}function Qt(Z,Q,he){for(var Pe=[],Ue=[],ut=0;ut<Z.length;){var Vt=Q?Z[ut][Q]:Z[ut];vt(Ue,Vt)<0&&Pe.push(Z[ut]),Ue[ut]=Vt,ut++}return he&&(Q?Pe=Pe.sort(function(zt,jn){return zt[Q]>jn[Q]}):Pe=Pe.sort()),Pe}function Bt(Z,Q){for(var he,Pe,Ue=Q[0].toUpperCase()+Q.slice(1),ut=0;ut<c.length;){if(he=c[ut],Pe=he?he+Ue:Q,Pe in Z)return Pe;ut++}return s}var ai=1;function Tt(){return ai++}function Si(Z){var Q=Z.ownerDocument||Z;return Q.defaultView||Q.parentWindow||e}var rt=/mobile|tablet|ip(ad|hone|od)|android/i,At="ontouchstart"in e,Ct=Bt(e,"PointerEvent")!==s,an=At&&rt.test(navigator.userAgent),ln="touch",cr="pen",li="mouse",Ai="kinect",ci=25,pn=1,Pi=2,Kt=4,Un=8,us=1,Oi=2,ei=4,Br=8,qi=16,yi=Oi|ei,Zi=Br|qi,Xs=yi|Zi,$t=["x","y"],Fi=["clientX","clientY"];function Vn(Z,Q){var he=this;this.manager=Z,this.callback=Q,this.element=Z.element,this.target=Z.options.inputTarget,this.domHandler=function(Pe){ie(Z.options.enable,[Z])&&he.handler(Pe)},this.init()}Vn.prototype={handler:function(){},init:function(){this.evEl&&be(this.element,this.evEl,this.domHandler),this.evTarget&&be(this.target,this.evTarget,this.domHandler),this.evWin&&be(Si(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&De(this.element,this.evEl,this.domHandler),this.evTarget&&De(this.target,this.evTarget,this.domHandler),this.evWin&&De(Si(this.element),this.evWin,this.domHandler)}};function hs(Z){var Q,he=Z.options.inputClass;return he?Q=he:Ct?Q=ur:an?Q=Pr:At?Q=ee:Q=kt,new Q(Z,To)}function To(Z,Q,he){var Pe=he.pointers.length,Ue=he.changedPointers.length,ut=Q&pn&&Pe-Ue===0,Vt=Q&(Kt|Un)&&Pe-Ue===0;he.isFirst=!!ut,he.isFinal=!!Vt,ut&&(Z.session={}),he.eventType=Q,Ur(Z,he),Z.emit("hammer.input",he),Z.recognize(he),Z.session.prevInput=he}function Ur(Z,Q){var he=Z.session,Pe=Q.pointers,Ue=Pe.length;he.firstInput||(he.firstInput=Sr(Q)),Ue>1&&!he.firstMultiple?he.firstMultiple=Sr(Q):Ue===1&&(he.firstMultiple=!1);var ut=he.firstInput,Vt=he.firstMultiple,Cn=Vt?Vt.center:ut.center,zt=Q.center=Le(Pe);Q.timeStamp=S(),Q.deltaTime=Q.timeStamp-ut.timeStamp,Q.angle=Gt(Cn,zt),Q.distance=Ii(Cn,zt),Vr(he,Q),Q.offsetDirection=ds(Q.deltaX,Q.deltaY);var jn=qe(Q.deltaTime,Q.deltaX,Q.deltaY);Q.overallVelocityX=jn.x,Q.overallVelocityY=jn.y,Q.overallVelocity=w(jn.x)>w(jn.y)?jn.x:jn.y,Q.scale=Vt?Ni(Vt.pointers,Pe):1,Q.rotation=Vt?Xi(Vt.pointers,Pe):0,Q.maxPointers=he.prevInput?Q.pointers.length>he.prevInput.maxPointers?Q.pointers.length:he.prevInput.maxPointers:Q.pointers.length,Ys(he,Q);var hr=Z.element;Ne(Q.srcEvent.target,hr)&&(hr=Q.srcEvent.target),Q.target=hr}function Vr(Z,Q){var he=Q.center,Pe=Z.offsetDelta||{},Ue=Z.prevDelta||{},ut=Z.prevInput||{};(Q.eventType===pn||ut.eventType===Kt)&&(Ue=Z.prevDelta={x:ut.deltaX||0,y:ut.deltaY||0},Pe=Z.offsetDelta={x:he.x,y:he.y}),Q.deltaX=Ue.x+(he.x-Pe.x),Q.deltaY=Ue.y+(he.y-Pe.y)}function Ys(Z,Q){var he=Z.lastInterval||Q,Pe=Q.timeStamp-he.timeStamp,Ue,ut,Vt,Cn;if(Q.eventType!=Un&&(Pe>ci||he.velocity===s)){var zt=Q.deltaX-he.deltaX,jn=Q.deltaY-he.deltaY,hr=qe(Pe,zt,jn);ut=hr.x,Vt=hr.y,Ue=w(hr.x)>w(hr.y)?hr.x:hr.y,Cn=ds(zt,jn),Z.lastInterval=Q}else Ue=he.velocity,ut=he.velocityX,Vt=he.velocityY,Cn=he.direction;Q.velocity=Ue,Q.velocityX=ut,Q.velocityY=Vt,Q.direction=Cn}function Sr(Z){for(var Q=[],he=0;he<Z.pointers.length;)Q[he]={clientX:y(Z.pointers[he].clientX),clientY:y(Z.pointers[he].clientY)},he++;return{timeStamp:S(),pointers:Q,center:Le(Q),deltaX:Z.deltaX,deltaY:Z.deltaY}}function Le(Z){var Q=Z.length;if(Q===1)return{x:y(Z[0].clientX),y:y(Z[0].clientY)};for(var he=0,Pe=0,Ue=0;Ue<Q;)he+=Z[Ue].clientX,Pe+=Z[Ue].clientY,Ue++;return{x:y(he/Q),y:y(Pe/Q)}}function qe(Z,Q,he){return{x:Q/Z||0,y:he/Z||0}}function ds(Z,Q){return Z===Q?us:w(Z)>=w(Q)?Z<0?Oi:ei:Q<0?Br:qi}function Ii(Z,Q,he){he||(he=$t);var Pe=Q[he[0]]-Z[he[0]],Ue=Q[he[1]]-Z[he[1]];return Math.sqrt(Pe*Pe+Ue*Ue)}function Gt(Z,Q,he){he||(he=$t);var Pe=Q[he[0]]-Z[he[0]],Ue=Q[he[1]]-Z[he[1]];return Math.atan2(Ue,Pe)*180/Math.PI}function Xi(Z,Q){return Gt(Q[1],Q[0],Fi)+Gt(Z[1],Z[0],Fi)}function Ni(Z,Q){return Ii(Q[0],Q[1],Fi)/Ii(Z[0],Z[1],Fi)}var Bi={mousedown:pn,mousemove:Pi,mouseup:Kt},fs="mousedown",$e="mousemove mouseup";function kt(){this.evEl=fs,this.evWin=$e,this.pressed=!1,Vn.apply(this,arguments)}V(kt,Vn,{handler:function(Q){var he=Bi[Q.type];he&pn&&Q.button===0&&(this.pressed=!0),he&Pi&&Q.which!==1&&(he=Kt),this.pressed&&(he&Kt&&(this.pressed=!1),this.callback(this.manager,he,{pointers:[Q],changedPointers:[Q],pointerType:li,srcEvent:Q}))}});var Lt={pointerdown:pn,pointermove:Pi,pointerup:Kt,pointercancel:Un,pointerout:Un},ti={2:ln,3:cr,4:li,5:Ai},jr="pointerdown",Mt="pointermove pointerup pointercancel";e.MSPointerEvent&&!e.PointerEvent&&(jr="MSPointerDown",Mt="MSPointerMove MSPointerUp MSPointerCancel");function ur(){this.evEl=jr,this.evWin=Mt,Vn.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}V(ur,Vn,{handler:function(Q){var he=this.store,Pe=!1,Ue=Q.type.toLowerCase().replace("ms",""),ut=Lt[Ue],Vt=ti[Q.pointerType]||Q.pointerType,Cn=Vt==ln,zt=vt(he,Q.pointerId,"pointerId");ut&pn&&(Q.button===0||Cn)?zt<0&&(he.push(Q),zt=he.length-1):ut&(Kt|Un)&&(Pe=!0),!(zt<0)&&(he[zt]=Q,this.callback(this.manager,ut,{pointers:he,changedPointers:[Q],pointerType:Vt,srcEvent:Q}),Pe&&he.splice(zt,1))}});var Zn={touchstart:pn,touchmove:Pi,touchend:Kt,touchcancel:Un},Ks="touchstart",On="touchstart touchmove touchend touchcancel";function ui(){this.evTarget=Ks,this.evWin=On,this.started=!1,Vn.apply(this,arguments)}V(ui,Vn,{handler:function(Q){var he=Zn[Q.type];if(he===pn&&(this.started=!0),!!this.started){var Pe=sn.call(this,Q,he);he&(Kt|Un)&&Pe[0].length-Pe[1].length===0&&(this.started=!1),this.callback(this.manager,he,{pointers:Pe[0],changedPointers:Pe[1],pointerType:ln,srcEvent:Q})}}});function sn(Z,Q){var he=Nt(Z.touches),Pe=Nt(Z.changedTouches);return Q&(Kt|Un)&&(he=Qt(he.concat(Pe),"identifier",!0)),[he,Pe]}var Js={touchstart:pn,touchmove:Pi,touchend:Kt,touchcancel:Un},Ar="touchstart touchmove touchend touchcancel";function Pr(){this.evTarget=Ar,this.targetIds={},Vn.apply(this,arguments)}V(Pr,Vn,{handler:function(Q){var he=Js[Q.type],Pe=ks.call(this,Q,he);Pe&&this.callback(this.manager,he,{pointers:Pe[0],changedPointers:Pe[1],pointerType:ln,srcEvent:Q})}});function ks(Z,Q){var he=Nt(Z.touches),Pe=this.targetIds;if(Q&(pn|Pi)&&he.length===1)return Pe[he[0].identifier]=!0,[he,he];var Ue,ut,Vt=Nt(Z.changedTouches),Cn=[],zt=this.target;if(ut=he.filter(function(jn){return Ne(jn.target,zt)}),Q===pn)for(Ue=0;Ue<ut.length;)Pe[ut[Ue].identifier]=!0,Ue++;for(Ue=0;Ue<Vt.length;)Pe[Vt[Ue].identifier]&&Cn.push(Vt[Ue]),Q&(Kt|Un)&&delete Pe[Vt[Ue].identifier],Ue++;if(Cn.length)return[Qt(ut.concat(Cn),"identifier",!0),Cn]}var Qs=2500,ps=25;function ee(){Vn.apply(this,arguments);var Z=W(this.handler,this);this.touch=new Pr(this.manager,Z),this.mouse=new kt(this.manager,Z),this.primaryTouch=null,this.lastTouches=[]}V(ee,Vn,{handler:function(Q,he,Pe){var Ue=Pe.pointerType==ln,ut=Pe.pointerType==li;if(!(ut&&Pe.sourceCapabilities&&Pe.sourceCapabilities.firesTouchEvents)){if(Ue)R.call(this,he,Pe);else if(ut&&K.call(this,Pe))return;this.callback(Q,he,Pe)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function R(Z,Q){Z&pn?(this.primaryTouch=Q.changedPointers[0].identifier,N.call(this,Q)):Z&(Kt|Un)&&N.call(this,Q)}function N(Z){var Q=Z.changedPointers[0];if(Q.identifier===this.primaryTouch){var he={x:Q.clientX,y:Q.clientY};this.lastTouches.push(he);var Pe=this.lastTouches,Ue=function(){var ut=Pe.indexOf(he);ut>-1&&Pe.splice(ut,1)};setTimeout(Ue,Qs)}}function K(Z){for(var Q=Z.srcEvent.clientX,he=Z.srcEvent.clientY,Pe=0;Pe<this.lastTouches.length;Pe++){var Ue=this.lastTouches[Pe],ut=Math.abs(Q-Ue.x),Vt=Math.abs(he-Ue.y);if(ut<=ps&&Vt<=ps)return!0}return!1}var J=Bt(d.style,"touchAction"),ue=J!==s,pe="compute",de="auto",ce="manipulation",me="none",Ce="pan-x",Fe="pan-y",Ie=Ke();function lt(Z,Q){this.manager=Z,this.set(Q)}lt.prototype={set:function(Z){Z==pe&&(Z=this.compute()),ue&&this.manager.element.style&&Ie[Z]&&(this.manager.element.style[J]=Z),this.actions=Z.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var Z=[];return D(this.manager.recognizers,function(Q){ie(Q.options.enable,[Q])&&(Z=Z.concat(Q.getTouchAction()))}),ht(Z.join(" "))},preventDefaults:function(Z){var Q=Z.srcEvent,he=Z.offsetDirection;if(this.manager.session.prevented){Q.preventDefault();return}var Pe=this.actions,Ue=He(Pe,me)&&!Ie[me],ut=He(Pe,Fe)&&!Ie[Fe],Vt=He(Pe,Ce)&&!Ie[Ce];if(Ue){var Cn=Z.pointers.length===1,zt=Z.distance<2,jn=Z.deltaTime<250;if(Cn&&zt&&jn)return}if(!(Vt&&ut)&&(Ue||ut&&he&yi||Vt&&he&Zi))return this.preventSrc(Q)},preventSrc:function(Z){this.manager.session.prevented=!0,Z.preventDefault()}};function ht(Z){if(He(Z,me))return me;var Q=He(Z,Ce),he=He(Z,Fe);return Q&&he?me:Q||he?Q?Ce:Fe:He(Z,ce)?ce:de}function Ke(){if(!ue)return!1;var Z={},Q=e.CSS&&e.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(he){Z[he]=Q?e.CSS.supports("touch-action",he):!0}),Z}var xt=1,gt=2,Dt=4,Et=8,It=Et,Ut=16,Wt=32;function _n(Z){this.options=H({},this.defaults,Z||{}),this.id=Tt(),this.manager=null,this.options.enable=ge(this.options.enable,!0),this.state=xt,this.simultaneous={},this.requireFail=[]}_n.prototype={defaults:{},set:function(Z){return H(this.options,Z),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(Z){if(P(Z,"recognizeWith",this))return this;var Q=this.simultaneous;return Z=Gr(Z,this),Q[Z.id]||(Q[Z.id]=Z,Z.recognizeWith(this)),this},dropRecognizeWith:function(Z){return P(Z,"dropRecognizeWith",this)?this:(Z=Gr(Z,this),delete this.simultaneous[Z.id],this)},requireFailure:function(Z){if(P(Z,"requireFailure",this))return this;var Q=this.requireFail;return Z=Gr(Z,this),vt(Q,Z)===-1&&(Q.push(Z),Z.requireFailure(this)),this},dropRequireFailure:function(Z){if(P(Z,"dropRequireFailure",this))return this;Z=Gr(Z,this);var Q=vt(this.requireFail,Z);return Q>-1&&this.requireFail.splice(Q,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(Z){return!!this.simultaneous[Z.id]},emit:function(Z){var Q=this,he=this.state;function Pe(Ue){Q.manager.emit(Ue,Z)}he<Et&&Pe(Q.options.event+yn(he)),Pe(Q.options.event),Z.additionalEvent&&Pe(Z.additionalEvent),he>=Et&&Pe(Q.options.event+yn(he))},tryEmit:function(Z){if(this.canEmit())return this.emit(Z);this.state=Wt},canEmit:function(){for(var Z=0;Z<this.requireFail.length;){if(!(this.requireFail[Z].state&(Wt|xt)))return!1;Z++}return!0},recognize:function(Z){var Q=H({},Z);if(!ie(this.options.enable,[this,Q])){this.reset(),this.state=Wt;return}this.state&(It|Ut|Wt)&&(this.state=xt),this.state=this.process(Q),this.state&(gt|Dt|Et|Ut)&&this.tryEmit(Q)},process:function(Z){},getTouchAction:function(){},reset:function(){}};function yn(Z){return Z&Ut?"cancel":Z&Et?"end":Z&Dt?"move":Z&gt?"start":""}function ni(Z){return Z==qi?"down":Z==Br?"up":Z==Oi?"left":Z==ei?"right":""}function Gr(Z,Q){var he=Q.manager;return he?he.get(Z):Z}function vi(){_n.apply(this,arguments)}V(vi,_n,{defaults:{pointers:1},attrTest:function(Z){var Q=this.options.pointers;return Q===0||Z.pointers.length===Q},process:function(Z){var Q=this.state,he=Z.eventType,Pe=Q&(gt|Dt),Ue=this.attrTest(Z);return Pe&&(he&Un||!Ue)?Q|Ut:Pe||Ue?he&Kt?Q|Et:Q&gt?Q|Dt:gt:Wt}});function en(){vi.apply(this,arguments),this.pX=null,this.pY=null}V(en,vi,{defaults:{event:"pan",threshold:10,pointers:1,direction:Xs},getTouchAction:function(){var Z=this.options.direction,Q=[];return Z&yi&&Q.push(Fe),Z&Zi&&Q.push(Ce),Q},directionTest:function(Z){var Q=this.options,he=!0,Pe=Z.distance,Ue=Z.direction,ut=Z.deltaX,Vt=Z.deltaY;return Ue&Q.direction||(Q.direction&yi?(Ue=ut===0?us:ut<0?Oi:ei,he=ut!=this.pX,Pe=Math.abs(Z.deltaX)):(Ue=Vt===0?us:Vt<0?Br:qi,he=Vt!=this.pY,Pe=Math.abs(Z.deltaY))),Z.direction=Ue,he&&Pe>Q.threshold&&Ue&Q.direction},attrTest:function(Z){return vi.prototype.attrTest.call(this,Z)&&(this.state&gt||!(this.state&gt)&&this.directionTest(Z))},emit:function(Z){this.pX=Z.deltaX,this.pY=Z.deltaY;var Q=ni(Z.direction);Q&&(Z.additionalEvent=this.options.event+Q),this._super.emit.call(this,Z)}});function So(){vi.apply(this,arguments)}V(So,vi,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[me]},attrTest:function(Z){return this._super.attrTest.call(this,Z)&&(Math.abs(Z.scale-1)>this.options.threshold||this.state&gt)},emit:function(Z){if(Z.scale!==1){var Q=Z.scale<1?"in":"out";Z.additionalEvent=this.options.event+Q}this._super.emit.call(this,Z)}});function Ao(){_n.apply(this,arguments),this._timer=null,this._input=null}V(Ao,_n,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[de]},process:function(Z){var Q=this.options,he=Z.pointers.length===Q.pointers,Pe=Z.distance<Q.threshold,Ue=Z.deltaTime>Q.time;if(this._input=Z,!Pe||!he||Z.eventType&(Kt|Un)&&!Ue)this.reset();else if(Z.eventType&pn)this.reset(),this._timer=C(function(){this.state=It,this.tryEmit()},Q.time,this);else if(Z.eventType&Kt)return It;return Wt},reset:function(){clearTimeout(this._timer)},emit:function(Z){this.state===It&&(Z&&Z.eventType&Kt?this.manager.emit(this.options.event+"up",Z):(this._input.timeStamp=S(),this.manager.emit(this.options.event,this._input)))}});function ra(){vi.apply(this,arguments)}V(ra,vi,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[me]},attrTest:function(Z){return this._super.attrTest.call(this,Z)&&(Math.abs(Z.rotation)>this.options.threshold||this.state&gt)}});function sa(){vi.apply(this,arguments)}V(sa,vi,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:yi|Zi,pointers:1},getTouchAction:function(){return en.prototype.getTouchAction.call(this)},attrTest:function(Z){var Q=this.options.direction,he;return Q&(yi|Zi)?he=Z.overallVelocity:Q&yi?he=Z.overallVelocityX:Q&Zi&&(he=Z.overallVelocityY),this._super.attrTest.call(this,Z)&&Q&Z.offsetDirection&&Z.distance>this.options.threshold&&Z.maxPointers==this.options.pointers&&w(he)>this.options.velocity&&Z.eventType&Kt},emit:function(Z){var Q=ni(Z.offsetDirection);Q&&this.manager.emit(this.options.event+Q,Z),this.manager.emit(this.options.event,Z)}});function eo(){_n.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}V(eo,_n,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[ce]},process:function(Z){var Q=this.options,he=Z.pointers.length===Q.pointers,Pe=Z.distance<Q.threshold,Ue=Z.deltaTime<Q.time;if(this.reset(),Z.eventType&pn&&this.count===0)return this.failTimeout();if(Pe&&Ue&&he){if(Z.eventType!=Kt)return this.failTimeout();var ut=this.pTime?Z.timeStamp-this.pTime<Q.interval:!0,Vt=!this.pCenter||Ii(this.pCenter,Z.center)<Q.posThreshold;this.pTime=Z.timeStamp,this.pCenter=Z.center,!Vt||!ut?this.count=1:this.count+=1,this._input=Z;var Cn=this.count%Q.taps;if(Cn===0)return this.hasRequireFailures()?(this._timer=C(function(){this.state=It,this.tryEmit()},Q.interval,this),gt):It}return Wt},failTimeout:function(){return this._timer=C(function(){this.state=Wt},this.options.interval,this),Wt},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==It&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function Wr(Z,Q){return Q=Q||{},Q.recognizers=ge(Q.recognizers,Wr.defaults.preset),new la(Z,Q)}Wr.VERSION="2.0.7",Wr.defaults={domEvents:!1,touchAction:pe,enable:!0,inputTarget:null,inputClass:null,preset:[[ra,{enable:!1}],[So,{enable:!1},["rotate"]],[sa,{direction:yi}],[en,{direction:yi},["swipe"]],[eo],[eo,{event:"doubletap",taps:2},["tap"]],[Ao]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var oa=1,aa=2;function la(Z,Q){this.options=H({},Wr.defaults,Q||{}),this.options.inputTarget=this.options.inputTarget||Z,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=Z,this.input=hs(this),this.touchAction=new lt(this,this.options.touchAction),tl(this,!0),D(this.options.recognizers,function(he){var Pe=this.add(new he[0](he[1]));he[2]&&Pe.recognizeWith(he[2]),he[3]&&Pe.requireFailure(he[3])},this)}la.prototype={set:function(Z){return H(this.options,Z),Z.touchAction&&this.touchAction.update(),Z.inputTarget&&(this.input.destroy(),this.input.target=Z.inputTarget,this.input.init()),this},stop:function(Z){this.session.stopped=Z?aa:oa},recognize:function(Z){var Q=this.session;if(!Q.stopped){this.touchAction.preventDefaults(Z);var he,Pe=this.recognizers,Ue=Q.curRecognizer;(!Ue||Ue&&Ue.state&It)&&(Ue=Q.curRecognizer=null);for(var ut=0;ut<Pe.length;)he=Pe[ut],Q.stopped!==aa&&(!Ue||he==Ue||he.canRecognizeWith(Ue))?he.recognize(Z):he.reset(),!Ue&&he.state&(gt|Dt|Et)&&(Ue=Q.curRecognizer=he),ut++}},get:function(Z){if(Z instanceof _n)return Z;for(var Q=this.recognizers,he=0;he<Q.length;he++)if(Q[he].options.event==Z)return Q[he];return null},add:function(Z){if(P(Z,"add",this))return this;var Q=this.get(Z.options.event);return Q&&this.remove(Q),this.recognizers.push(Z),Z.manager=this,this.touchAction.update(),Z},remove:function(Z){if(P(Z,"remove",this))return this;if(Z=this.get(Z),Z){var Q=this.recognizers,he=vt(Q,Z);he!==-1&&(Q.splice(he,1),this.touchAction.update())}return this},on:function(Z,Q){if(Z!==s&&Q!==s){var he=this.handlers;return D(je(Z),function(Pe){he[Pe]=he[Pe]||[],he[Pe].push(Q)}),this}},off:function(Z,Q){if(Z!==s){var he=this.handlers;return D(je(Z),function(Pe){Q?he[Pe]&&he[Pe].splice(vt(he[Pe],Q),1):delete he[Pe]}),this}},emit:function(Z,Q){this.options.domEvents&&rc(Z,Q);var he=this.handlers[Z]&&this.handlers[Z].slice();if(!(!he||!he.length)){Q.type=Z,Q.preventDefault=function(){Q.srcEvent.preventDefault()};for(var Pe=0;Pe<he.length;)he[Pe](Q),Pe++}},destroy:function(){this.element&&tl(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function tl(Z,Q){var he=Z.element;if(he.style){var Pe;D(Z.options.cssProps,function(Ue,ut){Pe=Bt(he.style,ut),Q?(Z.oldCssProps[Pe]=he.style[Pe],he.style[Pe]=Ue):he.style[Pe]=Z.oldCssProps[Pe]||""}),Q||(Z.oldCssProps={})}}function rc(Z,Q){var he=n.createEvent("Event");he.initEvent(Z,!0,!0),he.gesture=Q,Q.target.dispatchEvent(he)}H(Wr,{INPUT_START:pn,INPUT_MOVE:Pi,INPUT_END:Kt,INPUT_CANCEL:Un,STATE_POSSIBLE:xt,STATE_BEGAN:gt,STATE_CHANGED:Dt,STATE_ENDED:Et,STATE_RECOGNIZED:It,STATE_CANCELLED:Ut,STATE_FAILED:Wt,DIRECTION_NONE:us,DIRECTION_LEFT:Oi,DIRECTION_RIGHT:ei,DIRECTION_UP:Br,DIRECTION_DOWN:qi,DIRECTION_HORIZONTAL:yi,DIRECTION_VERTICAL:Zi,DIRECTION_ALL:Xs,Manager:la,Input:Vn,TouchAction:lt,TouchInput:Pr,MouseInput:kt,PointerEventInput:ur,TouchMouseInput:ee,SingleTouchInput:ui,Recognizer:_n,AttrRecognizer:vi,Tap:eo,Pan:en,Swipe:sa,Pinch:So,Rotate:ra,Press:Ao,on:be,off:De,each:D,merge:G,extend:ae,assign:H,inherit:V,bindFn:W,prefixed:Bt});var Rs=typeof e<"u"?e:typeof self<"u"?self:{};Rs.Hammer=Wr,typeof s=="function"&&s.amd?s(function(){return Wr}):t.exports?t.exports=Wr:e[i]=Wr})(window,document,"Hammer")})(pI);var lf=pI.exports;const C6=sg(lf),fo=jM({__proto__:null,default:C6},[lf]),mI=1,gI=2,sv=4,M6={mousedown:mI,mousemove:gI,mouseup:sv};function L6(t,e){for(let n=0;n<t.length;n++)if(e(t[n]))return!0;return!1}function k6(t){const e=t.prototype.handler;t.prototype.handler=function(i){const s=this.store;i.button>0&&i.type==="pointerdown"&&(L6(s,c=>c.pointerId===i.pointerId)||s.push(i)),e.call(this,i)}}function R6(t){t.prototype.handler=function(n){let i=M6[n.type];i&mI&&n.button>=0&&(this.pressed=!0),i&gI&&n.which===0&&(i=sv),this.pressed&&(i&sv&&(this.pressed=!1),this.callback(this.manager,i,{pointers:[n],changedPointers:[n],pointerType:"mouse",srcEvent:n}))}}k6(lf.PointerEventInput);R6(lf.MouseInput);const D6=lf.Manager;class Pg{constructor(e,n,i){this.element=e,this.callback=n,this.options={enable:!0,...i}}}const z6=fo?[[fo.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[fo.Rotate,{enable:!1}],[fo.Pinch,{enable:!1}],[fo.Swipe,{enable:!1}],[fo.Pan,{threshold:0,enable:!1}],[fo.Press,{enable:!1}],[fo.Tap,{event:"doubletap",taps:2,enable:!1}],[fo.Tap,{event:"anytap",enable:!1}],[fo.Tap,{enable:!1}]]:null,hT={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},O6={doubletap:["tap"]},F6={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},Bx={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},N6={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},dT={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},B6=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",uu=typeof window<"u"?window:global;let ov=!1;try{const t={get passive(){return ov=!0,!0}};uu.addEventListener("test",null,t),uu.removeEventListener("test",null)}catch{ov=!1}const U6=B6.indexOf("firefox")!==-1,{WHEEL_EVENTS:V6}=Bx,fT="wheel",pT=4.000244140625,j6=40,G6=.25;class W6 extends Pg{constructor(e,n,i){super(e,n,i),this.handleEvent=s=>{if(!this.options.enable)return;let c=s.deltaY;uu.WheelEvent&&(U6&&s.deltaMode===uu.WheelEvent.DOM_DELTA_PIXEL&&(c/=uu.devicePixelRatio),s.deltaMode===uu.WheelEvent.DOM_DELTA_LINE&&(c*=j6)),c!==0&&c%pT===0&&(c=Math.floor(c/pT)),s.shiftKey&&c&&(c=c*G6),this.callback({type:fT,center:{x:s.clientX,y:s.clientY},delta:-c,srcEvent:s,pointerType:"mouse",target:s.target})},this.events=(this.options.events||[]).concat(V6),this.events.forEach(s=>e.addEventListener(s,this.handleEvent,ov?{passive:!1}:!1))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===fT&&(this.options.enable=n)}}const{MOUSE_EVENTS:H6}=Bx,mT="pointermove",gT="pointerover",_T="pointerout",yT="pointerenter",vT="pointerleave";class $6 extends Pg{constructor(e,n,i){super(e,n,i),this.handleEvent=c=>{this.handleOverEvent(c),this.handleOutEvent(c),this.handleEnterEvent(c),this.handleLeaveEvent(c),this.handleMoveEvent(c)},this.pressed=!1;const{enable:s}=this.options;this.enableMoveEvent=s,this.enableLeaveEvent=s,this.enableEnterEvent=s,this.enableOutEvent=s,this.enableOverEvent=s,this.events=(this.options.events||[]).concat(H6),this.events.forEach(c=>e.addEventListener(c,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===mT&&(this.enableMoveEvent=n),e===gT&&(this.enableOverEvent=n),e===_T&&(this.enableOutEvent=n),e===yT&&(this.enableEnterEvent=n),e===vT&&(this.enableLeaveEvent=n)}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit(gT,e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit(_T,e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit(yT,e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit(vT,e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.which===0&&(this.pressed=!1),this.pressed||this._emit(mT,e);break;case"mouseup":this.pressed=!1;break}}_emit(e,n){this.callback({type:e,center:{x:n.clientX,y:n.clientY},srcEvent:n,pointerType:"mouse",target:n.target})}}const{KEY_EVENTS:q6}=Bx,xT="keydown",bT="keyup";class Z6 extends Pg{constructor(e,n,i){super(e,n,i),this.handleEvent=s=>{const c=s.target||s.srcElement;c.tagName==="INPUT"&&c.type==="text"||c.tagName==="TEXTAREA"||(this.enableDownEvent&&s.type==="keydown"&&this.callback({type:xT,srcEvent:s,key:s.key,target:s.target}),this.enableUpEvent&&s.type==="keyup"&&this.callback({type:bT,srcEvent:s,key:s.key,target:s.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=(this.options.events||[]).concat(q6),e.tabIndex=this.options.tabIndex||0,e.style.outline="none",this.events.forEach(s=>e.addEventListener(s,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===xT&&(this.enableDownEvent=n),e===bT&&(this.enableUpEvent=n)}}const wT="contextmenu";class X6 extends Pg{constructor(e,n,i){super(e,n,i),this.handleEvent=s=>{this.options.enable&&this.callback({type:wT,center:{x:s.clientX,y:s.clientY},srcEvent:s,pointerType:"mouse",target:s.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,n){e===wT&&(this.options.enable=n)}}const av=1,eg=2,lv=4,Y6={pointerdown:av,pointermove:eg,pointerup:lv,mousedown:av,mousemove:eg,mouseup:lv},K6=1,J6=2,Q6=3,eU=0,tU=1,nU=2,iU=1,rU=2,sU=4;function oU(t){const e=Y6[t.srcEvent.type];if(!e)return null;const{buttons:n,button:i,which:s}=t.srcEvent;let c=!1,d=!1,l=!1;return e===lv||e===eg&&!Number.isFinite(n)?(c=s===K6,d=s===J6,l=s===Q6):e===eg?(c=!!(n&iU),d=!!(n&sU),l=!!(n&rU)):e===av&&(c=i===eU,d=i===tU,l=i===nU),{leftButton:c,middleButton:d,rightButton:l}}function aU(t,e){const n=t.center;if(!n)return null;const i=e.getBoundingClientRect(),s=i.width/e.offsetWidth||1,c=i.height/e.offsetHeight||1,d={x:(n.x-i.left-e.clientLeft)/s,y:(n.y-i.top-e.clientTop)/c};return{center:n,offsetCenter:d}}const zy={srcElement:"root",priority:0};class lU{constructor(e){this.handleEvent=n=>{if(this.isEmpty())return;const i=this._normalizeEvent(n);let s=n.srcEvent.target;for(;s&&s!==i.rootElement;){if(this._emit(i,s),i.handled)return;s=s.parentNode}this._emit(i,"root")},this.eventManager=e,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,n,i,s=!1,c=!1){const{handlers:d,handlersByElement:l}=this;let y=zy;typeof i=="string"||i&&i.addEventListener?y={...zy,srcElement:i}:i&&(y={...zy,...i});let w=l.get(y.srcElement);w||(w=[],l.set(y.srcElement,w));const S={type:e,handler:n,srcElement:y.srcElement,priority:y.priority};s&&(S.once=!0),c&&(S.passive=!0),d.push(S),this._active=this._active||!S.passive;let C=w.length-1;for(;C>=0&&!(w[C].priority>=S.priority);)C--;w.splice(C+1,0,S)}remove(e,n){const{handlers:i,handlersByElement:s}=this;for(let c=i.length-1;c>=0;c--){const d=i[c];if(d.type===e&&d.handler===n){i.splice(c,1);const l=s.get(d.srcElement);l.splice(l.indexOf(d),1),l.length===0&&s.delete(d.srcElement)}}this._active=i.some(c=>!c.passive)}_emit(e,n){const i=this.handlersByElement.get(n);if(i){let s=!1;const c=()=>{e.handled=!0},d=()=>{e.handled=!0,s=!0},l=[];for(let y=0;y<i.length;y++){const{type:w,handler:S,once:C}=i[y];if(S({...e,type:w,stopPropagation:c,stopImmediatePropagation:d}),C&&l.push(i[y]),s)break}for(let y=0;y<l.length;y++){const{type:w,handler:S}=l[y];this.remove(w,S)}}}_normalizeEvent(e){const n=this.eventManager.getElement();return{...e,...oU(e),...aU(e,n),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:n}}}const cU={events:null,recognizers:null,recognizerOptions:{},Manager:D6,touchAction:"none",tabIndex:0};class uU{constructor(e=null,n){this._onBasicInput=s=>{const{srcEvent:c}=s,d=F6[c.type];d&&this.manager.emit(d,s)},this._onOtherEvent=s=>{this.manager.emit(s.type,s)},this.options={...cU,...n},this.events=new Map,this.setElement(e);const{events:i}=this.options;i&&this.on(i)}getElement(){return this.element}setElement(e){if(this.element&&this.destroy(),this.element=e,!e)return;const{options:n}=this,i=n.Manager;this.manager=new i(e,{touchAction:n.touchAction,recognizers:n.recognizers||z6}).on("hammer.input",this._onBasicInput),n.recognizers||Object.keys(hT).forEach(s=>{const c=this.manager.get(s);c&&hT[s].forEach(d=>{c.recognizeWith(d)})});for(const s in n.recognizerOptions){const c=this.manager.get(s);if(c){const d=n.recognizerOptions[s];delete d.enable,c.set(d)}}this.wheelInput=new W6(e,this._onOtherEvent,{enable:!1}),this.moveInput=new $6(e,this._onOtherEvent,{enable:!1}),this.keyInput=new Z6(e,this._onOtherEvent,{enable:!1,tabIndex:n.tabIndex}),this.contextmenuInput=new X6(e,this._onOtherEvent,{enable:!1});for(const[s,c]of this.events)c.isEmpty()||(this._toggleRecognizer(c.recognizerName,!0),this.manager.on(s,c.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(e,n,i){this._addEventHandler(e,n,i,!1)}once(e,n,i){this._addEventHandler(e,n,i,!0)}watch(e,n,i){this._addEventHandler(e,n,i,!1,!0)}off(e,n){this._removeEventHandler(e,n)}_toggleRecognizer(e,n){const{manager:i}=this;if(!i)return;const s=i.get(e);if(s&&s.options.enable!==n){s.set({enable:n});const c=O6[e];c&&!this.options.recognizers&&c.forEach(d=>{const l=i.get(d);n?(l.requireFailure(e),s.dropRequireFailure(d)):l.dropRequireFailure(e)})}this.wheelInput.enableEventType(e,n),this.moveInput.enableEventType(e,n),this.keyInput.enableEventType(e,n),this.contextmenuInput.enableEventType(e,n)}_addEventHandler(e,n,i,s,c){if(typeof e!="string"){i=n;for(const S in e)this._addEventHandler(S,e[S],i,s,c);return}const{manager:d,events:l}=this,y=dT[e]||e;let w=l.get(y);w||(w=new lU(this),l.set(y,w),w.recognizerName=N6[y]||y,d&&d.on(y,w.handleEvent)),w.add(e,n,i,s,c),w.isEmpty()||this._toggleRecognizer(w.recognizerName,!0)}_removeEventHandler(e,n){if(typeof e!="string"){for(const d in e)this._removeEventHandler(d,e[d]);return}const{events:i}=this,s=dT[e]||e,c=i.get(s);if(c&&(c.remove(e,n),c.isEmpty())){const{recognizerName:d}=c;let l=!1;for(const y of i.values())if(y.recognizerName===d&&!y.isEmpty()){l=!0;break}l||this._toggleRecognizer(d,!1)}}}function Cl(){}const hU=({isDragging:t})=>t?"grabbing":"grab",_I={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,glOptions:{},parameters:{},parent:null,gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,onWebGLInitialized:Cl,onResize:Cl,onViewStateChange:Cl,onInteractionStateChange:Cl,onBeforeRender:Cl,onAfterRender:Cl,onLoad:Cl,onError:t=>fn.error(t.message,t.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:hU,getTooltip:null,debug:!1,drawPickingColors:!1};class Ig{constructor(e){$(this,"props",void 0),$(this,"width",0),$(this,"height",0),$(this,"userData",{}),$(this,"canvas",null),$(this,"viewManager",null),$(this,"layerManager",null),$(this,"effectManager",null),$(this,"deckRenderer",null),$(this,"deckPicker",null),$(this,"eventManager",null),$(this,"tooltip",null),$(this,"metrics",void 0),$(this,"animationLoop",void 0),$(this,"stats",void 0),$(this,"viewState",void 0),$(this,"cursorState",void 0),$(this,"_needsRedraw",void 0),$(this,"_pickRequest",void 0),$(this,"_lastPointerDownInfo",null),$(this,"_metricsCounter",void 0),$(this,"_onPointerMove",n=>{const{_pickRequest:i}=this;if(n.type==="pointerleave")i.x=-1,i.y=-1,i.radius=0;else{if(n.leftButton||n.rightButton)return;{const s=n.offsetCenter;if(!s)return;i.x=s.x,i.y=s.y,i.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:i.x,y:i.y}),i.event=n}),$(this,"_onEvent",n=>{const i=sE[n.type],s=n.offsetCenter;if(!i||!s||!this.layerManager)return;const c=this.layerManager.getLayers(),d=this.deckPicker.getLastPickedObject({x:s.x,y:s.y,layers:c,viewports:this.getViewports(s)},this._lastPointerDownInfo),{layer:l}=d,y=l&&(l[i.handler]||l.props[i.handler]),w=this.props[i.handler];let S=!1;y&&(S=y.call(l,d,n)),!S&&w&&w(d,n)}),$(this,"_onPointerDown",n=>{const i=n.offsetCenter,s=this._pick("pickObject","pickObject Time",{x:i.x,y:i.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=s.result[0]||s.emptyInfo}),this.props={..._I,...e},e=this.props,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this.cursorState={isHovering:!1,isDragging:!1},e.viewState&&e.initialViewState&&fn.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),iP()==="IE"&&fn.warn("IE 11 is not supported")(),this.viewState=e.initialViewState,e.gl||typeof document<"u"&&(this.canvas=this._createCanvas(e)),this.animationLoop=this._createAnimationLoop(e),this.stats=new Ax({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this.setProps(e),e._typedArrayManagerProps&&Fu.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){var e,n,i,s,c,d,l,y;if((e=this.animationLoop)===null||e===void 0||e.stop(),this.animationLoop=null,this._lastPointerDownInfo=null,(n=this.layerManager)===null||n===void 0||n.finalize(),this.layerManager=null,(i=this.viewManager)===null||i===void 0||i.finalize(),this.viewManager=null,(s=this.effectManager)===null||s===void 0||s.finalize(),this.effectManager=null,(c=this.deckRenderer)===null||c===void 0||c.finalize(),this.deckRenderer=null,(d=this.deckPicker)===null||d===void 0||d.finalize(),this.deckPicker=null,(l=this.eventManager)===null||l===void 0||l.destroy(),this.eventManager=null,(y=this.tooltip)===null||y===void 0||y.remove(),this.tooltip=null,!this.props.canvas&&!this.props.gl&&this.canvas){var w;(w=this.canvas.parentElement)===null||w===void 0||w.removeChild(this.canvas),this.canvas=null}}setProps(e){this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&fn.removed("onLayerHover","onHover")(),"onLayerClick"in e&&fn.removed("onLayerClick","onClick")(),e.initialViewState&&!vo(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const n=Object.create(this.props);Object.assign(n,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop.setProps(n),this.layerManager&&(this.viewManager.setProps(n),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(n),this.effectManager.setProps(n),this.deckRenderer.setProps(n),this.deckPicker.setProps(n)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const i=this.viewManager.needsRedraw(e),s=this.layerManager.needsRedraw(e),c=this.effectManager.needsRedraw(e),d=this.deckRenderer.needsRedraw(e);return n=n||i||s||c||d,n}redraw(e){if(!this.layerManager)return;let n=this.needsRedraw({clearRedrawFlags:!0});n=e||n,n&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(n):this._drawLayers(n))}get isInitialized(){return this.viewManager!==null}getViews(){return Di(this.viewManager),this.viewManager.views}getViewports(e){return Di(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const n=this._pick("pickObject","pickObject Time",e).result;return n.length?n[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,n=!1){for(const i in e)this.layerManager.resourceManager.add({resourceId:i,data:e[i],forceUpdate:n})}_removeResources(e){for(const n of e)this.layerManager.resourceManager.remove(n)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_pick(e,n,i){Di(this.deckPicker);const{stats:s}=this;s.get("Pick Count").incrementCount(),s.get(n).timeStart();const c=this.deckPicker[e]({layers:this.layerManager.getLayers(i),views:this.viewManager.getViews(),viewports:this.getViewports(i),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...i});return s.get(n).timeEnd(),c}_createCanvas(e){let n=e.canvas;return typeof n=="string"&&(n=document.getElementById(n),Di(n)),n||(n=document.createElement("canvas"),n.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(n)),Object.assign(n.style,e.style),n}_setCanvasSize(e){if(!this.canvas)return;const{width:n,height:i}=e;if(n||n===0){const c=Number.isFinite(n)?"".concat(n,"px"):n;this.canvas.style.width=c}if(i||i===0){var s;const c=Number.isFinite(i)?"".concat(i,"px"):i;this.canvas.style.position=((s=e.style)===null||s===void 0?void 0:s.position)||"absolute",this.canvas.style.height=c}}_updateCanvasSize(){var e,n;const{canvas:i}=this;if(!i)return;const s=(e=i.clientWidth)!==null&&e!==void 0?e:i.width,c=(n=i.clientHeight)!==null&&n!==void 0?n:i.height;if(s!==this.width||c!==this.height){var d,l;this.width=s,this.height=c,(d=this.viewManager)===null||d===void 0||d.setProps({width:s,height:c}),(l=this.layerManager)===null||l===void 0||l.activateViewport(this.getViewports()[0]),this.props.onResize({width:s,height:c})}}_createAnimationLoop(e){const{width:n,height:i,gl:s,glOptions:c,debug:d,onError:l,onBeforeRender:y,onAfterRender:w,useDevicePixels:S}=e;return new iF({width:n,height:i,useDevicePixels:S,autoResizeDrawingBuffer:!s,autoResizeViewport:!1,gl:s,onCreateContext:C=>uP({...c,...C,canvas:this.canvas,debug:d,onContextLost:()=>this._onContextLost()}),onInitialize:C=>this._setGLContext(C.gl),onRender:this._onRenderFrame.bind(this),onBeforeRender:y,onAfterRender:w,onError:l})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){let e=this.props.views||[new hI({id:"default-view"})];return e=Array.isArray(e)?e:[e],e.length&&this.props.controller&&(e[0].props.controller=this.props.controller),e}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){const{_pickRequest:e}=this;if(e.event){const{result:i,emptyInfo:s}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=i.length>0;let c=s,d=!1;for(const l of i){var n;c=l,d=((n=l.layer)===null||n===void 0?void 0:n.onHover(l,e.event))||d}if(!d&&this.props.onHover&&this.props.onHover(c,e.event),this.props.getTooltip&&this.tooltip){const l=this.props.getTooltip(c);this.tooltip.setTooltip(l,c.x,c.y)}e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setGLContext(e){if(this.layerManager)return;this.canvas||(this.canvas=e.canvas,Sx(e,{enable:!0,copyState:!0})),this.tooltip=new I6(this.canvas),Qo(e,{blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onWebGLInitialized(e);const n=new WP;n.play(),this.animationLoop.attachTimeline(n),this.eventManager=new uU(this.props.parent||e.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const s in sE)this.eventManager.on(s,this._onEvent);this.viewManager=new n6({timeline:n,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const i=this.viewManager.getViewports()[0];this.layerManager=new t6(e,{deck:this,stats:this.stats,viewport:i,timeline:n}),this.effectManager=new _6,this.deckRenderer=new x6(e),this.deckPicker=new A6(e),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,n){const{gl:i}=this.layerManager.context;Qo(i,this.props.parameters),this.props.onBeforeRender({gl:i}),this.deckRenderer.renderLayers({target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...n}),this.props.onAfterRender({gl:i})}_onRenderFrame(e){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),fn.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.tooltip.isVisible&&this.viewManager.needsRedraw()&&this.tooltip.setTooltip(null),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const n=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:n},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const n=this.animationLoop.stats;e.get("GPU Time").addTime(n.get("GPU Time").lastTiming),e.get("CPU Time").addTime(n.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:n}=this;e.fps=n.get("frameRate").getHz(),e.setPropsTime=n.get("setProps Time").time,e.updateAttributesTime=n.get("Update Attributes").time,e.framesRedrawn=n.get("Redraw Count").count,e.pickTime=n.get("pickObject Time").time+n.get("pickMultipleObjects Time").time+n.get("pickObjects Time").time,e.pickCount=n.get("Pick Count").count,e.gpuTime=n.get("GPU Time").time,e.cpuTime=n.get("CPU Time").time,e.gpuTimePerFrame=n.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=n.get("CPU Time").getAverageTime();const i=Nl.get("Memory Usage");e.bufferMemory=i.get("Buffer Memory").count,e.textureMemory=i.get("Texture Memory").count,e.renderbufferMemory=i.get("Renderbuffer Memory").count,e.gpuMemory=i.get("GPU Memory").count}}$(Ig,"defaultProps",_I);$(Ig,"VERSION",cz);class Oy{constructor(e,n){$(this,"opts",void 0),$(this,"source",void 0),this.opts=n,this.source=e}get value(){return this.source.value}getValue(){const e=this.source.getBuffer(),n=this.getAccessor();if(e)return[e,n];const{value:i}=this.source,{size:s}=n;let c=i;if(i&&i.length!==s){c=new Float32Array(s);const d=n.elementOffset||0;for(let l=0;l<s;++l)c[l]=i[d+l]}return c}getAccessor(){return{...this.source.getAccessor(),...this.opts}}}function dU(t){switch(t){case 5126:return Float32Array;case 5130:return Float64Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return Uint8ClampedArray;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Unknown GL type")}}function pm(t){return t.stride||t.size*t.bytesPerElement}function yI(t,e){e.offset&&fn.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const n=pm(t),i=e.vertexOffset!==void 0?e.vertexOffset:t.vertexOffset||0,s=e.elementOffset||0,c=i*n+s*t.bytesPerElement+(t.offset||0);return{...e,offset:c,stride:n}}function fU(t,e){const n=yI(t,e);return{high:n,low:{...n,offset:n.offset+t.size*4}}}class pU{constructor(e,n,i){$(this,"gl",void 0),$(this,"id",void 0),$(this,"size",void 0),$(this,"settings",void 0),$(this,"value",void 0),$(this,"doublePrecision",void 0),$(this,"_buffer",void 0),$(this,"state",void 0),this.gl=e,this.id=n.id||"",this.size=n.size||1;const s=n.logicalType||n.type,c=s===5130;let{defaultValue:d}=n;d=Number.isFinite(d)?[d]:d||new Array(this.size).fill(0);let l;c?l=5126:!s&&n.isIndexed?l=e&&RO(e,gn.ELEMENT_INDEX_UINT32)?5125:5123:l=s||5126;let y=dU(s||l||5126);this.doublePrecision=c,c&&n.fp64===!1&&(y=Float32Array),this.value=null,this.settings={...n,defaultType:y,defaultValue:d,logicalType:s,type:l,size:this.size,bytesPerElement:y.BYTES_PER_ELEMENT},this.state={...i,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1},this._buffer=null}get isConstant(){return this.state.constant}get buffer(){if(!this._buffer){const{isIndexed:e,type:n}=this.settings;this._buffer=new vn(this.gl,{id:this.id,target:e?34963:34962,accessor:{type:n}})}return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*pm(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),Fu.release(this.state.allocatedValue)}getShaderAttributes(e,n){if(this.doublePrecision){const i={},s=this.value instanceof Float64Array,c=fU(this.getAccessor(),n||{});return i[e]=new Oy(this,c.high),i["".concat(e,"64Low")]=s?new Oy(this,c.low):new Float32Array(this.size),i}if(n){const i=yI(this.getAccessor(),n);return{[e]:new Oy(this,i)}}return{[e]:this}}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(){return this.state.constant?this.value:[this.getBuffer(),this.getAccessor()]}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const n=Array.from(this.value);e=[n,n]}else{const{value:n,numInstances:i,size:s}=this,c=i*s;if(n&&c&&n.length>=c){const d=new Array(s).fill(1/0),l=new Array(s).fill(-1/0);for(let y=0;y<c;)for(let w=0;w<s;w++){const S=n[y++];S<d[w]&&(d[w]=S),S>l[w]&&(l[w]=S)}e=[d,l]}}return this.state.bounds=e,e}setData(e){const{state:n}=this;let i;ArrayBuffer.isView(e)?i={value:e}:e instanceof vn?i={buffer:e}:i=e;const s={...this.settings,...i};if(n.bufferAccessor=s,n.bounds=null,i.constant){let c=i.value;if(c=this._normalizeValue(c,[],0),this.settings.normalized&&(c=this.normalizeConstant(c)),!(!n.constant||!this._areValuesEqual(c,this.value)))return!1;n.externalBuffer=null,n.constant=!0,this.value=c}else if(i.buffer){const c=i.buffer;n.externalBuffer=c,n.constant=!1,this.value=i.value||null;const d=i.value instanceof Float64Array;s.type=i.type||c.accessor.type,s.bytesPerElement=c.accessor.BYTES_PER_ELEMENT*(d?2:1),s.stride=pm(s)}else if(i.value){this._checkExternalBuffer(i);let c=i.value;n.externalBuffer=null,n.constant=!1,this.value=c,s.bytesPerElement=c.BYTES_PER_ELEMENT,s.stride=pm(s);const{buffer:d,byteOffset:l}=this;this.doublePrecision&&c instanceof Float64Array&&(c=ky(c,s));const y=c.byteLength+l+s.stride*2;d.byteLength<y&&d.reallocate(y),d.setAccessor(null),d.subData({data:c,offset:l}),s.type=i.type||d.accessor.type}return!0}updateSubBuffer(e={}){this.state.bounds=null;const n=this.value,{startOffset:i=0,endOffset:s}=e;this.buffer.subData({data:this.doublePrecision&&n instanceof Float64Array?ky(n,{size:this.size,startIndex:i,endIndex:s}):n.subarray(i,s),offset:i*n.BYTES_PER_ELEMENT+this.byteOffset})}allocate(e,n=!1){const{state:i}=this,s=i.allocatedValue,c=Fu.allocate(s,e+1,{size:this.size,type:this.settings.defaultType,copy:n});this.value=c;const{buffer:d,byteOffset:l}=this;return d.byteLength<c.byteLength+l&&(d.reallocate(c.byteLength+l),n&&s&&d.subData({data:s instanceof Float64Array?ky(s,this):s,offset:l})),i.allocatedValue=c,i.constant=!1,i.externalBuffer=null,i.bufferAccessor=this.settings,!0}_checkExternalBuffer(e){const{value:n}=e;if(!ArrayBuffer.isView(n))throw new Error("Attribute ".concat(this.id," value is not TypedArray"));const i=this.settings.defaultType;let s=!1;if(this.doublePrecision&&(s=n.BYTES_PER_ELEMENT<4),s)throw new Error("Attribute ".concat(this.id," does not support ").concat(n.constructor.name));!(n instanceof i)&&this.settings.normalized&&!("normalized"in e)&&fn.warn("Attribute ".concat(this.id," is normalized"))()}normalizeConstant(e){switch(this.settings.type){case 5120:return new Float32Array(e).map(n=>(n+128)/255*2-1);case 5122:return new Float32Array(e).map(n=>(n+32768)/65535*2-1);case 5121:return new Float32Array(e).map(n=>n/255);case 5123:return new Float32Array(e).map(n=>n/65535);default:return e}}_normalizeValue(e,n,i){const{defaultValue:s,size:c}=this.settings;if(Number.isFinite(e))return n[i]=e,n;if(!e){let d=c;for(;--d>=0;)n[i+d]=s[d];return n}switch(c){case 4:n[i+3]=Number.isFinite(e[3])?e[3]:s[3];case 3:n[i+2]=Number.isFinite(e[2])?e[2]:s[2];case 2:n[i+1]=Number.isFinite(e[1])?e[1]:s[1];case 1:n[i+0]=Number.isFinite(e[0])?e[0]:s[0];break;default:let d=c;for(;--d>=0;)n[i+d]=Number.isFinite(e[d])?e[d]:s[d]}return n}_areValuesEqual(e,n){if(!e||!n)return!1;const{size:i}=this;for(let s=0;s<i;s++)if(e[s]!==n[s])return!1;return!0}}const ET=[],TT=[];function Ux(t,e=0,n=1/0){let i=ET;const s={index:-1,data:t,target:[]};return t?typeof t[Symbol.iterator]=="function"?i=t:t.length>0&&(TT.length=t.length,i=TT):i=ET,(e>0||Number.isFinite(n))&&(i=(Array.isArray(i)?i:Array.from(i)).slice(e,n),s.index=e-1),{iterable:i,objectInfo:s}}function vI(t){return t&&t[Symbol.asyncIterator]}function xI(t,e){const{size:n,stride:i,offset:s,startIndices:c,nested:d}=e,l=t.BYTES_PER_ELEMENT,y=i?i/l:n,w=s?s/l:0,S=Math.floor((t.length-w)/y);return(C,{index:P,target:D})=>{if(!c){const G=P*y+w;for(let V=0;V<n;V++)D[V]=t[G+V];return D}const U=c[P],H=c[P+1]||S;let ae;if(d){ae=new Array(H-U);for(let G=U;G<H;G++){const V=G*y+w;D=new Array(n);for(let W=0;W<n;W++)D[W]=t[V+W];ae[G-U]=D}}else if(y===n)ae=t.subarray(U*n+w,H*n+w);else{ae=new t.constructor((H-U)*n);let G=0;for(let V=U;V<H;V++){const W=V*y+w;for(let ie=0;ie<n;ie++)ae[G++]=t[W+ie]}}return ae}}const mU=[],mm=[[0,1/0]];function gU(t,e){if(t===mm||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return t;const n=[],i=t.length;let s=0;for(let c=0;c<i;c++){const d=t[c];d[1]<e[0]?(n.push(d),s=c+1):d[0]>e[1]?n.push(d):e=[Math.min(d[0],e[0]),Math.max(d[1],e[1])]}return n.splice(s,0,e),n}function Fy(t){const{source:e,target:n,start:i=0,size:s,getData:c}=t,d=t.end||n.length,l=e.length,y=d-i;if(l>y){n.set(e.subarray(0,y),i);return}if(n.set(e,i),!c)return;let w=l;for(;w<y;){const S=c(w,e);for(let C=0;C<s;C++)n[i+w]=S[C]||0,w++}}function _U({source:t,target:e,size:n,getData:i,sourceStartIndices:s,targetStartIndices:c}){if(!Array.isArray(c))return Fy({source:t,target:e,size:n,getData:i}),e;let d=0,l=0;const y=i&&((S,C)=>i(S+l,C)),w=Math.min(s.length,c.length);for(let S=1;S<w;S++){const C=s[S]*n,P=c[S]*n;Fy({source:t.subarray(d,C),target:e,start:l,end:P,size:n,getData:y}),d=C,l=P}return l<e.length&&Fy({source:[],target:e,start:l,size:n,getData:y}),e}const yU={interpolation:{duration:0,easing:t=>t},spring:{stiffness:.05,damping:.5}};function bI(t,e){if(!t)return null;Number.isFinite(t)&&(t={type:"interpolation",duration:t});const n=t.type||"interpolation";return{...yU[n],...e,...t,type:n}}function wI(t,e){const n=e.getBuffer();return n?[n,{divisor:0,size:e.size,normalized:e.settings.normalized}]:e.value}function EI(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error('No defined attribute type for size "'.concat(t,'"'))}}function TI(t){t.push(t.shift())}function Vx(t,e){const{doublePrecision:n,settings:i,value:s,size:c}=t,d=n&&s instanceof Float64Array?2:1;return(i.noAlloc?s.length:e*c)*d}function SI({buffer:t,numInstances:e,attribute:n,fromLength:i,fromStartIndices:s,getData:c=d=>d}){const d=n.doublePrecision&&n.value instanceof Float64Array?2:1,l=n.size*d,y=n.byteOffset,w=n.startIndices,S=s&&w,C=Vx(n,e),P=n.isConstant;if(!S&&i>=C)return;const D=P?n.value:n.getBuffer().getData({srcByteOffset:y});if(n.settings.normalized&&!P){const G=c;c=(V,W)=>n.normalizeConstant(G(V,W))}const U=P?(G,V)=>c(D,V):(G,V)=>c(D.subarray(G,G+l),V),H=t.getData({length:i}),ae=new Float32Array(C);_U({source:H,target:ae,sourceStartIndices:s,targetStartIndices:w,size:l,getData:U}),t.byteLength<ae.byteLength+y&&t.reallocate(ae.byteLength+y),t.subData({data:ae,offset:y})}class jx extends pU{constructor(e,n){super(e,n,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,updateRanges:mm}),$(this,"constant",!1),this.settings.update=n.update||(n.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const n=this.state.needsRedraw;return this.state.needsRedraw=n&&!e,n}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:n}=this.settings,i=this.settings.transition,s=Array.isArray(n)?e[n.find(c=>e[c])]:e[n];return bI(s,i)}setNeedsUpdate(e=this.id,n){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),n){const{startRow:i=0,endRow:s=1/0}=n;this.state.updateRanges=gU(this.state.updateRanges,[i,s])}else this.state.updateRanges=mm}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=mU}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:n,settings:i}=this;return i.noAlloc?!1:i.update?(super.allocate(e,n.updateRanges!==mm),!0):!1}updateBuffer({numInstances:e,data:n,props:i,context:s}){if(!this.needsUpdate())return!1;const{state:{updateRanges:c},settings:{update:d,noAlloc:l}}=this;let y=!0;if(d){for(const[w,S]of c)d.call(s,this,{data:n,startRow:w,endRow:S,props:i,numInstances:e});if(this.value)if(this.constant||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[w,S]of c){const C=Number.isFinite(w)?this.getVertexOffset(w):0,P=Number.isFinite(S)?this.getVertexOffset(S):l||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:C,endOffset:P})}this._checkAttributeArray()}else y=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),y}setConstantValue(e){return e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:n}=this;return e?(this.clearNeedsUpdate(),n.lastExternalBuffer===e||(n.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(n.lastExternalBuffer=null,!1)}setBinaryValue(e,n=null){const{state:i,settings:s}=this;if(!e)return i.binaryValue=null,i.binaryAccessor=null,!1;if(s.noAlloc)return!1;if(i.binaryValue===e)return this.clearNeedsUpdate(),!0;if(i.binaryValue=e,this.setNeedsRedraw(),s.transform||n!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const d=e;Di(ArrayBuffer.isView(d.value),"invalid ".concat(s.accessor));const l=!!d.size&&d.size!==this.size;return i.binaryAccessor=xI(d.value,{size:d.size||this.size,stride:d.stride,offset:d.offset,startIndices:n,nested:l}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:n}=this;return(n?e<n.length?n[e]:this.numInstances:e)*this.size}getShaderAttributes(){const e=this.settings.shaderAttributes||{[this.id]:null},n={};for(const i in e)Object.assign(n,super.getShaderAttributes(i,e[i]));return n}_autoUpdater(e,{data:n,startRow:i,endRow:s,props:c,numInstances:d}){if(e.constant)return;const{settings:l,state:y,value:w,size:S,startIndices:C}=e,{accessor:P,transform:D}=l,U=y.binaryAccessor||(typeof P=="function"?P:c[P]);Di(typeof U=="function",'accessor "'.concat(P,'" is not a function'));let H=e.getVertexOffset(i);const{iterable:ae,objectInfo:G}=Ux(n,i,s);for(const V of ae){G.index++;let W=U(V,G);if(D&&(W=D.call(this,W)),C){const ie=(G.index<C.length-1?C[G.index+1]:d)-C[G.index];if(W&&Array.isArray(W[0])){let ge=H;for(const be of W)e._normalizeValue(be,w,ge),ge+=S}else W&&W.length>S?w.set(W,H):(e._normalizeValue(W,G.target,0),$5({target:w,source:G.target,start:H,count:ie}));H+=ie*S}else e._normalizeValue(W,w,H),H+=S}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error("Attribute ".concat(this.id," missing update or accessor"))}_checkAttributeArray(){const{value:e}=this,n=Math.min(4,this.size);if(e&&e.length>=n){let i=!0;switch(n){case 4:i=i&&Number.isFinite(e[3]);case 3:i=i&&Number.isFinite(e[2]);case 2:i=i&&Number.isFinite(e[1]);case 1:i=i&&Number.isFinite(e[0]);break;default:i=!1}if(!i)throw new Error("Illegal attribute generated for ".concat(this.id))}}}class vU{constructor({gl:e,attribute:n,timeline:i}){$(this,"gl",void 0),$(this,"type","interpolation"),$(this,"attributeInTransition",void 0),$(this,"settings",void 0),$(this,"attribute",void 0),$(this,"transition",void 0),$(this,"currentStartIndices",void 0),$(this,"currentLength",void 0),$(this,"transform",void 0),$(this,"buffers",void 0),this.gl=e,this.transition=new af(i),this.attribute=n,this.attributeInTransition=new jx(e,n.settings),this.currentStartIndices=n.startIndices,this.currentLength=0,this.transform=bU(e,n);const s={byteLength:0,usage:35050};this.buffers=[new vn(e,s),new vn(e,s)]}get inProgress(){return this.transition.inProgress}start(e,n){if(e.duration<=0){this.transition.cancel();return}this.settings=e;const{gl:i,buffers:s,attribute:c}=this;TI(s);const d={numInstances:n,attribute:c,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter};for(const l of s)SI({buffer:l,...d});this.currentStartIndices=c.startIndices,this.currentLength=Vx(c,n),this.attributeInTransition.setData({buffer:s[1],value:c.value}),this.transition.start(e),this.transform.update({elementCount:Math.floor(this.currentLength/c.size),sourceBuffers:{aFrom:s[0],aTo:wI(i,c)},feedbackBuffers:{vCurrent:s[1]}})}update(){const e=this.transition.update();if(e){const{duration:n,easing:i}=this.settings,{time:s}=this.transition;let c=s/n;i&&(c=i(c)),this.transform.run({uniforms:{time:c}})}return e}cancel(){this.transition.cancel(),this.transform.delete();for(const e of this.buffers)e.delete();this.buffers.length=0}}const xU=`
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
attribute ATTRIBUTE_TYPE aFrom;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, time);
  gl_Position = vec4(0.0);
}
`;function bU(t,e){const n=EI(e.size);return new Ag(t,{vs:xU,defines:{ATTRIBUTE_TYPE:n},varyings:["vCurrent"]})}class wU{constructor({gl:e,attribute:n,timeline:i}){$(this,"gl",void 0),$(this,"type","spring"),$(this,"attributeInTransition",void 0),$(this,"settings",void 0),$(this,"attribute",void 0),$(this,"transition",void 0),$(this,"currentStartIndices",void 0),$(this,"currentLength",void 0),$(this,"texture",void 0),$(this,"framebuffer",void 0),$(this,"transform",void 0),$(this,"buffers",void 0),this.gl=e,this.type="spring",this.transition=new af(i),this.attribute=n,this.attributeInTransition=new jx(e,{...n.settings,normalized:!1}),this.currentStartIndices=n.startIndices,this.currentLength=0,this.texture=TU(e),this.framebuffer=SU(e,this.texture),this.transform=EU(e,n,this.framebuffer);const s={byteLength:0,usage:35050};this.buffers=[new vn(e,s),new vn(e,s),new vn(e,s)]}get inProgress(){return this.transition.inProgress}start(e,n){const{gl:i,buffers:s,attribute:c}=this,d={numInstances:n,attribute:c,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter};for(const l of s)SI({buffer:l,...d});this.settings=e,this.currentStartIndices=c.startIndices,this.currentLength=Vx(c,n),this.attributeInTransition.setData({buffer:s[1],value:c.value}),this.transition.start({...e,duration:1/0}),this.transform.update({elementCount:Math.floor(this.currentLength/c.size),sourceBuffers:{aTo:wI(i,c)}})}update(){const{buffers:e,transform:n,framebuffer:i,transition:s}=this;if(!s.update())return!1;const d=this.settings;return n.update({sourceBuffers:{aPrev:e[0],aCur:e[1]},feedbackBuffers:{vNext:e[2]}}),n.run({framebuffer:i,discard:!1,clearRenderTarget:!0,uniforms:{stiffness:d.stiffness,damping:d.damping},parameters:{depthTest:!1,blend:!0,viewport:[0,0,1,1],blendFunc:[1,1],blendEquation:[32776,32776]}}),TI(e),this.attributeInTransition.setData({buffer:e[1],value:this.attribute.value}),Sg(i)[0]>0||s.end(),!0}cancel(){this.transition.cancel(),this.transform.delete();for(const e of this.buffers)e.delete();this.buffers.length=0,this.texture.delete(),this.framebuffer.delete()}}function EU(t,e,n){const i=EI(e.size);return new Ag(t,{framebuffer:n,vs:`
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

uniform float stiffness;
uniform float damping;
attribute ATTRIBUTE_TYPE aPrev;
attribute ATTRIBUTE_TYPE aCur;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vNext;
varying float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE spring = delta * stiffness;
  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;
  return spring + damper + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,fs:`
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

varying float vIsTransitioningFlag;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  gl_FragColor = vec4(1.0);
}`,defines:{ATTRIBUTE_TYPE:i},varyings:["vNext"]})}function TU(t){return new Ls(t,{data:new Uint8Array(4),format:6408,type:5121,border:0,mipmaps:!1,dataFormat:6408,width:1,height:1})}function SU(t,e){return new _i(t,{id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,attachments:{36064:e}})}const AU={interpolation:vU,spring:wU};class PU{constructor(e,{id:n,timeline:i}){$(this,"id",void 0),$(this,"isSupported",void 0),$(this,"gl",void 0),$(this,"timeline",void 0),$(this,"transitions",void 0),$(this,"needsRedraw",void 0),$(this,"numInstances",void 0),this.id=n,this.gl=e,this.timeline=i,this.transitions={},this.needsRedraw=!1,this.numInstances=1,this.isSupported=Ag.isSupported(e)}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:n,numInstances:i}){this.numInstances=i||1;for(const s in e){const c=e[s],d=c.getTransitionSetting(n);d&&this._updateAttribute(s,c,d)}for(const s in this.transitions){const c=e[s];(!c||!c.getTransitionSetting(n))&&this._removeTransition(s)}}hasAttribute(e){const n=this.transitions[e];return n&&n.inProgress}getAttributes(){const e={};for(const n in this.transitions){const i=this.transitions[n];i.inProgress&&(e[n]=i.attributeInTransition)}return e}run(){if(!this.isSupported||this.numInstances===0)return!1;for(const n in this.transitions)this.transitions[n].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].cancel(),delete this.transitions[e]}_updateAttribute(e,n,i){const s=this.transitions[e];let c=!s||s.type!==i.type;if(c){if(!this.isSupported){fn.warn("WebGL2 not supported by this browser. Transition for ".concat(e," is disabled."))();return}s&&this._removeTransition(e);const d=AU[i.type];d?this.transitions[e]=new d({attribute:n,timeline:this.timeline,gl:this.gl}):(fn.error("unsupported transition type '".concat(i.type,"'"))(),c=!1)}(c||n.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(i,this.numInstances))}}const ST="attributeManager.invalidate",IU="attributeManager.updateStart",CU="attributeManager.updateEnd",MU="attribute.updateStart",LU="attribute.allocate",kU="attribute.updateEnd";class AI{constructor(e,{id:n="attribute-manager",stats:i,timeline:s}={}){$(this,"id",void 0),$(this,"gl",void 0),$(this,"attributes",void 0),$(this,"updateTriggers",void 0),$(this,"needsRedraw",void 0),$(this,"userData",void 0),$(this,"stats",void 0),$(this,"attributeTransitionManager",void 0),$(this,"mergeBoundsMemoized",of(F5)),this.id=n,this.gl=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=i,this.attributeTransitionManager=new PU(e,{id:"".concat(n,"-transitions"),timeline:s}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const n=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,n&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{instanced:1})}remove(e){for(const n of e)this.attributes[n]!==void 0&&(this.attributes[n].delete(),delete this.attributes[n])}invalidate(e,n){const i=this._invalidateTrigger(e,n);rr(ST,this,e,i)}invalidateAll(e){for(const n in this.attributes)this.attributes[n].setNeedsUpdate(n,e);rr(ST,this,"all")}update({data:e,numInstances:n,startIndices:i=null,transitions:s,props:c={},buffers:d={},context:l={}}){let y=!1;rr(IU,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const w in this.attributes){const S=this.attributes[w],C=S.settings.accessor;S.startIndices=i,S.numInstances=n,c[w]&&fn.removed("props.".concat(w),"data.attributes.".concat(w))(),S.setExternalBuffer(d[w])||S.setBinaryValue(typeof C=="string"?d[C]:void 0,e.startIndices)||typeof C=="string"&&!d[C]&&S.setConstantValue(c[C])||S.needsUpdate()&&(y=!0,this._updateAttribute({attribute:S,numInstances:n,data:e,props:c,context:l})),this.needsRedraw=this.needsRedraw||S.needsRedraw()}y&&rr(CU,this,n),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:n,transitions:s})}updateTransition(){const{attributeTransitionManager:e}=this,n=e.run();return this.needsRedraw=this.needsRedraw||n,n}getAttributes(){return this.attributes}getBounds(e){const n=e.map(i=>{var s;return(s=this.attributes[i])===null||s===void 0?void 0:s.getBounds()});return this.mergeBoundsMemoized(n)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:n,attributeTransitionManager:i}=this,s={...i.getAttributes()};for(const c in n){const d=n[c];d.needsRedraw(e)&&!i.hasAttribute(c)&&(s[c]=d)}return s}getShaderAttributes(e,n={}){e||(e=this.getAttributes());const i={};for(const s in e)n[s]||Object.assign(i,e[s].getShaderAttributes());return i}_add(e,n={}){for(const i in e){const s=e[i];this.attributes[i]=this._createAttribute(i,s,n)}this._mapUpdateTriggersToAttributes()}_createAttribute(e,n,i){const s={...n,id:e,size:n.isIndexed&&1||n.size||1,divisor:i.instanced?1:n.divisor||0};return new jx(this.gl,s)}_mapUpdateTriggersToAttributes(){const e={};for(const n in this.attributes)this.attributes[n].getUpdateTriggers().forEach(s=>{e[s]||(e[s]=[]),e[s].push(n)});this.updateTriggers=e}_invalidateTrigger(e,n){const{attributes:i,updateTriggers:s}=this,c=s[e];return c&&c.forEach(d=>{const l=i[d];l&&l.setNeedsUpdate(l.id,n)}),c}_updateAttribute(e){const{attribute:n,numInstances:i}=e;if(rr(MU,n),n.constant){n.setConstantValue(n.value);return}n.allocate(i)&&rr(LU,n,i),n.updateBuffer(e)&&(this.needsRedraw=!0,rr(kU,n,i))}}class RU extends af{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:n,toValue:i,duration:s,easing:c}}=this,d=c(e/s);this._value=Vd(n,i,d)}}const AT=1e-5;function PT(t,e,n,i,s){const c=e-t,l=(n-e)*s,y=-c*i;return l+y+c+e}function DU(t,e,n,i,s){if(Array.isArray(n)){const c=[];for(let d=0;d<n.length;d++)c[d]=PT(t[d],e[d],n[d],i,s);return c}return PT(t,e,n,i,s)}function IT(t,e){if(Array.isArray(t)){let n=0;for(let i=0;i<t.length;i++){const s=t[i]-e[i];n+=s*s}return Math.sqrt(n)}return Math.abs(t-e)}class zU extends af{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:n,damping:i,stiffness:s}=this.settings,{_prevValue:c=e,_currValue:d=e}=this;let l=DU(c,d,n,i,s);const y=IT(l,n),w=IT(l,d);y<AT&&w<AT&&(l=n,this.end()),this._prevValue=d,this._currValue=l}}const OU={interpolation:RU,spring:zU};class FU{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,n,i,s){const{transitions:c}=this;if(c.has(e)){const y=c.get(e),{value:w=y.settings.fromValue}=y;n=w,this.remove(e)}if(s=bI(s),!s)return;const d=OU[s.type];if(!d){fn.error("unsupported transition type '".concat(s.type,"'"))();return}const l=new d(this.timeline);l.start({...s,fromValue:n,toValue:i}),c.set(e,l)}remove(e){const{transitions:n}=this;n.has(e)&&(n.get(e).cancel(),n.delete(e))}update(){const e={};for(const[n,i]of this.transitions)i.update(),e[n]=i.value,i.inProgress||this.remove(n);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function NU(t){const e=t[Za];for(const n in e){const i=e[n],{validate:s}=i;if(s&&!s(t[n],i))throw new Error("Invalid prop ".concat(n,": ").concat(t[n]))}}function BU(t,e){const n=Gx({newProps:t,oldProps:e,propTypes:t[Za],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),i=VU(t,e);let s=!1;return i||(s=jU(t,e)),{dataChanged:i,propsChanged:n,updateTriggersChanged:s,extensionsChanged:GU(t,e),transitionsChanged:UU(t,e)}}function UU(t,e){if(!t.transitions)return!1;const n={},i=t[Za];let s=!1;for(const c in t.transitions){const d=i[c],l=d&&d.type;(l==="number"||l==="color"||l==="array")&&cv(t[c],e[c],d)&&(n[c]=!0,s=!0)}return s?n:!1}function Gx({newProps:t,oldProps:e,ignoreProps:n={},propTypes:i={},triggerName:s="props"}){if(e===t)return!1;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return"".concat(s," changed shallowly");for(const c of Object.keys(t))if(!(c in n)){if(!(c in e))return"".concat(s,".").concat(c," added");const d=cv(t[c],e[c],i[c]);if(d)return"".concat(s,".").concat(c," ").concat(d)}for(const c of Object.keys(e))if(!(c in n)){if(!(c in t))return"".concat(s,".").concat(c," dropped");if(!Object.hasOwnProperty.call(t,c)){const d=cv(t[c],e[c],i[c]);if(d)return"".concat(s,".").concat(c," ").concat(d)}}return!1}function cv(t,e,n){let i=n&&n.equal;return i&&!i(t,e,n)||!i&&(i=t&&e&&t.equals,i&&!i.call(t,e))?"changed deeply":!i&&e!==t?"changed shallowly":null}function VU(t,e){if(e===null)return"oldProps is null, initial diff";let n=!1;const{dataComparator:i,_dataDiff:s}=t;return i?i(t.data,e.data)||(n="Data comparator detected a change"):t.data!==e.data&&(n="A new data container was supplied"),n&&s&&(n=s(t.data,e.data)||n),n}function jU(t,e){if(e===null)return{all:!0};if("all"in t.updateTriggers&&CT(t,e,"all"))return{all:!0};const n={};let i=!1;for(const s in t.updateTriggers)s!=="all"&&CT(t,e,s)&&(n[s]=!0,i=!0);return i?n:!1}function GU(t,e){if(e===null)return!0;const n=e.extensions,{extensions:i}=t;if(i===n)return!1;if(!n||!i||i.length!==n.length)return!0;for(let s=0;s<i.length;s++)if(!i[s].equals(n[s]))return!0;return!1}function CT(t,e,n){let i=t.updateTriggers[n];i=i??{};let s=e.updateTriggers[n];return s=s??{},Gx({oldProps:s,newProps:i,triggerName:n})}const WU="count(): argument not an object",HU="count(): argument not a container";function $U(t){if(!ZU(t))throw new Error(WU);if(typeof t.count=="function")return t.count();if(Number.isFinite(t.size))return t.size;if(Number.isFinite(t.length))return t.length;if(qU(t))return Object.keys(t).length;throw new Error(HU)}function qU(t){return t!==null&&typeof t=="object"&&t.constructor===Object}function ZU(t){return t!==null&&typeof t=="object"}function PI(t,e){if(!e)return t;const n={...t,...e};if("defines"in e&&(n.defines={...t.defines,...e.defines}),"modules"in e&&(n.modules=(t.modules||[]).concat(e.modules),e.modules.some(i=>i.name==="project64"))){const i=n.modules.findIndex(s=>s.name==="project32");i>=0&&n.modules.splice(i,1)}if("inject"in e)if(!t.inject)n.inject=e.inject;else{const i={...t.inject};for(const s in e.inject)i[s]=(i[s]||"")+e.inject[s];n.inject=i}return n}const XU={10241:9987,10240:9729,10242:33071,10243:33071},uv={};function YU(t,e,n,i){if(n instanceof Ls)return n;n.constructor&&n.constructor.name!=="Object"&&(n={data:n});let s=null;n.compressed&&(s={10241:n.data.length>1?9985:9729});const c=new Ls(e,{...n,parameters:{...XU,...s,...i}});return uv[c.id]=t,c}function KU(t,e){!e||!(e instanceof Ls)||uv[e.id]===t&&(e.delete(),delete uv[e.id])}const JU={boolean:{validate(t,e){return!0},equal(t,e,n){return!!t==!!e}},number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},color:{validate(t,e){return e.optional&&!t||hv(t)&&(t.length===3||t.length===4)},equal(t,e,n){return vo(t,e,1)}},accessor:{validate(t,e){const n=tg(t);return n==="function"||n===tg(e.value)},equal(t,e,n){return typeof e=="function"?!0:vo(t,e,1)}},array:{validate(t,e){return e.optional&&!t||hv(t)},equal(t,e,n){const{compare:i}=n,s=Number.isInteger(i)?i:i?1:0;return i?vo(t,e,s):t===e}},object:{equal(t,e,n){if(n.ignore)return!0;const{compare:i}=n,s=Number.isInteger(i)?i:i?1:0;return i?vo(t,e,s):t===e}},function:{validate(t,e){return e.optional&&!t||typeof t=="function"},equal(t,e,n){return!n.compare&&n.ignore!==!1||t===e}},data:{transform:(t,e,n)=>{const{dataTransform:i}=n.props;return i&&t?i(t):t}},image:{transform:(t,e,n)=>{const i=n.context;return!i||!i.gl?null:YU(n.id,i.gl,t,{...e.parameters,...n.props.textureParameters})},release:(t,e,n)=>{KU(n.id,t)}}};function QU(t){const e={},n={},i={};for(const[s,c]of Object.entries(t)){const d=c==null?void 0:c.deprecatedFor;if(d)i[s]=Array.isArray(d)?d:[d];else{const l=eV(s,c);e[s]=l,n[s]=l.value}}return{propTypes:e,defaultProps:n,deprecatedProps:i}}function eV(t,e){switch(tg(e)){case"object":return Kh(t,e);case"array":return Kh(t,{type:"array",value:e,compare:!1});case"boolean":return Kh(t,{type:"boolean",value:e});case"number":return Kh(t,{type:"number",value:e});case"function":return Kh(t,{type:"function",value:e,compare:!0});default:return{name:t,type:"unknown",value:e}}}function Kh(t,e){return"type"in e?{name:t,...JU[e.type],...e}:"value"in e?{name:t,type:tg(e.value),...e}:{name:t,type:"object",value:e}}function hv(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function tg(t){return hv(t)?"array":t===null?"null":typeof t}function tV(t,e){let n;for(let c=e.length-1;c>=0;c--){const d=e[c];"extensions"in d&&(n=d.extensions)}const i=dv(t.constructor,n),s=Object.create(i);s[Qm]=t,s[Yl]={},s[Fa]={};for(let c=0;c<e.length;++c){const d=e[c];for(const l in d)s[l]=d[l]}return Object.freeze(s),s}const nV="_mergedDefaultProps";function dv(t,e){let n=nV;if(e)for(const s of e){const c=s.constructor;c&&(n+=":".concat(c.extensionName||c.name))}const i=II(t,n);return i||(t[n]=iV(t,e||[]))}function iV(t,e){if(!t.prototype)return null;const i=Object.getPrototypeOf(t),s=dv(i),c=II(t,"defaultProps")||{},d=QU(c),l=Object.assign(Object.create(null),s,d.defaultProps),y=Object.assign(Object.create(null),s==null?void 0:s[Za],d.propTypes),w=Object.assign(Object.create(null),s==null?void 0:s[Dy],d.deprecatedProps);for(const S of e){const C=dv(S.constructor);C&&(Object.assign(l,C),Object.assign(y,C[Za]),Object.assign(w,C[Dy]))}return rV(l,t),oV(l,y),sV(l,w),l[Za]=y,l[Dy]=w,e.length===0&&!Wx(t,"_propTypes")&&(t._propTypes=y),l}function rV(t,e){const n=lV(e);Object.defineProperties(t,{id:{writable:!0,value:n}})}function sV(t,e){for(const n in e)Object.defineProperty(t,n,{enumerable:!1,set(i){const s="".concat(this.id,": ").concat(n);for(const c of e[n])Wx(this,c)||(this[c]=i);fn.deprecated(s,e[n].join("/"))()}})}function oV(t,e){const n={},i={};for(const s in e){const c=e[s],{name:d,value:l}=c;c.async&&(n[d]=l,i[d]=aV(d))}t[vu]=n,t[Yl]={},Object.defineProperties(t,i)}function aV(t){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||vI(e)?this[Yl][t]=e:this[Fa][t]=e},get(){if(this[Fa]){if(t in this[Fa])return this[Fa][t]||this[vu][t];if(t in this[Yl]){const e=this[Qm]&&this[Qm].internalState;if(e&&e.hasAsyncProp(t))return e.getAsyncProp(t)||this[vu][t]}}return this[vu][t]}}}function Wx(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function II(t,e){return Wx(t,e)&&t[e]}function lV(t){const e=t.componentName;return e||fn.warn("".concat(t.name,".componentName not specified"))(),e||t.name}let cV=0;class Hx{constructor(...e){$(this,"id",void 0),$(this,"props",void 0),$(this,"count",void 0),this.props=tV(this,e),this.id=this.props.id,this.count=cV++}clone(e){const{props:n}=this,i={};for(const s in n[vu])s in n[Fa]?i[s]=n[Fa][s]:s in n[Yl]&&(i[s]=n[Yl][s]);return new this.constructor({...n,...i,...e})}}$(Hx,"componentName","Component");$(Hx,"defaultProps",{});const uV=Object.freeze({});class hV{constructor(e){$(this,"component",void 0),$(this,"onAsyncPropUpdated",void 0),$(this,"asyncProps",void 0),$(this,"oldProps",void 0),$(this,"oldAsyncProps",void 0),this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const n=this.asyncProps[e];n&&n.type&&n.type.release&&n.type.release(n.resolvedValue,n.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||uV}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const n=this.asyncProps[e];return n&&n.resolvedValue}isAsyncPropLoading(e){if(e){const n=this.asyncProps[e];return!!(n&&n.pendingLoadCount>0&&n.pendingLoadCount!==n.resolvedLoadCount)}for(const n in this.asyncProps)if(this.isAsyncPropLoading(n))return!0;return!1}reloadAsyncProp(e,n){this._watchPromise(e,Promise.resolve(n))}setAsyncProps(e){this.component=e[Qm]||this.component;const n=e[Fa]||{},i=e[Yl]||e,s=e[vu]||{};for(const c in n){const d=n[c];this._createAsyncPropData(c,s[c]),this._updateAsyncProp(c,d),n[c]=this.getAsyncProp(c)}for(const c in i){const d=i[c];this._createAsyncPropData(c,s[c]),this._updateAsyncProp(c,d)}}_fetch(e,n){return null}_onResolve(e,n){}_onError(e,n){}_updateAsyncProp(e,n){if(this._didAsyncInputValueChange(e,n)){if(typeof n=="string"&&(n=this._fetch(e,n)),n instanceof Promise){this._watchPromise(e,n);return}if(vI(n)){this._resolveAsyncIterable(e,n);return}this._setPropValue(e,n)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,n){const i=this.asyncProps[e];return n===i.resolvedValue||n===i.lastValue?!1:(i.lastValue=n,!0)}_setPropValue(e,n){this._freezeAsyncOldProps();const i=this.asyncProps[e];i&&(n=this._postProcessValue(i,n),i.resolvedValue=n,i.pendingLoadCount++,i.resolvedLoadCount=i.pendingLoadCount)}_setAsyncPropValue(e,n,i){const s=this.asyncProps[e];s&&i>=s.resolvedLoadCount&&n!==void 0&&(this._freezeAsyncOldProps(),s.resolvedValue=n,s.resolvedLoadCount=i,this.onAsyncPropUpdated(e,n))}_watchPromise(e,n){const i=this.asyncProps[e];if(i){i.pendingLoadCount++;const s=i.pendingLoadCount;n.then(c=>{this.component&&(c=this._postProcessValue(i,c),this._setAsyncPropValue(e,c,s),this._onResolve(e,c))}).catch(c=>{this._onError(e,c)})}}async _resolveAsyncIterable(e,n){if(e!=="data"){this._setPropValue(e,n);return}const i=this.asyncProps[e];if(!i)return;i.pendingLoadCount++;const s=i.pendingLoadCount;let c=[],d=0;for await(const l of n){if(!this.component)return;const{dataTransform:y}=this.component.props;y?c=y(l,c):c=c.concat(l),Object.defineProperty(c,"__diff",{enumerable:!1,value:[{startRow:d,endRow:c.length}]}),d=c.length,this._setAsyncPropValue(e,c,s)}this._onResolve(e,c)}_postProcessValue(e,n){const i=e.type;return i&&this.component&&(i.release&&i.release(e.resolvedValue,i,this.component),i.transform)?i.transform(n,i,this.component):n}_createAsyncPropData(e,n){if(!this.asyncProps[e]){const s=this.component&&this.component.props[Za];this.asyncProps[e]={type:s&&s[e],lastValue:null,resolvedValue:n,pendingLoadCount:0,resolvedLoadCount:0}}}}class dV extends hV{constructor({attributeManager:e,layer:n}){super(n),$(this,"attributeManager",void 0),$(this,"needsRedraw",void 0),$(this,"needsUpdate",void 0),$(this,"subLayers",void 0),$(this,"usesPickingColorCache",void 0),$(this,"hasPickingBuffer",void 0),$(this,"changeFlags",void 0),$(this,"viewport",void 0),$(this,"uniformTransitions",void 0),$(this,"propsInTransition",void 0),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,n){const i=this.layer,s=i==null?void 0:i.props.fetch;return s?s(n,{propName:e,layer:i}):super._fetch(e,n)}_onResolve(e,n){const i=this.layer;if(i){const s=i.props.onDataLoad;e==="data"&&s&&s(n,{propName:e,layer:i})}}_onError(e,n){const i=this.layer;i&&i.raiseError(n,"loading ".concat(e," of ").concat(this.layer))}}const fV="layer.changeFlag",pV="layer.initialize",mV="layer.update",gV="layer.finalize",_V="layer.matched",MT=2**24-1,yV=Object.freeze([]),vV=of(({oldViewport:t,viewport:e})=>t.equals(e));let po=new Uint8ClampedArray(0);const xV={data:{type:"data",value:yV,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:t=>t&&t.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(t,{propName:e,layer:n,loaders:i,loadOptions:s,signal:c})=>{const{resourceManager:d}=n.context;if(s=s||n.getLoadOptions(),i=i||n.props.loaders,c){var l;s={...s,fetch:{...(l=s)===null||l===void 0?void 0:l.fetch,signal:c}}}let y=d.contains(t);return!y&&!s&&(d.add({resourceId:t,data:B0(t,i),persistent:!1}),y=!0),y?d.subscribe({resourceId:t,onChange:w=>{var S;return(S=n.internalState)===null||S===void 0?void 0:S.reloadAsyncProp(e,w)},consumerId:n.id,requestId:e}):B0(t,i,s)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:Jt.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:t})=>[0,-t*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class Wu extends Hx{constructor(...e){super(...e),$(this,"internalState",null),$(this,"lifecycle",Yc.NO_STATE),$(this,"context",void 0),$(this,"state",void 0),$(this,"parent",null)}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){const e=this.constructor.layerName||this.constructor.name;return"".concat(e,"({id: '").concat(this.props.id,"'})")}project(e){Di(this.internalState);const n=this.internalState.viewport||this.context.viewport,i=sI(e,{viewport:n,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[s,c,d]=eI(i,n.pixelProjectionMatrix);return e.length===2?[s,c]:[s,c,d]}unproject(e){return Di(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,n){Di(this.internalState);const i=this.internalState.viewport||this.context.viewport;return G5(e,{viewport:i,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...n})}get isComposite(){return!1}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){return this.state&&(this.state.models||this.state.model&&[this.state.model])||[]}setModuleParameters(e){for(const n of this.getModels())n.updateModuleSettings(e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===Jt.DEFAULT||e===Jt.LNGLAT||e===Jt.CARTESIAN}onHover(e,n){return this.props.onHover&&this.props.onHover(e,n)||!1}onClick(e,n){return this.props.onClick&&this.props.onClick(e,n)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,n=[]){return n[0]=e+1&255,n[1]=e+1>>8&255,n[2]=e+1>>8>>8&255,n}decodePickingColor(e){Di(e instanceof Uint8Array);const[n,i,s]=e;return n+i*256+s*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:$U(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var e;return(e=this.getAttributeManager())===null||e===void 0?void 0:e.getBounds(["positions","instancePositions"])}getShaders(e){for(const n of this.props.extensions)e=PI(e,n.getShaders.call(this,n));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const n=this.getAttributeManager(),{dataChanged:i}=e.changeFlags;if(i&&n)if(Array.isArray(i))for(const s of i)n.invalidateAll(s);else n.invalidateAll();if(n){const{props:s}=e,c=this.internalState.hasPickingBuffer,d=Number.isInteger(s.highlightedObjectIndex)||s.pickable||s.extensions.some(l=>l.getNeedsPickingBuffer.call(this,l));if(c!==d){this.internalState.hasPickingBuffer=d;const{pickingColors:l,instancePickingColors:y}=n.attributes,w=l||y;w&&(d&&w.constant&&(w.constant=!1,n.invalidate(w.id)),!w.value&&!d&&(w.constant=!0,w.value=[0,0,0]))}}}finalizeState(e){for(const i of this.getModels())i.delete();const n=this.getAttributeManager();n&&n.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const n of this.getModels())n.draw(e)}getPickingInfo({info:e,mode:n,sourceLayer:i}){const{index:s}=e;return s>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[s]),e}raiseError(e,n){var i,s;if(n&&(e=new Error("".concat(n,": ").concat(e.message),{cause:e})),!((i=(s=this.props).onError)!==null&&i!==void 0&&i.call(s,e))){var c,d;(c=this.context)===null||c===void 0||(d=c.onError)===null||d===void 0||d.call(c,e,this)}}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var e;return((e=this.internalState)===null||e===void 0?void 0:e.uniformTransitions.active)||!1}activateViewport(e){if(!this.internalState)return;const n=this.internalState.viewport;this.internalState.viewport=e,(!n||!vV({oldViewport:n,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const n=this.getAttributeManager();n&&(e==="all"?n.invalidateAll():n.invalidate(e))}updateAttributes(e){for(const n of this.getModels())this._setModelAttributes(n,e)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const n=this.props,i=this.getNumInstances(),s=this.getStartIndices();e.update({data:n.data,numInstances:i,startIndices:s,props:n,transitions:n.transitions,buffers:n.data.attributes,context:this});const c=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(c)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const n=e.update(),i=Object.create(this.props);for(const s in n)Object.defineProperty(i,s,{value:n[s]});return i}return this.props}calculateInstancePickingColors(e,{numInstances:n}){if(e.constant)return;const i=Math.floor(po.length/3);if(this.internalState.usesPickingColorCache=!0,i<n){n>MT&&fn.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),po=Fu.allocate(po,n,{size:3,copy:!0,maxCount:Math.max(n,MT)});const s=Math.floor(po.length/3),c=[];for(let d=i;d<s;d++)this.encodePickingColor(d,c),po[d*3+0]=c[0],po[d*3+1]=c[1],po[d*3+2]=c[2]}e.value=po.subarray(0,n*3)}_setModelAttributes(e,n){const i=this.getAttributeManager(),s=e.userData.excludeAttributes||{},c=i.getShaderAttributes(n,s);e.setAttributes(c)}disablePickingIndex(e){const n=this.props.data;if(!("attributes"in n)){this._disablePickingIndex(e);return}const{pickingColors:i,instancePickingColors:s}=this.getAttributeManager().attributes,c=i||s,d=c&&n.attributes&&n.attributes[c.id];if(d&&d.value){const l=d.value,y=this.encodePickingColor(e);for(let w=0;w<n.length;w++){const S=c.getVertexOffset(w);l[S]===y[0]&&l[S+1]===y[1]&&l[S+2]===y[2]&&this._disablePickingIndex(w)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:n,instancePickingColors:i}=this.getAttributeManager().attributes,s=n||i;if(!s)return;const c=s.getVertexOffset(e),d=s.getVertexOffset(e+1);s.buffer.subData({data:new Uint8Array(d-c),offset:c})}restorePickingColors(){const{pickingColors:e,instancePickingColors:n}=this.getAttributeManager().attributes,i=e||n;i&&(this.internalState.usesPickingColorCache&&i.value.buffer!==po.buffer&&(i.value=po.subarray(0,i.value.length)),i.updateSubBuffer({startOffset:0}))}_initialize(){Di(!this.internalState),Di(Number.isFinite(this.props.coordinateSystem)),rr(pV,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new dV({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(fn.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new FU(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const n of this.props.extensions)n.initializeState.call(this,this.context,n);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){rr(_V,this,this===e);const{state:n,internalState:i}=e;this!==e&&(this.internalState=i,this.state=n,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(rr(mV,this,e),!e)return;const n=this.props,i=this.context,s=this.internalState,c=i.viewport,d=this._updateUniformTransition();s.propsInTransition=d,i.viewport=s.viewport||c,this.props=d;try{const l=this._getUpdateParams(),y=this.getModels();if(i.gl)this.updateState(l);else try{this.updateState(l)}catch{}for(const S of this.props.extensions)S.updateState.call(this,l,S);const w=this.getModels()[0]!==y[0];this._postUpdate(l,w)}finally{i.viewport=c,this.props=n,this._clearChangeFlags(),s.needsUpdate=!1,s.resetOldProps()}}_finalize(){rr(gV,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({moduleParameters:e=null,uniforms:n={},parameters:i={}}){this._updateAttributeTransition();const s=this.props,c=this.context;this.props=this.internalState.propsInTransition||s;const d=this.props.opacity;n.opacity=Math.pow(d,1/2.2);try{e&&this.setModuleParameters(e);const{getPolygonOffset:l}=this.props,y=l&&l(n)||[0,0];Qo(c.gl,{polygonOffset:y}),Nr(c.gl,i,()=>{const w={moduleParameters:e,uniforms:n,parameters:i,context:c};for(const S of this.props.extensions)S.draw.call(this,w,S);this.draw(w)})}finally{this.props=s}}getChangeFlags(){var e;return(e=this.internalState)===null||e===void 0?void 0:e.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:n}=this.internalState;for(const s in e)if(e[s]){let c=!1;switch(s){case"dataChanged":const d=e[s],l=n[s];d&&Array.isArray(l)&&(n.dataChanged=Array.isArray(d)?l.concat(d):d,c=!0);default:n[s]||(n[s]=e[s],c=!0)}c&&rr(fV,this,s,e)}const i=!!(n.dataChanged||n.updateTriggersChanged||n.propsChanged||n.extensionsChanged);n.propsOrDataChanged=i,n.somethingChanged=i||n.viewportChanged||n.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,n){const i=BU(e,n);if(i.updateTriggersChanged)for(const c in i.updateTriggersChanged)i.updateTriggersChanged[c]&&this.invalidateAttribute(c);if(i.transitionsChanged)for(const c in i.transitionsChanged){var s;this.internalState.uniformTransitions.add(c,n[c],e[c],(s=e.transitions)===null||s===void 0?void 0:s[c])}return this.setChangeFlags(i)}validateProps(){NU(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const n={pickingSelectedColor:e.picked?e.color:null},{highlightColor:i}=this.props;e.picked&&typeof i=="function"&&(n.pickingHighlightColor=i(e)),this.setModuleParameters(n),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new AI(e.gl,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,n){const{props:i,oldProps:s}=e;this.setNeedsRedraw(),this._updateAttributes();const{model:c}=this.state;c==null||c.setInstanceCount(this.getNumInstances());const{autoHighlight:d,highlightedObjectIndex:l,highlightColor:y}=i;if(n||s.autoHighlight!==d||s.highlightedObjectIndex!==l||s.highlightColor!==y){const w={};d||(w.pickingSelectedColor=null),Array.isArray(y)&&(w.pickingHighlightColor=y),(n||l!==s.highlightedObjectIndex)&&(w.pickingSelectedColor=Number.isFinite(l)&&l>=0?this.encodePickingColor(l):null),this.setModuleParameters(w)}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let n=!1;n=n||this.internalState.needsRedraw&&this.id;const i=this.getAttributeManager(),s=i?i.getNeedsRedraw(e):!1;if(n=n||s,n)for(const c of this.props.extensions)c.onNeedsRedraw.call(this,c);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,n}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}$(Wu,"defaultProps",xV);$(Wu,"layerName","Layer");const bV="compositeLayer.renderLayers";class CI extends Wu{get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){const{object:n}=e;return n&&n.__source&&n.__source.parent&&n.__source.parent.id===this.id&&(e.object=n.__source.object,e.index=n.__source.index),e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,n){return n&&n.length}getSubLayerClass(e,n){const{_subLayerProps:i}=this.props;return i&&i[e]&&i[e].type||n}getSubLayerRow(e,n,i){return e.__source={parent:this,object:n,index:i},e}getSubLayerAccessor(e){if(typeof e=="function"){const n={index:-1,data:this.props.data,target:[]};return(i,s)=>i&&i.__source?(n.index=i.__source.index,e(i.__source.object,n)):e(i,s)}return e}getSubLayerProps(e={}){var n;const{opacity:i,pickable:s,visible:c,parameters:d,getPolygonOffset:l,highlightedObjectIndex:y,autoHighlight:w,highlightColor:S,coordinateSystem:C,coordinateOrigin:P,wrapLongitude:D,positionFormat:U,modelMatrix:H,extensions:ae,fetch:G,operation:V,_subLayerProps:W}=this.props,ie={id:"",updateTriggers:{},opacity:i,pickable:s,visible:c,parameters:d,getPolygonOffset:l,highlightedObjectIndex:y,autoHighlight:w,highlightColor:S,coordinateSystem:C,coordinateOrigin:P,wrapLongitude:D,positionFormat:U,modelMatrix:H,extensions:ae,fetch:G,operation:V},ge=W&&e.id&&W[e.id],be=ge&&ge.updateTriggers,De=e.id||"sublayer";if(ge){const Ne=this.props[Za],He=e.type?e.type._propTypes:{};for(const je in ge){const vt=He[je]||Ne[je];vt&&vt.type==="accessor"&&(ge[je]=this.getSubLayerAccessor(ge[je]))}}Object.assign(ie,e,ge),ie.id="".concat(this.props.id,"-").concat(De),ie.updateTriggers={all:(n=this.props.updateTriggers)===null||n===void 0?void 0:n.all,...e.updateTriggers,...be};for(const Ne of ae){const He=Ne.getSubLayerProps.call(this,Ne);He&&Object.assign(ie,He,{updateTriggers:Object.assign(ie.updateTriggers,He.updateTriggers)})}return ie}_updateAutoHighlight(e){for(const n of this.getSubLayers())n.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,n){let i=this.internalState.subLayers;const s=!i||this.needsUpdate();if(s){const c=this.renderLayers();i=Fx(c,Boolean),this.internalState.subLayers=i}rr(bV,this,s,i);for(const c of i)c.parent=this}}$(CI,"layerName","CompositeLayer");const Ny={bearing:0,pitch:0,position:[0,0,0]},wV={speed:1.2,curve:1.414};class By extends cI{constructor(e={}){super({compare:["longitude","latitude","zoom","bearing","pitch","position"],extract:["width","height","longitude","latitude","zoom","bearing","pitch","position"],required:["width","height","latitude","longitude","zoom"]}),$(this,"opts",void 0),this.opts={...wV,...e}}interpolateProps(e,n,i){const s=v5(e,n,i,this.opts);for(const c in Ny)s[c]=Vd(e[c]||Ny[c],n[c]||Ny[c],i);return s}getDuration(e,n){let{transitionDuration:i}=n;return i==="auto"&&(i=x5(e,n,this.opts)),i}}class EV{constructor(e){$(this,"opts",void 0),$(this,"typedArrayManager",void 0),$(this,"indexStarts",[0]),$(this,"vertexStarts",[0]),$(this,"vertexCount",0),$(this,"instanceCount",0),$(this,"attributes",void 0),$(this,"_attributeDefs",void 0),$(this,"data",void 0),$(this,"getGeometry",void 0),$(this,"geometryBuffer",void 0),$(this,"buffers",void 0),$(this,"positionSize",void 0),$(this,"normalize",void 0);const{attributes:n={}}=e;this.typedArrayManager=Fu,this.attributes={},this._attributeDefs=n,this.opts=e,this.updateGeometry(e)}updateGeometry(e){Object.assign(this.opts,e);const{data:n,buffers:i={},getGeometry:s,geometryBuffer:c,positionFormat:d,dataChanged:l,normalize:y=!0}=this.opts;if(this.data=n,this.getGeometry=s,this.positionSize=c&&c.size||(d==="XY"?2:3),this.buffers=i,this.normalize=y,c&&(Di(n.startIndices),this.getGeometry=this.getGeometryFromBuffer(c),y||(i.positions=c)),this.geometryBuffer=i.positions,Array.isArray(l))for(const w of l)this._rebuildGeometry(w);else this._rebuildGeometry()}updatePartialGeometry({startRow:e,endRow:n}){this._rebuildGeometry({startRow:e,endRow:n})}getGeometryFromBuffer(e){const n=e.value||e;return ArrayBuffer.isView(n)?xI(n,{size:this.positionSize,offset:e.offset,stride:e.stride,startIndices:this.data.startIndices}):null}_allocate(e,n){const{attributes:i,buffers:s,_attributeDefs:c,typedArrayManager:d}=this;for(const l in c)if(l in s)d.release(i[l]),i[l]=null;else{const y=c[l];y.copy=n,i[l]=d.allocate(i[l],e,y)}}_forEachGeometry(e,n,i){const{data:s,getGeometry:c}=this,{iterable:d,objectInfo:l}=Ux(s,n,i);for(const y of d){l.index++;const w=c?c(y,l):null;e(w,l.index)}}_rebuildGeometry(e){if(!this.data)return;let{indexStarts:n,vertexStarts:i,instanceCount:s}=this;const{data:c,geometryBuffer:d}=this,{startRow:l=0,endRow:y=1/0}=e||{},w={};if(e||(n=[0],i=[0]),this.normalize||!d)this._forEachGeometry((C,P)=>{const D=C&&this.normalizeGeometry(C);w[P]=D,i[P+1]=i[P]+(D?this.getGeometrySize(D):0)},l,y),s=i[i.length-1];else if(i=c.startIndices,s=i[c.length]||0,ArrayBuffer.isView(d))s=s||d.length/this.positionSize;else if(d instanceof vn){const C=d.accessor.stride||this.positionSize*4;s=s||d.byteLength/C}else if(d.buffer){const C=d.stride||this.positionSize*4;s=s||d.buffer.byteLength/C}else if(d.value){const C=d.value,P=d.stride/C.BYTES_PER_ELEMENT||this.positionSize;s=s||C.length/P}this._allocate(s,!!e),this.indexStarts=n,this.vertexStarts=i,this.instanceCount=s;const S={};this._forEachGeometry((C,P)=>{const D=w[P]||C;S.vertexStart=i[P],S.indexStart=n[P];const U=P<i.length-1?i[P+1]:s;S.geometrySize=U-i[P],S.geometryIndex=P,this.updateGeometryAttributes(D,S)},l,y),this.vertexCount=n[n.length-1]}}const or={SUM:1,MEAN:2,MIN:3,MAX:4};function MI(t,e){return t+e}function TV(t,e){return e>t?e:t}function SV(t,e){return e<t?e:t}function AV(t,e){if(Number.isFinite(e))return t.length?e:null;const n=t.map(e).filter(Number.isFinite);return n.length?n.reduce(MI,0)/n.length:null}function PV(t,e){if(Number.isFinite(e))return t.length?t.length*e:null;const n=t.map(e).filter(Number.isFinite);return n.length?n.reduce(MI,0):null}function IV(t,e){if(Number.isFinite(e))return t.length?e:null;const n=t.map(e).filter(Number.isFinite);return n.length?n.reduce(TV,-1/0):null}function CV(t,e){if(Number.isFinite(e))return t.length?e:null;const n=t.map(e).filter(Number.isFinite);return n.length?n.reduce(SV,1/0):null}function MV(t,e,n){const i=or[t]||or.SUM;switch(e=LV(e,n),i){case or.MIN:return s=>CV(s,e);case or.SUM:return s=>PV(s,e);case or.MEAN:return s=>AV(s,e);case or.MAX:return s=>IV(s,e);default:return null}}function LV(t,e={}){return Number.isFinite(t)?t:n=>(e.index=n.index,t(n.source,e))}const kV={projectPoints:!1,viewport:null,createBufferObjects:!0,moduleSettings:{}},Ml=3402823466e29,LI=[32775,32774],kI=[32776,32774],RV=[32776,32775],LT={[or.SUM]:32774,[or.MEAN]:32774,[or.MIN]:LI,[or.MAX]:kI},DV={size:1,operation:or.SUM,needMin:!1,needMax:!1,combineMaxMin:!1},zV=4,OV=`#define SHADER_NAME gpu-aggregation-to-grid-vs

attribute vec3 positions;
attribute vec3 positions64Low;
attribute vec3 weights;
uniform vec2 cellSize;
uniform vec2 gridSize;
uniform bool projectPoints;
uniform vec2 translation;
uniform vec3 scaling;

varying vec3 vWeights;

vec2 project_to_pixel(vec4 pos) {
  vec4 result;
  pos.xy = pos.xy/pos.w;
  result = pos + vec4(translation, 0., 0.);
  result.xy = scaling.z > 0. ? result.xy * scaling.xy : result.xy;
  return result.xy;
}

void main(void) {

  vWeights = weights;

  vec4 windowPos = vec4(positions, 1.);
  if (projectPoints) {
    windowPos = project_position_to_clipspace(positions, positions64Low, vec3(0));
  }

  vec2 pos = project_to_pixel(windowPos);

  vec2 pixelXY64[2];
  pixelXY64[0] = vec2(pos.x, 0.);
  pixelXY64[1] = vec2(pos.y, 0.);
  vec2 gridXY64[2];
  gridXY64[0] = div_fp64(pixelXY64[0], vec2(cellSize.x, 0));
  gridXY64[1] = div_fp64(pixelXY64[1], vec2(cellSize.y, 0));
  float x = floor(gridXY64[0].x);
  float y = floor(gridXY64[1].x);
  pos = vec2(x, y);
  pos = (pos * (2., 2.) / (gridSize)) - (1., 1.);
  vec2 offset = 1.0 / gridSize;
  pos = pos + offset;

  gl_Position = vec4(pos, 0.0, 1.0);
  gl_PointSize = 1.0;
}
`,FV=`#define SHADER_NAME gpu-aggregation-to-grid-fs

precision highp float;

varying vec3 vWeights;

void main(void) {
  gl_FragColor = vec4(vWeights, 1.0);
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,NV=`#version 300 es
#define SHADER_NAME gpu-aggregation-all-vs-64

in vec2 position;
uniform ivec2 gridSize;
out vec2 vTextureCoord;

void main(void) {
  vec2 pos = vec2(-1.0, -1.0);
  vec2 offset = 1.0 / vec2(gridSize);
  pos = pos + offset;

  gl_Position = vec4(pos, 0.0, 1.0);

  int yIndex = gl_InstanceID / gridSize[0];
  int xIndex = gl_InstanceID - (yIndex * gridSize[0]);

  vec2 yIndexFP64 = vec2(float(yIndex), 0.);
  vec2 xIndexFP64 = vec2(float(xIndex), 0.);
  vec2 gridSizeYFP64 = vec2(gridSize[1], 0.);
  vec2 gridSizeXFP64 = vec2(gridSize[0], 0.);

  vec2 texCoordXFP64 = div_fp64(yIndexFP64, gridSizeYFP64);
  vec2 texCoordYFP64 = div_fp64(xIndexFP64, gridSizeXFP64);

  vTextureCoord = vec2(texCoordYFP64.x, texCoordXFP64.x);
  gl_PointSize = 1.0;
}
`,BV=`#version 300 es
#define SHADER_NAME gpu-aggregation-all-fs

precision highp float;

in vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform bool combineMaxMin;
out vec4 fragColor;
void main(void) {
  vec4 textureColor = texture(uSampler, vec2(vTextureCoord.s, vTextureCoord.t));
  if (textureColor.a == 0.) {
    discard;
  }
  fragColor.rgb = textureColor.rgb;
  fragColor.a = combineMaxMin ? textureColor.r : textureColor.a;
}
`,UV=`#define SHADER_NAME gpu-aggregation-transform-mean-vs
attribute vec4 aggregationValues;
varying vec4 meanValues;

void main()
{
  bool isCellValid = bool(aggregationValues.w > 0.);
  meanValues.xyz = isCellValid ? aggregationValues.xyz/aggregationValues.w : vec3(0, 0, 0);
  meanValues.w = aggregationValues.w;
  gl_PointSize = 1.0;
}
`,VV={10240:9728,10241:9728};function Uy(t,e={}){const{width:n=1,height:i=1,data:s=null,unpackFlipY:c=!0,parameters:d=VV}=e;return new Ls(t,{data:s,format:Yt(t)?34836:6408,type:5126,border:0,mipmaps:!1,parameters:d,dataFormat:6408,width:n,height:i,unpackFlipY:c})}function Up(t,e){const{id:n,width:i=1,height:s=1,texture:c}=e;return new _i(t,{id:n,width:i,height:s,attachments:{36064:c}})}const jV=["aggregationBuffer","maxMinBuffer","minBuffer","maxBuffer"],kT={maxData:"maxBuffer",minData:"minBuffer",maxMinData:"maxMinBuffer"},GV=[gn.WEBGL2,gn.COLOR_ATTACHMENT_RGBA32F,gn.BLEND_EQUATION_MINMAX,gn.FLOAT_BLEND,gn.TEXTURE_FLOAT];class fv{static getAggregationData({aggregationData:e,maxData:n,minData:i,maxMinData:s,pixelIndex:c}){const d=c*zV,l={};return e&&(l.cellCount=e[d+3],l.cellWeight=e[d]),s?(l.maxCellWieght=s[0],l.minCellWeight=s[3]):(n&&(l.maxCellWieght=n[0],l.totalCount=n[3]),i&&(l.minCellWeight=i[0],l.totalCount=n[3])),l}static getCellData({countsData:e,size:n=1}){const i=e.length/4,s=new Float32Array(i*n),c=new Uint32Array(i);for(let d=0;d<i;d++){for(let l=0;l<n;l++)s[d*n+l]=e[d*4+l];c[d]=e[d*4+3]}return{cellCounts:c,cellWeights:s}}static isSupported(e){return Nd(e,GV)}constructor(e,n={}){this.id=n.id||"gpu-grid-aggregator",this.gl=e,this.state={weightAttributes:{},textures:{},meanTextures:{},buffers:{},framebuffers:{},maxMinFramebuffers:{},minFramebuffers:{},maxFramebuffers:{},equations:{},resources:{},results:{}},this._hasGPUSupport=Yt(e)&&Nd(this.gl,gn.BLEND_EQUATION_MINMAX),this._hasGPUSupport&&this._setupModels()}delete(){const{gridAggregationModel:e,allAggregationModel:n,meanTransform:i}=this,{textures:s,framebuffers:c,maxMinFramebuffers:d,minFramebuffers:l,maxFramebuffers:y,meanTextures:w,resources:S}=this.state;e==null||e.delete(),n==null||n.delete(),i==null||i.delete(),HV([c,s,d,l,y,w,S])}run(e={}){this.setState({results:{}});const n=this._normalizeAggregationParams(e);return this._hasGPUSupport||fn.log(1,"GPUGridAggregator: not supported")(),this._runAggregation(n)}getData(e){const n={},i=this.state.results;i[e].aggregationData||(i[e].aggregationData=i[e].aggregationBuffer.getData()),n.aggregationData=i[e].aggregationData;for(const s in kT){const c=kT[s];(i[e][s]||i[e][c])&&(i[e][s]=i[e][s]||i[e][c].getData(),n[s]=i[e][s])}return n}updateShaders(e={}){this.setState({shaderOptions:e,modelDirty:!0})}_normalizeAggregationParams(e){const n={...kV,...e},{weights:i}=n;return i&&(n.weights=WV(i)),n}setState(e){Object.assign(this.state,e)}_getAggregateData(e){const n={},{textures:i,framebuffers:s,maxMinFramebuffers:c,minFramebuffers:d,maxFramebuffers:l,resources:y}=this.state,{weights:w}=e;for(const S in w){n[S]={};const{needMin:C,needMax:P,combineMaxMin:D}=w[S];n[S].aggregationTexture=i[S],n[S].aggregationBuffer=Cp(s[S],{target:w[S].aggregationBuffer,sourceType:5126}),C&&P&&D?(n[S].maxMinBuffer=Cp(c[S],{target:w[S].maxMinBuffer,sourceType:5126}),n[S].maxMinTexture=y["".concat(S,"-maxMinTexture")]):(C&&(n[S].minBuffer=Cp(d[S],{target:w[S].minBuffer,sourceType:5126}),n[S].minTexture=y["".concat(S,"-minTexture")]),P&&(n[S].maxBuffer=Cp(l[S],{target:w[S].maxBuffer,sourceType:5126}),n[S].maxTexture=y["".concat(S,"-maxTexture")]))}return this._trackGPUResultBuffers(n,w),n}_renderAggregateData(e){const{cellSize:n,projectPoints:i,attributes:s,moduleSettings:c,numCol:d,numRow:l,weights:y,translation:w,scaling:S}=e,{maxMinFramebuffers:C,minFramebuffers:P,maxFramebuffers:D}=this.state,U=[d,l],H={blend:!0,depthTest:!1,blendFunc:[1,1]},ae={cellSize:n,gridSize:U,projectPoints:i,translation:w,scaling:S};for(const G in y){const{needMin:V,needMax:W}=y[G],ie=V&&W&&y[G].combineMaxMin;this._renderToWeightsTexture({id:G,parameters:H,moduleSettings:c,uniforms:ae,gridSize:U,attributes:s,weights:y}),ie?this._renderToMaxMinTexture({id:G,parameters:{...H,blendEquation:RV},gridSize:U,minOrMaxFb:C[G],clearParams:{clearColor:[0,0,0,Ml]},combineMaxMin:ie}):(V&&this._renderToMaxMinTexture({id:G,parameters:{...H,blendEquation:LI},gridSize:U,minOrMaxFb:P[G],clearParams:{clearColor:[Ml,Ml,Ml,0]},combineMaxMin:ie}),W&&this._renderToMaxMinTexture({id:G,parameters:{...H,blendEquation:kI},gridSize:U,minOrMaxFb:D[G],clearParams:{clearColor:[0,0,0,0]},combineMaxMin:ie}))}}_renderToMaxMinTexture(e){const{id:n,parameters:i,gridSize:s,minOrMaxFb:c,combineMaxMin:d,clearParams:l={}}=e,{framebuffers:y}=this.state,{gl:w,allAggregationModel:S}=this;Nr(w,{...l,framebuffer:c,viewport:[0,0,s[0],s[1]]},()=>{w.clear(16384),S.draw({parameters:i,uniforms:{uSampler:y[n].texture,gridSize:s,combineMaxMin:d}})})}_renderToWeightsTexture(e){const{id:n,parameters:i,moduleSettings:s,uniforms:c,gridSize:d,weights:l}=e,{framebuffers:y,equations:w,weightAttributes:S}=this.state,{gl:C,gridAggregationModel:P}=this,{operation:D}=l[n],U=D===or.MIN?[Ml,Ml,Ml,0]:[0,0,0,0];if(Nr(C,{framebuffer:y[n],viewport:[0,0,d[0],d[1]],clearColor:U},()=>{C.clear(16384);const H={weights:S[n]};P.draw({parameters:{...i,blendEquation:w[n]},moduleSettings:s,uniforms:c,attributes:H})}),D===or.MEAN){const{meanTextures:H,textures:ae}=this.state,G={_sourceTextures:{aggregationValues:H[n]},_targetTexture:ae[n],elementCount:ae[n].width*ae[n].height};this.meanTransform?this.meanTransform.update(G):this.meanTransform=ZV(C,G),this.meanTransform.run({parameters:{blend:!1,depthTest:!1}}),y[n].attach({36064:ae[n]})}}_runAggregation(e){this._updateModels(e),this._setupFramebuffers(e),this._renderAggregateData(e);const n=this._getAggregateData(e);return this.setState({results:n}),n}_setupFramebuffers(e){const{textures:n,framebuffers:i,maxMinFramebuffers:s,minFramebuffers:c,maxFramebuffers:d,meanTextures:l,equations:y}=this.state,{weights:w}=e,{numCol:S,numRow:C}=e,P={width:S,height:C};for(const D in w){const{needMin:U,needMax:H,combineMaxMin:ae,operation:G}=w[D];n[D]=w[D].aggregationTexture||n[D]||Uy(this.gl,{id:"".concat(D,"-texture"),width:S,height:C}),n[D].resize(P);let V=n[D];G===or.MEAN&&(l[D]=l[D]||Uy(this.gl,{id:"".concat(D,"-mean-texture"),width:S,height:C}),l[D].resize(P),V=l[D]),i[D]?i[D].attach({36064:V}):i[D]=Up(this.gl,{id:"".concat(D,"-fb"),width:S,height:C,texture:V}),i[D].resize(P),y[D]=LT[G]||LT.SUM,(U||H)&&(U&&H&&ae?s[D]||(V=w[D].maxMinTexture||this._getMinMaxTexture("".concat(D,"-maxMinTexture")),s[D]=Up(this.gl,{id:"".concat(D,"-maxMinFb"),texture:V})):(U&&(c[D]||(V=w[D].minTexture||this._getMinMaxTexture("".concat(D,"-minTexture")),c[D]=Up(this.gl,{id:"".concat(D,"-minFb"),texture:V}))),H&&(d[D]||(V=w[D].maxTexture||this._getMinMaxTexture("".concat(D,"-maxTexture")),d[D]=Up(this.gl,{id:"".concat(D,"-maxFb"),texture:V})))))}}_getMinMaxTexture(e){const{resources:n}=this.state;return n[e]||(n[e]=Uy(this.gl,{id:"resourceName"})),n[e]}_setupModels({numCol:e=0,numRow:n=0}={}){var i;const{gl:s}=this,{shaderOptions:c}=this.state;if((i=this.gridAggregationModel)===null||i===void 0||i.delete(),this.gridAggregationModel=$V(s,c),!this.allAggregationModel){const d=e*n;this.allAggregationModel=qV(s,d)}}_setupWeightAttributes(e){const{weightAttributes:n}=this.state,{weights:i}=e;for(const s in i)n[s]=e.attributes[s]}_trackGPUResultBuffers(e,n){const{resources:i}=this.state;for(const s in e)if(e[s]){for(const c of jV)if(e[s][c]&&n[s][c]!==e[s][c]){const d="gpu-result-".concat(s,"-").concat(c);i[d]&&i[d].delete(),i[d]=e[s][c]}}}_updateModels(e){const{vertexCount:n,attributes:i,numCol:s,numRow:c}=e,{modelDirty:d}=this.state;d&&(this._setupModels(e),this.setState({modelDirty:!1})),this._setupWeightAttributes(e),this.gridAggregationModel.setVertexCount(n),this.gridAggregationModel.setAttributes(i),this.allAggregationModel.setInstanceCount(s*c)}}function WV(t){const e={};for(const n in t)e[n]={...DV,...t[n]};return e}function HV(t){t=Array.isArray(t)?t:[t],t.forEach(e=>{for(const n in e)e[n].delete()})}function $V(t,e){const n=PI({vs:OV,fs:FV,modules:[zP,Nx]},e);return new Du(t,{id:"Gird-Aggregation-Model",vertexCount:1,drawMode:0,...n})}function qV(t,e){return new Du(t,{id:"All-Aggregation-Model",vs:NV,fs:BV,modules:[zP],vertexCount:1,drawMode:0,isInstanced:!0,instanceCount:e,attributes:{position:[0,0]}})}function ZV(t,e){return new Ag(t,{vs:UV,_targetTextureVarying:"meanValues",...e})}function XV(t,e){const n={};for(const i in t)e.includes(i)||(n[i]=t[i]);return n}class RI extends CI{constructor(...e){super(...e),$(this,"state",void 0)}initializeAggregationLayer(e){super.initializeState(this.context),this.setState({ignoreProps:XV(this.constructor._propTypes,e.data.props),dimensions:e})}updateState(e){super.updateState(e);const{changeFlags:n}=e;if(n.extensionsChanged){const i=this.getShaders({});i&&i.defines&&(i.defines.NON_INSTANCED_MODEL=1),this.updateShaders(i)}this._updateAttributes()}updateAttributes(e){this.setState({changedAttributes:e})}getAttributes(){return this.getAttributeManager().getShaderAttributes()}getModuleSettings(){const{viewport:e,mousePosition:n,gl:i}=this.context;return Object.assign(Object.create(this.props),{viewport:e,mousePosition:n,pickingActive:0,devicePixelRatio:Zl(i)})}updateShaders(e){}isAggregationDirty(e,n={}){const{props:i,oldProps:s,changeFlags:c}=e,{compareAll:d=!1,dimension:l}=n,{ignoreProps:y}=this.state,{props:w,accessors:S=[]}=l,{updateTriggersChanged:C}=c;if(c.dataChanged)return!0;if(C){if(C.all)return!0;for(const P of S)if(C[P])return!0}if(d)return c.extensionsChanged?!0:Gx({oldProps:s,newProps:i,ignoreProps:y,propTypes:this.constructor._propTypes});for(const P of w)if(i[P]!==s[P])return!0;return!1}isAttributeChanged(e){const{changedAttributes:n}=this.state;return e?n&&n[e]!==void 0:!YV(n)}_getAttributeManager(){return new AI(this.context.gl,{id:this.props.id,stats:this.context.stats})}}$(RI,"layerName","AggregationLayer");function YV(t){let e=!0;for(const n in t){e=!1;break}return e}function DI(t){return t!=null}function KV(t){const e=[];return t.forEach(n=>{!e.includes(n)&&DI(n)&&e.push(n)}),e}function zI(t,e){return(typeof e=="function"?t.map(e):t).filter(DI)}function JV(t,e){return zI(t,e)}function QV(t,e){return KV(zI(t,e))}function e8(t,e,n){return Math.max(e,Math.min(n,t))}const OI=t=>t.length,t8=3402823466e29,FI=t=>t.points,NI=t=>t.index,RT=(t,e)=>t<e?-1:t>e?1:t>=e?0:NaN,n8={getValue:OI,getPoints:FI,getIndex:NI,filterData:null};class i8{constructor(e=[],n=n8){$(this,"maxCount",void 0),$(this,"maxValue",void 0),$(this,"minValue",void 0),$(this,"totalCount",void 0),$(this,"aggregatedBins",void 0),$(this,"sortedBins",void 0),$(this,"binMap",void 0),this.aggregatedBins=this.getAggregatedBins(e,n),this._updateMinMaxValues(),this.binMap=this.getBinMap()}getAggregatedBins(e,n){const{getValue:i=OI,getPoints:s=FI,getIndex:c=NI,filterData:d}=n,l=typeof d=="function",y=e.length,w=[];let S=0;for(let C=0;C<y;C++){const P=e[C],D=s(P),U=c(P),H=l?D.filter(d):D;P.filteredPoints=l?H:null;const ae=H.length?i(H):null;ae!=null&&(w[S]={i:Number.isFinite(U)?U:C,value:ae,counts:H.length},S++)}return w}_percentileToIndex(e){const n=this.sortedBins.length;if(n<2)return[0,0];const[i,s]=e.map(l=>e8(l,0,100)),c=Math.ceil(i/100*(n-1)),d=Math.floor(s/100*(n-1));return[c,d]}getBinMap(){const e={};for(const n of this.aggregatedBins)e[n.i]=n;return e}_updateMinMaxValues(){let e=0,n=0,i=t8,s=0;for(const c of this.aggregatedBins)e=e>c.counts?e:c.counts,n=n>c.value?n:c.value,i=i<c.value?i:c.value,s+=c.counts;this.maxCount=e,this.maxValue=n,this.minValue=i,this.totalCount=s}getValueRange(e){if(this.sortedBins||(this.sortedBins=this.aggregatedBins.sort((s,c)=>RT(s.value,c.value))),!this.sortedBins.length)return[];let n=0,i=this.sortedBins.length-1;if(Array.isArray(e)){const s=this._percentileToIndex(e);n=s[0],i=s[1]}return[this.sortedBins[n].value,this.sortedBins[i].value]}getValueDomainByScale(e,[n=0,i=100]=[]){if(this.sortedBins||(this.sortedBins=this.aggregatedBins.sort((c,d)=>RT(c.value,d.value))),!this.sortedBins.length)return[];const s=this._percentileToIndex([n,i]);return this._getScaleDomain(e,s)}_getScaleDomain(e,[n,i]){const s=this.sortedBins;switch(e){case"quantize":case"linear":return[s[n].value,s[i].value];case"quantile":return JV(s.slice(n,i+1),c=>c.value);case"ordinal":return QV(s,c=>c.value);default:return[s[n].value,s[i].value]}}}const BI=6378e3;function Vp(t){return Number.isFinite(t)?t:0}function r8(t,e){const n=t.positions.value;let i=1/0,s=-1/0,c=1/0,d=-1/0,l,y;for(let S=0;S<e;S++)y=n[S*3],l=n[S*3+1],i=l<i?l:i,s=l>s?l:s,c=y<c?y:c,d=y>d?y:d;return{xMin:Vp(c),xMax:Vp(d),yMin:Vp(i),yMax:Vp(s)}}function s8(t,e,n,i){const{width:s,height:c}=i,d=n===Jt.CARTESIAN?[-s/2,-c/2]:[-180,-90];fn.assert(n===Jt.CARTESIAN||n===Jt.LNGLAT||n===Jt.DEFAULT);const{xMin:l,yMin:y}=t;return[-1*(DT(l-d[0],e.xOffset)+d[0]),-1*(DT(y-d[1],e.yOffset)+d[1])]}function DT(t,e){const n=t<0?-1:1;let i=n<0?Math.abs(t)+e:Math.abs(t);return i=Math.floor(i/e)*e,i*n}function UI(t,e,n=!0){if(!n)return{xOffset:e,yOffset:e};const{yMin:i,yMax:s}=t,c=(i+s)/2;return a8(e,c)}function o8(t,e,n,i){const s=UI(t,e,i!==Jt.CARTESIAN),c=s8(t,s,i,n),{xMin:d,yMin:l,xMax:y,yMax:w}=t,S=y-d+s.xOffset,C=w-l+s.yOffset,P=Math.ceil(S/s.xOffset),D=Math.ceil(C/s.yOffset);return{gridOffset:s,translation:c,width:S,height:C,numCol:P,numRow:D}}function a8(t,e){const n=l8(t),i=c8(e,t);return{yOffset:n,xOffset:i}}function l8(t){return t/BI*(180/Math.PI)}function c8(t,e){return e/BI*(180/Math.PI)/Math.cos(t*Math.PI/180)}function u8(t,e){const n=h8(t,e),i=d8(n);return{gridHash:n.gridHash,gridOffset:n.gridOffset,data:i}}function h8(t,e){const{data:n=[],cellSize:i}=t,{attributes:s,viewport:c,projectPoints:d,numInstances:l}=e,y=s.positions.value,{size:w}=s.positions.getAccessor(),S=e.boundingBox||f8(s.positions,l),C=e.posOffset||[180,90],P=e.gridOffset||UI(S,i);if(P.xOffset<=0||P.yOffset<=0)return{gridHash:{},gridOffset:P};const{width:D,height:U}=c,H=Math.ceil(D/P.xOffset),ae=Math.ceil(U/P.yOffset),G={},{iterable:V,objectInfo:W}=Ux(n),ie=new Array(3);for(const ge of V){W.index++,ie[0]=y[W.index*w],ie[1]=y[W.index*w+1],ie[2]=w>=3?y[W.index*w+2]:0;const[be,De]=d?c.project(ie):ie;if(Number.isFinite(be)&&Number.isFinite(De)){const Ne=Math.floor((De+C[1])/P.yOffset),He=Math.floor((be+C[0])/P.xOffset);if(!d||He>=0&&He<H&&Ne>=0&&Ne<ae){const je="".concat(Ne,"-").concat(He);G[je]=G[je]||{count:0,points:[],lonIdx:He,latIdx:Ne},G[je].count+=1,G[je].points.push({source:ge,index:W.index})}}}return{gridHash:G,gridOffset:P,offsets:[C[0]*-1,C[1]*-1]}}function d8({gridHash:t,gridOffset:e,offsets:n}){const i=new Array(Object.keys(t).length);let s=0;for(const c in t){const d=c.split("-"),l=parseInt(d[0],10),y=parseInt(d[1],10),w=s++;i[w]={index:w,position:[n[0]+e.xOffset*y,n[1]+e.yOffset*l],...t[c]}}return i}function f8(t,e){const n=t.value,{size:i}=t.getAccessor();let s=1/0,c=-1/0,d=1/0,l=-1/0,y,w;for(let S=0;S<e;S++)w=n[S*i],y=n[S*i+1],Number.isFinite(w)&&Number.isFinite(y)&&(s=y<s?y:s,c=y>c?y:c,d=w<d?w:d,l=w>l?w:l);return{xMin:d,xMax:l,yMin:s,yMax:c}}class VI extends RI{constructor(...e){super(...e),$(this,"state",void 0)}initializeAggregationLayer({dimensions:e}){const{gl:n}=this.context;super.initializeAggregationLayer(e),this.setState({layerData:{},gpuGridAggregator:new fv(n,{id:"".concat(this.id,"-gpu-aggregator")}),cpuGridAggregator:u8})}updateState(e){super.updateState(e),this.updateAggregationState(e);const{aggregationDataDirty:n,aggregationWeightsDirty:i,gpuAggregation:s}=this.state;if(this.getNumInstances()<=0)return;let c=!1;(n||s&&i)&&(this._updateAggregation(e),c=!0),!s&&(n||i)&&(this._updateWeightBins(),this._uploadAggregationResults(),c=!0),this.setState({aggregationDirty:c})}finalizeState(e){var n;const{count:i}=this.state.weights;i&&i.aggregationBuffer&&i.aggregationBuffer.delete(),(n=this.state.gpuGridAggregator)===null||n===void 0||n.delete(),super.finalizeState(e)}updateShaders(e){this.state.gpuAggregation&&this.state.gpuGridAggregator.updateShaders(e)}updateAggregationState(e){fn.assert(!1)}allocateResources(e,n){if(this.state.numRow!==e||this.state.numCol!==n){const i=n*e*4*4,s=this.context.gl,{weights:c}=this.state;for(const d in c){const l=c[d];l.aggregationBuffer&&l.aggregationBuffer.delete(),l.aggregationBuffer=new vn(s,{byteLength:i,accessor:{size:4,type:5126,divisor:1}})}}}updateResults({aggregationData:e,maxMinData:n,maxData:i,minData:s}){const{count:c}=this.state.weights;c&&(c.aggregationData=e,c.maxMinData=n,c.maxData=i,c.minData=s)}_updateAggregation(e){const{cpuGridAggregator:n,gpuGridAggregator:i,gridOffset:s,posOffset:c,translation:d=[0,0],scaling:l=[0,0,0],boundingBox:y,projectPoints:w,gpuAggregation:S,numCol:C,numRow:P}=this.state,{props:D}=e,{viewport:U}=this.context,H=this.getAttributes(),ae=this.getNumInstances();if(S){const{weights:G}=this.state;i.run({weights:G,cellSize:[s.xOffset,s.yOffset],numCol:C,numRow:P,translation:d,scaling:l,vertexCount:ae,projectPoints:w,attributes:H,moduleSettings:this.getModuleSettings()})}else{const G=n(D,{gridOffset:s,projectPoints:w,attributes:H,viewport:U,posOffset:c,boundingBox:y});this.setState({layerData:G})}}_updateWeightBins(){const{getValue:e}=this.state,n=new i8(this.state.layerData.data||[],{getValue:e});this.setState({sortedBins:n})}_uploadAggregationResults(){const{numCol:e,numRow:n}=this.state,{data:i}=this.state.layerData,{aggregatedBins:s,minValue:c,maxValue:d,totalCount:l}=this.state.sortedBins,y=4,w=e*n*y,S=new Float32Array(w).fill(0);for(const U of s){const{lonIdx:H,latIdx:ae}=i[U.i],{value:G,counts:V}=U,W=(H+ae*e)*y;S[W]=G,S[W+y-1]=V}const C=new Float32Array([d,0,0,c]),P=new Float32Array([d,0,0,l]),D=new Float32Array([c,0,0,l]);this.updateResults({aggregationData:S,maxMinData:C,maxData:P,minData:D})}}$(VI,"layerName","GridAggregationLayer");const p8=`#define SHADER_NAME line-layer-vertex-shader

attribute vec3 positions;
attribute vec3 instanceSourcePositions;
attribute vec3 instanceTargetPositions;
attribute vec3 instanceSourcePositions64Low;
attribute vec3 instanceTargetPositions64Low;
attribute vec4 instanceColors;
attribute vec3 instancePickingColors;
attribute float instanceWidths;

uniform float opacity;
uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform float useShortestPath;
uniform int widthUnits;

varying vec4 vColor;
varying vec2 uv;
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {
  vec2 dir_screenspace = normalize(line_clipspace * project_uViewportSize);
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  return dir_screenspace * offset_direction * width / 2.0;
}

vec3 splitLine(vec3 a, vec3 b, float x) {
  float t = (x - a.x) / (b.x - a.x);
  return vec3(x, mix(a.yz, b.yz, t));
}

void main(void) {
  geometry.worldPosition = instanceSourcePositions;
  geometry.worldPositionAlt = instanceTargetPositions;

  vec3 source_world = instanceSourcePositions;
  vec3 target_world = instanceTargetPositions;
  vec3 source_world_64low = instanceSourcePositions64Low;
  vec3 target_world_64low = instanceTargetPositions64Low;

  if (useShortestPath > 0.5 || useShortestPath < -0.5) {
    source_world.x = mod(source_world.x + 180., 360.0) - 180.;
    target_world.x = mod(target_world.x + 180., 360.0) - 180.;
    float deltaLng = target_world.x - source_world.x;

    if (deltaLng * useShortestPath > 180.) {
      source_world.x += 360. * useShortestPath;
      source_world = splitLine(source_world, target_world, 180. * useShortestPath);
      source_world_64low = vec3(0.0);
    } else if (deltaLng * useShortestPath < -180.) {
      target_world.x += 360. * useShortestPath;
      target_world = splitLine(source_world, target_world, 180. * useShortestPath);
      target_world_64low = vec3(0.0);
    } else if (useShortestPath < 0.) {
      gl_Position = vec4(0.);
      return;
    }
  }
  vec4 source_commonspace;
  vec4 target_commonspace;
  vec4 source = project_position_to_clipspace(source_world, source_world_64low, vec3(0.), source_commonspace);
  vec4 target = project_position_to_clipspace(target_world, target_world_64low, vec3(0.), target_commonspace);
  float segmentIndex = positions.x;
  vec4 p = mix(source, target, segmentIndex);
  geometry.position = mix(source_commonspace, target_commonspace, segmentIndex);
  uv = positions.xy;
  geometry.uv = uv;
  geometry.pickingColor = instancePickingColors;
  float widthPixels = clamp(
    project_size_to_pixel(instanceWidths * widthScale, widthUnits),
    widthMinPixels, widthMaxPixels
  );
  vec3 offset = vec3(
    getExtrusionOffset(target.xy - source.xy, positions.y, widthPixels),
    0.0);
  DECKGL_FILTER_SIZE(offset, geometry);
  DECKGL_FILTER_GL_POSITION(p, geometry);
  gl_Position = p + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);
  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity);
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,m8=`#define SHADER_NAME line-layer-fragment-shader

precision highp float;

varying vec4 vColor;
varying vec2 uv;

void main(void) {
  geometry.uv = uv;

  gl_FragColor = vColor;

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,g8=[0,0,0,255],_8={getSourcePosition:{type:"accessor",value:t=>t.sourcePosition},getTargetPosition:{type:"accessor",value:t=>t.targetPosition},getColor:{type:"accessor",value:g8},getWidth:{type:"accessor",value:1},widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}};class $x extends Wu{getBounds(){var e;return(e=this.getAttributeManager())===null||e===void 0?void 0:e.getBounds(["instanceSourcePositions","instanceTargetPositions"])}getShaders(){return super.getShaders({vs:p8,fs:m8,modules:[Nx,lI]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1}})}updateState(e){if(super.updateState(e),e.changeFlags.extensionsChanged){var n;const{gl:i}=this.context;(n=this.state.model)===null||n===void 0||n.delete(),this.state.model=this._getModel(i),this.getAttributeManager().invalidateAll()}}draw({uniforms:e}){const{widthUnits:n,widthScale:i,widthMinPixels:s,widthMaxPixels:c,wrapLongitude:d}=this.props;this.state.model.setUniforms(e).setUniforms({widthUnits:W0[n],widthScale:i,widthMinPixels:s,widthMaxPixels:c,useShortestPath:d?1:0}).draw(),d&&this.state.model.setUniforms({useShortestPath:-1}).draw()}_getModel(e){const n=[0,-1,0,0,1,0,1,-1,0,1,1,0];return new Du(e,{...this.getShaders(),id:this.props.id,geometry:new GP({drawMode:5,attributes:{positions:new Float32Array(n)}}),isInstanced:!0})}}$($x,"layerName","LineLayer");$($x,"defaultProps",_8);const jI={CLOCKWISE:1,COUNTER_CLOCKWISE:-1};function GI(t,e,n={}){return y8(t,n)!==e?(x8(t,n),!0):!1}function y8(t,e={}){return Math.sign(v8(t,e))}function v8(t,e={}){const{start:n=0,end:i=t.length}=e,s=e.size||2;let c=0;for(let d=n,l=i-s;d<i;d+=s)c+=(t[d]-t[l])*(t[d+1]+t[l+1]),l=d;return c/2}function x8(t,e){const{start:n=0,end:i=t.length,size:s=2}=e,c=(i-n)/s,d=Math.floor(c/2);for(let l=0;l<d;++l){const y=n+l*s,w=n+(c-1-l)*s;for(let S=0;S<s;++S){const C=t[y+S];t[y+S]=t[w+S],t[w+S]=C}}}function Bl(t,e){const n=e.length,i=t.length;if(i>0){let s=!0;for(let c=0;c<n;c++)if(t[i-n+c]!==e[c]){s=!1;break}if(s)return!1}for(let s=0;s<n;s++)t[i+s]=e[s];return!0}function b8(t,e){const n=e.length;for(let i=0;i<n;i++)t[i]=e[i]}function pv(t,e,n,i,s=[]){const c=i+e*n;for(let d=0;d<n;d++)s[d]=t[c+d];return s}function w8(t,e,n,i,s=[]){let c,d;if(n&8)c=(i[3]-t[1])/(e[1]-t[1]),d=3;else if(n&4)c=(i[1]-t[1])/(e[1]-t[1]),d=1;else if(n&2)c=(i[2]-t[0])/(e[0]-t[0]),d=2;else if(n&1)c=(i[0]-t[0])/(e[0]-t[0]),d=0;else return null;for(let l=0;l<t.length;l++)s[l]=(d&1)===l?i[d]:c*(e[l]-t[l])+t[l];return s}function E8(t,e){let n=0;return t[0]<e[0]?n|=1:t[0]>e[2]&&(n|=2),t[1]<e[1]?n|=4:t[1]>e[3]&&(n|=8),n}const zT=0,T8=1;function jp(t,e){for(let n=0;n<e.length;n++)t.push(e[n]);return t}function WI(t,e=null,n){if(!t.length)return[];const{size:i=2,gridResolution:s=10,gridOffset:c=[0,0],edgeTypes:d=!1}=n||{},l=[],y=[{pos:t,types:d?new Array(t.length/i).fill(T8):null,holes:e||[]}],w=[[],[]];let S=[];for(;y.length;){const{pos:C,types:P,holes:D}=y.shift();A8(C,i,D[0]||C.length,w),S=S8(w[0],s,c,S);const U=E8(w[1],S);if(U){let H=OT(C,P,i,0,D[0]||C.length,S,U);const ae={pos:H[0].pos,types:H[0].types,holes:[]},G={pos:H[1].pos,types:H[1].types,holes:[]};y.push(ae,G);for(let V=0;V<D.length;V++)H=OT(C,P,i,D[V],D[V+1]||C.length,S,U),H[0]&&(ae.holes.push(ae.pos.length),ae.pos=jp(ae.pos,H[0].pos),d&&(ae.types=jp(ae.types,H[0].types))),H[1]&&(G.holes.push(G.pos.length),G.pos=jp(G.pos,H[1].pos),d&&(G.types=jp(G.types,H[1].types)))}else{const H={positions:C};d&&(H.edgeTypes=P),D.length&&(H.holeIndices=D),l.push(H)}}return l}function OT(t,e,n,i,s,c,d){const l=(s-i)/n,y=[],w=[],S=[],C=[],P=[];let D,U,H;const ae=pv(t,l-1,n,i);let G=Math.sign(d&8?ae[1]-c[3]:ae[0]-c[2]),V=e&&e[l-1],W=0,ie=0;for(let ge=0;ge<l;ge++)D=pv(t,ge,n,i,D),U=Math.sign(d&8?D[1]-c[3]:D[0]-c[2]),H=e&&e[i/n+ge],U&&G&&G!==U&&(w8(ae,D,d,c,P),Bl(y,P)&&S.push(V),Bl(w,P)&&C.push(V)),U<=0?(Bl(y,D)&&S.push(H),W-=U):S.length&&(S[S.length-1]=zT),U>=0?(Bl(w,D)&&C.push(H),ie+=U):C.length&&(C[C.length-1]=zT),b8(ae,D),G=U,V=H;return[W?{pos:y,types:e&&S}:null,ie?{pos:w,types:e&&C}:null]}function S8(t,e,n,i){const s=Math.floor((t[0]-n[0])/e)*e+n[0],c=Math.floor((t[1]-n[1])/e)*e+n[1];return i[0]=s,i[1]=c,i[2]=s+e,i[3]=c+e,i}function A8(t,e,n,i){let s=1/0,c=-1/0,d=1/0,l=-1/0;for(let y=0;y<n;y+=e){const w=t[y],S=t[y+1];s=w<s?w:s,c=w>c?w:c,d=S<d?S:d,l=S>l?S:l}return i[0][0]=s,i[0][1]=d,i[1][0]=c,i[1][1]=l,i}const P8=85.051129;function I8(t,e=null,n){const{size:i=2,normalize:s=!0,edgeTypes:c=!1}=n||{};e=e||[];const d=[],l=[];let y=0,w=0;for(let C=0;C<=e.length;C++){const P=e[C]||t.length,D=w,U=C8(t,i,y,P);for(let H=U;H<P;H++)d[w++]=t[H];for(let H=y;H<U;H++)d[w++]=t[H];L8(d,i,D,w),M8(d,i,D,w,n==null?void 0:n.maxLatitude),y=P,l[C]=w}l.pop();const S=WI(d,l,{size:i,gridResolution:360,gridOffset:[-180,-180],edgeTypes:c});if(s)for(const C of S)k8(C.positions,i);return S}function C8(t,e,n,i){let s=-1,c=-1;for(let d=n+1;d<i;d+=e){const l=Math.abs(t[d]);l>s&&(s=l,c=d-1)}return c}function M8(t,e,n,i,s=P8){const c=t[n],d=t[i-e];if(Math.abs(c-d)>180){const l=pv(t,0,e,n);l[0]+=Math.round((d-c)/360)*360,Bl(t,l),l[1]=Math.sign(l[1])*s,Bl(t,l),l[0]=c,Bl(t,l)}}function L8(t,e,n,i){let s=t[0],c;for(let d=n;d<i;d+=e){c=t[d];const l=c-s;(l>180||l<-180)&&(c-=Math.round(l/360)*360),t[d]=s=c}}function k8(t,e){let n;const i=t.length/e;for(let c=0;c<i&&(n=t[c*e],(n+180)%360===0);c++);const s=-Math.round(n/360)*360;if(s!==0)for(let c=0;c<i;c++)t[c*e]+=s}var qx={exports:{}};qx.exports=Cg;qx.exports.default=Cg;function Cg(t,e,n){n=n||2;var i=e&&e.length,s=i?e[0]*n:t.length,c=HI(t,0,s,n,!0),d=[];if(!c||c.next===c.prev)return d;var l,y,w,S,C,P,D;if(i&&(c=F8(t,e,c,n)),t.length>80*n){l=w=t[0],y=S=t[1];for(var U=n;U<s;U+=n)C=t[U],P=t[U+1],C<l&&(l=C),P<y&&(y=P),C>w&&(w=C),P>S&&(S=P);D=Math.max(w-l,S-y),D=D!==0?32767/D:0}return Gd(c,d,n,l,y,D,0),d}function HI(t,e,n,i,s){var c,d;if(s===_v(t,e,n,i)>0)for(c=e;c<n;c+=i)d=FT(c,t[c],t[c+1],d);else for(c=n-i;c>=e;c-=i)d=FT(c,t[c],t[c+1],d);return d&&Mg(d,d.next)&&(Hd(d),d=d.next),d}function Kl(t,e){if(!t)return t;e||(e=t);var n=t,i;do if(i=!1,!n.steiner&&(Mg(n,n.next)||Hn(n.prev,n,n.next)===0)){if(Hd(n),n=e=n.prev,n===n.next)break;i=!0}else n=n.next;while(i||n!==e);return e}function Gd(t,e,n,i,s,c,d){if(t){!d&&c&&j8(t,i,s,c);for(var l=t,y,w;t.prev!==t.next;){if(y=t.prev,w=t.next,c?D8(t,i,s,c):R8(t)){e.push(y.i/n|0),e.push(t.i/n|0),e.push(w.i/n|0),Hd(t),t=w.next,l=w.next;continue}if(t=w,t===l){d?d===1?(t=z8(Kl(t),e,n),Gd(t,e,n,i,s,c,2)):d===2&&O8(t,e,n,i,s,c):Gd(Kl(t),e,n,i,s,c,1);break}}}}function R8(t){var e=t.prev,n=t,i=t.next;if(Hn(e,n,i)>=0)return!1;for(var s=e.x,c=n.x,d=i.x,l=e.y,y=n.y,w=i.y,S=s<c?s<d?s:d:c<d?c:d,C=l<y?l<w?l:w:y<w?y:w,P=s>c?s>d?s:d:c>d?c:d,D=l>y?l>w?l:w:y>w?y:w,U=i.next;U!==e;){if(U.x>=S&&U.x<=P&&U.y>=C&&U.y<=D&&hu(s,l,c,y,d,w,U.x,U.y)&&Hn(U.prev,U,U.next)>=0)return!1;U=U.next}return!0}function D8(t,e,n,i){var s=t.prev,c=t,d=t.next;if(Hn(s,c,d)>=0)return!1;for(var l=s.x,y=c.x,w=d.x,S=s.y,C=c.y,P=d.y,D=l<y?l<w?l:w:y<w?y:w,U=S<C?S<P?S:P:C<P?C:P,H=l>y?l>w?l:w:y>w?y:w,ae=S>C?S>P?S:P:C>P?C:P,G=mv(D,U,e,n,i),V=mv(H,ae,e,n,i),W=t.prevZ,ie=t.nextZ;W&&W.z>=G&&ie&&ie.z<=V;){if(W.x>=D&&W.x<=H&&W.y>=U&&W.y<=ae&&W!==s&&W!==d&&hu(l,S,y,C,w,P,W.x,W.y)&&Hn(W.prev,W,W.next)>=0||(W=W.prevZ,ie.x>=D&&ie.x<=H&&ie.y>=U&&ie.y<=ae&&ie!==s&&ie!==d&&hu(l,S,y,C,w,P,ie.x,ie.y)&&Hn(ie.prev,ie,ie.next)>=0))return!1;ie=ie.nextZ}for(;W&&W.z>=G;){if(W.x>=D&&W.x<=H&&W.y>=U&&W.y<=ae&&W!==s&&W!==d&&hu(l,S,y,C,w,P,W.x,W.y)&&Hn(W.prev,W,W.next)>=0)return!1;W=W.prevZ}for(;ie&&ie.z<=V;){if(ie.x>=D&&ie.x<=H&&ie.y>=U&&ie.y<=ae&&ie!==s&&ie!==d&&hu(l,S,y,C,w,P,ie.x,ie.y)&&Hn(ie.prev,ie,ie.next)>=0)return!1;ie=ie.nextZ}return!0}function z8(t,e,n){var i=t;do{var s=i.prev,c=i.next.next;!Mg(s,c)&&$I(s,i,i.next,c)&&Wd(s,c)&&Wd(c,s)&&(e.push(s.i/n|0),e.push(i.i/n|0),e.push(c.i/n|0),Hd(i),Hd(i.next),i=t=c),i=i.next}while(i!==t);return Kl(i)}function O8(t,e,n,i,s,c){var d=t;do{for(var l=d.next.next;l!==d.prev;){if(d.i!==l.i&&H8(d,l)){var y=qI(d,l);d=Kl(d,d.next),y=Kl(y,y.next),Gd(d,e,n,i,s,c,0),Gd(y,e,n,i,s,c,0);return}l=l.next}d=d.next}while(d!==t)}function F8(t,e,n,i){var s=[],c,d,l,y,w;for(c=0,d=e.length;c<d;c++)l=e[c]*i,y=c<d-1?e[c+1]*i:t.length,w=HI(t,l,y,i,!1),w===w.next&&(w.steiner=!0),s.push(W8(w));for(s.sort(N8),c=0;c<s.length;c++)n=B8(s[c],n);return n}function N8(t,e){return t.x-e.x}function B8(t,e){var n=U8(t,e);if(!n)return e;var i=qI(n,t);return Kl(i,i.next),Kl(n,n.next)}function U8(t,e){var n=e,i=t.x,s=t.y,c=-1/0,d;do{if(s<=n.y&&s>=n.next.y&&n.next.y!==n.y){var l=n.x+(s-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(l<=i&&l>c&&(c=l,d=n.x<n.next.x?n:n.next,l===i))return d}n=n.next}while(n!==e);if(!d)return null;var y=d,w=d.x,S=d.y,C=1/0,P;n=d;do i>=n.x&&n.x>=w&&i!==n.x&&hu(s<S?i:c,s,w,S,s<S?c:i,s,n.x,n.y)&&(P=Math.abs(s-n.y)/(i-n.x),Wd(n,t)&&(P<C||P===C&&(n.x>d.x||n.x===d.x&&V8(d,n)))&&(d=n,C=P)),n=n.next;while(n!==y);return d}function V8(t,e){return Hn(t.prev,t,e.prev)<0&&Hn(e.next,t,t.next)<0}function j8(t,e,n,i){var s=t;do s.z===0&&(s.z=mv(s.x,s.y,e,n,i)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next;while(s!==t);s.prevZ.nextZ=null,s.prevZ=null,G8(s)}function G8(t){var e,n,i,s,c,d,l,y,w=1;do{for(n=t,t=null,c=null,d=0;n;){for(d++,i=n,l=0,e=0;e<w&&(l++,i=i.nextZ,!!i);e++);for(y=w;l>0||y>0&&i;)l!==0&&(y===0||!i||n.z<=i.z)?(s=n,n=n.nextZ,l--):(s=i,i=i.nextZ,y--),c?c.nextZ=s:t=s,s.prevZ=c,c=s;n=i}c.nextZ=null,w*=2}while(d>1);return t}function mv(t,e,n,i,s){return t=(t-n)*s|0,e=(e-i)*s|0,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t|e<<1}function W8(t){var e=t,n=t;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==t);return n}function hu(t,e,n,i,s,c,d,l){return(s-d)*(e-l)>=(t-d)*(c-l)&&(t-d)*(i-l)>=(n-d)*(e-l)&&(n-d)*(c-l)>=(s-d)*(i-l)}function H8(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!$8(t,e)&&(Wd(t,e)&&Wd(e,t)&&q8(t,e)&&(Hn(t.prev,t,e.prev)||Hn(t,e.prev,e))||Mg(t,e)&&Hn(t.prev,t,t.next)>0&&Hn(e.prev,e,e.next)>0)}function Hn(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function Mg(t,e){return t.x===e.x&&t.y===e.y}function $I(t,e,n,i){var s=Wp(Hn(t,e,n)),c=Wp(Hn(t,e,i)),d=Wp(Hn(n,i,t)),l=Wp(Hn(n,i,e));return!!(s!==c&&d!==l||s===0&&Gp(t,n,e)||c===0&&Gp(t,i,e)||d===0&&Gp(n,t,i)||l===0&&Gp(n,e,i))}function Gp(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function Wp(t){return t>0?1:t<0?-1:0}function $8(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&$I(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}function Wd(t,e){return Hn(t.prev,t,t.next)<0?Hn(t,e,t.next)>=0&&Hn(t,t.prev,e)>=0:Hn(t,e,t.prev)<0||Hn(t,t.next,e)<0}function q8(t,e){var n=t,i=!1,s=(t.x+e.x)/2,c=(t.y+e.y)/2;do n.y>c!=n.next.y>c&&n.next.y!==n.y&&s<(n.next.x-n.x)*(c-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next;while(n!==t);return i}function qI(t,e){var n=new gv(t.i,t.x,t.y),i=new gv(e.i,e.x,e.y),s=t.next,c=e.prev;return t.next=e,e.prev=t,n.next=s,s.prev=n,i.next=n,n.prev=i,c.next=i,i.prev=c,i}function FT(t,e,n,i){var s=new gv(t,e,n);return i?(s.next=i.next,s.prev=i,i.next.prev=s,i.next=s):(s.prev=s,s.next=s),s}function Hd(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function gv(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}Cg.deviation=function(t,e,n,i){var s=e&&e.length,c=s?e[0]*n:t.length,d=Math.abs(_v(t,0,c,n));if(s)for(var l=0,y=e.length;l<y;l++){var w=e[l]*n,S=l<y-1?e[l+1]*n:t.length;d-=Math.abs(_v(t,w,S,n))}var C=0;for(l=0;l<i.length;l+=3){var P=i[l]*n,D=i[l+1]*n,U=i[l+2]*n;C+=Math.abs((t[P]-t[U])*(t[D+1]-t[P+1])-(t[P]-t[D])*(t[U+1]-t[P+1]))}return d===0&&C===0?0:Math.abs((C-d)/d)};function _v(t,e,n,i){for(var s=0,c=e,d=n-i;c<n;c+=i)s+=(t[d]-t[c])*(t[c+1]+t[d+1]),d=c;return s}Cg.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},i=0,s=0;s<t.length;s++){for(var c=0;c<t[s].length;c++)for(var d=0;d<e;d++)n.vertices.push(t[s][c][d]);s>0&&(i+=t[s-1].length,n.holes.push(i))}return n};var Z8=qx.exports;const X8=sg(Z8),Hp=jI.CLOCKWISE,NT=jI.COUNTER_CLOCKWISE,Na={isClosed:!0};function Y8(t){if(t=t&&t.positions||t,!Array.isArray(t)&&!ArrayBuffer.isView(t))throw new Error("invalid polygon")}function od(t){return"positions"in t?t.positions:t}function gm(t){return"holeIndices"in t?t.holeIndices:null}function K8(t){return Array.isArray(t[0])}function J8(t){return t.length>=1&&t[0].length>=2&&Number.isFinite(t[0][0])}function Q8(t){const e=t[0],n=t[t.length-1];return e[0]===n[0]&&e[1]===n[1]&&e[2]===n[2]}function ej(t,e,n,i){for(let s=0;s<e;s++)if(t[n+s]!==t[i-e+s])return!1;return!0}function BT(t,e,n,i,s){let c=e;const d=n.length;for(let l=0;l<d;l++)for(let y=0;y<i;y++)t[c++]=n[l][y]||0;if(!Q8(n))for(let l=0;l<i;l++)t[c++]=n[0][l]||0;return Na.start=e,Na.end=c,Na.size=i,GI(t,s,Na),c}function UT(t,e,n,i,s=0,c,d){c=c||n.length;const l=c-s;if(l<=0)return e;let y=e;for(let w=0;w<l;w++)t[y++]=n[s+w];if(!ej(n,i,s,c))for(let w=0;w<i;w++)t[y++]=n[s+w];return Na.start=e,Na.end=y,Na.size=i,GI(t,d,Na),y}function tj(t,e){Y8(t);const n=[],i=[];if("positions"in t){const{positions:s,holeIndices:c}=t;if(c){let d=0;for(let l=0;l<=c.length;l++)d=UT(n,d,s,e,c[l-1],c[l],l===0?Hp:NT),i.push(d);return i.pop(),{positions:n,holeIndices:i}}t=s}if(!K8(t))return UT(n,0,t,e,0,n.length,Hp),n;if(!J8(t)){let s=0;for(const[c,d]of t.entries())s=BT(n,s,d,e,c===0?Hp:NT),i.push(s);return i.pop(),{positions:n,holeIndices:i}}return BT(n,0,t,e,Hp),n}function Vy(t,e,n){const i=t.length/3;let s=0;for(let c=0;c<i;c++){const d=(c+1)%i;s+=t[c*3+e]*t[d*3+n],s-=t[d*3+e]*t[c*3+n]}return Math.abs(s/2)}function VT(t,e,n,i){const s=t.length/3;for(let c=0;c<s;c++){const d=c*3,l=t[d+0],y=t[d+1],w=t[d+2];t[d+e]=l,t[d+n]=y,t[d+i]=w}}function nj(t,e,n,i){let s=gm(t);s&&(s=s.map(l=>l/e));let c=od(t);const d=i&&e===3;if(n){const l=c.length;c=c.slice();const y=[];for(let w=0;w<l;w+=e){y[0]=c[w],y[1]=c[w+1],d&&(y[2]=c[w+2]);const S=n(y);c[w]=S[0],c[w+1]=S[1],d&&(c[w+2]=S[2])}}if(d){const l=Vy(c,0,1),y=Vy(c,0,2),w=Vy(c,1,2);if(!l&&!y&&!w)return[];l>y&&l>w||(y>w?(n||(c=c.slice()),VT(c,0,2,1)):(n||(c=c.slice()),VT(c,2,0,1)))}return X8(c,s,e)}class ij extends EV{constructor(e){const{fp64:n,IndexType:i=Uint32Array}=e;super({...e,attributes:{positions:{size:3,type:n?Float64Array:Float32Array},vertexValid:{type:Uint8ClampedArray,size:1},indices:{type:i,size:1}}})}get(e){const{attributes:n}=this;return e==="indices"?n.indices&&n.indices.subarray(0,this.vertexCount):n[e]}updateGeometry(e){super.updateGeometry(e);const n=this.buffers.indices;if(n)this.vertexCount=(n.value||n).length;else if(this.data&&!this.getGeometry)throw new Error("missing indices buffer")}normalizeGeometry(e){if(this.normalize){const n=tj(e,this.positionSize);return this.opts.resolution?WI(od(n),gm(n),{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0}):this.opts.wrapLongitude?I8(od(n),gm(n),{size:this.positionSize,maxLatitude:86,edgeTypes:!0}):n}return e}getGeometrySize(e){if(jT(e)){let n=0;for(const i of e)n+=this.getGeometrySize(i);return n}return od(e).length/this.positionSize}getGeometryFromBuffer(e){return this.normalize||!this.buffers.indices?super.getGeometryFromBuffer(e):null}updateGeometryAttributes(e,n){if(e&&jT(e))for(const i of e){const s=this.getGeometrySize(i);n.geometrySize=s,this.updateGeometryAttributes(i,n),n.vertexStart+=s,n.indexStart=this.indexStarts[n.geometryIndex+1]}else this._updateIndices(e,n),this._updatePositions(e,n),this._updateVertexValid(e,n)}_updateIndices(e,{geometryIndex:n,vertexStart:i,indexStart:s}){const{attributes:c,indexStarts:d,typedArrayManager:l}=this;let y=c.indices;if(!y||!e)return;let w=s;const S=nj(e,this.positionSize,this.opts.preproject,this.opts.full3d);y=l.allocate(y,s+S.length,{copy:!0});for(let C=0;C<S.length;C++)y[w++]=S[C]+i;d[n+1]=s+S.length,c.indices=y}_updatePositions(e,{vertexStart:n,geometrySize:i}){const{attributes:{positions:s},positionSize:c}=this;if(!s||!e)return;const d=od(e);for(let l=n,y=0;y<i;l++,y++){const w=d[y*c],S=d[y*c+1],C=c>2?d[y*c+2]:0;s[l*3]=w,s[l*3+1]=S,s[l*3+2]=C}}_updateVertexValid(e,{vertexStart:n,geometrySize:i}){const{positionSize:s}=this,c=this.attributes.vertexValid,d=e&&gm(e);if(e&&e.edgeTypes?c.set(e.edgeTypes,n):c.fill(1,n,n+i),d)for(let l=0;l<d.length;l++)c[n+d[l]/s-1]=0;c[n+i-1]=0}}function jT(t){return Array.isArray(t)&&t.length>0&&!Number.isFinite(t[0])}const ZI=`
attribute vec2 vertexPositions;
attribute float vertexValid;

uniform bool extruded;
uniform bool isWireframe;
uniform float elevationScale;
uniform float opacity;

varying vec4 vColor;

struct PolygonProps {
  vec4 fillColors;
  vec4 lineColors;
  vec3 positions;
  vec3 nextPositions;
  vec3 pickingColors;
  vec3 positions64Low;
  vec3 nextPositions64Low;
  float elevations;
};

vec3 project_offset_normal(vec3 vector) {
  if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {
    return normalize(vector * project_uCommonUnitsPerWorldUnit);
  }
  return project_normal(vector);
}

void calculatePosition(PolygonProps props) {
#ifdef IS_SIDE_VERTEX
  if(vertexValid < 0.5){
    gl_Position = vec4(0.);
    return;
  }
#endif

  vec3 pos;
  vec3 pos64Low;
  vec3 normal;
  vec4 colors = isWireframe ? props.lineColors : props.fillColors;

  geometry.worldPosition = props.positions;
  geometry.worldPositionAlt = props.nextPositions;
  geometry.pickingColor = props.pickingColors;

#ifdef IS_SIDE_VERTEX
  pos = mix(props.positions, props.nextPositions, vertexPositions.x);
  pos64Low = mix(props.positions64Low, props.nextPositions64Low, vertexPositions.x);
#else
  pos = props.positions;
  pos64Low = props.positions64Low;
#endif

  if (extruded) {
    pos.z += props.elevations * vertexPositions.y * elevationScale;
  }
  gl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);

  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  if (extruded) {
  #ifdef IS_SIDE_VERTEX
    normal = vec3(
      props.positions.y - props.nextPositions.y + (props.positions64Low.y - props.nextPositions64Low.y),
      props.nextPositions.x - props.positions.x + (props.nextPositions64Low.x - props.positions64Low.x),
      0.0);
    normal = project_offset_normal(normal);
  #else
    normal = project_normal(vec3(0.0, 0.0, 1.0));
  #endif
    geometry.normal = normal;
    vec3 lightColor = lighting_getLightColor(colors.rgb, project_uCameraPosition, geometry.position.xyz, normal);
    vColor = vec4(lightColor, colors.a * opacity);
  } else {
    vColor = vec4(colors.rgb, colors.a * opacity);
  }
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,rj=`#define SHADER_NAME solid-polygon-layer-vertex-shader

attribute vec3 positions;
attribute vec3 positions64Low;
attribute float elevations;
attribute vec4 fillColors;
attribute vec4 lineColors;
attribute vec3 pickingColors;

`.concat(ZI,`

void main(void) {
  PolygonProps props;

  props.positions = positions;
  props.positions64Low = positions64Low;
  props.elevations = elevations;
  props.fillColors = fillColors;
  props.lineColors = lineColors;
  props.pickingColors = pickingColors;

  calculatePosition(props);
}
`),sj=`#define SHADER_NAME solid-polygon-layer-vertex-shader-side
#define IS_SIDE_VERTEX


attribute vec3 instancePositions;
attribute vec3 nextPositions;
attribute vec3 instancePositions64Low;
attribute vec3 nextPositions64Low;
attribute float instanceElevations;
attribute vec4 instanceFillColors;
attribute vec4 instanceLineColors;
attribute vec3 instancePickingColors;

`.concat(ZI,`

void main(void) {
  PolygonProps props;

  #if RING_WINDING_ORDER_CW == 1
    props.positions = instancePositions;
    props.positions64Low = instancePositions64Low;
    props.nextPositions = nextPositions;
    props.nextPositions64Low = nextPositions64Low;
  #else
    props.positions = nextPositions;
    props.positions64Low = nextPositions64Low;
    props.nextPositions = instancePositions;
    props.nextPositions64Low = instancePositions64Low;
  #endif
  props.elevations = instanceElevations;
  props.fillColors = instanceFillColors;
  props.lineColors = instanceLineColors;
  props.pickingColors = instancePickingColors;

  calculatePosition(props);
}
`),oj=`#define SHADER_NAME solid-polygon-layer-fragment-shader

precision highp float;

varying vec4 vColor;

void main(void) {
  gl_FragColor = vColor;

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,ng=[0,0,0,255],aj={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",_full3d:!1,elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:t=>t.polygon},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:ng},getLineColor:{type:"accessor",value:ng},material:!0},$p={enter:(t,e)=>e.length?e.subarray(e.length-t.length):t};class Zx extends Wu{constructor(...e){super(...e),$(this,"state",void 0)}getShaders(e){return super.getShaders({vs:e==="top"?rj:sj,fs:oj,defines:{RING_WINDING_ORDER_CW:!this.props._normalize&&this.props._windingOrder==="CCW"?0:1},modules:[Nx,lB,lI]})}get wrapLongitude(){return!1}initializeState(){const{gl:e,viewport:n}=this.context;let{coordinateSystem:i}=this.props;const{_full3d:s}=this.props;n.isGeospatial&&i===Jt.DEFAULT&&(i=Jt.LNGLAT);let c;i===Jt.LNGLAT&&(s?c=n.projectPosition.bind(n):c=n.projectFlat.bind(n)),this.setState({numInstances:0,polygonTesselator:new ij({preproject:c,fp64:this.use64bitPositions(),IndexType:!e||Nd(e,gn.ELEMENT_INDEX_UINT32)?Uint32Array:Uint16Array})});const d=this.getAttributeManager(),l=!0;d.remove(["instancePickingColors"]),d.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:l},positions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:$p,accessor:"getPolygon",update:this.calculatePositions,noAlloc:l,shaderAttributes:{positions:{vertexOffset:0,divisor:0},instancePositions:{vertexOffset:0,divisor:1},nextPositions:{vertexOffset:1,divisor:1}}},vertexValid:{size:1,divisor:1,type:5121,update:this.calculateVertexValid,noAlloc:l},elevations:{size:1,transition:$p,accessor:"getElevation",shaderAttributes:{elevations:{divisor:0},instanceElevations:{divisor:1}}},fillColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:$p,accessor:"getFillColor",defaultValue:ng,shaderAttributes:{fillColors:{divisor:0},instanceFillColors:{divisor:1}}},lineColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:$p,accessor:"getLineColor",defaultValue:ng,shaderAttributes:{lineColors:{divisor:0},instanceLineColors:{divisor:1}}},pickingColors:{size:3,type:5121,accessor:(y,{index:w,target:S})=>this.encodePickingColor(y&&y.__source?y.__source.index:w,S),shaderAttributes:{pickingColors:{divisor:0},instancePickingColors:{divisor:1}}}})}getPickingInfo(e){const n=super.getPickingInfo(e),{index:i}=n,{data:s}=this.props;return s[0]&&s[0].__source&&(n.object=s.find(c=>c.__source.index===i)),n}disablePickingIndex(e){const{data:n}=this.props;if(n[0]&&n[0].__source)for(let i=0;i<n.length;i++)n[i].__source.index===e&&this._disablePickingIndex(i);else super.disablePickingIndex(e)}draw({uniforms:e}){const{extruded:n,filled:i,wireframe:s,elevationScale:c}=this.props,{topModel:d,sideModel:l,polygonTesselator:y}=this.state,w={...e,extruded:!!n,elevationScale:c};l&&(l.setInstanceCount(y.instanceCount-1),l.setUniforms(w),s&&(l.setDrawMode(3),l.setUniforms({isWireframe:!0}).draw()),i&&(l.setDrawMode(6),l.setUniforms({isWireframe:!1}).draw())),d&&(d.setVertexCount(y.vertexCount),d.setUniforms(w).draw())}updateState(e){super.updateState(e),this.updateGeometry(e);const{props:n,oldProps:i,changeFlags:s}=e,c=this.getAttributeManager();if(s.extensionsChanged||n.filled!==i.filled||n.extruded!==i.extruded){var l;(l=this.state.models)===null||l===void 0||l.forEach(y=>y.delete()),this.setState(this._getModels(this.context.gl)),c.invalidateAll()}}updateGeometry({props:e,oldProps:n,changeFlags:i}){if(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getPolygon)){const{polygonTesselator:c}=this.state,d=e.data.attributes||{};c.updateGeometry({data:e.data,normalize:e._normalize,geometryBuffer:d.getPolygon,buffers:d,getGeometry:e.getPolygon,positionFormat:e.positionFormat,wrapLongitude:e.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:i.dataChanged,full3d:e._full3d}),this.setState({numInstances:c.instanceCount,startIndices:c.vertexStarts}),i.dataChanged||this.getAttributeManager().invalidateAll()}}_getModels(e){const{id:n,filled:i,extruded:s}=this.props;let c,d;if(i){const l=this.getShaders("top");l.defines.NON_INSTANCED_MODEL=1,c=new Du(e,{...l,id:"".concat(n,"-top"),drawMode:4,attributes:{vertexPositions:new Float32Array([0,1])},uniforms:{isWireframe:!1,isSideVertex:!1},vertexCount:0,isIndexed:!0})}return s&&(d=new Du(e,{...this.getShaders("side"),id:"".concat(n,"-side"),geometry:new GP({drawMode:1,vertexCount:4,attributes:{vertexPositions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),instanceCount:0,isInstanced:1}),d.userData.excludeAttributes={indices:!0}),{models:[d,c].filter(Boolean),topModel:c,sideModel:d}}calculateIndices(e){const{polygonTesselator:n}=this.state;e.startIndices=n.indexStarts,e.value=n.get("indices")}calculatePositions(e){const{polygonTesselator:n}=this.state;e.startIndices=n.vertexStarts,e.value=n.get("positions")}calculateVertexValid(e){e.value=this.state.polygonTesselator.get("vertexValid")}}$(Zx,"defaultProps",aj);$(Zx,"layerName","SolidPolygonLayer");const Je=.5,pt=1/6,Ae={N:[0,Je],E:[Je,0],S:[0,-Je],W:[-Je,0],NE:[Je,Je],NW:[-Je,Je],SE:[Je,-Je],SW:[-Je,-Je]},Uc=[Ae.W,Ae.SW,Ae.S],Vc=[Ae.S,Ae.SE,Ae.E],jc=[Ae.E,Ae.NE,Ae.N],Gc=[Ae.NW,Ae.W,Ae.N],Wc=[[-Je,pt],[-Je,-pt],[-pt,-Je],[pt,-Je]],Hc=[[-pt,-Je],[pt,-Je],[Je,-pt],[Je,pt]],$c=[[Je,-pt],[Je,pt],[pt,Je],[-pt,Je]],qc=[[-Je,pt],[-Je,-pt],[pt,Je],[-pt,Je]],GT=[Ae.W,Ae.SW,Ae.SE,Ae.E],WT=[Ae.S,Ae.SE,Ae.NE,Ae.N],HT=[Ae.NW,Ae.W,Ae.E,Ae.NE],$T=[Ae.NW,Ae.SW,Ae.S,Ae.N],qT=[[-Je,pt],[-Je,-pt],[Je,-pt],[Je,pt]],ZT=[[-pt,-Je],[pt,-Je],[pt,Je],[-pt,Je]],lj=[Ae.NW,Ae.SW,Ae.SE,Ae.NE],XT=[Ae.NW,Ae.SW,Ae.SE,Ae.E,Ae.N],YT=[Ae.W,Ae.SW,Ae.SE,Ae.NE,Ae.N],KT=[Ae.NW,Ae.W,Ae.S,Ae.SE,Ae.NE],JT=[Ae.NW,Ae.SW,Ae.S,Ae.E,Ae.NE],QT=[Ae.NW,Ae.W,[Je,-pt],[Je,pt],Ae.N],e2=[[-pt,-Je],[pt,-Je],Ae.E,Ae.NE,Ae.N],t2=[[-Je,pt],[-Je,-pt],Ae.S,Ae.SE,Ae.E],n2=[Ae.W,Ae.SW,Ae.S,[pt,Je],[-pt,Je]],i2=[Ae.NW,Ae.W,[-pt,-Je],[pt,-Je],Ae.N],r2=[[-Je,pt],[-Je,-pt],Ae.E,Ae.NE,Ae.N],s2=[Ae.S,Ae.SE,Ae.E,[pt,Je],[-pt,Je]],o2=[Ae.W,Ae.SW,Ae.S,[Je,-pt],[Je,pt]],a2=[Ae.W,Ae.SW,Ae.SE,Ae.E,[pt,Je],[-pt,Je]],l2=[[-Je,pt],[-Je,-pt],Ae.S,Ae.SE,Ae.NE,Ae.N],c2=[Ae.NW,Ae.W,[-pt,-Je],[pt,-Je],Ae.E,Ae.NE],u2=[Ae.NW,Ae.SW,Ae.S,[Je,-pt],[Je,pt],Ae.N],Zc=[Ae.W,Ae.SW,Ae.S,Ae.E,Ae.NE,Ae.N],Xc=[Ae.NW,Ae.W,Ae.S,Ae.SE,Ae.E,Ae.N],qp=[[-Je,pt],[-Je,-pt],[-pt,-Je],[pt,-Je],Ae.E,Ae.NE,Ae.N],Zp=[Ae.W,Ae.SW,Ae.S,[Je,-pt],[Je,pt],[pt,Je],[-pt,Je]],Xp=[Ae.NW,Ae.W,[-pt,-Je],[pt,-Je],[Je,-pt],[Je,pt],Ae.N],Yp=[[-Je,pt],[-Je,-pt],Ae.S,Ae.SE,Ae.E,[pt,Je],[-pt,Je]],h2=[[-Je,pt],[-Je,-pt],[-pt,-Je],[pt,-Je],[Je,-pt],[Je,pt],[pt,Je],[-pt,Je]],cj={0:[],1:[[Ae.W,Ae.S]],2:[[Ae.S,Ae.E]],3:[[Ae.W,Ae.E]],4:[[Ae.N,Ae.E]],5:{0:[[Ae.W,Ae.S],[Ae.N,Ae.E]],1:[[Ae.W,Ae.N],[Ae.S,Ae.E]]},6:[[Ae.N,Ae.S]],7:[[Ae.W,Ae.N]],8:[[Ae.W,Ae.N]],9:[[Ae.N,Ae.S]],10:{0:[[Ae.W,Ae.N],[Ae.S,Ae.E]],1:[[Ae.W,Ae.S],[Ae.N,Ae.E]]},11:[[Ae.N,Ae.E]],12:[[Ae.W,Ae.E]],13:[[Ae.S,Ae.E]],14:[[Ae.W,Ae.S]],15:[]};function it(t){return parseInt(t,4)}const uj={[it("0000")]:[],[it("2222")]:[],[it("2221")]:[Uc],[it("2212")]:[Vc],[it("2122")]:[jc],[it("1222")]:[Gc],[it("0001")]:[Uc],[it("0010")]:[Vc],[it("0100")]:[jc],[it("1000")]:[Gc],[it("2220")]:[Wc],[it("2202")]:[Hc],[it("2022")]:[$c],[it("0222")]:[qc],[it("0002")]:[Wc],[it("0020")]:[Hc],[it("0200")]:[$c],[it("2000")]:[qc],[it("0011")]:[GT],[it("0110")]:[WT],[it("1100")]:[HT],[it("1001")]:[$T],[it("2211")]:[GT],[it("2112")]:[WT],[it("1122")]:[HT],[it("1221")]:[$T],[it("2200")]:[qT],[it("2002")]:[ZT],[it("0022")]:[qT],[it("0220")]:[ZT],[it("1111")]:[lj],[it("1211")]:[XT],[it("2111")]:[YT],[it("1112")]:[KT],[it("1121")]:[JT],[it("1011")]:[XT],[it("0111")]:[YT],[it("1110")]:[KT],[it("1101")]:[JT],[it("1200")]:[QT],[it("0120")]:[e2],[it("0012")]:[t2],[it("2001")]:[n2],[it("1022")]:[QT],[it("2102")]:[e2],[it("2210")]:[t2],[it("0221")]:[n2],[it("1002")]:[i2],[it("2100")]:[r2],[it("0210")]:[s2],[it("0021")]:[o2],[it("1220")]:[i2],[it("0122")]:[r2],[it("2012")]:[s2],[it("2201")]:[o2],[it("0211")]:[a2],[it("2110")]:[l2],[it("1102")]:[c2],[it("1021")]:[u2],[it("2011")]:[a2],[it("0112")]:[l2],[it("1120")]:[c2],[it("1201")]:[u2],[it("2101")]:[Zc],[it("0121")]:[Zc],[it("1012")]:[Xc],[it("1210")]:[Xc],[it("0101")]:{0:[Uc,jc],1:[Zc],2:[Zc]},[it("1010")]:{0:[Gc,Vc],1:[Xc],2:[Xc]},[it("2121")]:{0:[Zc],1:[Zc],2:[Uc,jc]},[it("1212")]:{0:[Xc],1:[Xc],2:[Gc,Vc]},[it("2120")]:{0:[qp],1:[qp],2:[Wc,jc]},[it("2021")]:{0:[Zp],1:[Zp],2:[Uc,$c]},[it("1202")]:{0:[Xp],1:[Xp],2:[Gc,Hc]},[it("0212")]:{0:[Yp],1:[Yp],2:[Vc,qc]},[it("0102")]:{0:[Wc,jc],1:[qp],2:[qp]},[it("0201")]:{0:[Uc,$c],1:[Zp],2:[Zp]},[it("1020")]:{0:[Gc,Hc],1:[Xp],2:[Xp]},[it("2010")]:{0:[Vc,qc],1:[Yp],2:[Yp]},[it("2020")]:{0:[qc,Hc],1:[h2],2:[Wc,$c]},[it("0202")]:{0:[$c,Wc],1:[h2],2:[qc,Hc]}},xu={ISO_LINES:1,ISO_BANDS:2},hj={zIndex:0,zOffset:.005};function Jh(t,e){return Array.isArray(e)?t<e[0]?0:t<e[1]?1:2:t>=e?1:0}function dj(t){const{cellWeights:e,x:n,y:i,width:s,height:c}=t;let d=t.threshold;t.thresholdValue&&(fn.deprecated("thresholdValue","threshold")(),d=t.thresholdValue);const l=n<0,y=n>=s-1,w=i<0,S=i>=c-1,C=l||y||w||S,P={},D={};l||S?D.top=0:(P.top=e[(i+1)*s+n],D.top=Jh(P.top,d)),y||S?D.topRight=0:(P.topRight=e[(i+1)*s+n+1],D.topRight=Jh(P.topRight,d)),y||w?D.right=0:(P.right=e[i*s+n+1],D.right=Jh(P.right,d)),l||w?D.current=0:(P.current=e[i*s+n],D.current=Jh(P.current,d));const{top:U,topRight:H,right:ae,current:G}=D;let V=-1;Number.isFinite(d)&&(V=U<<3|H<<2|ae<<1|G),Array.isArray(d)&&(V=U<<6|H<<4|ae<<2|G);let W=0;return C||(W=Jh((P.top+P.topRight+P.right+P.current)/4,d)),{code:V,meanCode:W}}function d2(t){const{gridOrigin:e,cellSize:n,x:i,y:s,code:c,meanCode:d,type:l=xu.ISO_LINES}=t,y={...hj,...t.thresholdData};let w=l===xu.ISO_BANDS?uj[c]:cj[c];Array.isArray(w)||(w=w[d]);const S=y.zIndex*y.zOffset,C=(i+1)*n[0],P=(s+1)*n[1],D=e[0]+C,U=e[1]+P;if(l===xu.ISO_BANDS){const ae=[];return w.forEach(G=>{const V=[];G.forEach(W=>{const ie=D+W[0]*n[0],ge=U+W[1]*n[1];V.push([ie,ge,S])}),ae.push(V)}),ae}const H=[];return w.forEach(ae=>{ae.forEach(G=>{const V=D+G[0]*n[0],W=U+G[1]*n[1];H.push([V,W,S])})}),H}function fj({thresholdData:t,cellWeights:e,gridSize:n,gridOrigin:i,cellSize:s}){const c=[],d=[],l=n[0],y=n[1];let w=0,S=0;for(const C of t){const{contour:P}=C,{threshold:D}=P;for(let U=-1;U<l;U++)for(let H=-1;H<y;H++){const{code:ae,meanCode:G}=dj({cellWeights:e,threshold:D,x:U,y:H,width:l,height:y}),V={type:xu.ISO_BANDS,gridOrigin:i,cellSize:s,x:U,y:H,width:l,height:y,code:ae,meanCode:G,thresholdData:C};if(Array.isArray(D)){V.type=xu.ISO_BANDS;const W=d2(V);for(const ie of W)d[S++]={vertices:ie,contour:P}}else{V.type=xu.ISO_LINES;const W=d2(V);for(let ie=0;ie<W.length;ie+=2)c[w++]={start:W[ie],end:W[ie+1],contour:P}}}}return{contourSegments:c,contourPolygons:d}}const f2=[255,255,255,255],pj=1,mj=1,gj={cellSize:{type:"number",min:1,max:1e3,value:1e3},getPosition:{type:"accessor",value:t=>t.position},getWeight:{type:"accessor",value:1},gpuAggregation:!0,aggregation:"SUM",contours:{type:"object",value:[{threshold:mj}],optional:!0,compare:3},zOffset:.005},p2="positions",_j={data:{props:["cellSize"]},weights:{props:["aggregation"],accessors:["getWeight"]}};class Xx extends VI{initializeState(){super.initializeAggregationLayer({dimensions:_j}),this.setState({contourData:{},projectPoints:!1,weights:{count:{size:1,operation:or.SUM}}}),this.getAttributeManager().add({[p2]:{size:3,accessor:"getPosition",type:5130,fp64:this.use64bitPositions()},count:{size:3,accessor:"getWeight"}})}updateState(e){super.updateState(e);let n=!1;const{oldProps:i,props:s}=e,{aggregationDirty:c}=this.state;(i.contours!==s.contours||i.zOffset!==s.zOffset)&&(n=!0,this._updateThresholdData(e.props)),this.getNumInstances()>0&&(c||n)&&this._generateContours()}renderLayers(){const{contourSegments:e,contourPolygons:n}=this.state.contourData,i=this.getSubLayerClass("lines",$x),s=this.getSubLayerClass("bands",Zx),c=e&&e.length>0&&new i(this.getSubLayerProps({id:"lines"}),{data:this.state.contourData.contourSegments,getSourcePosition:l=>l.start,getTargetPosition:l=>l.end,getColor:l=>l.contour.color||f2,getWidth:l=>l.contour.strokeWidth||pj}),d=n&&n.length>0&&new s(this.getSubLayerProps({id:"bands"}),{data:this.state.contourData.contourPolygons,getPolygon:l=>l.vertices,getFillColor:l=>l.contour.color||f2});return[c,d]}updateAggregationState(e){const{props:n,oldProps:i}=e,{cellSize:s,coordinateSystem:c}=n,{viewport:d}=this.context,l=i.cellSize!==s;let y=n.gpuAggregation;this.state.gpuAggregation!==n.gpuAggregation&&y&&!fv.isSupported(this.context.gl)&&(fn.warn("GPU Grid Aggregation not supported, falling back to CPU")(),y=!1);const w=y!==this.state.gpuAggregation;this.setState({gpuAggregation:y});const{dimensions:S}=this.state,C=this.isAttributeChanged(p2),{data:P,weights:D}=S;let{boundingBox:U}=this.state;if(C&&(U=r8(this.getAttributes(),this.getNumInstances()),this.setState({boundingBox:U})),C||l){const{gridOffset:G,translation:V,width:W,height:ie,numCol:ge,numRow:be}=o8(U,s,d,c);this.allocateResources(be,ge),this.setState({gridOffset:G,boundingBox:U,translation:V,posOffset:V.slice(),gridOrigin:[-1*V[0],-1*V[1]],width:W,height:ie,numCol:ge,numRow:be})}const H=C||w||this.isAggregationDirty(e,{dimension:P,compareAll:y}),ae=this.isAggregationDirty(e,{dimension:D});ae&&this._updateAccessors(e),(H||ae)&&this._resetResults(),this.setState({aggregationDataDirty:H,aggregationWeightsDirty:ae})}_updateAccessors(e){const{getWeight:n,aggregation:i,data:s}=e.props,{count:c}=this.state.weights;c&&(c.getWeight=n,c.operation=or[i]),this.setState({getValue:MV(i,n,{data:s})})}_resetResults(){const{count:e}=this.state.weights;e&&(e.aggregationData=null)}_generateContours(){const{numCol:e,numRow:n,gridOrigin:i,gridOffset:s,thresholdData:c}=this.state,{count:d}=this.state.weights;let{aggregationData:l}=d;l||(l=d.aggregationBuffer.getData(),d.aggregationData=l);const{cellWeights:y}=fv.getCellData({countsData:l}),w=fj({thresholdData:c,cellWeights:y,gridSize:[e,n],gridOrigin:i,cellSize:[s.xOffset,s.yOffset]});this.setState({contourData:w})}_updateThresholdData(e){const{contours:n,zOffset:i}=e,s=n.length,c=new Array(s);for(let d=0;d<s;d++){const l=n[d];c[d]={contour:l,zIndex:l.zIndex||d,zOffset:i}}this.setState({thresholdData:c})}}$(Xx,"layerName","ContourLayer");$(Xx,"defaultProps",gj);const yj=typeof window<"u"?at.useLayoutEffect:at.useEffect,vj=yj;function ig(t,e){for(;t;){if(t===e)return!0;t=Object.getPrototypeOf(t)}return!1}const xj={position:"absolute",zIndex:-1};function XI(t,e){if(typeof t=="function")return t(e);if(Array.isArray(t))return t.map(n=>XI(n,e));if(Lg(t)){if(bj(t))return e.style=xj,at.cloneElement(t,e);if(wj(t))return at.cloneElement(t,e)}return t}function Lg(t){return t&&typeof t=="object"&&"type"in t||!1}function bj(t){var e;return(e=t.props)===null||e===void 0?void 0:e.mapStyle}function wj(t){const e=t.type;return e&&e.deckGLViewProps}function yv(t){if(typeof t=="function")return at.createElement(Bu,{},t);if(Array.isArray(t))return t.map(yv);if(Lg(t)){if(t.type===at.Fragment)return yv(t.props.children);if(ig(t.type,Bu))return t}return t}function Ej({children:t,layers:e=[],views:n=null}){const i=[],s=[],c={};return at.Children.forEach(yv(t),d=>{if(Lg(d)){const l=d.type;if(ig(l,Wu)){const y=Tj(l,d.props);s.push(y)}else i.push(d);if(ig(l,Bu)&&l!==Bu&&d.props.id){const y=new l(d.props);c[y.id]=y}}else d&&i.push(d)}),Object.keys(c).length>0&&(Array.isArray(n)?n.forEach(d=>{c[d.id]=d}):n&&(c[n.id]=n),n=Object.values(c)),e=s.length>0?[...s,...e]:e,{layers:e,children:i,views:n}}function Tj(t,e){const n={},i=t.defaultProps||{};for(const s in e)i[s]!==e[s]&&(n[s]=e[s]);return new t(n)}function Sj({children:t,deck:e,ContextProvider:n}){const{viewManager:i}=e||{};if(!i||!i.views.length)return[];const s={},c=i.views[0].id;for(const d of t){let l=c,y=d;Lg(d)&&ig(d.type,Bu)&&(l=d.props.id||c,y=d.props.children);const w=i.getViewport(l),S=i.getViewState(l);if(w){S.padding=w.padding;const{x:C,y:P,width:D,height:U}=w;y=XI(y,{x:C,y:P,width:D,height:U,viewport:w,viewState:S}),s[l]||(s[l]={viewport:w,children:[]}),s[l].children.push(y)}}return Object.keys(s).map(d=>{const{viewport:l,children:y}=s[d],{x:w,y:S,width:C,height:P}=l,D={position:"absolute",left:w,top:S,width:C,height:P},U="view-".concat(d),H=at.createElement("div",{key:U,id:U,style:D},...y);if(n){const ae={viewport:l,container:e.canvas.offsetParent,eventManager:e.eventManager,onViewStateChange:G=>{G.viewId=d,e._onViewStateChange(G)}};return at.createElement(n,{key:U,value:ae},H)}return H})}const Aj={mixBlendMode:null};function Pj({width:t,height:e,style:n}){const i={position:"absolute",zIndex:0,left:0,top:0,width:t,height:e},s={left:0,top:0};if(n)for(const c in n)c in Aj?s[c]=n[c]:i[c]=n[c];return{containerStyle:i,canvasStyle:s}}function Ij(t){return{get deck(){return t.deck},pickObject:e=>t.deck.pickObject(e),pickMultipleObjects:e=>t.deck.pickMultipleObjects(e),pickObjects:e=>t.deck.pickObjects(e)}}function YI(t){t.redrawReason&&(t.deck._drawLayers(t.redrawReason),t.redrawReason=null)}function Cj(t,e,n){const i=new e({...n,_customRender:s=>{t.redrawReason=s;const c=i.getViewports();t.lastRenderedViewports!==c?t.forceUpdate():YI(t)}});return i}const KI=at.forwardRef((t,e)=>{const[n,i]=at.useState(0),c=at.useRef({control:null,version:n,forceUpdate:()=>i(ge=>ge+1)}).current,d=at.useRef(null),l=at.useRef(null),y=at.useMemo(()=>Ej(t),[t.layers,t.views,t.children]);let w=!0;const S=ge=>{var be;return w&&t.viewState?(c.viewStateUpdateRequested=ge,null):(c.viewStateUpdateRequested=null,(be=t.onViewStateChange)===null||be===void 0?void 0:be.call(t,ge))},C=ge=>{if(w)c.interactionStateUpdateRequested=ge;else{var be;c.interactionStateUpdateRequested=null,(be=t.onInteractionStateChange)===null||be===void 0||be.call(t,ge)}},P=at.useMemo(()=>{const ge={...t,style:null,width:"100%",height:"100%",parent:d.current,canvas:l.current,layers:y.layers,views:y.views,onViewStateChange:S,onInteractionStateChange:C};return delete ge._customRender,c.deck&&c.deck.setProps(ge),ge},[t]);at.useEffect(()=>{const ge=t.Deck||Ig;return c.deck=Cj(c,ge,{...P,parent:d.current,canvas:l.current}),()=>{var be;return(be=c.deck)===null||be===void 0?void 0:be.finalize()}},[]),vj(()=>{YI(c);const{viewStateUpdateRequested:ge,interactionStateUpdateRequested:be}=c;ge&&S(ge),be&&C(be)}),at.useImperativeHandle(e,()=>Ij(c),[]);const D=c.deck&&c.deck.isInitialized?c.deck.getViewports():void 0,{ContextProvider:U,width:H,height:ae,id:G,style:V}=t,{containerStyle:W,canvasStyle:ie}=at.useMemo(()=>Pj({width:H,height:ae,style:V}),[H,ae,V]);if(!c.viewStateUpdateRequested&&c.lastRenderedViewports===D||c.version!==n){c.lastRenderedViewports=D,c.version=n;const ge=Sj({children:y.children,deck:c.deck,ContextProvider:U}),be=at.createElement("canvas",{key:"canvas",id:G||"deckgl-overlay",ref:l,style:ie});c.control=at.createElement("div",{id:"".concat(G||"deckgl","-wrapper"),ref:d,style:W},[be,ge])}return w=!1,c.control});KI.defaultProps=Ig.defaultProps;const Mj=KI;var bs="$";function rg(){}rg.prototype=Yx.prototype={constructor:rg,has:function(t){return bs+t in this},get:function(t){return this[bs+t]},set:function(t,e){return this[bs+t]=e,this},remove:function(t){var e=bs+t;return e in this&&delete this[e]},clear:function(){for(var t in this)t[0]===bs&&delete this[t]},keys:function(){var t=[];for(var e in this)e[0]===bs&&t.push(e.slice(1));return t},values:function(){var t=[];for(var e in this)e[0]===bs&&t.push(this[e]);return t},entries:function(){var t=[];for(var e in this)e[0]===bs&&t.push({key:e.slice(1),value:this[e]});return t},size:function(){var t=0;for(var e in this)e[0]===bs&&++t;return t},empty:function(){for(var t in this)if(t[0]===bs)return!1;return!0},each:function(t){for(var e in this)e[0]===bs&&t(this[e],e.slice(1),this)}};function Yx(t,e){var n=new rg;if(t instanceof rg)t.each(function(l,y){n.set(y,l)});else if(Array.isArray(t)){var i=-1,s=t.length,c;if(e==null)for(;++i<s;)n.set(i,t[i]);else for(;++i<s;)n.set(e(c=t[i],i,t),c)}else if(t)for(var d in t)n.set(d,t[d]);return n}function m2(){}var Ll=Yx.prototype;m2.prototype={constructor:m2,has:Ll.has,add:function(t){return t+="",this[bs+t]=t,this},remove:Ll.remove,clear:Ll.clear,values:Ll.keys,size:Ll.size,empty:Ll.empty,each:Ll.each};var Lj={value:function(){}};function JI(){for(var t=0,e=arguments.length,n={},i;t<e;++t){if(!(i=arguments[t]+"")||i in n||/[\s.]/.test(i))throw new Error("illegal type: "+i);n[i]=[]}return new _m(n)}function _m(t){this._=t}function kj(t,e){return t.trim().split(/^|\s+/).map(function(n){var i="",s=n.indexOf(".");if(s>=0&&(i=n.slice(s+1),n=n.slice(0,s)),n&&!e.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:i}})}_m.prototype=JI.prototype={constructor:_m,on:function(t,e){var n=this._,i=kj(t+"",n),s,c=-1,d=i.length;if(arguments.length<2){for(;++c<d;)if((s=(t=i[c]).type)&&(s=Rj(n[s],t.name)))return s;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++c<d;)if(s=(t=i[c]).type)n[s]=g2(n[s],t.name,e);else if(e==null)for(s in n)n[s]=g2(n[s],t.name,null);return this},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new _m(t)},call:function(t,e){if((s=arguments.length-2)>0)for(var n=new Array(s),i=0,s,c;i<s;++i)n[i]=arguments[i+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(c=this._[t],i=0,s=c.length;i<s;++i)c[i].value.apply(e,n)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var i=this._[t],s=0,c=i.length;s<c;++s)i[s].value.apply(e,n)}};function Rj(t,e){for(var n=0,i=t.length,s;n<i;++n)if((s=t[n]).name===e)return s.value}function g2(t,e,n){for(var i=0,s=t.length;i<s;++i)if(t[i].name===e){t[i]=Lj,t=t.slice(0,i).concat(t.slice(i+1));break}return n!=null&&t.push({name:e,value:n}),t}function Dj(t,e){var n,i=JI("beforesend","progress","load","error"),s,c=Yx(),d=new XMLHttpRequest,l=null,y=null,w,S,C=0;typeof XDomainRequest<"u"&&!("withCredentials"in d)&&/^(http(s)?:)?\/\//.test(t)&&(d=new XDomainRequest),"onload"in d?d.onload=d.onerror=d.ontimeout=P:d.onreadystatechange=function(D){d.readyState>3&&P(D)};function P(D){var U=d.status,H;if(!U&&Oj(d)||U>=200&&U<300||U===304){if(w)try{H=w.call(n,d)}catch(ae){i.call("error",n,ae);return}else H=d;i.call("load",n,H)}else i.call("error",n,D)}if(d.onprogress=function(D){i.call("progress",n,D)},n={header:function(D,U){return D=(D+"").toLowerCase(),arguments.length<2?c.get(D):(U==null?c.remove(D):c.set(D,U+""),n)},mimeType:function(D){return arguments.length?(s=D==null?null:D+"",n):s},responseType:function(D){return arguments.length?(S=D,n):S},timeout:function(D){return arguments.length?(C=+D,n):C},user:function(D){return arguments.length<1?l:(l=D==null?null:D+"",n)},password:function(D){return arguments.length<1?y:(y=D==null?null:D+"",n)},response:function(D){return w=D,n},get:function(D,U){return n.send("GET",D,U)},post:function(D,U){return n.send("POST",D,U)},send:function(D,U,H){return d.open(D,t,!0,l,y),s!=null&&!c.has("accept")&&c.set("accept",s+",*/*"),d.setRequestHeader&&c.each(function(ae,G){d.setRequestHeader(G,ae)}),s!=null&&d.overrideMimeType&&d.overrideMimeType(s),S!=null&&(d.responseType=S),C>0&&(d.timeout=C),H==null&&typeof U=="function"&&(H=U,U=null),H!=null&&H.length===1&&(H=zj(H)),H!=null&&n.on("error",H).on("load",function(ae){H(null,ae)}),i.call("beforesend",n,d),d.send(U??null),n},abort:function(){return d.abort(),n},on:function(){var D=i.on.apply(i,arguments);return D===i?n:D}},e!=null){if(typeof e!="function")throw new Error("invalid callback: "+e);return n.get(e)}return n}function zj(t){return function(e,n){t(e==null?n:null)}}function Oj(t){var e=t.responseType;return e&&e!=="text"?t.response:t.responseText}var _2={},jy={},Gy=34,Qh=10,Wy=13;function QI(t){return new Function("d","return {"+t.map(function(e,n){return JSON.stringify(e)+": d["+n+'] || ""'}).join(",")+"}")}function Fj(t,e){var n=QI(t);return function(i,s){return e(n(i),s,t)}}function y2(t){var e=Object.create(null),n=[];return t.forEach(function(i){for(var s in i)s in e||n.push(e[s]=s)}),n}function kr(t,e){var n=t+"",i=n.length;return i<e?new Array(e-i+1).join(0)+n:n}function Nj(t){return t<0?"-"+kr(-t,6):t>9999?"+"+kr(t,6):kr(t,4)}function Bj(t){var e=t.getUTCHours(),n=t.getUTCMinutes(),i=t.getUTCSeconds(),s=t.getUTCMilliseconds();return isNaN(t)?"Invalid Date":Nj(t.getUTCFullYear())+"-"+kr(t.getUTCMonth()+1,2)+"-"+kr(t.getUTCDate(),2)+(s?"T"+kr(e,2)+":"+kr(n,2)+":"+kr(i,2)+"."+kr(s,3)+"Z":i?"T"+kr(e,2)+":"+kr(n,2)+":"+kr(i,2)+"Z":n||e?"T"+kr(e,2)+":"+kr(n,2)+"Z":"")}function Uj(t){var e=new RegExp('["'+t+`
\r]`),n=t.charCodeAt(0);function i(C,P){var D,U,H=s(C,function(ae,G){if(D)return D(ae,G-1);U=ae,D=P?Fj(ae,P):QI(ae)});return H.columns=U||[],H}function s(C,P){var D=[],U=C.length,H=0,ae=0,G,V=U<=0,W=!1;C.charCodeAt(U-1)===Qh&&--U,C.charCodeAt(U-1)===Wy&&--U;function ie(){if(V)return jy;if(W)return W=!1,_2;var be,De=H,Ne;if(C.charCodeAt(De)===Gy){for(;H++<U&&C.charCodeAt(H)!==Gy||C.charCodeAt(++H)===Gy;);return(be=H)>=U?V=!0:(Ne=C.charCodeAt(H++))===Qh?W=!0:Ne===Wy&&(W=!0,C.charCodeAt(H)===Qh&&++H),C.slice(De+1,be-1).replace(/""/g,'"')}for(;H<U;){if((Ne=C.charCodeAt(be=H++))===Qh)W=!0;else if(Ne===Wy)W=!0,C.charCodeAt(H)===Qh&&++H;else if(Ne!==n)continue;return C.slice(De,be)}return V=!0,C.slice(De,U)}for(;(G=ie())!==jy;){for(var ge=[];G!==_2&&G!==jy;)ge.push(G),G=ie();P&&(ge=P(ge,ae++))==null||D.push(ge)}return D}function c(C,P){return C.map(function(D){return P.map(function(U){return S(D[U])}).join(t)})}function d(C,P){return P==null&&(P=y2(C)),[P.map(S).join(t)].concat(c(C,P)).join(`
`)}function l(C,P){return P==null&&(P=y2(C)),c(C,P).join(`
`)}function y(C){return C.map(w).join(`
`)}function w(C){return C.map(S).join(t)}function S(C){return C==null?"":C instanceof Date?Bj(C):e.test(C+="")?'"'+C.replace(/"/g,'""')+'"':C}return{parse:i,parseRows:s,format:d,formatBody:l,formatRows:y,formatRow:w,formatValue:S}}var Vj=Uj(","),jj=Vj.parse;function Gj(t,e){return function(n,i,s){arguments.length<3&&(s=i,i=null);var c=Dj(n).mimeType(t);return c.row=function(d){return arguments.length?c.response(Wj(e,i=d)):i},c.row(i),s?c.get(s):c}}function Wj(t,e){return function(n){return t(n.responseText,e)}}const Hj=Gj("text/csv",jj),$j="./merged-data.csv",qj=[{threshold:[.001,.01],color:[17,17,207]},{threshold:[.01,.015],color:[76,121,176]},{threshold:[.015,.02],color:[190,169,199]},{threshold:[.02,.025],color:[208,168,224]},{threshold:[.025,.03],color:[213,100,138]},{threshold:[.03,1],color:[214,2,52]}];function v2({data:t,contours:e=qj,cellSize:n=3e4,mapStyle:i="https://basemaps.cartocdn.com/gl/dark-matter-nolabels-gl-style/style.json"}){const[s,c]=at.useState(0),[d,l]=at.useState("Climate Migrations in the US: 2070"),[y,w]=at.useState("Countries across the world are poised to have to deal with population shifts due to climate change - which will lead to massive increases in internal migration. To be ready for this, the U.S. needs to define climate refugees and have the housing and economic infrastructure ready to accommodate them. Government officials need to recognize that not just land, but people will be affected - and be ready with laws and systems to handle what is at the core of the climate crisis."),[S,C]=at.useState({longitude:-96,latitude:40,zoom:3.5,maxZoom:10,transitionDuration:8e3}),P=[new Xx({data:t,id:"contour-layer",getPosition:G=>[G[0],G[1]],getWeight:G=>G[2],pickable:!0,aggregation:"MAX",contours:e,cellSize:n})],D={longitude:-74.1,latitude:40.7,zoom:5,pitch:0,bearing:0,transitionDuration:4e3,transitionInterpolator:new By},U={longitude:-79.1,latitude:31.7,zoom:5,pitch:0,bearing:0,transitionDuration:4e3,transitionInterpolator:new By},H={longitude:-94,latitude:40,zoom:4.55,pitch:0,bearing:0,transitionDuration:4e3,transitionInterpolator:new By};function ae(){s==0&&(C(D),l("Northeast Corridor"),w("The Northeast Corridor is the economic and political powerhouse of America, and it is no coincidence that it is buit along rivers and the Atlantic Ocean. Although not predicted to be drastically affected, researchers do believe that there will be a roughly ~5% increase in out-migration that would not have occured without climate change.")),s==1&&(C(U),l("Louisiana, Florida & The Southeast"),w("Louisiana, Florida and strips of land along Georgia, South Carolina and North Carolina are by far at the most risk of sea level rise. These areas already frequently see tropical storms as well, and issues with housing will only get worse as climate change continues on. Many of these areas are flat wetlands or beaches, which makes the threat of sea level rise very severe. Research predicts that there would be upwards of a 25% increase in out-migration from these areas.")),s==2&&(C(H),l("Midwest"),w("With the increase of internal migrants, there will be demand for cheap, available and climate safe housing for displaced people. And the midwestern states of Ohio, Kentucky, Indiana and Illinois come into play to meet this demand. Although they face the threat of farmland degredation, their housing and ability to take in internal migrants is quite strong. Researchers predict and increase of up to a 13% in in-migration to these states. So the next hip big city for climate-minded Gen Alphas might just be a post-industrial midwestern town in Ohio.")),c(s+1)}return Tn.createElement("div",null,Tn.createElement("div",{style:{width:"70%"}},Tn.createElement("div",{className:"overlay"},Tn.createElement("h3",null,"Projected Climate Migration"),Tn.createElement("p",null,"Proportional change in migrants due to climate change. Darker values = more emmigration"),Tn.createElement("div",{className:"colorBars"},Tn.createElement("div",{style:{background:"rgb(17, 17, 207)"}}),Tn.createElement("div",{style:{background:"rgb(76, 121, 176)"}}),Tn.createElement("div",{style:{background:"rgb(190, 169, 199)"}}),Tn.createElement("div",{style:{background:"rgb(208, 168, 224)"}}),Tn.createElement("div",{style:{background:"rgb(213, 100, 138)"}}),Tn.createElement("div",{style:{background:"rgb(214, 2, 52)"}})),Tn.createElement("div",{className:"labels"},Tn.createElement("div",null,"Increase in incoming"),Tn.createElement("div",null),Tn.createElement("div",null),Tn.createElement("div",null),Tn.createElement("div",null),Tn.createElement("div",null),Tn.createElement("div",null,"Increase in leaving"))),Tn.createElement(Mj,{layers:P,controller:!0,initialViewState:S},Tn.createElement(D3,{reuseMaps:!0,mapLib:O3,mapStyle:i,preventStyleDiffing:!0}))),Tn.createElement("div",{className:"article"},Tn.createElement("h2",null,d),Tn.createElement("p",null,y),Tn.createElement("button",{onClick:ae},">")))}function Zj(t){const e=LA(t);e.render(Tn.createElement(v2,null)),Hj($j,(n,i)=>{if(n)n&&console.log("Error loading CSV");else{const s=i.map(y=>[Number(y.lng),Number(y.lat),Number(y.migdifprop),y.County]),c=Math.min(...s.map(y=>y[2]));console.log(c);const d=Math.abs(c),l=s.map(y=>[y[0],y[1],y[2]+d]);console.log(l),e.render(Tn.createElement(v2,{data:l}))}})}Zj(document.getElementById("app"));
